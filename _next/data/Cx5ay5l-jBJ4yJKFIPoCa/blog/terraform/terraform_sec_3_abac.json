{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=p(s,n))||c.enumerable});return a},y=a=>g(i(l(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((T,o)=>{o.exports=_jsx_runtime});var v={};k(v,{default:()=>f,frontmatter:()=>b});var e=y(r()),b={title:\"ABAC and RBAC: A Journey with Terraform and AWS Tagged Resources\",date:\"2023-05-16\",tags:[\"Terraform\",\"Cloud\",\"AWS\"],draft:!1,summary:\"Exploring the nuances of Attribute-based Access Control (ABAC) and Role-based Access Control (RBAC) in cloud security using Terraform, and understanding their strategic implementation in managing AWS tagged resources.\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",ul:\"ul\",li:\"li\",strong:\"strong\",code:\"code\",h2:\"h2\",a:\"a\",span:\"span\",pre:\"pre\"},a.components),{Image:t}=n;return t||_(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"Alright, let's talk about granting permissions in your cloud kingdom. If you just give everyone the master key, you're going to have a bad time. So, we need a system. For decades, we've had two main schools of thought on this, kind of like two competing martial arts dojos: the Way of the Role (RBAC) and the Way of the Attribute (ABAC).\"}),(0,e.jsx)(n.p,{children:\"So what's the difference? Let's go back to our trusty cloud castle analogy.\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"RBAC (Role-Based Access Control)\"}),`: This is the classic, straightforward approach. You get permissions based on your job title. We create a \"Guard\" role, and all guards get a key that opens the armory. We create a \"Chef\" role, and all chefs get a key to the pantry. It's simple, predictable, and easy to explain.`]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"ABAC (Attribute-Based Access Control)\"}),`: This is the fancy, modern, some might say magical approach. Permissions are based on attributes (or \"tags\" in AWS). It\\u2019s like a smart-lock system. The rule isn't \"Only Chefs can open the pantry.\" It's \"The pantry door will only open for a person whose ID card has the `,(0,e.jsx)(n.code,{children:\"Department=Kitchen\"}),` attribute, and only if the time is between 6 AM and 8 PM, and only if they are wearing the official Chef's Hat.\" It's way more flexible and powerful.`]})})]}),(0,e.jsx)(n.p,{children:\"Let's see how these two styles play out in the real world with AWS and Terraform.\"}),(0,e.jsxs)(n.h2,{id:\"the-rbac-way-simple-and-structured\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#the-rbac-way-simple-and-structured\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The RBAC Way: Simple and Structured\"]}),(0,e.jsx)(n.p,{children:\"RBAC is the bread and butter of access control. You define a role, attach permissions to it, and then assign users to that role. It's perfect for stable organizations where everyone's job is clearly defined.\"}),(0,e.jsx)(n.p,{children:\"With Terraform, creating a role is no big deal.\"}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_role\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"test_role\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"test_role\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"assume_role_policy\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` data.aws_iam_policy_document.assume_role.json\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_role_policy_attachment\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"test_role_policy\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"role\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_role.test_role.name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"policy_arn\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_policy.test_policy.arn\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Anyone assigned to \",(0,e.jsx)(n.code,{children:\"test_role\"}),\" gets the powers defined in \",(0,e.jsx)(n.code,{children:\"test_policy\"}),`. Easy peasy. The downside? If you have lots of slightly different teams, you can end up with hundreds of roles (\"Test-Developers\", \"Prod-Developers\", \"Super-Prod-Developers-Who-Can-Also-Order-Pizza\"). This is called \"role explosion,\" and it's not fun to manage.`]}),(0,e.jsxs)(n.h2,{id:\"the-abac-way-flexible-and-scalable-with-tags\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#the-abac-way-flexible-and-scalable-with-tags\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The ABAC Way: Flexible and Scalable with Tags\"]}),(0,e.jsx)(n.p,{children:\"This is where things get interesting. ABAC uses tags (which are just simple labels) to make smarter decisions. Instead of creating a new role for every project, you just create a new tag!\"}),(0,e.jsx)(n.p,{children:`First, let's use Terraform to create an S3 bucket and slap a tag on it. We're labeling this bucket as part of the \"Test\" environment.`}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_s3_bucket\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"bucket\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"bucket\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"supasaf-test-bucket\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"acl\"}),\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"private\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Environment\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Test\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[`Now for the magic. We'll create a policy that doesn't care who you are or what your job title is. It only cares about attributes. This policy says, \"You can put an object in this bucket, but `,(0,e.jsx)(n.strong,{children:\"only if\"}),\" you also tag that new object with \",(0,e.jsx)(n.code,{children:\"Environment=Test\"}),'.\"']}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"data \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_policy_document\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3_limited\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"actions\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:ListBucket\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"resources\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0 \\xA0 aws_s3_bucket.bucket.arn,\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"actions\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:GetObject\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:PutObject\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:PutObjectTagging\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"resources\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"aws_s3_bucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"bucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"arn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'/*\"']}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"condition\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"test\"}),\"\\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"StringEquals\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"variable\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:RequestObjectTag/Environment\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"values\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Test\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Let's create a user and give them this shiny new policy.\"}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_policy\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3_limited_policy\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3_limited\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"S3 limited policy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"policy\"}),\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` data.aws_iam_policy_document.s3_limited.json\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_user\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"user\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3_limited_user\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_user_policy_attachment\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"user_s3_limited\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"user\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_user.user.name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"policy_arn\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_policy.s3_limited_policy.arn\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, let's try to use our new user's credentials to upload a file. Notice we have to provide the \",(0,e.jsx)(n.code,{children:\"--tagging 'Environment=Test'\"}),` part. We're presenting the correct \"attribute\" to the magical lock.`]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u276F aws s3api put-object --bucket supasaf-test-bucket --key test.txt --body test.txt --tagging \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Environment=Test'\"}),` --profile s3_limited_user\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ETag\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),\"bc98d84673286ce1447eca1766f28504\",(0,e.jsx)(n.span,{className:\"token entity\",title:'\\\\\"',children:'\\\\\"'}),'\"']}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ServerSideEncryption\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"AES256\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Success! The smart-lock saw our tag and let us in. If we tried this without the tag, AWS would have slammed the door in our face. We can see our correctly tagged file sitting happily in the bucket.\"}),(0,e.jsx)(t,{width:600,src:\"/static/images/terraform/terra_s3_tags.png\"}),(0,e.jsxs)(n.h2,{id:\"building-a-policy-machine\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#building-a-policy-machine\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Building a Policy Machine\"]}),(0,e.jsx)(n.p,{children:\"The real power of ABAC with Terraform is that you can build dynamic policies. Look at this example where we use a variable to define the environment.\"}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"environment\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"The environment for which to grant access\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"data \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_policy_document\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3_limited\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"effect\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"actions\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:*\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"resources\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"aws_s3_bucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"bucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"arn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'/*\"']}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"condition\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"test\"}),\"\\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"StringEquals\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"variable\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:ExistingObjectTag/Environment\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"values\"}),\"\\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"var.environment\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:`With this, you can apply the same Terraform code for your \"Test\", \"Staging\", and \"Prod\" environments just by changing one variable. You've built a policy-making machine instead of hand-crafting policies one by one.`}),(0,e.jsxs)(n.h2,{id:\"so-which-kung-fu-style-is-best\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#so-which-kung-fu-style-is-best\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"So, Which Kung Fu Style is Best?\"]}),(0,e.jsx)(n.p,{children:\"Here\\u2019s the secret: you don\\u2019t have to choose! The best dojos teach a mix of styles.\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"Use \",(0,e.jsx)(n.strong,{children:\"RBAC\"}),` for broad, company-wide permissions that don't change much. For example, a \"Billing-Admins\" role or a \"ReadOnly-Auditors\" role.`]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"Use \",(0,e.jsx)(n.strong,{children:\"ABAC\"}),\" for your dynamic, project-based work. It's perfect for development teams working across multiple projects and environments because you can grant access to resources based on a project:X or team:Y tag without creating a million roles.\"]})})]}),(0,e.jsx)(n.p,{children:\"The key is to understand that security isn't a one-size-fits-all problem. By having both RBAC and ABAC in your toolkit, you have the flexibility to build a security model that is both powerful and manageable. You get the best of both worlds\\u2014the simplicity of roles and the fine-grained, scalable power of attributes. Now go forth and secure your castle!\"})]})}}var f=w;function _(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"The RBAC Way: Simple and Structured","url":"#the-rbac-way-simple-and-structured","depth":2},{"value":"The ABAC Way: Flexible and Scalable with Tags","url":"#the-abac-way-flexible-and-scalable-with-tags","depth":2},{"value":"Building a Policy Machine","url":"#building-a-policy-machine","depth":2},{"value":"So, Which Kung Fu Style is Best?","url":"#so-which-kung-fu-style-is-best","depth":2}],"frontMatter":{"readingTime":{"text":"7 min read","minutes":6.54,"time":392400,"words":1308},"slug":"terraform/terraform_sec_3_abac","fileName":"terraform/terraform_sec_3_abac.md","title":"ABAC and RBAC: A Journey with Terraform and AWS Tagged Resources","date":"2023-05-16T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"Exploring the nuances of Attribute-based Access Control (ABAC) and Role-based Access Control (RBAC) in cloud security using Terraform, and understanding their strategic implementation in managing AWS tagged resources."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"An IAM Split-Privilege Model with Terraform for Robust Cybersecurity","date":"2023-05-14T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"A practical (and funny) guide to implementing a split-privilege model in AWS. We'll separate the power to create permissions from the power to assign them, making your cloud a whole lot safer.","slug":"terraform/terraform_sec_2_iam1"},"next":{"title":"InfoSec architect 101-Service account from prehistory","date":"2025-07-01T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Service accounts may sound boring, but they’re the unsung heroes of secure automation. In this post, we time-travel back to the prehistoric age of Windows domains to see how service accounts and Kerberos work together to avoid hardcoded passwords and security nightmares.","images":[],"slug":"service-account-1"}},"__N_SSG":true}