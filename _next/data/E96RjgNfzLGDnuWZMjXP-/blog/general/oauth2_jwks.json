{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var t in s)l(a,t,{get:s[t],enumerable:!0})},g=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)&&e!==\"default\"&&l(a,e,{get:()=>s[e],enumerable:!(t=p(s,e))||t.enumerable});return a},y=a=>g(i(l(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((C,o)=>{o.exports=_jsx_runtime});var A={};k(A,{default:()=>b,frontmatter:()=>f});var n=y(r()),f={title:\"Stop Hand-Crafting Tokens\",date:\"2025-11-22\",tags:[\"Architect\"],draft:!1,summary:\"Stop using hard-coded tokens like it's 2007: A deep dive into securing microservices with OAuth 2.0 Client Credentials and the magic of JWKS key rotation.\",images:[]};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(t,{})})):t();function t(){let e=Object.assign({p:\"p\",strong:\"strong\",h2:\"h2\",a:\"a\",span:\"span\",ol:\"ol\",li:\"li\",ul:\"ul\",code:\"code\",h3:\"h3\",pre:\"pre\"},a.components),{Image:c}=e;return c||v(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.p,{children:'It\\u2019s 2007. I was a young, bright-eyed developer entering the workforce. This was the era of the \"Monolith\"\\u2014giant, heavy software blocks that ruled the earth. We didn\\u2019t have fancy \"Microservices.\"'}),(0,n.jsx)(e.p,{children:'I remember writing C++ code back then. If I needed to call an API from another department, it was like the Wild West. I was manually stitching together HTTP packet headers, byte by byte. Authentication? What authentication? If the network cable was plugged in, we trusted you. \"Hey, I\\u2019m a packet from the Accounting server!\" \"Sounds legit, come on in!\"'}),(0,n.jsx)(e.p,{children:\"Fast forward to today. In my local market, surprisingly, not much has changed. Many companies still run their internal services like it\\u2019s 2007\\u2014completely naked, with zero internal authentication.\"}),(0,n.jsxs)(e.p,{children:['Recently, I had to provide an API for another team\\u2019s system to call. My immediate thought was: \"',(0,n.jsx)(e.strong,{children:\"We are doing this right. We are using OAuth 2.0 Client Credentials.\"}),'\"']}),(0,n.jsx)(e.p,{children:\"To celebrate this small victory for security (and to make sure I actually understand how it works), I wrote this post to document my journey.\"}),(0,n.jsxs)(e.h2,{id:\"why-we-need-to-drop-the-artisanal-hand-crafted-tokens\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#why-we-need-to-drop-the-artisanal-hand-crafted-tokens\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),'Why We Need to Drop the \"Artisanal, Hand-Crafted\" Tokens']}),(0,n.jsx)(e.p,{children:'In many \"good enough\" architectures, downstream services use a very lazy authentication method: generating a static Token (like a UUID) and hard-coding it into the config file.'}),(0,n.jsx)(e.p,{children:'I call this the \"Hand-Crafted Token.\" It\\u2019s simple, sure. But it\\u2019s a security nightmare waiting to happen. Here is why OAuth 2.0 is the adult in the room:'}),(0,n.jsx)(e.ol,{children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.strong,{children:\"Lifecycle Management (Rotation & Expiration)\"})})}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Hand-Crafted\"}),\": Usually valid forever. If it leaks, you have to change the code, update the config, and restart the servers on both sides. It\\u2019s painful.\"]})}),(0,n.jsx)(e.li,{children:(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"OAuth 2.0\"}),\": Access Tokens are short-lived (e.g., 24 hours). If a hacker steals one, they only have a tiny window of time to use it.\"]})})]}),(0,n.jsx)(e.ol,{start:\"2\",children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.strong,{children:\"Permissions (Scopes)\"})})}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Hand-Crafted\"}),': Usually represents \"God Mode.\" If you have the token, you can do anything.']})}),(0,n.jsx)(e.li,{children:(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"OAuth 2.0\"}),\": Supports Scopes (like \",(0,n.jsx)(e.code,{children:\"read:data\"}),\" vs \",(0,n.jsx)(e.code,{children:\"write:order\"}),\"). We can restrict a Python script to only read data, following \",(0,n.jsx)(e.strong,{children:\"the Principle of Least Privilege\"}),\".\"]})})]}),(0,n.jsx)(e.ol,{start:\"3\",children:(0,n.jsx)(e.li,{children:(0,n.jsx)(e.strong,{children:\"Standardization & Performance\"})})}),(0,n.jsxs)(e.p,{children:[\"We use \",(0,n.jsx)(e.strong,{children:\"JWT (JSON Web Token)\"}),` based on asymmetric encryption (RS256). The Go service doesn't need to call Auth0 every single time to ask, \"Hey, is this token real?\" It just downloads a Public Key once and uses math to verify the token locally. This saves network traffic and makes things fast.`]}),(0,n.jsxs)(e.h2,{id:\"the-flow\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#the-flow\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Flow\"]}),(0,n.jsxs)(e.ol,{children:[(0,n.jsxs)(e.li,{children:[\"Python CLI (Client) sends \",(0,n.jsx)(e.code,{children:\"Client ID\"}),\" and \",(0,n.jsx)(e.code,{children:\"Client Secret\"}),\" to Auth0.\"]}),(0,n.jsxs)(e.li,{children:[\"Auth0 checks the ID card, and returns a signed \",(0,n.jsx)(e.strong,{children:\"JWT Access Token\"}),\".\"]}),(0,n.jsxs)(e.li,{children:[\"Python CLI puts that token in the Header (\",(0,n.jsx)(e.code,{children:\"Authorization: Bearer <token>\"}),\") and calls the Go Server.\"]}),(0,n.jsxs)(e.li,{children:[\"Go Server (Resource Server) grabs the \",(0,n.jsx)(e.strong,{children:\"Public Key (JWKS)\"}),\" from Auth0, checks the signature, the expiration, and the Scopes.\"]}),(0,n.jsx)(e.li,{children:\"Success: Data is returned.\"})]}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/client_credentials.jpg\"}),(0,n.jsxs)(e.h2,{id:\"part-1-auth0-configuration-control-plane\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#part-1-auth0-configuration-control-plane\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Part 1: Auth0 Configuration (Control Plane)\"]}),(0,n.jsx)(e.p,{children:\"This is the control center. Log in to your Auth0 Dashboard and follow along.\"}),(0,n.jsxs)(e.h3,{id:\"1-create-the-api-resource-server\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#1-create-the-api-resource-server\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"1. Create the API (Resource Server)\"]}),(0,n.jsx)(e.p,{children:\"Go to Applications -> APIs -> Create API.\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Name: \",(0,n.jsx)(e.code,{children:\"Supa API\"})]}),(0,n.jsxs)(e.li,{children:[\"Identifier: \",(0,n.jsx)(e.code,{children:\"http://localhost:8080\"}),\" Note: This is super important. In OAuth land, this is called the audience. Even though it looks like a URL, it\\u2019s just a logical ID. It does not need to be reachable on the public internet.\"]}),(0,n.jsxs)(e.li,{children:[\"Signing Algorithm: Choose \",(0,n.jsx)(e.code,{children:\"RS256\"}),\".\"]})]}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/occ_1.png\"}),(0,n.jsxs)(e.h3,{id:\"2-define-scopes\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#2-define-scopes\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"2. Define Scopes\"]}),(0,n.jsxs)(e.p,{children:[\"In the API you just made, click the \",(0,n.jsx)(e.strong,{children:\"Permissions\"}),\" tab.\"]}),(0,n.jsx)(e.p,{children:\"Let's add a permission:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Permission (Scope)\"}),\": \",(0,n.jsx)(e.code,{children:\"read:data\"}),\" (Our Go code will specifically look for this string).\"]}),(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Description\"}),\": testing read data\"]})]}),(0,n.jsxs)(e.p,{children:[\"Click \",(0,n.jsx)(e.strong,{children:\"Add\"}),\".\"]}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/occ_2.png\"}),(0,n.jsxs)(e.h3,{id:\"3-create-the-m2m-application-client\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#3-create-the-m2m-application-client\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"3. Create the M2M Application (Client)\"]}),(0,n.jsxs)(e.p,{children:[\"Go to \",(0,n.jsx)(e.strong,{children:\"Applications\"}),\" -> \",(0,n.jsx)(e.strong,{children:\"Applications\"}),\" -> \",(0,n.jsx)(e.strong,{children:\"Create Application\"}),\".\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsxs)(e.li,{children:[\"Name: \",(0,n.jsx)(e.code,{children:\"Supa CLI\"}),\".\"]}),(0,n.jsxs)(e.li,{children:[\"Application Type: \",(0,n.jsx)(e.code,{children:\"Machine to Machine Applications\"}),\".\"]})]}),(0,n.jsxs)(e.p,{children:[\"Click \",(0,n.jsx)(e.strong,{children:\"Create\"}),\".\"]}),(0,n.jsxs)(e.h3,{id:\"4-authorize\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#4-authorize\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"4. Authorize\"]}),(0,n.jsx)(e.p,{children:'After creating the app, Auth0 will ask: \"Which API does this application talk to?\"'}),(0,n.jsx)(e.p,{children:\"Select the Supa API we created in Step 1.\"}),(0,n.jsxs)(e.p,{children:[\"Crucial Step: Expand the menu and you will see the read:data scope. \",(0,n.jsx)(e.strong,{children:\"You must check this box\"}),', then click \"Authorize\".']}),(0,n.jsx)(e.p,{children:'The Logic: This tells Auth0 that this specific machine (App) is allowed to ask for \"read\" permissions.'}),(0,n.jsxs)(e.h3,{id:\"5-get-the-credentials\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#5-get-the-credentials\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"5. Get the Credentials\"]}),(0,n.jsxs)(e.p,{children:[\"Go to the \",(0,n.jsx)(e.strong,{children:\"Settings\"}),\" tab of your Supa CLI application.\"]}),(0,n.jsxs)(e.p,{children:[\"Copy the \",(0,n.jsx)(e.strong,{children:\"Domain\"}),\", \",(0,n.jsx)(e.strong,{children:\"Client ID\"}),\", and \",(0,n.jsx)(e.strong,{children:\"Client Secret\"}),\". We need these for our Python script.\"]}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/occ_3.png\"}),(0,n.jsxs)(e.h2,{id:\"part-2-the-downstream-service-go--gin\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#part-2-the-downstream-service-go--gin\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Part 2: The Downstream Service (Go + Gin)\"]}),(0,n.jsx)(e.p,{children:\"Here is our Go service. Notice that it does not save the Client Secret. It doesn't know the password. It only cares about the Public Key (JWKS) to verify signatures.\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),` main\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"fmt\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"log\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"net/url\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"strings\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"time\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github.com/auth0/go-jwt-middleware/v2/jwks\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github.com/auth0/go-jwt-middleware/v2/validator\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github.com/gin-gonic/gin\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Configuration (Fill in your Auth0 info)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tAuth0Domain   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev-724gim41fcgi3z2p.us.auth0.com\"'}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Replace with your Domain\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tAuth0Audience \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"http://localhost:8080\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ensureValidToken is a middleware used to validate the Token\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"ensureValidToken\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"HandlerFunc \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 1. Set up JWKS provider (Fetch public keys from Auth0 to verify signatures)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tissuerURL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"https://\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" Auth0Domain \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tprovider \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" jwks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewCachingProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"issuerURL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Minute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 2. Set up the validator\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tjwtValidator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" validator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"New\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tprovider\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"KeyFunc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tvalidator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RS256\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tissuerURL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"Auth0Audience\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Validate that Audience matches\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tvalidator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithCustomClaims\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" validator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CustomClaims \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"CustomClaims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tvalidator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithAllowedClockSkew\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Minute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tauthHeader \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetHeader\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Authorization\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" authHeader \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AbortWithStatusJSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"401\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"H\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"error\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"No Authorization header\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Remove \"Bearer \" prefix'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\ttokenString \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" strings\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"TrimPrefix\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"authHeader\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Bearer \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 3. Validate Token\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tclaims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" jwtValidator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ValidateToken\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Background\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" tokenString\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Token validation failed: %v\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AbortWithStatusJSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"401\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"H\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"error\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Invalid Token\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 4. Validate Scope (Optional, but important in OAuth2)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Here we demonstrate a simple check; production environments may use more complex logic\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tcustomClaims \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" claims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"validator\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ValidatedClaims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"CustomClaims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"CustomClaims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\"strings\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Contains\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"customClaims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Scope\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"read:data\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"AbortWithStatusJSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"403\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"H\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"error\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Insufficient scope\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Next\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// CustomClaims is used to parse custom fields in the Token (e.g., Scope)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" CustomClaims \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tScope \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'`json:\"scope\"`'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"CustomClaims\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"Validate\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Default\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Public endpoint (No authentication required)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GET\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/ping\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"JSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"H\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"message\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"pong\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Protected endpoint (Requires OAuth2 authentication)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tprotected \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Group\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/api\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tprotected\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Use\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ensureValidToken\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tprotected\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GET\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"/data\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"JSON\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" gin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"H\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"message\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Congras! Authentication success!\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"data\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Secret A\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Secret B\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tfmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Server running on http://localhost:8080\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\":8080\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"part-3-the-upstream-client-python\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#part-3-the-upstream-client-python\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Part 3: The Upstream Client (Python)\"]}),(0,n.jsx)(e.p,{children:\"The Python script acts as the upstream microservice. Its job is to trade the Client Credentials for a Token, and then use that Token to knock on Go's door.\"}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-python\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` requests\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` sys\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Configuration (Copy from Auth0 Application Settings)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"AUTH0_DOMAIN \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dev-724gim41fcgi3z2p.us.auth0.com\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"CLIENT_ID \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"zJlvk0TKsOKxTO8w...\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"CLIENT_SECRET \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"i1v5lGTJOVFc...\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"AUDIENCE \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"http://localhost:8080\"'}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Must match the one in Go Server\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"get_access_token\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`    Step 1: Request Token from Auth0\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'    \"\"\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"https://'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"AUTH0_DOMAIN\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'/oauth/token\"'})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    payload \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"client_id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" CLIENT_ID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"client_secret\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" CLIENT_SECRET\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"audience\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" AUDIENCE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"grant_type\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"client_credentials\"'}),` \n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Scope is optional here. If omitted, Auth0 grants all allowed scopes for this Client.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:'# You can also specify: \"scope\": \"read:data\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    headers \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'content-type'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"application/json\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Requesting Token from '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'...\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    response \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"post\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" json\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"payload\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"headers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"status_code \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Failed to retrieve Token: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        sys\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"exit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Token retrieved successfully!\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" data\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'access_token'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"call_api\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`    Step 2: Access local Go Server with Token\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'    \"\"\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    api_url \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"http://localhost:8080/api/data\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    headers \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Authorization\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Bearer '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"\\\\nCalling API: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"api_url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' ...\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    response \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"api_url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"headers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"status_code \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n=== Call successful! ===\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Server response:\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"\\\\n=== Call failed ['}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"status_code\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'] ===\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Server response:\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" response\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"text\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"__main__\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 1. Get Token\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" get_access_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 2. (Optional) Print Token to see what it looks like\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# You can paste this token into jwt.io to decode and view contents\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"-\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"60\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Access Token:\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"-\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"60\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`    \n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 3. Call Interface\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    call_api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"part-4-jwks--the-magic-of-rotation\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#part-4-jwks--the-magic-of-rotation\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Part 4: JWKS & The Magic of Rotation\"]}),(0,n.jsxs)(e.p,{children:['You might be wondering: \"',(0,n.jsx)(e.strong,{children:\"Wait, the Go server doesn't have the password. How does it know the Token isn't fake?\"}),'\"']}),(0,n.jsxs)(e.p,{children:[\"This is where \",(0,n.jsx)(e.strong,{children:\"JWKS (JSON Web Key Set)\"}),\" comes in to save the day.\"]}),(0,n.jsxs)(e.h3,{id:\"1-what-is-jwks\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#1-what-is-jwks\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"1. What is JWKS?\"]}),(0,n.jsx)(e.p,{children:\"JWKS isn't a file you download manually. It's a public endpoint hosted by Auth0. When our Go program starts, it quietly visits a URL like this in the background:\"}),(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`https://dev-724gim41fcgi3z2p.us.auth0.com/.well-known/jwks.json\n`})})}),(0,n.jsx)(e.p,{children:\"And it downloads a list of public keys that looks like this:\"}),(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-json\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"keys\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"kty\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"RSA\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"use\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sig\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"n\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"4CemFJ7TlHiramjrCuL-RU=..bala\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"e\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"AQAB\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"kid\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"zNzOehS3IyrE_affVCCbV\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"x5t\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Y22Fn3PK4_hPu_DbjbaBdwquCh8\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"x5c\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"MIIDHTCCAgW...wwHVUEUpmL...bala\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"alg\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"RS256\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"kty\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"RSA\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"use\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sig\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"n\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"lM3Xs6f4kW...bala\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"e\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"AQAB\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"kid\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"GhlB5qAXm3pI1C8dXhag1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"x5t\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"t7RmMk_OungUDOxDjxVgFBuNSg0\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"x5c\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"MIIDHTCCAgWgAw...RjUlHTLoPmucCC...bala\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"alg\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"RS256\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"The Logic:\"}),(0,n.jsx)(e.ol,{children:(0,n.jsx)(e.li,{children:\"The Token from Python has a kid (Key ID) in its Header.\"})}),(0,n.jsx)(c,{width:500,src:\"/static/images/general/occ_4.png\"}),(0,n.jsxs)(e.ol,{start:\"2\",children:[(0,n.jsxs)(e.li,{children:[\"Go looks at that \",(0,n.jsx)(e.code,{children:\"kid\"}),\", finds the matching \",(0,n.jsx)(e.strong,{children:\"Public Key\"}),\" in the list above.\"]}),(0,n.jsxs)(e.li,{children:[\"Go uses the \",(0,n.jsx)(e.code,{children:\"n\"}),\" and \",(0,n.jsx)(e.code,{children:\"e\"}),\" values to mathematically verify the signature.\"]})]}),(0,n.jsxs)(e.h3,{id:\"2-caching-dont-kill-the-server\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#2-caching-dont-kill-the-server\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"2. Caching (Don't kill the server)\"]}),(0,n.jsxs)(e.p,{children:['\"',(0,n.jsx)(e.strong,{children:\"If Go downloads this JSON on every request, won't Auth0 explode?\"}),'\"']}),(0,n.jsx)(e.p,{children:\"Good question. That's why we have this line in the Go code:\"}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsx)(e.code,{className:\"code-highlight language-go\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"provider \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" jwks\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewCachingProvider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"issuerURL\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Minute\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"First Request: Download the keys, store in RAM.\"}),(0,n.jsx)(e.li,{children:\"Next 5 Minutes: Use RAM. This is microsecond-level fast.\"}),(0,n.jsx)(e.li,{children:\"After 5 Minutes: Cache expires. Download again.\"})]}),(0,n.jsxs)(e.h3,{id:\"3-the-killer-feature-key-rotation-zero-downtime\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#3-the-killer-feature-key-rotation-zero-downtime\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"3. The Killer Feature: Key Rotation (Zero Downtime)\"]}),(0,n.jsx)(e.p,{children:'This is why JWKS beats \"Hand-Crafted Tokens.\"'}),(0,n.jsx)(e.p,{children:\"If we need to rotate the keys (maybe for compliance, or maybe because someone pasted the private key on StackOverflow):\"}),(0,n.jsxs)(e.ol,{children:[(0,n.jsx)(e.li,{children:\"Auth0 generates a New pair of keys.\"}),(0,n.jsx)(e.li,{children:\"Auth0 puts the New Public Key in the jwks.json list, but keeps the Old Public Key there too.\"}),(0,n.jsx)(e.li,{children:\"Auth0 starts signing new tokens with the New Private Key.\"}),(0,n.jsx)(e.li,{children:\"The Go service downloads the updated list (within 5 mins).\"}),(0,n.jsx)(e.li,{children:\"Because the list has both keys, Go can verify both old tokens (valid until they expire) and new tokens.\"})]}),(0,n.jsx)(e.p,{children:\"So, we just changed the entire security foundation without changing a single line of code or restarting a single server.\"}),(0,n.jsxs)(e.h3,{id:\"4-seeing-it-in-action\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#4-seeing-it-in-action\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"4. Seeing it in action\"]}),(0,n.jsx)(e.p,{children:\"I triggered a rotation in Auth0:\"}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/occ_5.png\"}),(0,n.jsx)(e.p,{children:\"I ran the client again without changing code:\"}),(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-shell\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"base\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),` ss@ss:~/client_credential1120$ python3 supa_cli.py\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Requesting Token from https://dev-724gim41fcgi3z2p.us.auth0.com/oauth/token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Token retrieved successfully\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`------------------------------------------------------------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Access Token:\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.blabla\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`------------------------------------------------------------\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Calling API: http://localhost:8080/api/data \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Call successful\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"Server response: \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'data'\"}),(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'Secret A'\"}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Secret B'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'message'\"}),(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Congras! Authentication success!'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Look closely, the kid has changed automatically:\"}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/occ_6.png\"}),(0,n.jsx)(e.p,{children:\"And verified in the backend:\"}),(0,n.jsx)(c,{width:300,src:\"/static/images/general/occ_7.png\"}),(0,n.jsxs)(e.h2,{id:\"running-result\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#running-result\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Running Result\"]}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/occ_8.png\"}),(0,n.jsxs)(e.h2,{id:\"appendix-doing-the-math-for-the-curious\",children:[(0,n.jsx)(e.a,{\"aria-hidden\":\"true\",href:\"#appendix-doing-the-math-for-the-curious\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Appendix: Doing the Math (For the curious)\"]}),(0,n.jsxs)(e.p,{children:[\"I mentioned that we use \",(0,n.jsx)(e.code,{children:\"n\"}),\" (Modulus) and \",(0,n.jsx)(e.code,{children:\"e\"}),\" (Exponent) to restore the RSA Public Key and verify the signature. If you don't trust the library and want to see the math yourself, here is a Python script I wrote to manually verify the JWT.\"]}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-python\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` base64\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` json\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" cryptography\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hazmat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"primitives\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"asymmetric \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` rsa\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" cryptography\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hazmat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"primitives \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` serialization\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" cryptography\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hazmat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"primitives \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` hashes\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" cryptography\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hazmat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"primitives\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"asymmetric \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` padding\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" cryptography\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"hazmat\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"backends \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` default_backend\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# ================= Configuration Area =================\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 1. Paste your full Token here\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"TOKEN \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"eyJhbGciO...\"'}),` \n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 2. Paste the corresponding n and e values found in jwks.json\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Note: Must match the key pair corresponding to the kid in the Token Header\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"N_VALUE \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"4CemFJ7TlHiram...\"'}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# This is a very long string\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"E_VALUE \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"AQAB\"'}),\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Usually very short\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# ======================================================\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"base64_to_int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data_str\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`    Helper function: Convert Base64URL string to Integer (Big Integer)\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`    Principle: Base64 -> Bytes -> Integer\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'    \"\"\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 1. Add Base64 padding ('=') to avoid decoding errors\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    padding_len \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data_str\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" padding_len \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        data_str \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),` padding_len\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 2. Base64URL decode to bytes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    decoded_bytes \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" base64\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"urlsafe_b64decode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"data_str\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 3. Convert bytes to Big Integer (Big Endian)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"from_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"decoded_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" byteorder\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'big'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"manual_verify\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"--- Starting manual public key construction and verification ---\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Step 1: Reconstruct RSA Public Key Object\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# This is a purely mathematical process: Public Key = (n, e)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        n_int \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" base64_to_int\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"N_VALUE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        e_int \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" base64_to_int\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"E_VALUE\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:'f\"[1] Conversion successful:\"'})}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"    n (First 50 digits): '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"str\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"n_int\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token format-spec\",children:\"50]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'...\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"    e (Integer): '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"e_int\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Use the cryptography library to assemble n and e into a public key object\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        public_numbers \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" rsa\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"RSAPublicNumbers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"e_int\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" n_int\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        public_key \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" public_numbers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"public_key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"default_backend\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"[2] RSA Public Key object constructed successfully!\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`        \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Public key reconstruction failed: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Step 2: Disassemble Token\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# JWT Format: Header.Payload.Signature\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    parts \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" TOKEN\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'.'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"parts\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Invalid Token format\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# The signature is also Base64URL encoded and needs to be decoded into raw bytes\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    header_payload \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" parts\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'.'\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" parts\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# This is the original content that was signed (Message)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    signature_b64 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" parts\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Add padding and decode signature\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    sig_padding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"signature_b64\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"%\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" sig_padding \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        signature_b64 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),` sig_padding\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    signature_bytes \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" base64\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"urlsafe_b64decode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"signature_b64\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"[3] Token disassembled successfully. Data length to verify: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"header_payload\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:' bytes\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Step 3: Perform Mathematical Signature Verification\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Algorithm: RS256 (RSA Signature + SHA256 Hash)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"try\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        public_key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"verify\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            signature_bytes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"                        \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# The real signature (Encrypted Hash)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            header_payload\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'ascii'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"         \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Original content (We calculate the Hash ourselves)\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            padding\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"PKCS1v15\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\"                     \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# JWT standard uses PKCS1 v1.5 padding\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            hashes\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SHA256\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\"                         \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# JWT standard uses SHA256\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\\u2705 Verification Passed! (Signature Valid)\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Conclusion: This Token was indeed signed by the entity holding the private key (Auth0) and has not been tampered with.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\\u274C Verification Failed! (Signature Invalid)\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Error details: '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Possible reasons:\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"1. Incorrect n or e copied (must match kid)\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"2. Incomplete Token copied\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"print\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"3. Token content has been modified\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"__main__\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    manual_verify\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"The Result:\"}),(0,n.jsx)(c,{width:600,src:\"/static/images/general/occ_9.png\"})]})}}var b=w;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return A;})();\n;return Component;","toc":[{"value":"Why We Need to Drop the \"Artisanal, Hand-Crafted\" Tokens","url":"#why-we-need-to-drop-the-artisanal-hand-crafted-tokens","depth":2},{"value":"The Flow","url":"#the-flow","depth":2},{"value":"Part 1: Auth0 Configuration (Control Plane)","url":"#part-1-auth0-configuration-control-plane","depth":2},{"value":"1. Create the API (Resource Server)","url":"#1-create-the-api-resource-server","depth":3},{"value":"2. Define Scopes","url":"#2-define-scopes","depth":3},{"value":"3. Create the M2M Application (Client)","url":"#3-create-the-m2m-application-client","depth":3},{"value":"4. Authorize","url":"#4-authorize","depth":3},{"value":"5. Get the Credentials","url":"#5-get-the-credentials","depth":3},{"value":"Part 2: The Downstream Service (Go + Gin)","url":"#part-2-the-downstream-service-go--gin","depth":2},{"value":"Part 3: The Upstream Client (Python)","url":"#part-3-the-upstream-client-python","depth":2},{"value":"Part 4: JWKS & The Magic of Rotation","url":"#part-4-jwks--the-magic-of-rotation","depth":2},{"value":"1. What is JWKS?","url":"#1-what-is-jwks","depth":3},{"value":"2. Caching (Don't kill the server)","url":"#2-caching-dont-kill-the-server","depth":3},{"value":"3. The Killer Feature: Key Rotation (Zero Downtime)","url":"#3-the-killer-feature-key-rotation-zero-downtime","depth":3},{"value":"4. Seeing it in action","url":"#4-seeing-it-in-action","depth":3},{"value":"Running Result","url":"#running-result","depth":2},{"value":"Appendix: Doing the Math (For the curious)","url":"#appendix-doing-the-math-for-the-curious","depth":2}],"frontMatter":{"readingTime":{"text":"17 min read","minutes":16.825,"time":1009500,"words":3365},"slug":"general/oauth2_jwks","fileName":"general/oauth2_jwks.md","title":"Stop Hand-Crafting Tokens","date":"2025-11-22T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Stop using hard-coded tokens like it's 2007: A deep dive into securing microservices with OAuth 2.0 Client Credentials and the magic of JWKS key rotation.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security  Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"Stop Making Your S3 Buckets Public! A Guide to Presigned URLs","date":"2025-11-15T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"Learn how to use S3 Presigned URLs to securely share private files without ever making your bucket public.","slug":"terraform/terraform_sec_6_presigned"},"next":null},"__N_SSG":true}