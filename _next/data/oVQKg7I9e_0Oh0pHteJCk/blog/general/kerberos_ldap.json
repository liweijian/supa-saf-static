{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=>{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=>k(i(l(a!=null?o(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((A,t)=>{t.exports=_jsx_runtime});var w={};u(w,{default:()=>y,frontmatter:()=>b});var e=g(r()),b={title:\"InfoSec Architect 102-Service Accounts in the Linux Universe\",date:\"2025-10-08\",tags:[\"Architect\"],draft:!1,summary:\"This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber.\",images:[]};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",ul:\"ul\",li:\"li\",strong:\"strong\",h2:\"h2\",span:\"span\",pre:\"pre\",code:\"code\",h3:\"h3\",ol:\"ol\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"Hey everyone! Remember our \",(0,e.jsx)(n.a,{href:\"https://www.supasaf.com/blog/service-account-1\",children:\"last adventure\"}),' into the \"Stone Age\" of service accounts with Windows? We tamed Active Directory and made SQL Server bow down to the magic of Kerberos without a single password.']}),(0,e.jsxs)(n.p,{children:[\"Well, I fell down the rabbit hole and stumbled upon an awesome blog post from Uber Engineering: \",(0,e.jsx)(n.a,{href:\"https://www.uber.com/en-HK/blog/scaling-adoption-of-kerberos-at-uber/\",children:\"Scaling Adoption of Kerberos at Uber\"}),`. They're using this \"ancient\" protocol to secure a massive data platform with thousands of machines. If it's good enough for Uber, it's good enough for our lab!`]}),(0,e.jsx)(n.p,{children:\"Inspired, I decided to build a sequel. This time, we're leaving the cozy world of Windows and diving into Linux. We'll build a mini security kingdom from scratch on a single Ubuntu VM, using Kerberos and its trusty sidekick, LDAP.\"}),(0,e.jsx)(n.p,{children:\"Before we start, let's get our analogies straight:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"LDAP (Lightweight Directory Access Protocol)\"}),': Think of this as a super-organized \"',(0,e.jsx)(n.strong,{children:\"company phonebook\"}),'.\" It stores info about users, groups, and computers in a neat tree structure.']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Kerberos\"}),`: This is your network's very strict \"`,(0,e.jsx)(n.strong,{children:\"bouncer\"}),`.\" It checks everyone's ID at the door and gives them special tickets so they can access other services without flashing their password all over the place.`]})})]}),(0,e.jsx)(n.p,{children:\"Let's get our hands dirty!\"}),(0,e.jsxs)(n.h2,{id:\"installation-and-basic-setup\",children:[(0,e.jsx)(n.a,{href:\"#installation-and-basic-setup\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Installation and Basic Setup\"]}),(0,e.jsx)(n.p,{children:\"First, I SSH'd into my fresh Ubuntu server and installed all the goodies we'll need.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-shell\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Update system packages\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" update \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),` upgrade -y\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Install LDAP core services and tools\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y slapd ldap-utils\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Install Kerberos Key Distribution Center (KDC), admin server, and client tools\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y krb5-kdc krb5-admin-server krb5-user\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"During the \",(0,e.jsx)(n.code,{children:\"krb5\"}),\" installation, a friendly wizard pops up. This is our first meeting with the Kerberos bouncer.\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[\"Default Kerberos version 5 realm: \",(0,e.jsx)(n.code,{children:\"SUPASAF.COM\"})]}),(0,e.jsx)(n.ul,{children:(0,e.jsx)(n.li,{children:\"Nerd Note: A Realm is the kingdom Kerberos manages. It's like a domain in Windows Active Directory. By convention, it's just your domain name, but in all caps.\"})})]}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"Kerberos servers for your realm: \",(0,e.jsx)(n.code,{children:\"localhost\"})]})}),(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[\"Administrative server for your Kerberos realm: \",(0,e.jsx)(n.code,{children:\"localhost\"})]}),(0,e.jsx)(n.ul,{children:(0,e.jsxs)(n.li,{children:[\"Since we're building our entire kingdom on one machine, all roads lead to \",(0,e.jsx)(n.code,{children:\"localhost\"}),\".\"]})})]})]}),(0,e.jsx)(n.p,{children:\"Next, we'll configure the LDAP service using its own setup wizard.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` dpkg-reconfigure slapd\n`]})})}),(0,e.jsx)(n.p,{children:\"Here are the choices I made:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Omit OpenLDAP server configuration?\"}),\" \",(0,e.jsx)(n.code,{children:\"No\"}),\" (We definitely want to configure it!)\"]})}),(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"DNS domain name\"}),\": \",(0,e.jsx)(n.code,{children:\"supasaf.com\"})]}),(0,e.jsx)(n.ul,{children:(0,e.jsxs)(n.li,{children:[\"This is important! It automatically creates the Base DN (Distinguished Name) for our directory, which will be \",(0,e.jsx)(n.code,{children:\"dc=supasaf,dc=com\"}),\". The DN is like the full file path to an entry in LDAP. \",(0,e.jsx)(n.code,{children:\"dc\"}),' stands for \"Domain Component.\"']})})]}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Organization name\"}),\": \",(0,e.jsx)(n.code,{children:\"Supasaf\"})]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Administrator password\"}),\": Pick a strong password (e.g., \",(0,e.jsx)(n.code,{children:\"admin&*&^@%28642\"}),\")\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Remove the database when slapd is purged\"}),\"? \",(0,e.jsx)(n.code,{children:\"No\"})]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Move old database\"}),\"? \",(0,e.jsx)(n.code,{children:\"Yes\"})]})})]}),(0,e.jsxs)(n.p,{children:[\"Once that's done, let's peek inside our new, empty phonebook with \",(0,e.jsx)(n.code,{children:\"ldapsearch\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ ldapsearch -x -LLL -b \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dn: \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"dc\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"supasaf,dc\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"objectClass: \",(0,e.jsx)(n.span,{className:\"token function\",children:\"top\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`objectClass: dcObject\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`objectClass: organization\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`o: Supasaf\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`dc: supasaf\n`})]})}),(0,e.jsx)(n.p,{children:\"Looks good! The root of our directory exists.\"}),(0,e.jsx)(n.p,{children:\"Now, let's create the database and the master key for our Kerberos realm.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` krb5_newrealm\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# The system will ask you to enter and confirm the KDC master password, for example: master123\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"This password is the key to the entire kingdom. Guard it well!\"}),(0,e.jsxs)(n.h2,{id:\"creating-users-and-getting-tickets\",children:[(0,e.jsx)(n.a,{href:\"#creating-users-and-getting-tickets\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating Users and Getting Tickets\"]}),(0,e.jsxs)(n.p,{children:[\"In Kerberos, every user, service, or machine is called a \",(0,e.jsx)(n.strong,{children:\"Principal\"}),\". Let's add a test user with the \",(0,e.jsx)(n.code,{children:\"kadmin.local\"}),\" tool.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Authenticating as principal root/admin@SUPASAF.COM with password.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc testuser@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"No policy specified \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" testuser@SUPASAF.COM\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),` defaulting to no policy\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Enter password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testuser@SUPASAF.COM\"'}),(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter a password\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Re-enter password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testuser@SUPASAF.COM\"'}),(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Confirm it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testuser@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  quit\n`})]})}),(0,e.jsxs)(n.h3,{id:\"the-heart-of-kerberos-tickets\",children:[(0,e.jsx)(n.a,{href:\"#the-heart-of-kerberos-tickets\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Heart of Kerberos: Tickets!\"]}),(0,e.jsx)(n.p,{children:\"This is where the magic happens. Instead of sending your password to every service, the flow works like this:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Authentication\"}),\" (\",(0,e.jsx)(n.code,{children:\"kinit\"}),\"): You prove your identity to the KDC (the bouncer) using your password, just once.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Get a TGT\"}),\": The KDC gives you a \",(0,e.jsx)(n.strong,{children:\"TGT (Ticket-Granting Ticket)\"}),'. Think of this as a temporary ID badge or a \"master ticket.\"']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Get a Service Ticket\"}),\": When you want to access a service (like a database), you show your TGT to the KDC and ask for a specific ticket for that service.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Access the Service\"}),\": The KDC gives you a \",(0,e.jsx)(n.strong,{children:\"Service Ticket\"}),\". You show this special ticket to the database, and it lets you in. No password ever crosses the network!\"]})})]}),(0,e.jsx)(n.p,{children:\"Let's try it:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# 1. Use kinit to ask the KDC for a TGT\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~$ kinit testuser@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" testuser@SUPASAF.COM: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter the password\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# 2. Use klist to see the ticket we received\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~$ klist\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Ticket cache: FILE:/tmp/krb5cc_1000\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Default principal: testuser@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Valid starting         Expires                Service principal\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/02/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"17\"}),\":29:27  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`/03/2025 03:29:27  krbtgt/SUPASAF.COM@SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        renew \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"until\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/03/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"17\"}),`:29:23\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Success! We got a ticket for \",(0,e.jsx)(n.code,{children:\"krbtgt/SUPASAF.COM@SUPASAF.COM\"}),\". That's our TGT.\"]}),(0,e.jsxs)(n.h3,{id:\"organizing-our-ldap-phonebook\",children:[(0,e.jsx)(n.a,{href:\"#organizing-our-ldap-phonebook\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Organizing our LDAP Phonebook\"]}),(0,e.jsxs)(n.p,{children:[`A good phonebook has sections. Let's create some \"folders\" (Organizational Units, or OUs) for our users, groups, and services using an `,(0,e.jsx)(n.strong,{children:\"LDIF (LDAP Data Interchange Format)\"}),\" file.\"]}),(0,e.jsxs)(n.p,{children:[\"Create a file named \",(0,e.jsx)(n.code,{children:\"add-structure.ldif\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the users Organizational Unit (OU)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ou=users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` organizationalUnit\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ou\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` users\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the groups OU\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ou=groups\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` organizationalUnit\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ou\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` groups\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the services OU\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ou=services\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` organizationalUnit\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ou\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` services\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, use \",(0,e.jsx)(n.code,{children:\"ldapadd\"}),\" to load this structure into our directory.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ ldapadd -x -D \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"cn=admin,dc=supasaf,dc=com\"'}),` -W -f add-structure.ldif\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Enter LDAP Password: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter the admin password you set earlier\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ou=users,dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ou=groups,dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ou=services,dc=supasaf,dc=com\"'}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"adding-users-to-the-phonebook\",children:[(0,e.jsx)(n.a,{href:\"#adding-users-to-the-phonebook\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Adding Users to the Phonebook\"]}),(0,e.jsx)(n.p,{children:\"Let's add two users, Alice and Bob, using another LDIF file.\"}),(0,e.jsxs)(n.p,{children:[\"Create \",(0,e.jsx)(n.code,{children:\"add-users.ldif\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" uid=alice\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ou=users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` inetOrgPerson\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` posixAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shadowAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` alice\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"cn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Alice Wang\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"sn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Wang\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"loginShell\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /bin/bash\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10001\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"gidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10001\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"homeDirectory\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /home/alice\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"userPassword\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"SSHA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"IoOlXeNSaWG0jxUZcJQib6yAF/dzchFd \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# This needs to be generated\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" uid=bob\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ou=users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` inetOrgPerson\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` posixAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shadowAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` bob\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"cn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Bob Li\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"sn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Li\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"loginShell\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /bin/bash\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10002\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"gidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10002\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"homeDirectory\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /home/bob\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"userPassword\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"SSHA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`another_password_hash_here\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"We should never store plaintext passwords. Let's generate a secure hash with \",(0,e.jsx)(n.code,{children:\"slappasswd\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ slappasswd\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"New password: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter a password\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Re-enter new password: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Confirm it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"SSHA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"IoOlXeNSaWG0jxUZcJQib6yAF/dzchFd \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Copy this hash\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Paste your generated hashes into the \",(0,e.jsx)(n.code,{children:\"add-users.ldif\"}),\" file, then add them to LDAP.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ ldapadd -x -D \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"cn=admin,dc=supasaf,dc=com\"'}),` -W -f add-users.ldif\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Enter LDAP Password:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"uid=alice,ou=users,dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"uid=bob,ou=users,dc=supasaf,dc=com\"'}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Great! Now we have users in both Kerberos and LDAP. But they don't know about each other yet. Let's connect them.\"}),(0,e.jsxs)(n.h2,{id:\"integrating-ldap-with-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#integrating-ldap-with-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Integrating LDAP with Kerberos\"]}),(0,e.jsxs)(n.p,{children:[\"We want to make LDAP stop using its own simple passwords and start using our fancy Kerberos bouncer for authentication. The magical glue for this is \",(0,e.jsx)(n.strong,{children:\"SASL\"}),\".\"]}),(0,e.jsxs)(n.h3,{id:\"what-the-heck-is-sasl\",children:[(0,e.jsx)(n.a,{href:\"#what-the-heck-is-sasl\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What the Heck is SASL?\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"What is SASL?\"}),` SASL (Simple Authentication and Security Layer) is not an authentication method itself; it's a framework. Think of it as a universal power adapter. Your application (LDAP) has one SASL socket, and you can plug in different authentication \"plugs\" like Kerberos (`,(0,e.jsx)(n.code,{children:\"GSSAPI\"}),\"), \",(0,e.jsx)(n.code,{children:\"PLAIN\"}),\", etc.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Is SASL Secure?\"}),' That depends entirely on the \"plug\" (mechanism) you use. If you use ',(0,e.jsx)(n.code,{children:\"PLAIN\"}),\", your password travels in cleartext (very bad!). If you use \",(0,e.jsx)(n.code,{children:\"GSSAPI\"}),\" (which uses Kerberos), it's highly secure. So, SASL's security is determined by the mechanism it uses.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SASL and Kerberos?\"}),' In our setup, Kerberos is the security \"engine,\" and SASL is the \"driveshaft\" that connects the engine to our LDAP application. LDAP uses the SASL framework to delegate the hard work of authentication to Kerberos.']})})]}),(0,e.jsxs)(n.h3,{id:\"configuring-ldap-to-use-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#configuring-ldap-to-use-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Configuring LDAP to Use Kerberos\"]}),(0,e.jsx)(n.p,{children:\"First, we need to install the SASL libraries that know how to talk to Kerberos.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y sasl2-bin libsasl2-modules-gssapi-mit\n`]})})}),(0,e.jsxs)(n.p,{children:[\"Just like a user, our LDAP service needs its own identity (Principal) to talk to the KDC. But since it's a background service, it can't type a password. So, we use a \",(0,e.jsx)(n.strong,{children:\"Keytab\"}),\" file.\"]}),(0,e.jsxs)(n.p,{children:[\"A \",(0,e.jsx)(n.strong,{children:\"Keytab (Key Table)\"}),` file is basically a password file for services. It holds the secret keys for one or more principals, allowing them to authenticate automatically without human help. This is the core problem Uber's \"Keytab Distribution Pipeline\" solves: how to securely manage and distribute these secret files.`]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Authenticating as principal root/admin@SUPASAF.COM with password.\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# -randkey generates a random key, which is much more secure than a password\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey ldap/ss@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ldap/ss@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Export this principal's key into a keytab file\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  ktadd -k /etc/ldap/ldap.keytab ldap/ss@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" principal ldap/ss@SUPASAF.COM with kvno \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\", \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`. added to keytab WRFILE:/etc/ldap/ldap.keytab.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  quit\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# This keytab file is super sensitive. Lock it down!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chown\"}),` openldap:openldap /etc/ldap/ldap.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),` /etc/ldap/ldap.keytab\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, let's tell the SASL daemon to use our Kerberos bouncer. Edit \",(0,e.jsx)(n.code,{children:\"/etc/default/saslauthd\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Edit the file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"vim\"}),` /etc/default/saslauthd\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Change the content to this:\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"START\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`yes\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"MECHANISMS\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"kerberos5\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Restart the services to apply our changes\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart saslauthd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart slapd\n`]})]})}),(0,e.jsx)(n.p,{children:\"Boom! Our LDAP phonebook now uses our Kerberos bouncer for ID checks.\"}),(0,e.jsxs)(n.h2,{id:\"simulating-the-uber-service-account-scene\",children:[(0,e.jsx)(n.a,{href:\"#simulating-the-uber-service-account-scene\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Simulating the Uber Service Account Scene\"]}),(0,e.jsxs)(n.p,{children:[\"Uber's blog talks about different account types (\",(0,e.jsx)(n.code,{children:\"User\"}),\", \",(0,e.jsx)(n.code,{children:\"Service\"}),\", \",(0,e.jsx)(n.code,{children:\"System\"}),\"). The key takeaway is that their backend services (like HDFS, YARN) all use principals and keytabs to authenticate automatically. Let's copy them.\"]}),(0,e.jsxs)(n.h3,{id:\"creating-service-principals-and-keytabs\",children:[(0,e.jsx)(n.a,{href:\"#creating-service-principals-and-keytabs\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating Service Principals and Keytabs\"]}),(0,e.jsx)(n.p,{children:\"Let's create principals for a few fake Hadoop services and a business service.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Authenticating as principal root/admin@SUPASAF.COM with password.\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create principals for HDFS and YARN services\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"hdfs/localhost@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey yarn/localhost@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"yarn/localhost@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a principal for a business service\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey uber_eats@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"uber_eats@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Generate keytabs for our hdfs and uber_eats services\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  ktadd -k /tmp/hdfs.keytab hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  ktadd -k /tmp/uber_eats.keytab uber_eats@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  quit\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Make sure the service process could read it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"644\"}),` /tmp/hdfs.keytab\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"password-free-authentication-with-a-keytab\",children:[(0,e.jsx)(n.a,{href:\"#password-free-authentication-with-a-keytab\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Password-Free Authentication with a Keytab\"]}),(0,e.jsxs)(n.p,{children:[\"This is the coolest part. Imagine you are the HDFS service starting up. You need to prove your identity to Kerberos, but you don't have hands to type a password. You use the \",(0,e.jsx)(n.code,{children:\"-kt\"}),\" flag with \",(0,e.jsx)(n.code,{children:\"kinit\"}),\" to point to your secret keytab file.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Authenticate using the hdfs.keytab file\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ kinit -kt /tmp/hdfs.keytab hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Immediately check our ticket cache\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ klist\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Ticket cache: FILE:/tmp/krb5cc_1000\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Default principal: hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Valid starting         Expires                Service principal\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/02/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"22\"}),\":07:38  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`/03/2025 08:07:38  krbtgt/SUPASAF.COM@SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        renew \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"until\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/03/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"22\"}),`:07:38\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"It worked! We, as the \",(0,e.jsx)(n.code,{children:\"hdfs/localhost\"}),\" service, got a TGT without typing any password. This is the foundation for all secure, automated backend services.\"]}),(0,e.jsxs)(n.h2,{id:\"passwordless-postgresql-access-with-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#passwordless-postgresql-access-with-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Passwordless PostgreSQL Access with Kerberos\"]}),(0,e.jsx)(n.p,{children:\"In any big company, applications need to talk to databases securely. Hardcoding passwords in config files is a recipe for disaster. This is why Uber built that keytab pipeline\\u2014to let services (like a data analytics app) access other services (like a database) securely and automatically.\"}),(0,e.jsx)(n.p,{children:\"Our final mission: write a Python app that uses a keytab to connect to a PostgreSQL database, read and write data, all without a password in sight.\"}),(0,e.jsx)(n.p,{children:\"First, we need a database that speaks Kerberos. Luckily, the standard PostgreSQL on Ubuntu already does.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y postgresql postgresql-contrib libpq-dev\n`]})})}),(0,e.jsxs)(n.p,{children:[\"Let's use \",(0,e.jsx)(n.code,{children:\"pg_config\"}),\" to make sure it was built with GSSAPI support (the low-level library for Kerberos).\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ pg_config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),` -i gssapi\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"CONFIGURE \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'--build=x86_64-linux-gnu'\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),\". \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'--with-gssapi'\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"LIBS \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),\". -lgssapi_krb5 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"--with-gssapi\"}),\" flag confirms it's ready for action!\"]}),(0,e.jsxs)(n.h3,{id:\"creating-principals-for-postgresql-and-our-app\",children:[(0,e.jsx)(n.a,{href:\"#creating-principals-for-postgresql-and-our-app\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating Principals for PostgreSQL and our App\"]}),(0,e.jsx)(n.p,{children:\"Just like LDAP, our database service and our Python app need their own identities in Kerberos.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Log in to the kadmin tool\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a principal for the PostgreSQL service.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# The naming convention is usually: service_name/hostname@REALM\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# The hostname 'ss' MUST match what the client uses to connect.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` addprinc -randkey postgres/ss@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Export its key to a keytab file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` ktadd -k /etc/postgresql/postgres.keytab postgres/ss@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` quit\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Set the correct permissions so only the postgres user can read this secret file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chown\"}),` postgres:postgres /etc/postgresql/postgres.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),` /etc/postgresql/postgres.keytab\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, let's create an identity for our Python app, which we'll call \",(0,e.jsx)(n.code,{children:\"data_service\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a principal for our application service\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` addprinc -randkey data_service@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Export its keytab, this time to our home directory\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` ktadd -k /home/ss/data_service.keytab data_service@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),` quit\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Set permissions so the user running the app (ss) can read it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chown\"}),` ss:ss /home/ss/data_service.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),` /home/ss/data_service.keytab\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"telling-postgresql-to-trust-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#telling-postgresql-to-trust-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Telling PostgreSQL to Trust Kerberos\"]}),(0,e.jsx)(n.p,{children:\"We need to tell PostgreSQL about its new Kerberos identity.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Step 1: Edit postgresql.conf\"})}),(0,e.jsx)(n.p,{children:\"This is the main config file. We need to tell it where its keytab is.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"vim\"}),` /etc/postgresql/16/main/postgresql.conf\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Add or modify these lines at the end of the file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Kerberos configuration - point to the service's own keytab file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"krb_server_keyfile \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/etc/postgresql/postgres.keytab'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Make sure the database is listening for network connections\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"listen_addresses \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"krb_server_keyfile\"}),` setting is the key. It tells PostgreSQL, \"When a client comes with a Kerberos ticket, use this file to verify it's legit.\"`]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Step 2: Edit pg_hba.conf\"})}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"hba\"}),` stands for \"Host-Based Authentication.\" This file is PostgreSQL's firewall. It defines `,(0,e.jsx)(n.strong,{children:\"who\"}),\" can connect from where to \",(0,e.jsx)(n.strong,{children:\"which database\"}),\" using \",(0,e.jsx)(n.strong,{children:\"what method\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"vim\"}),` /etc/postgresql/16/main/pg_hba.conf\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Add this rule at the very top of the file to give it priority\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# TYPE  DATABASE        USER            ADDRESS                 METHOD\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"host\"}),\"    all             all             \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127.0\"}),\".0.1/32            gss \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"include_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"krb_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"host\"}),\"    all             all             ::1/128                 gss \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"include_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"krb_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`SUPASAF.COM\n`]})]})}),(0,e.jsx)(n.p,{children:\"Here's what this rule means:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"host\"}),\": Allow TCP/IP connections.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"all all\"}),\": For all databases and all users.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"127.0.0.1/32\"}),\": Only from the local machine (for this lab).\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"gss\"}),\": \",(0,e.jsx)(n.strong,{children:\"This is the core!\"}),\" It means the authentication method must be \",(0,e.jsx)(n.strong,{children:\"GSSAPI\"}),\" (Kerberos).\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"include_realm=0\"}),\": A handy setting that tells PostgreSQL to strip the \",(0,e.jsx)(n.code,{children:\"@SUPASAF.COM\"}),\" part from the principal name. This way, \",(0,e.jsx)(n.code,{children:\"data_service@SUPASAF.COM\"}),\" is mapped to the database user \",(0,e.jsx)(n.code,{children:\"data_service\"}),\".\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"krb_realm\"}),\": Specifies which Kerberos realm we trust.\"]})})]}),(0,e.jsx)(n.p,{children:\"Finally, restart PostgreSQL to make the new configuration active.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart postgresql\n`]})})}),(0,e.jsxs)(n.h3,{id:\"mapping-identities-in-the-database\",children:[(0,e.jsx)(n.a,{href:\"#mapping-identities-in-the-database\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Mapping Identities in the Database\"]}),(0,e.jsxs)(n.p,{children:[\"Kerberos handles \",(0,e.jsx)(n.strong,{children:\"Authentication\"}),\" (who you are), but PostgreSQL handles \",(0,e.jsx)(n.strong,{children:\"Authorization\"}),\" (what you're allowed to do). We need to create a database user that matches our Kerberos principal.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Switch to the postgres system user and open the psql command line\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` -u postgres psql\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"psql \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Ubuntu \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\"-0ubuntu0.24.04.1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"))\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Type \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"help\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` help.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-- Create a database user corresponding to the Kerberos principal \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'data_service'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# CREATE USER data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`CREATE ROLE\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-- Create a \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),` database and give all permissions to our new user\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# CREATE DATABASE testdb;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`CREATE DATABASE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# GRANT ALL PRIVILEGES ON DATABASE testdb TO data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`GRANT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-- Connect to the new database\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# \\\\c testdb\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"You are now connected to database \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testdb\"'}),\" as user \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"postgres\"'}),(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\".\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-- Create a \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),` table and grant permissions\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# CREATE TABLE kerberos_test (\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),` SERIAL PRIMARY KEY,\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    message TEXT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`CREATE TABLE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# GRANT ALL PRIVILEGES ON TABLE kerberos_test TO data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`GRANT\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# GRANT USAGE, SELECT ON SEQUENCE kerberos_test_id_seq TO data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`GRANT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-- Exit psql\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# \\\\q\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, when \",(0,e.jsx)(n.code,{children:\"data_service@SUPASAF.COM\"}),\" successfully authenticates, PostgreSQL will treat it as the \",(0,e.jsx)(n.code,{children:\"data_service\"}),\" database user and apply these permissions.\"]}),(0,e.jsxs)(n.h3,{id:\"the-grand-finale-pythons-passwordless-db-access\",children:[(0,e.jsx)(n.a,{href:\"#the-grand-finale-pythons-passwordless-db-access\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Grand Finale: Python's Passwordless DB Access\"]}),(0,e.jsxs)(n.p,{children:[\"Let's write a Python script to simulate our \",(0,e.jsx)(n.code,{children:\"data_service\"}),\" application.\"]}),(0,e.jsx)(n.p,{children:\"Install Dependencies:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y libkrb5-dev krb5-user\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ pip3 \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` psycopg2-binary gssapi --break-system-packages\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Create a file named \",(0,e.jsx)(n.code,{children:\"kerberos_db_access.py\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` os\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` subprocess\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` psycopg2\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" datetime \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` datetime\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"KerberosDBConnection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"A database connection manager that uses Kerberos authentication.\"\"\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"__init__\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" keytab_path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" db_host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" db_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" db_port\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5432\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`        Initializes the Kerberos database connection.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`        Args:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            keytab_path: Full path to the keytab file.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            principal: The Kerberos principal (e.g., data_service@SUPASAF.COM).\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            db_host: Database hostname.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            db_name: Database name.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            db_port: Database port.\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'        \"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"keytab_path \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` keytab_path\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` principal\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_host \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` db_host\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` db_name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_port \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` db_port\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"authenticate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Perform Kerberos authentication using the keytab.\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Destroy any existing tickets\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"run\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'kdestroy'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" stderr\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"DEVNULL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Get a TGT using the keytab\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            cmd \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'kinit'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-kt'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"keytab_path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"run\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cmd\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" capture_output\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" text\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"returncode \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"raise\"}),\" Exception\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Kerberos authentication failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stderr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\u2713 Kerberos authentication successful for: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Show ticket info\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            klist_result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"run\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'klist'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" capture_output\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" text\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\nCurrent Kerberos Tickets:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"klist_result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stdout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\u2717 Kerberos authentication failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"False\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"connect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Establish the database connection (using GSSAPI).\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Extract username from the principal\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            db_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Connection string (key part: use gssencmode=prefer)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            connection_params \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'host'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'port'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'dbname'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'user'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" db_user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'gssencmode'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'prefer'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Use GSSAPI encryption\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'sslmode'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'prefer'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\nAttempting to connect to the database...\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Host: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\":\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Database: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  User: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"db_user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Auth Method: Kerberos GSSAPI (Password-Free)\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" psycopg2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"connect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"**\"}),\"connection_params\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2713 Database connection successful!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\u2717 Database connection failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"False\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"execute_query\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" params\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" fetch\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Execute a SQL query.\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"raise\"}),\" Exception\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Database is not connected\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            cursor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"execute\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" params\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# For SELECT or RETURNING clauses, fetch results\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" fetch \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"upper\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"startswith\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'SELECT'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'RETURNING'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"upper\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"fetchall\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"commit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),` result\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"commit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`rowcount\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"rollback\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"raise\"}),` e\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"close\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Close the connection.\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\nDatabase connection closed.\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Main function to demonstrate passwordless Kerberos database access.\"\"\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Kerberos Passwordless Database Access Demo\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Configuration (change according to your environment)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    KEYTAB_PATH \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/home/ss/data_service.keytab\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    PRINCIPAL \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"data_service@SUPASAF.COM\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    DB_HOST \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ss\"'}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Or use FQDN\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    DB_NAME \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testdb\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the connection manager\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    db \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" KerberosDBConnection\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        keytab_path\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"KEYTAB_PATH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        principal\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"PRINCIPAL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        db_host\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"DB_HOST\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        db_name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`DB_NAME\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 1: Kerberos Authentication\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"authenticate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 2: Connect to the Database\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"connect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 3: Insert test data\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Inserting Test Data\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Insert a test record with a timestamp\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        insert_query \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            INSERT INTO kerberos_test (message) \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            VALUES (%s) \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            RETURNING id, message, created_at\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'        \"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        test_message \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Passwordless Kerberos auth test - '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"datetime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"now\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"strftime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'%Y-%m-%d %H:%M:%S'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\nInserting message: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"test_message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"execute_query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"insert_query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"test_message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            record_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            record_msg \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            record_time \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n\\u2713 Data inserted successfully!\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Record ID: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Message: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_msg\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Timestamp: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Verification Steps\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\nYou can now verify the data was inserted with these commands:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n1. Log into the database as the postgres user:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"   sudo -u postgres psql -d testdb\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n2. Run a query inside psql:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"   SELECT * FROM kerberos_test ORDER BY id DESC LIMIT 5;\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n3. Or run directly from the command line:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"   sudo -u postgres psql -d testdb -c \\\\\"SELECT * FROM kerberos_test WHERE id = '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:';\\\\\"\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n4. Exit psql:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"   \\\\\\\\q\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n\\u2713 All operations completed! No database password was used.\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n\\u2717 An error occurred: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` traceback\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        traceback\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"print_exc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"finally\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"__main__\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    main\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"How It Works: The Ticket's Journey\"})}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"db.authenticate()\"}),\": The script runs \",(0,e.jsx)(n.code,{children:\"kinit -kt ....\"}),\" The app shows its ID card (keytab) to the KDC (bouncer) and gets a \",(0,e.jsx)(n.strong,{children:\"TGT\"}),\" (the master ticket).\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"db.connect()\"}),\": When \",(0,e.jsx)(n.code,{children:\"psycopg2.connect()\"}),\" is called with \",(0,e.jsx)(n.code,{children:\"gssencmode\"}),\", the underlying library (\",(0,e.jsx)(n.code,{children:\"libpq\"}),\") kicks off the GSSAPI process.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Get Service Ticket\"}),\": \",(0,e.jsx)(n.code,{children:\"libpq\"}),' sees the TGT in the cache, goes back to the KDC, and says \"Hey, I need a ticket to get into the PostgreSQL party (',(0,e.jsx)(n.code,{children:\"postgres/ss@SUPASAF.COM\"}),').\"']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Send Ticket\"}),\": \",(0,e.jsx)(n.code,{children:\"libpq\"}),\" gets the specific \",(0,e.jsx)(n.strong,{children:\"Service Ticket\"}),\" and sends it to the PostgreSQL server during the connection handshake.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Server Verification\"}),\": The PostgreSQL server receives the ticket and uses its own secret key from \",(0,e.jsx)(n.code,{children:\"postgres.keytab\"}),\" to decrypt it. If it works, the server knows the client is legit.\"]})})]}),(0,e.jsx)(n.p,{children:\"The whole process forms a secure chain of trust, and no passwords ever travel over the network.\"}),(0,e.jsx)(n.p,{children:\"Let's run it!\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Make sure the keytab file exists and has the right permissions\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),` -l /home/ss/data_service.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-r-------- \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" ss ss \",(0,e.jsx)(n.span,{className:\"token number\",children:\"150\"}),\" Oct  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:22 /home/ss/data_service.keytab\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Run our Python app\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ python3 kerberos_db_access.py\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Kerberos Passwordless Database Access Demo\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u2713 Kerberos authentication successful for: data_service@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Current Kerberos Tickets:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Ticket cache: FILE:/tmp/krb5cc_1000\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Default principal: data_service@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Valid starting         Expires                Service principal\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/04/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\":55:42  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/04/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"20\"}),`:55:42  krbtgt/SUPASAF.COM@SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        renew \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"until\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/05/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Attempting to connect to the database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  Host: ss:5432\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  Database: testdb\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  User: data_service\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Auth Method: Kerberos GSSAPI \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Password-Free\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2713 Database connection successful\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Inserting Test Data\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Inserting message: Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2713 Data inserted successfully\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Record ID: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Message: Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Timestamp: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42.331621\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Verification Steps\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`You can now verify the data was inserted with these commands:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`. Log into the database as the postgres user:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` -u postgres psql -d testdb\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`. Run a query inside psql:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   SELECT * FROM kerberos_test ORDER BY \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),\" DESC LIMIT \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),\". Or run directly from the \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"command\"}),` line:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" -u postgres psql -d testdb -c \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"SELECT * FROM kerberos_test WHERE id = 2;\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),`. Exit psql:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`q\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2713 All operations completed\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),` No database password was used.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Database connection closed.\n`})]})}),(0,e.jsx)(n.p,{children:\"Let's follow the instructions from the output and check the database ourselves.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` -u postgres psql -d testdb\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"sudo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` ss:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"psql \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Ubuntu \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\"-0ubuntu0.24.04.1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"))\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Type \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"help\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` help.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# SELECT * FROM kerberos_test ORDER BY id DESC LIMIT 5;\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                   message                     \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`          created_at\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`----+-----------------------------------------------+----------------------------\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\":55:42 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42.331621\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\":54:02 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:54:02.399912\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" rows\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# \\\\q\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"It's there! Our Python application, acting as a true service account, authenticated via Kerberos and wrote to the database without ever needing a password.\"}),(0,e.jsx)(n.p,{children:\"So there you have it. From Windows to Linux, Kerberos is still a powerful, relevant tool for building secure systems. It might seem complicated, but breaking it down with a hands-on lab makes all the difference.\"}),(0,e.jsx)(n.p,{children:\"Go build something!\"})]})}}var y=f;return w;})();\n;return Component;","toc":[{"value":"Installation and Basic Setup","url":"#installation-and-basic-setup","depth":2},{"value":"Creating Users and Getting Tickets","url":"#creating-users-and-getting-tickets","depth":2},{"value":"The Heart of Kerberos: Tickets!","url":"#the-heart-of-kerberos-tickets","depth":3},{"value":"Organizing our LDAP Phonebook","url":"#organizing-our-ldap-phonebook","depth":3},{"value":"Adding Users to the Phonebook","url":"#adding-users-to-the-phonebook","depth":3},{"value":"Integrating LDAP with Kerberos","url":"#integrating-ldap-with-kerberos","depth":2},{"value":"What the Heck is SASL?","url":"#what-the-heck-is-sasl","depth":3},{"value":"Configuring LDAP to Use Kerberos","url":"#configuring-ldap-to-use-kerberos","depth":3},{"value":"Simulating the Uber Service Account Scene","url":"#simulating-the-uber-service-account-scene","depth":2},{"value":"Creating Service Principals and Keytabs","url":"#creating-service-principals-and-keytabs","depth":3},{"value":"Password-Free Authentication with a Keytab","url":"#password-free-authentication-with-a-keytab","depth":3},{"value":"Passwordless PostgreSQL Access with Kerberos","url":"#passwordless-postgresql-access-with-kerberos","depth":2},{"value":"Creating Principals for PostgreSQL and our App","url":"#creating-principals-for-postgresql-and-our-app","depth":3},{"value":"Telling PostgreSQL to Trust Kerberos","url":"#telling-postgresql-to-trust-kerberos","depth":3},{"value":"Mapping Identities in the Database","url":"#mapping-identities-in-the-database","depth":3},{"value":"The Grand Finale: Python's Passwordless DB Access","url":"#the-grand-finale-pythons-passwordless-db-access","depth":3}],"frontMatter":{"readingTime":{"text":"26 min read","minutes":25.38,"time":1522800,"words":5076},"slug":"general/kerberos_ldap","fileName":"general/kerberos_ldap.md","title":"InfoSec Architect 102-Service Accounts in the Linux Universe","date":"2025-10-08T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security  Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)","date":"2025-10-06T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices.","images":[],"slug":"general/spiffe_go_k8s"},"next":null},"__N_SSG":true}