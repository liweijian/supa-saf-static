{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=a=>l(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},f=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)&&n!==\"default\"&&l(a,n,{get:()=>s[n],enumerable:!(c=p(s,n))||c.enumerable});return a},g=a=>f(t(l(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((P,o)=>{o.exports=_jsx_runtime});var I={};k(I,{default:()=>v,frontmatter:()=>y});var e=g(r()),y={title:\"From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)\",date:\"2025-10-06\",tags:[\"Architect\"],draft:!1,summary:\"This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices.\",images:[]};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",strong:\"strong\",ol:\"ol\",li:\"li\",ul:\"ul\",code:\"code\",h3:\"h3\",pre:\"pre\"},a.components),{Image:i}=n;return i||w(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"A few years ago, when someone needed to get two microservices to talk to each other securely, they would probably generate a long-lived API key, paste it into a config file, and commit it \\u2014 maybe even to a public repo (oops). Then they\\u2019d cross their fingers and hope nobody found it.\"}),(0,e.jsx)(n.p,{children:\"It feels a bit like leaving your house key under the doormat. It\\u2019s simple, sure, but is it secure? Not really.\"}),(0,e.jsx)(n.p,{children:\"Welcome to the wonderful, chaotic world of microservice security. In my market, getting developers to encrypt internal traffic is a weekly adventure. We have teams building awesome things with Java Spring Boot and using Nacos for service discovery, but the communication between them is often plain, unencrypted HTTP.\"}),(0,e.jsxs)(n.p,{children:[\"After watching a fantastic gRPC Conf talk, \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=qFSHoxs8i2Q\",children:\"Fortifying gRPC Microservices\"}),', I was inspired. The speaker explained these complex topics in such a clear, story-like way. I thought, \"I have to try this myself!\" So, I fired up my laptop, spun up Minikube, and built a working Go demo. The process was incredibly enlightening, and I want to share that journey with you.']}),(0,e.jsxs)(n.p,{children:[\"So grab a coffee, and let's go from zero to Zero Trust. All the code is available on my GitHub: \",(0,e.jsx)(n.a,{href:\"https://github.com/liweijian/spire-demo\",children:\"https://github.com/liweijian/spire-demo\"})]}),(0,e.jsxs)(n.h2,{id:\"its-behind-a-firewall\",children:[(0,e.jsx)(n.a,{href:\"#its-behind-a-firewall\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),`\"It's Behind a Firewall\"`]}),(0,e.jsx)(n.p,{children:\"First question: why do we even need to secure communication inside our own network? Isn't that what the firewall is for?\"}),(0,e.jsx)(n.p,{children:\"Relying solely on a firewall is like having a world-class bouncer at the front door of a nightclub, but once you're inside, it's a total free-for-all. No one checks your ID again, so anyone could potentially impersonate a staff member and walk into the cash room.\"}),(0,e.jsxs)(n.p,{children:['In the digital world, if an attacker gets past your firewall (your \"bouncer\"), they can listen to all your internal plaintext traffic. As the Snowden leaks famously revealed with a slide saying \"',(0,e.jsx)(n.strong,{children:\"SSL added and removed here\"}),'\", even giants like Google had their internal traffic tapped.']}),(0,e.jsx)(i,{width:800,src:\"/static/images/general/snowden.jpg\"}),(0,e.jsx)(n.p,{children:\"In today's world of dynamic, cloud-native environments, services are ephemeral. Their IP addresses change constantly. Using network location as a security measure is like trying to identify a friend based on the parking spot they're in. Tomorrow, someone else will be in that spot.\"}),(0,e.jsxs)(n.p,{children:[\"This is the core idea of \",(0,e.jsx)(n.strong,{children:\"Zero Trust: Never trust, always verify\"}),\".\"]}),(0,e.jsxs)(n.h2,{id:\"the-painful-journey-api-keys-and-the-mtls-headache\",children:[(0,e.jsx)(n.a,{href:\"#the-painful-journey-api-keys-and-the-mtls-headache\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Painful Journey: API Keys and the mTLS Headache\"]}),(0,e.jsx)(n.p,{children:\"Okay, so we need to secure our internal traffic. What are our options?\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"API Keys & Access Tokens\"}),`: This is often the first step. We issue a secret key or a short-lived JWT token to a client. The client flashes this token, and the server says, \"Okay, you're in.\" This is better than nothing, but if the communication channel isn't encrypted, an attacker can just snatch the token off the wire and use it. We've solved one problem but ignored the bigger one: encryption.`]})}),(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Traditional mTLS\"}),\": The next logical step is mutual TLS. It\\u2019s like a secret handshake where both the client and server show their IDs (certificates) to prove who they are before they start talking. This is great! But doing it manually in a microservices world is a nightmare.\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Certificate Management is a Pain\"}),\": Who creates the certificates? Who signs them? How do you get them onto every single pod? How do you rotate them before they expire? It quickly becomes a full-time job.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Identity is Flimsy\"}),': What do you put in the certificate as the \"name\"? An IP address? A DNS name? As we discussed, these things are meaningless for ephemeral workloads. We once had to disable the default gRPC name validation and write our own custom, brittle code to check the identity. It worked, but it felt like holding things together with duct tape.']})})]})]})]}),(0,e.jsx)(n.p,{children:\"There had to be a better way. And there is.\"}),(0,e.jsxs)(n.h2,{id:\"the-hero-arrives-spiffe-and-spire\",children:[(0,e.jsx)(n.a,{href:\"#the-hero-arrives-spiffe-and-spire\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Hero Arrives: SPIFFE and SPIRE\"]}),(0,e.jsx)(n.p,{children:\"This is where our story gets its heroes.\"}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIFFE (Secure Production Identity Framework For Everyone)\"}),\" is not a tool, but a \",(0,e.jsx)(n.strong,{children:\"standard\"}),\". It\\u2019s a set of rules for how to give a software service a strong, verifiable identity, no matter where it's running.\"]}),(0,e.jsxs)(n.p,{children:[\"The core concept is the \",(0,e.jsx)(n.strong,{children:\"SPIFFE ID\"}),\", a unique name for your service that looks like this: \",(0,e.jsx)(n.code,{children:\"spiffe://your-company.com/your-service\"}),\".\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"your-company.com\"}),' part is the \"trust domain.\" Think of it as the country that issues the passport.']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"/your-service\"}),\" part is the unique identity within that country.\"]})})]}),(0,e.jsxs)(n.p,{children:[\"This ID is then embedded into a short-lived cryptographic document called an \",(0,e.jsx)(n.strong,{children:\"SVID (Spiffe Verifiable Identity Document)\"}),\", which is usually just a standard X.509 certificate or JWT.\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIRE (SPIFFE Runtime Environment)\"}),\" is the \",(0,e.jsx)(n.strong,{children:\"implementation\"}),\" of the SPIFFE standard. It\\u2019s the machinery that actually does the work. Think of SPIRE as the passport office for your services. It consists of two main parts:\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIRE Server\"}),\": The central authority. It manages which service gets which SPIFFE ID and signs the certificates.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIRE Agent\"}),': A little helper that runs on every node (or machine/pod). Its job is to figure out which services are running on its node and securely deliver the correct \"passport\" (SVID) to them.']})})]}),(0,e.jsxs)(n.p,{children:[\"The magic is in how the Agent verifies a workload's identity, a process called \",(0,e.jsx)(n.strong,{children:\"Workload Attestation\"}),`. In Kubernetes, the Agent can ask the kubelet, \"Hey, tell me about the process that's calling me. What's its service account? What's its namespace?\" Based on these trusted proofs, the Agent gets the correct SVID from the SPIRE Server.`]}),(0,e.jsx)(n.p,{children:\"The result? Every service gets a strong, short-lived, automatically rotated identity without you having to lift a finger.\"}),(0,e.jsxs)(n.h2,{id:\"lets-get-our-hands-dirty-a-live-demo-in-minikube\",children:[(0,e.jsx)(n.a,{href:\"#lets-get-our-hands-dirty-a-live-demo-in-minikube\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Let's Get Our Hands Dirty: A Live Demo in Minikube!\"]}),(0,e.jsx)(n.p,{children:\"Talk is cheap. Let me show you how this actually works. I've put together a simple Go-based gRPC client/server demo that runs on Minikube.\"}),(0,e.jsx)(i,{width:800,src:\"/static/images/general/spiffe_grpc.png\"}),(0,e.jsx)(n.p,{children:(0,e.jsxs)(n.strong,{children:[\"Credit goes to \",(0,e.jsx)(n.a,{href:\"https://youtu.be/qFSHoxs8i2Q?t=1115\",children:\"Mehrdad Afshari\"})]})}),(0,e.jsxs)(n.h3,{id:\"setup-spiresh-the-magic-wand\",children:[(0,e.jsx)(n.a,{href:\"#setup-spiresh-the-magic-wand\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),(0,e.jsx)(n.code,{children:\"setup-spire.sh\"}),\" (The Magic Wand)\"]}),(0,e.jsxs)(n.p,{children:['This script installs SPIRE using Helm and registers the identities for our client and server. We are telling SPIRE: \"Any pod running with the Kubernetes service account ',(0,e.jsx)(n.code,{children:\"my-server-sa\"}),\" should be given the identity \",(0,e.jsx)(n.code,{children:\"spiffe://supasaf.com/server\"}),'.\"']}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token important shebang\",children:\"#!/bin/bash\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"set\"}),` -e\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBECTL\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"minikube kubectl --\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F680} Setting up SPIRE demo environment...\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F464} Creating Service Accounts...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" apply -f - \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<<\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`ENDSA\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`apiVersion: v1\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`kind: ServiceAccount\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`metadata:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  name: my-server-sa\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  namespace: default\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`---\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`apiVersion: v1\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`kind: ServiceAccount\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`metadata:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  name: my-client-sa\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  namespace: default\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:\"ENDSA\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4E6} Installing SPIRE with Helm...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"helm repo \",(0,e.jsx)(n.span,{className:\"token function\",children:\"add\"}),\" spiffe https://spiffe.github.io/helm-charts/ \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\">\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`helm repo update\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4E6} Installing SPIRE with custom values...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" helm list -n spire-system \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),\" -q spire\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  SPIRE already installed, upgrading with custom values...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    helm upgrade spire spiffe/spire \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --namespace spire-system \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -f spire-values.yaml \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --wait \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        --timeout 5m\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    helm \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),\" spire spiffe/spire \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --namespace spire-system \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --create-namespace \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -f spire-values.yaml \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --wait \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        --timeout 5m\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u23F3 Waiting for SPIRE components to be ready...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"wait\"}),\" --for\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"condition\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"ready pod -l app.kubernetes.io/name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"server -n spire-system --timeout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`300s\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"wait\"}),\" --for\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"condition\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"ready pod -l app.kubernetes.io/name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"agent -n spire-system --timeout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`300s\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"SERVER_POD\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"$KUBECTL get pod -n spire-system -l app.kubernetes.io/name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"server -o \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"jsonpath\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'{.items[0].metadata.name}'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"\\u2705 SPIRE Server pod: ',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F510} Registering node identity...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    /opt/spire/bin/spire-server entry create \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -spiffeID spiffe://supasaf.com/minikube-node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s_psat:cluster:minikube \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s_psat:agent_ns:spire-system \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s_psat:agent_sa:spire-agent \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\">\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  Node entry already exists\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F510} Registering server workload identity...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    /opt/spire/bin/spire-server entry create \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -parentID spiffe://supasaf.com/minikube-node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -spiffeID spiffe://supasaf.com/server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:ns:default \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:sa:my-server-sa \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\">\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  Server entry already exists\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F510} Registering client workload identity...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    /opt/spire/bin/spire-server entry create \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -parentID spiffe://supasaf.com/minikube-node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -spiffeID spiffe://supasaf.com/client \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:ns:default \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:sa:my-client-sa \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\">\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  Client entry already exists\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4CB} Registered entries:\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    /opt/spire/bin/spire-server entry show\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2705 SPIRE setup complete!\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4DD} Registered SPIFFE IDs:\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"   Node:   spiffe://supasaf.com/minikube-node\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"   Server: spiffe://supasaf.com/server (SA: my-server-sa)\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"   Client: spiffe://supasaf.com/client (SA: my-client-sa)\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Next steps:\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"1. Build: ./build.sh\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2. Deploy: kubectl apply -f deployment.yaml\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"3. Check logs: kubectl logs -l app=my-server -f\"'}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"We will get the following outputs\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u2705 SPIRE Server pod: spire-server-0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u{1F510} Registering node identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 11223f64-8be3-4d84-9d7e-1827b599c5ae\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/spire/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_ns:spire-system\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_sa:spire-agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:cluster:minikube\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u{1F510} Registering server workload identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 977ab667-1001-476f-bb4d-838bb4fc556b\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-server-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u{1F510} Registering client workload identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 06a80986-983e-401e-9545-e71dfc2aecde\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-client-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u{1F4CB} Registered entries:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Found \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),` entries\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 06a80986-983e-401e-9545-e71dfc2aecde\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-client-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 11223f64-8be3-4d84-9d7e-1827b599c5ae\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/spire/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_ns:spire-system\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_sa:spire-agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:cluster:minikube\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 977ab667-1001-476f-bb4d-838bb4fc556b\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-server-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2705 SPIRE setup complete\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u{1F4DD} Registered SPIFFE IDs:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`   Node:   spiffe://supasaf.com/minikube-node\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   Server: spiffe://supasaf.com/server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"SA: my-server-sa\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   Client: spiffe://supasaf.com/client \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"SA: my-client-sa\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"deploymentyaml-the-blueprint\",children:[(0,e.jsx)(n.a,{href:\"#deploymentyaml-the-blueprint\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),(0,e.jsx)(n.code,{children:\"deployment.yaml\"}),\" (The Blueprint)\"]}),(0,e.jsxs)(n.p,{children:[\"This file tells Kubernetes how to run our apps. The most important part is the \",(0,e.jsx)(n.code,{children:\"volumes\"}),\" section. We use the \",(0,e.jsx)(n.code,{children:\"csi.spiffe.io\"}),\" driver to mount the SPIRE Agent's socket directly into our pod. This is how our app talks to the agent.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ServiceAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ServiceAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`svc\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` TCP\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"targetPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ClusterIP\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"serviceAccountName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Never\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` SPIFFE_ENDPOINT_SOCKET\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" unix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"///spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"api/spire\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`agent.sock\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" /spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"csi\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"driver\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"csi.spiffe.io\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"serviceAccountName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"restartPolicy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Always\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Never\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` SPIFFE_ENDPOINT_SOCKET\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" unix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"///spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"api/spire\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`agent.sock\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" /spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"csi\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"driver\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"csi.spiffe.io\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"servermaingo-the-wise-guardian\",children:[(0,e.jsx)(n.a,{href:\"#servermaingo-the-wise-guardian\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"server/main.go (The Wise Guardian)\"]}),(0,e.jsxs)(n.p,{children:[\"Look how simple the Go code is! We don't handle any private keys or certificate files. We just ask the \",(0,e.jsx)(n.code,{children:\"workloadapi\"}),\" for a \",(0,e.jsx)(n.code,{children:\"Source\"}),\", and it handles all the magic of talking to the SPIRE Agent behind the scenes. When a request comes in, we can inspect the peer's certificate and pull out its verified SPIFFE ID.\"]}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-go\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"package\"}),` main\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"log\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"net\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"github.com/spiffe/go-spiffe/v2/spiffetls/tlsconfig\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"github.com/spiffe/go-spiffe/v2/workloadapi\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.golang.org/grpc\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.golang.org/grpc/credentials\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.golang.org/grpc/peer\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"spire-demo/proto\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" Server \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`UnimplementedEchoServer\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"s \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"Server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"SayHello\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" in \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"error\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ok \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" peer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"FromContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"ok \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: could not get peer from context\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no peer info\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        tlsInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ok \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"AuthInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"credentials\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"TLSInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"ok \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: peer auth info is not TLS\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no TLS info\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"tlsInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"State\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PeerCertificates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: no peer certificates\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no certificates\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        cert \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" tlsInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"State\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PeerCertificates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cert\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"URIs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: no URIs in certificate\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no SPIFFE ID\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        spiffeID \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" cert\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"URIs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2705 Received a request from client with SPIFFE ID: %s\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" spiffeID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Hello \"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" in\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\" from \"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" spiffeID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        ctx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Background\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F680} Starting server, waiting for SPIRE agent...\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" workloadapi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"NewX509Source\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Fatalf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u274C Unable to create X509Source: %v\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"defer\"}),\" source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Close\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2705 Successfully connected to SPIRE agent\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        tlsConfig \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" tlsconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"MTLSServerConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" tlsconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"AuthorizeAny\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        creds \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" credentials\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"NewTLS\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"tlsConfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        server \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" grpc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"NewServer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"grpc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Creds\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"creds\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"RegisterEchoServer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&\"}),\"Server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        lis\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" net\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Listen\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"tcp\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\":8080\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Fatalf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u274C Failed to listen: %v\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F3A7} Server listening on :8080 with mTLS enabled\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Serve\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"lis\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Fatalf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u274C Failed to serve: %v\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"the-aha-moment-checking-the-logs\",children:[(0,e.jsx)(n.a,{href:\"#the-aha-moment-checking-the-logs\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),'The \"Aha!\" Moment: Checking the Logs']}),(0,e.jsxs)(n.p,{children:[\"After running \",(0,e.jsx)(n.code,{children:\"./setup-spire.sh\"}),\", \",(0,e.jsx)(n.code,{children:\"./build.sh\"}),\", and \",(0,e.jsx)(n.code,{children:\"kubectl apply -f deployment.yaml\"}),\", let's look at the logs.\"]}),(0,e.jsx)(n.p,{children:\"Server Logs:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/spire-demo$ kubectl logs -l \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`my-server -f\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:24 \\u{1F680} Starting server, waiting \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" SPIRE agent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:25 \\u2705 Successfully connected to SPIRE agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:25 \\u{1F3A7} Server listening on :8080 with mTLS enabled\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:25 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:50 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:52:22 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]})]})}),(0,e.jsx)(n.p,{children:\"Client Logs:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/spire-demo$ kubectl logs -l \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`my-client -f\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:30 \\u{1F680} Starting client, waiting \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" SPIRE agent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Successfully connected to SPIRE agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:31 \\u{1F504} Attempting to connect to server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"attempt \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/10\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Connected to server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:31 \\u{1F4E4} Sending request to server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Response from server: Hello SPIFFE from spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:31 \\u{1F389} Zero Trust communication successful\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Look at that beautiful server log! \",(0,e.jsx)(n.code,{children:\"Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"The server doesn't know the client's IP address, nor does it care. It knows its \",(0,e.jsx)(n.strong,{children:\"true\"}),\", cryptographically verified identity. This is the foundation of Zero Trust security. We've successfully established a secure, authenticated, and encrypted channel between two microservices, and it was almost entirely automatic.\"]}),(0,e.jsxs)(n.h2,{id:\"wrapping-up\",children:[(0,e.jsx)(n.a,{href:\"#wrapping-up\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Wrapping Up\"]}),(0,e.jsx)(n.p,{children:\"Building this demo was a real eye-opener. The concepts from the gRPC Conf talk came to life when I could actually see the SPIFFE IDs in my logs, watch certificates rotate automatically, and know that every connection was authenticated and encrypted.\"}),(0,e.jsx)(n.p,{children:\"In my market, where English documentation can be a barrier and plaintext HTTP is still common, I hope this practical example helps show that zero trust isn't as scary as it sounds. SPIRE handles the complexity - certificate management, rotation, attestation - so we can focus on building secure applications.\"}),(0,e.jsx)(n.p,{children:\"Now if you'll excuse me, I have another meeting about microservice security next week. But this time, I'm bringing a working demo. \\u{1F680}\"})]})}}var v=b;function w(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return I;})();\n;return Component;","toc":[{"value":"\"It's Behind a Firewall\"","url":"#its-behind-a-firewall","depth":2},{"value":"The Painful Journey: API Keys and the mTLS Headache","url":"#the-painful-journey-api-keys-and-the-mtls-headache","depth":2},{"value":"The Hero Arrives: SPIFFE and SPIRE","url":"#the-hero-arrives-spiffe-and-spire","depth":2},{"value":"Let's Get Our Hands Dirty: A Live Demo in Minikube!","url":"#lets-get-our-hands-dirty-a-live-demo-in-minikube","depth":2},{"value":"setup-spire.sh (The Magic Wand)","url":"#setup-spiresh-the-magic-wand","depth":3},{"value":"deployment.yaml (The Blueprint)","url":"#deploymentyaml-the-blueprint","depth":3},{"value":"server/main.go (The Wise Guardian)","url":"#servermaingo-the-wise-guardian","depth":3},{"value":"The \"Aha!\" Moment: Checking the Logs","url":"#the-aha-moment-checking-the-logs","depth":3},{"value":"Wrapping Up","url":"#wrapping-up","depth":2}],"frontMatter":{"readingTime":{"text":"19 min read","minutes":18.065,"time":1083900,"words":3613},"slug":"general/spiffe_go_k8s","fileName":"general/spiffe_go_k8s.md","title":"From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)","date":"2025-10-06T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security  Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"Hacker and Physicist - A Tale of \"Common Sense\"","date":"2025-08-22T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Why fundamental digital principles are as invisible (and essential) as the laws of physics.","images":[],"slug":"general/hacker_physicist"},"next":null},"__N_SSG":true}