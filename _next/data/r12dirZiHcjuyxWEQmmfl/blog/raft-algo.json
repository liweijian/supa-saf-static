{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var t=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var i=a=>t(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{i(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)&&n!==\"default\"&&t(a,n,{get:()=>s[n],enumerable:!(c=p(s,n))||c.enumerable});return a},f=a=>g(i(t(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((x,o)=>{o.exports=_jsx_runtime});var T={};k(T,{default:()=>b,frontmatter:()=>w});var e=f(r()),w={title:\"Consensus Algorithms Through the Eyes of an Infosec Architect\",date:\"2025-07-04\",tags:[\"Architect\"],draft:!1,summary:\"a.k.a. I wrote a Raft cluster in Go and accidentally learned a lot\",images:[]};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",strong:\"strong\",blockquote:\"blockquote\",a:\"a\",h2:\"h2\",span:\"span\",ul:\"ul\",li:\"li\",pre:\"pre\",code:\"code\",h3:\"h3\",ol:\"ol\"},a.components),{Image:l}=n;return l||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"We\\u2019ve recently been evaluating some vendors for secrets management solutions. Due to some unfortunate legal or market reasons, well-known products like Akeyless can\\u2019t be sold in our local market. That pushed us to look into alternative solutions.\"}),(0,e.jsxs)(n.p,{children:[\"Now, secrets management demands \",(0,e.jsx)(n.strong,{children:\"extremely high availability\"}),\" (HA). I mean, nobody wants to wake up at 3 a.m. because the system storing your passwords decided to take a nap. So I spent some time analyzing how different vendors implement HA.\"]}),(0,e.jsxs)(n.p,{children:[\"Some vendors use a \",(0,e.jsx)(n.strong,{children:\"primary-standby model\"}),\" based on traditional databases like PostgreSQL. Others go fancier and adopt \",(0,e.jsx)(n.strong,{children:\"consensus algorithms\"}),\" like Raft.\"]}),(0,e.jsx)(n.p,{children:\"Yesterday, a teammate asked:\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"\\u201CWhat exactly is a consensus algorithm?\\u201D\"})}),(0,e.jsx)(n.p,{children:\"That question hit me right in the brainstem.\"}),(0,e.jsxs)(n.p,{children:[\"I once worked for a company with a product that had over a billion DAUs. Under the hood, it used a Paxos-based system called \",(0,e.jsx)(n.a,{href:\"https://github.com/Tencent/paxosstore\",children:\"paxosstore\"}),\". The core logic? Less than 2,000 lines of C++. Nowadays, I have to admit \\u2014 I can barely read that C++ anymore. But I thought \\u2014 why not write a tiny version of Raft myself in Go? Just for fun and to sharpen my understanding of the secret manager tech we\\u2019re reviewing.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsxs)(n.strong,{children:[\"Disclaimer: My little Raft only does leader election, failure recovery, and node restarts. It\\u2019s not ready for production or serious use. If you want a deep dive into a more solid Go implementation, check out \",(0,e.jsx)(n.a,{href:\"https://eli.thegreenplace.net/2020/implementing-raft-part-1-elections/\",children:\"this excellent series\"}),\".\"]})}),(0,e.jsxs)(n.h2,{id:\"tldr\",children:[(0,e.jsx)(n.a,{href:\"#tldr\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"I wrote a Raft mini-clone in Go\"}),(0,e.jsx)(n.li,{children:\"It fits in a single file\"}),(0,e.jsx)(n.li,{children:\"It does elections and heartbeats\"}),(0,e.jsx)(n.li,{children:\"It doesn\\u2019t do log replication (yet)\"}),(0,e.jsx)(n.li,{children:\"But hey \\u2014 it was fun!\"})]}),(0,e.jsxs)(n.h2,{id:\"what-does-this-raft-do\",children:[(0,e.jsx)(n.a,{href:\"#what-does-this-raft-do\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What Does This Raft Do?\"]}),(0,e.jsx)(n.p,{children:\"Just the basics:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Leader election\"}),(0,e.jsx)(n.li,{children:\"Heartbeats\"}),(0,e.jsx)(n.li,{children:\"Failover (when leader dies, a new one is elected)\"}),(0,e.jsx)(n.li,{children:\"REST API for testing\"})]}),(0,e.jsx)(n.p,{children:\"Each node is just an HTTP server. They ping each other, vote for leaders, and complain when they don\\u2019t get love from others (i.e. no heartbeats).\"}),(0,e.jsxs)(n.h2,{id:\"how-does-it-work\",children:[(0,e.jsx)(n.a,{href:\"#how-does-it-work\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"How Does It Work?\"]}),(0,e.jsx)(n.p,{children:\"You start each node in a separate terminal:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`# Terminal 1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`go run main.go 0\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`# Terminal 2\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`go run main.go 1\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`# Terminal 3\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`go run main.go 2\n`})]})}),(0,e.jsx)(n.p,{children:\"Meanwhile, I had a little monitoring shell script running to watch the cluster:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`$ ./test.sh monitor\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`=== Raft Cluster Status Monitor ===\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`=== Checking status of all nodes ===\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8081:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8082:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8083:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`=== Finding the Leader node ===\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`No leader found.\n`})]})}),(0,e.jsx)(n.p,{children:\"Soon after starting, you\\u2019ll see something like:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8081:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`{\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  \"id\": 0,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  \"state\": \"Leader\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  \"current_term\": 15,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  ...\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`}\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8082:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"state\": \"Follower\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8083:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"state\": \"Follower\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`=== Leader found on port 8081 ===\n`})]})}),(0,e.jsx)(n.p,{children:\"Yay, it elected a leader!\"}),(0,e.jsxs)(n.h2,{id:\"kill-the-leader-for-science\",children:[(0,e.jsx)(n.a,{href:\"#kill-the-leader-for-science\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Kill the Leader (for Science)\"]}),(0,e.jsxs)(n.p,{children:[\"When I \",(0,e.jsx)(n.strong,{children:\"Ctrl+C\"}),\" the leader process (port 8081), the cluster recovers:\"]}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8082:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"state\": \"Follower\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"voted_for\": 2,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"current_term\": 16\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Node on port 8083:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"state\": \"Leader\",\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"voted_for\": 2,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\"current_term\": 16\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`=== Leader found on port 8083 ===\n`})]})}),(0,e.jsxs)(n.p,{children:[\"Later, if I restart the killed node (\",(0,e.jsx)(n.code,{children:\"go run main.go 0\"}),\"), it happily rejoins the cluster.\"]}),(0,e.jsx)(l,{width:580,src:\"/static/images/general/toyraft.png\"}),(0,e.jsxs)(n.h2,{id:\"code-highlights-without-making-your-eyes-bleed\",children:[(0,e.jsx)(n.a,{href:\"#code-highlights-without-making-your-eyes-bleed\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Code Highlights (Without Making Your Eyes Bleed)\"]}),(0,e.jsxs)(n.h3,{id:\"the-basic-architecture\",children:[(0,e.jsx)(n.a,{href:\"#the-basic-architecture\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Basic Architecture\"]}),(0,e.jsxs)(n.p,{children:[\"Our implementation models each server as a \",(0,e.jsx)(n.code,{children:\"RaftNode\"}),\" that can be in one of three states:\"]}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"language-go code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// NodeState represents the state of a node in the Raft cluster.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" NodeState \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tFollower  NodeState \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"iota\"}),` \n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\tCandidate                  \n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\tLeader                     \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Follower\"}),\": The default state. Followers respond to requests from leaders and candidates\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Candidate\"}),\": A node trying to become leader during an election\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Leader\"}),\": The node that handles all client requests and coordinates log replication\"]})]}),(0,e.jsxs)(n.h3,{id:\"core-data-structures\",children:[(0,e.jsx)(n.a,{href:\"#core-data-structures\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Core Data Structures\"]}),(0,e.jsx)(n.p,{children:\"Each Raft node maintains several key pieces of state:\"}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"language-go code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// RaftNode represents a single node in the Raft cluster.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" RaftNode \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tid          \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),\"          \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// The unique ID for this node.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tpeers       \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),\"     \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// The network addresses of the other nodes in the cluster.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tstate       NodeState    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// The current state of the node (Follower, Candidate, or Leader).\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tcurrentTerm \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),\"          \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// The latest term the server has seen.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tvotedFor    \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),\"          \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// The candidateId that received a vote in the current term (-1 if none).\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tlog         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\"LogEntry   \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// The log entries; the first entry is a sentinel.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tcommitIndex \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),\"          \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// The index of the highest log entry known to be committed.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ... other fields\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"currentTerm\"}),\" is crucial - it's like a logical clock that helps nodes understand the sequence of events in the cluster.\"]}),(0,e.jsxs)(n.h3,{id:\"leader-election\",children:[(0,e.jsx)(n.a,{href:\"#leader-election\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Leader Election\"]}),(0,e.jsx)(n.p,{children:\"When a follower doesn't hear from a leader for a certain time, it becomes a candidate and starts an election:\"}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"language-go code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"RaftNode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"runElection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Increment term\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"votedFor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"id    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Vote for ourselves\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tterm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`currentTerm\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ... unlock and prepare request\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tvotes \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"make\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"chan\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"peers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tvotes \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<-\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Vote for self.\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Send vote requests to all peers concurrently.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" wg sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`WaitGroup\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"_\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" peer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"range\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"peers \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\twg\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Add\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"go\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"peerAddr \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ...\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" resp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"sendVoteRequest\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" peerAddr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" votes \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<-\"}),\" resp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"VoteGranted\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<-\"}),\"ctx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Done\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Context timed out or was cancelled.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"mu\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Lock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// If a response contains a higher term, step down and become a follower.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" resp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Term \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" resp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`Term\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` Follower\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"votedFor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"resetElectionTimer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"mu\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Unlock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"peer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Tally the votes.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tvoteCount \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" vote \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"range\"}),\" votes \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" vote \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\tvoteCount\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Check if we got majority votes\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tmajority \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"peers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" voteCount \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">=\"}),\" majority \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" Candidate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" term \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\tlog\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Node %d became leader for term %d with %d votes\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" voteCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` Leader\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"initLeaderState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Stop the election timer as a leader.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"electionTimer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"electionTimer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Stop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"The election process is straightforward:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:\"Increment the current term\"}),(0,e.jsx)(n.li,{children:\"Vote for yourself\"}),(0,e.jsx)(n.li,{children:\"Send vote requests to all other nodes\"}),(0,e.jsx)(n.li,{children:\"If you get a majority of votes, become leader\"})]}),(0,e.jsxs)(n.h3,{id:\"handling-vote-requests\",children:[(0,e.jsx)(n.a,{href:\"#handling-vote-requests\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Handling Vote Requests\"]}),(0,e.jsx)(n.p,{children:\"When a node receives a vote request, it follows these rules:\"}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"language-go code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"RaftNode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"handleVote\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"w http\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"ResponseWriter\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" r \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"http\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ... parse request\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\tresp \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" VoteResponse\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\tTerm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"        rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\tVoteGranted\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Update term if candidate has higher term\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Term \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`Term\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` Follower\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"votedFor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Grant vote if conditions are met\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Term \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"votedFor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"votedFor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"CandidateID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\tlastLogIndex \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\tlastLogTerm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" lastLogIndex \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\tlastLogTerm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"lastLogIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`Term\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ... send response\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"A node will vote for a candidate if:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:\"The candidate's term is at least as high as the node's current term\"}),(0,e.jsx)(n.li,{children:\"The node hasn't already voted for someone else in this term\"}),(0,e.jsx)(n.li,{children:\"The candidate's log is at least as up-to-date as the node's log\"})]}),(0,e.jsxs)(n.h3,{id:\"heartbeats-and-log-replication\",children:[(0,e.jsx)(n.a,{href:\"#heartbeats-and-log-replication\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Heartbeats and Log Replication\"]}),(0,e.jsx)(n.p,{children:\"Once elected, a leader must send regular heartbeats to maintain its authority:\"}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"language-go code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"RaftNode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sendHeartbeats\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ... prepare heartbeat request\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" peer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"range\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"peers \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\treq \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" AppendRequest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\tTerm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"         term\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\tLeaderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"     rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\tPrevLogIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" prevLogIndex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\tPrevLogTerm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"  prevLogTerm\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\tEntries\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\"LogEntry\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Empty for heartbeats.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\tLeaderCommit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" leaderCommit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" resp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"sendAppendRequest\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" peerAddr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Handle response\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" resp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Term \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Step down if we discover higher term\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"currentTerm \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" resp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`Term\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` Follower\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"votedFor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"resetElectionTimer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"peer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Heartbeats serve two purposes:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:\"They prevent followers from starting elections\"}),(0,e.jsx)(n.li,{children:\"They're the same mechanism used for replicating log entries\"})]}),(0,e.jsxs)(n.h3,{id:\"the-main-loop\",children:[(0,e.jsx)(n.a,{href:\"#the-main-loop\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Main Loop\"]}),(0,e.jsx)(n.p,{children:\"Each node runs a simple state machine:\"}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"language-go code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"RaftNode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"run\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Perform actions based on the current state.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"switch\"}),\" state \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" Candidate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"go\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"runElection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" Leader\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"go\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"sendHeartbeats\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"This loop ensures that:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"Followers wait for messages from leaders(NO \",(0,e.jsx)(n.code,{children:\"case\"}),\" branch in \",(0,e.jsx)(n.code,{children:\"switch state\"}),\")\"]}),(0,e.jsx)(n.li,{children:\"Candidates run elections when their timer expires\"}),(0,e.jsx)(n.li,{children:\"Leaders send regular heartbeats\"})]}),(0,e.jsxs)(n.h3,{id:\"election-timeouts\",children:[(0,e.jsx)(n.a,{href:\"#election-timeouts\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Election Timeouts\"]}),(0,e.jsx)(n.p,{children:\"A critical part of Raft is the election timeout - how long a follower waits before becoming a candidate:\"}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"language-go code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"rn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"RaftNode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"resetElectionTimer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"electionTimer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"electionTimer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Stop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Use a randomized timeout between 800ms and 1200ms.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\ttimeout \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Duration\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"800\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\"rand\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Intn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`Millisecond\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"electionTimer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"AfterFunc\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"timeout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"mu\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Lock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Only start an election if not already a leader.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" Leader \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\tlog\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Node %d election timer expired, becoming candidate.\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" rn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"state \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` Candidate\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\trn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"mu\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Unlock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\t\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"The randomization is important - it prevents multiple nodes from becoming candidates at the same time, which would split the vote.\"}),(0,e.jsxs)(n.h2,{id:\"whats-missing\",children:[(0,e.jsx)(n.a,{href:\"#whats-missing\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What's Missing\"]}),(0,e.jsx)(n.p,{children:\"This implementation is simplified and missing several important features:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Log Compaction\"}),\": In a real system, logs can't grow forever\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Persistent State\"}),\": Nodes should survive restarts\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Client Interface\"}),\": There's no way for clients to submit operations\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Membership Changes\"}),\": Can't add or remove nodes from the cluster\"]})]}),(0,e.jsxs)(n.h2,{id:\"what-i-learned\",children:[(0,e.jsx)(n.a,{href:\"#what-i-learned\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What I Learned\"]}),(0,e.jsx)(n.p,{children:\"This hands-on Raft experiment gave me a much better mental model of how HA works under the hood for products like open-source version of something.\"}),(0,e.jsxs)(n.p,{children:[\"More importantly, I understood why \",(0,e.jsx)(n.strong,{children:\"Raft hates long-distance relationships\"}),\". Raft was designed for \",(0,e.jsx)(n.strong,{children:\"low-latency\"}),\" networks \\u2014 like machines within the same \",(0,e.jsx)(n.strong,{children:\"data center or cloud region\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"If you try to stretch a Raft cluster across regions (e.g., Region A, B, and C), the \",(0,e.jsx)(n.strong,{children:\"latency will kill it\"}),\". Seriously.\"]}),(0,e.jsx)(n.p,{children:\"You\\u2019ll run into:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"\\u274C Frequent leader elections (due to timeouts)\"}),(0,e.jsx)(n.li,{children:\"\\u274C Awful write performance (consensus needs roundtrips)\"}),(0,e.jsx)(n.li,{children:\"\\u274C Split-brain risks (everyone thinks they\\u2019re the leader \\u{1F635})\"})]}),(0,e.jsx)(n.p,{children:\"So unless you\\u2019re operating within a tightly-knit region (like us in Region A), don't stretch Raft too far. It gets grumpy.\"}),(0,e.jsxs)(n.h2,{id:\"what-if-you-cant-afford-enterprise\",children:[(0,e.jsx)(n.a,{href:\"#what-if-you-cant-afford-enterprise\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What If You Can\\u2019t Afford Enterprise?\"]}),(0,e.jsx)(n.p,{children:\"That brings me to the real question:\"}),(0,e.jsx)(n.blockquote,{children:(0,e.jsx)(n.p,{children:\"\\u201CWhat if the enterprise version (which supports multi-region HA) isn\\u2019t approved for procurement?\\u201D\"})}),(0,e.jsx)(n.p,{children:\"I don't have a perfect answer just yet; I'm still evaluating the trade-offs and expect to build some custom code to help reduce the risks. Perhaps I'll have the opportunity to share more on this in the future.\"})]})}}var b=y;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return T;})();\n;return Component;","toc":[{"value":"TL;DR","url":"#tldr","depth":2},{"value":"What Does This Raft Do?","url":"#what-does-this-raft-do","depth":2},{"value":"How Does It Work?","url":"#how-does-it-work","depth":2},{"value":"Kill the Leader (for Science)","url":"#kill-the-leader-for-science","depth":2},{"value":"Code Highlights (Without Making Your Eyes Bleed)","url":"#code-highlights-without-making-your-eyes-bleed","depth":2},{"value":"The Basic Architecture","url":"#the-basic-architecture","depth":3},{"value":"Core Data Structures","url":"#core-data-structures","depth":3},{"value":"Leader Election","url":"#leader-election","depth":3},{"value":"Handling Vote Requests","url":"#handling-vote-requests","depth":3},{"value":"Heartbeats and Log Replication","url":"#heartbeats-and-log-replication","depth":3},{"value":"The Main Loop","url":"#the-main-loop","depth":3},{"value":"Election Timeouts","url":"#election-timeouts","depth":3},{"value":"What's Missing","url":"#whats-missing","depth":2},{"value":"What I Learned","url":"#what-i-learned","depth":2},{"value":"What If You Can’t Afford Enterprise?","url":"#what-if-you-cant-afford-enterprise","depth":2}],"frontMatter":{"readingTime":{"text":"12 min read","minutes":11.29,"time":677400,"words":2258},"slug":"raft-algo","fileName":"raft-algo.md","title":"Consensus Algorithms Through the Eyes of an Infosec Architect","date":"2025-07-04T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"a.k.a. I wrote a Raft cluster in Go and accidentally learned a lot","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"InfoSec architect 101-Service account from prehistory","date":"2025-07-01T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Service accounts may sound boring, but they’re the unsung heroes of secure automation. In this post, we time-travel back to the prehistoric age of Windows domains to see how service accounts and Kerberos work together to avoid hardcoded passwords and security nightmares.","images":[],"slug":"service-account-1"},"next":{"title":"An InfoSec Architect's First Taste of Temporal","date":"2025-07-08T00:00:00.000Z","tags":["Secrets Management"],"draft":false,"summary":null,"images":[],"slug":"general/temporal"}},"__N_SSG":true}