<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Envelope Encryption: Boosting Cloud Security with KMS</title><meta name="robots" content="follow, index"/><meta name="description" content="Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."/><meta property="og:url" content="https://www.supasaf.com/blog/general/envelope_encr"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."/><meta property="og:title" content="Envelope Encryption: Boosting Cloud Security with KMS"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Envelope Encryption: Boosting Cloud Security with KMS"/><meta name="twitter:description" content="Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/general/envelope_encr"/><meta property="article:published_time" content="2023-07-02T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/general/envelope_encr"
  },
  "headline": "Envelope Encryption: Boosting Cloud Security with KMS",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-07-02T00:00:00.000Z",
  "dateModified": "2023-07-02T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "L.W.J"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/OKH4P3e7uXw3t_Tqf6jAy/_buildManifest.js" defer=""></script><script src="/_next/static/OKH4P3e7uXw3t_Tqf6jAy/_ssgManifest.js" defer=""></script><script src="/_next/static/OKH4P3e7uXw3t_Tqf6jAy/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-07-02T00:00:00.000Z">Sunday, July 2, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Envelope Encryption: Boosting Cloud Security with KMS</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.png" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">L.W.J</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>Before the advent of the cloud computing era, data encryption was a very important topic. Looking back, when I read Chapter 7. Cryptography Basics of &#x27;Practical Unix &amp; Internet Security&#x27; in prehistory, I learned a lot about how cryptography is important for the security architecture of back-end services. Even in today&#x27;s cloud computing era, this technology can still play a very important role.</p><img width="600" src="/static/images/general/practical_unix_internet_sec.jpeg"/><p>In today&#x27;s ever-evolving digital landscape, data security is more important than ever. Cloud-based storage and services have become increasingly popular, but with that comes the challenge of ensuring data remains secure and confidential. One essential technique in the realm of cloud security is envelope encryption, which provides an additional layer of protection for large data files. In this blog post, we&#x27;ll dive into the concept of envelope encryption, its significance for cloud security, and how to implement it using AWS Key Management Service (KMS) and OpenSSL.</p><p>Envelope encryption is a technique that combines symmetric and asymmetric encryption methods to protect large volumes of data efficiently. The process involves encrypting a file using a symmetric data key, which is then encrypted using a master key, typically provided by a key management service like AWS KMS. The encrypted data key and the encrypted file are stored together, while the master key remains securely stored in the key management service.</p><p>The main advantage of envelope encryption is that it minimizes the risk of exposing the plaintext data key, as the master key never directly interacts with the data. This approach is particularly useful in cloud environments, where data is often distributed across multiple services, and security becomes a challenge due to the vast number of potential attack vectors.</p><p>Here&#x27;s a step-by-step guide to implementing envelope encryption using AWS KMS and OpenSSL:</p><p>Generate a data key using AWS KMS:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">aws kms generate-data-key --key-id 085865dc-8e72-42a9-94d6-f60cb43f637b --key-spec AES_256
</span></code></pre></div><p>This command creates a new data key, encrypted with the specified KMS key. Make sure the <code>key-id</code> is exists in the AWS console.</p><img width="400" src="/static/images/general/general_kms_arn.png"/><p>The output would be the follow format:</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;CiphertextBlob&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AQIDAHgp3upyUvXfYTtaE+GSFfzK5pkL/Jc37eipuMi8fqwifwGrgrzt+nBcuzgUefb0Tr7gAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMY626nlBe9k1ZWwoMAgEQgDuvQdZS/mBKVl0cF35ht7iq4WTz1ZlOW/kBARrndF7RHSxU3Kvc7+0PSpcJ28wcmeicvfxdzEs8R681kQ==&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;Plaintext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;KeyId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p><code>CiphertextBlob</code> and <code>Plaintext</code> are two properties returned when generating a data key using the AWS KMS command.</p><p><code>CiphertextBlob</code> is the encrypted data key produced by the AWS KMS service using the specified master key. It is presented as a Base64-encoded string. The ciphertext blob can be used to securely store or transmit the data key during data transfer. Only users with the corresponding master key can decrypt the ciphertext blob to obtain the original data key.</p><p><code>Plaintext</code> is the plaintext data key, which is the raw form of the generated random key encoded in Base64. The plaintext data key is used for encryption and decryption operations when using cryptographic algorithms. Only users with the ciphertext blob can decrypt it and use the plaintext data key for encrypting or decrypting data.</p><p>These two properties have the following use cases in AWS KMS:</p><ul><li><code>CiphertextBlob</code> is used for secure storage or transmission of the data key to ensure its confidentiality during transit.</li><li><code>Plaintext</code> is used for actual encryption and decryption operations as it serves as the raw key for the cryptographic algorithm.</li></ul><p>It is important to note that safeguarding and managing the security of these data keys is crucial to ensure the confidentiality and integrity of the data.</p><p>Save the encrypted data key to a binary file:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">echo &lt;CiphertextBlob&gt; | base64 -d &gt; enc_data_key.bin
</span></code></pre></div><p>Replace <code>&lt;CiphertextBlob&gt;</code> with the Base64-encoded encrypted data key returned by the <code>aws kms generate-data-key</code> command.</p><p>Encrypt the file using OpenSSL and the plaintext data key:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">openssl enc -aes-256-cbc -pbkdf2 -in secret_file.txt -out encrypted_secret_file.txt -pass pass:&lt;Plaintext&gt;
</span></code></pre></div><p>Replace <code>&lt;Plaintext&gt;</code> with the plaintext data key generated in <code>aws kms generate-data-key</code>, and adjust the input and output file paths as needed. You may need to <code>brew install openssl</code> if you are using macOS. (<a target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/a/63341786/1319619">refer</a>)</p><p>When you need to decrypt the file, first use AWS KMS to decrypt the encrypted data key:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">aws kms decrypt --ciphertext-blob fileb://enc_data_key.bin
</span></code></pre></div><p>The output would like:</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;KeyId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;Plaintext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;EncryptionAlgorithm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SYMMETRIC_DEFAULT&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Decrypt the file using OpenSSL and the decrypted plaintext data key:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">openssl enc -d -aes-256-cbc -pbkdf2 -in encrypted_secret_file.txt -out decrypted_secret_file.txt -pass pass:&lt;Plaintext&gt;
</span></code></pre></div><p>Replace <code>&lt;Plaintext&gt;</code> with the decrypted plaintext data key obtained from <code>aws kms decrypt</code>, and adjust the input and output file paths as needed.</p><p>By leveraging envelope encryption and tools like AWS KMS and OpenSSL, you can significantly bolster the security of your cloud-based data. Envelope encryption provides an added layer of protection that helps to mitigate the risk of data breaches and ensures that sensitive information remains confidential. Embracing envelope encryption and other security best practices is crucial for maintaining the integrity of your data in an increasingly interconnected world. Stay tuned for more cloud security tips and guides in upcoming blog posts.</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cloud">Cloud</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/aws">AWS</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cryptography">Cryptography</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/terraform/terraform_sec_5_kms_dynamodb">Encrypting DynamoDB with AWS KMS: A Secure and Easy Guide</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/aws_security_cert">AWS Security Specialty: What I Learned Preparing for the Exam</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var l=Object.create;var r=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var y=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var c=t=\u003er(t,\"__esModule\",{value:!0});var u=(t,a)=\u003e()=\u003e(a||t((a={exports:{}}).exports,a),a.exports),g=(t,a)=\u003e{c(t);for(var i in a)r(t,i,{get:a[i],enumerable:!0})},f=(t,a,i)=\u003e{if(a\u0026\u0026typeof a==\"object\"||typeof a==\"function\")for(let n of h(a))!m.call(t,n)\u0026\u0026n!==\"default\"\u0026\u0026r(t,n,{get:()=\u003ea[n],enumerable:!(i=p(a,n))||i.enumerable});return t},k=t=\u003ef(c(r(t!=null?l(y(t)):{},\"default\",t\u0026\u0026t.__esModule\u0026\u0026\"default\"in t?{get:()=\u003et.default,enumerable:!0}:{value:t,enumerable:!0})),t);var d=u((A,o)=\u003e{o.exports=_jsx_runtime});var x={};g(x,{default:()=\u003eS,frontmatter:()=\u003eb});var e=k(d()),b={title:\"Envelope Encryption: Boosting Cloud Security with KMS\",date:\"2023-07-02\",tags:[\"Cloud\",\"AWS\",\"Cryptography\"],draft:!1,summary:\"Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data.\",images:[]};function w(t={}){let{wrapper:a}=t.components||{};return a?(0,e.jsx)(a,Object.assign({},t,{children:(0,e.jsx)(i,{})})):i();function i(){let n=Object.assign({p:\"p\",pre:\"pre\",code:\"code\",span:\"span\",ul:\"ul\",li:\"li\",a:\"a\"},t.components),{Image:s}=n;return s||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"Before the advent of the cloud computing era, data encryption was a very important topic. Looking back, when I read Chapter 7. Cryptography Basics of 'Practical Unix \u0026 Internet Security' in prehistory, I learned a lot about how cryptography is important for the security architecture of back-end services. Even in today's cloud computing era, this technology can still play a very important role.\"}),(0,e.jsx)(s,{width:600,src:\"/static/images/general/practical_unix_internet_sec.jpeg\"}),(0,e.jsx)(n.p,{children:\"In today's ever-evolving digital landscape, data security is more important than ever. Cloud-based storage and services have become increasingly popular, but with that comes the challenge of ensuring data remains secure and confidential. One essential technique in the realm of cloud security is envelope encryption, which provides an additional layer of protection for large data files. In this blog post, we'll dive into the concept of envelope encryption, its significance for cloud security, and how to implement it using AWS Key Management Service (KMS) and OpenSSL.\"}),(0,e.jsx)(n.p,{children:\"Envelope encryption is a technique that combines symmetric and asymmetric encryption methods to protect large volumes of data efficiently. The process involves encrypting a file using a symmetric data key, which is then encrypted using a master key, typically provided by a key management service like AWS KMS. The encrypted data key and the encrypted file are stored together, while the master key remains securely stored in the key management service.\"}),(0,e.jsx)(n.p,{children:\"The main advantage of envelope encryption is that it minimizes the risk of exposing the plaintext data key, as the master key never directly interacts with the data. This approach is particularly useful in cloud environments, where data is often distributed across multiple services, and security becomes a challenge due to the vast number of potential attack vectors.\"}),(0,e.jsx)(n.p,{children:\"Here's a step-by-step guide to implementing envelope encryption using AWS KMS and OpenSSL:\"}),(0,e.jsx)(n.p,{children:\"Generate a data key using AWS KMS:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`aws kms generate-data-key --key-id 085865dc-8e72-42a9-94d6-f60cb43f637b --key-spec AES_256\n`})})}),(0,e.jsxs)(n.p,{children:[\"This command creates a new data key, encrypted with the specified KMS key. Make sure the \",(0,e.jsx)(n.code,{children:\"key-id\"}),\" is exists in the AWS console.\"]}),(0,e.jsx)(s,{width:400,src:\"/static/images/general/general_kms_arn.png\"}),(0,e.jsx)(n.p,{children:\"The output would be the follow format:\"}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"CiphertextBlob\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"AQIDAHgp3upyUvXfYTtaE+GSFfzK5pkL/Jc37eipuMi8fqwifwGrgrzt+nBcuzgUefb0Tr7gAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMY626nlBe9k1ZWwoMAgEQgDuvQdZS/mBKVl0cF35ht7iq4WTz1ZlOW/kBARrndF7RHSxU3Kvc7+0PSpcJ28wcmeicvfxdzEs8R681kQ==\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Plaintext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"KeyId\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"CiphertextBlob\"}),\" and \",(0,e.jsx)(n.code,{children:\"Plaintext\"}),\" are two properties returned when generating a data key using the AWS KMS command.\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"CiphertextBlob\"}),\" is the encrypted data key produced by the AWS KMS service using the specified master key. It is presented as a Base64-encoded string. The ciphertext blob can be used to securely store or transmit the data key during data transfer. Only users with the corresponding master key can decrypt the ciphertext blob to obtain the original data key.\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"Plaintext\"}),\" is the plaintext data key, which is the raw form of the generated random key encoded in Base64. The plaintext data key is used for encryption and decryption operations when using cryptographic algorithms. Only users with the ciphertext blob can decrypt it and use the plaintext data key for encrypting or decrypting data.\"]}),(0,e.jsx)(n.p,{children:\"These two properties have the following use cases in AWS KMS:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"CiphertextBlob\"}),\" is used for secure storage or transmission of the data key to ensure its confidentiality during transit.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"Plaintext\"}),\" is used for actual encryption and decryption operations as it serves as the raw key for the cryptographic algorithm.\"]})]}),(0,e.jsx)(n.p,{children:\"It is important to note that safeguarding and managing the security of these data keys is crucial to ensure the confidentiality and integrity of the data.\"}),(0,e.jsx)(n.p,{children:\"Save the encrypted data key to a binary file:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`echo \u003cCiphertextBlob\u003e | base64 -d \u003e enc_data_key.bin\n`})})}),(0,e.jsxs)(n.p,{children:[\"Replace \",(0,e.jsx)(n.code,{children:\"\u003cCiphertextBlob\u003e\"}),\" with the Base64-encoded encrypted data key returned by the \",(0,e.jsx)(n.code,{children:\"aws kms generate-data-key\"}),\" command.\"]}),(0,e.jsx)(n.p,{children:\"Encrypt the file using OpenSSL and the plaintext data key:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`openssl enc -aes-256-cbc -pbkdf2 -in secret_file.txt -out encrypted_secret_file.txt -pass pass:\u003cPlaintext\u003e\n`})})}),(0,e.jsxs)(n.p,{children:[\"Replace \",(0,e.jsx)(n.code,{children:\"\u003cPlaintext\u003e\"}),\" with the plaintext data key generated in \",(0,e.jsx)(n.code,{children:\"aws kms generate-data-key\"}),\", and adjust the input and output file paths as needed. You may need to \",(0,e.jsx)(n.code,{children:\"brew install openssl\"}),\" if you are using macOS. (\",(0,e.jsx)(n.a,{href:\"https://stackoverflow.com/a/63341786/1319619\",children:\"refer\"}),\")\"]}),(0,e.jsx)(n.p,{children:\"When you need to decrypt the file, first use AWS KMS to decrypt the encrypted data key:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`aws kms decrypt --ciphertext-blob fileb://enc_data_key.bin\n`})})}),(0,e.jsx)(n.p,{children:\"The output would like:\"}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"KeyId\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Plaintext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"EncryptionAlgorithm\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"SYMMETRIC_DEFAULT\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Decrypt the file using OpenSSL and the decrypted plaintext data key:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`openssl enc -d -aes-256-cbc -pbkdf2 -in encrypted_secret_file.txt -out decrypted_secret_file.txt -pass pass:\u003cPlaintext\u003e\n`})})}),(0,e.jsxs)(n.p,{children:[\"Replace \",(0,e.jsx)(n.code,{children:\"\u003cPlaintext\u003e\"}),\" with the decrypted plaintext data key obtained from \",(0,e.jsx)(n.code,{children:\"aws kms decrypt\"}),\", and adjust the input and output file paths as needed.\"]}),(0,e.jsx)(n.p,{children:\"By leveraging envelope encryption and tools like AWS KMS and OpenSSL, you can significantly bolster the security of your cloud-based data. Envelope encryption provides an added layer of protection that helps to mitigate the risk of data breaches and ensures that sensitive information remains confidential. Embracing envelope encryption and other security best practices is crucial for maintaining the integrity of your data in an increasingly interconnected world. Stay tuned for more cloud security tips and guides in upcoming blog posts.\"})]})}}var S=w;function v(t,a){throw new Error(\"Expected \"+(a?\"component\":\"object\")+\" `\"+t+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return x;})();\n;return Component;","toc":[],"frontMatter":{"readingTime":{"text":"5 min read","minutes":4.385,"time":263100,"words":877},"slug":"general/envelope_encr","fileName":"general/envelope_encr.md","title":"Envelope Encryption: Boosting Cloud Security with KMS","date":"2023-07-02T00:00:00.000Z","tags":["Cloud","AWS","Cryptography"],"draft":false,"summary":"Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.675,"time":40500,"words":135},"slug":["default"],"fileName":"default.md","name":"L.W.J","avatar":"/static/images/avatar.png","occupation":"CISSP, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"Encrypting DynamoDB with AWS KMS: A Secure and Easy Guide","date":"2023-06-30T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"Discover how to use Terraform and AWS Key Management Service (KMS) to encrypt DynamoDB tables and enhance cybersecurity.","slug":"terraform/terraform_sec_5_kms_dynamodb"},"next":{"title":"AWS Security Specialty: What I Learned Preparing for the Exam","date":"2023-09-24T00:00:00.000Z","tags":["Cloud","AWS"],"draft":false,"summary":"Sharing my exam prep insights and key technical focus areas like IAM, KMS, and VPC to help others prepare for the AWS Security Specialty exam.","images":[],"slug":"general/aws_security_cert"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["general","envelope_encr"]},"buildId":"OKH4P3e7uXw3t_Tqf6jAy","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>