<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Envelope Encryption: Boosting Cloud Security with KMS</title><meta name="robots" content="follow, index"/><meta name="description" content="Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."/><meta property="og:url" content="https://www.supasaf.com/blog/general/envelope_encr.md"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."/><meta property="og:title" content="Envelope Encryption: Boosting Cloud Security with KMS"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Envelope Encryption: Boosting Cloud Security with KMS"/><meta name="twitter:description" content="Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/general/envelope_encr.md"/><meta property="article:published_time" content="2023-07-02T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/general/envelope_encr.md"
  },
  "headline": "Envelope Encryption: Boosting Cloud Security with KMS",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-07-02T00:00:00.000Z",
  "dateModified": "2023-07-02T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/0dwZe4eVU0jMD5Rxz286r/_buildManifest.js" defer=""></script><script src="/_next/static/0dwZe4eVU0jMD5Rxz286r/_ssgManifest.js" defer=""></script><script src="/_next/static/0dwZe4eVU0jMD5Rxz286r/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-07-02T00:00:00.000Z">Sunday, July 2, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Envelope Encryption: Boosting Cloud Security with KMS</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>Way back in the dial-up era, long before the cloud was even a twinkle in a developer&#x27;s eye, I was reading this legendary tome: &#x27;Practical Unix &amp; Internet Security&#x27;. It was dense, it was epic, and it taught me that cryptography was basically the secret magic that holds the entire internet together.</p><img width="600" src="/static/images/general/practical_unix_internet_sec.jpeg"/><p>Fast forward to today, and guess what? That ancient magic is more important than ever. In the cloud, we&#x27;re constantly shuffling data around, and we need a rock-solid way to keep it safe. One of the most clever spells in the modern wizard&#x27;s book is <strong>Envelope Encryption</strong>.</p><h2 id="what-the-heck-is-envelope-encryption-a-silly-analogy"><a href="#what-the-heck-is-envelope-encryption-a-silly-analogy" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What the Heck is Envelope Encryption? A Silly Analogy</h2><p>Okay, the name sounds fancy, but the concept is simple. Imagine this:</p><ol><li>You have a very long, secret letter you want to protect (this is <strong>your data</strong>).</li><li>You lock it in a sturdy metal box using a simple, everyday key. This key is fast and efficient for locking big boxes. (This is your <strong>Data Key</strong>).</li><li>Now you have a problem: what do you do with the key to the box? You can&#x27;t just tape it to the lid!</li><li>So, you take that small, simple key and lock it inside a tiny, nearly-indestructible safe. This safe requires a huge, complex, one-of-a-kind key to open it. (This is your <strong>Master Key</strong> from KMS).</li><li>Finally, you take the tiny, locked safe (the encrypted data key) and glue it to the outside of the big metal box (your encrypted data). This tiny safe is the &quot;envelope.&quot;</li></ol><p>That&#x27;s it! You get the best of both worlds: the speed of a simple key for your big data, and the super-high security of a master key for protecting that simple key. The master key itself never even touches your data.</p><h2 id="lets-do-it-for-real-with-aws-kms"><a href="#lets-do-it-for-real-with-aws-kms" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Let&#x27;s Do It for Real with AWS KMS</h2><p>Let&#x27;s put the analogy into practice. We&#x27;ll use AWS KMS as our master locksmith and the command-line tool OpenSSL to handle the actual file locking.</p><h3 id="step-1-generate-the-keys"><a href="#step-1-generate-the-keys" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 1: Generate the Keys</h3><p>First, we ask our master locksmith (KMS) to create our key set. We need to give it the ID of our master key, which is the big, complex key that never leaves the KMS vault.</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">aws kms generate-data-key --key-id 085865dc-8e72-42a9-94d6-f60cb43f637b --key-spec AES_256
</span></code></pre></div><p>Make sure you&#x27;ve already created a master key in your KMS console to get an ID like this.</p><img width="400" src="/static/images/general/general_kms_arn.png"/><p>KMS will hand you back two important things:</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;CiphertextBlob&quot;</span><span class="token operator">:</span> <span class="token string">&quot;AQIDAHgp3upyUvXfYTtaE+GSFfzK5pkL/Jc37eipuMi8fqwifwGrgrzt+nBcuzgUefb0Tr7gAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMY626nlBe9k1ZWwoMAgEQgDuvQdZS/mBKVl0cF35ht7iq4WTz1ZlOW/kBARrndF7RHSxU3Kvc7+0PSpcJ28wcmeicvfxdzEs8R681kQ==&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;Plaintext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;KeyId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><ul><li><code>Plaintext</code>: This is the simple, everyday key for our big metal box. We&#x27;ll use this to encrypt our file.</li><li><code>CiphertextBlob</code>: This is the tiny, indestructible safe with our simple key locked inside. This is the &quot;envelope&quot; itself.</li></ul><h3 id="step-2-lock-the-file"><a href="#step-2-lock-the-file" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 2: Lock the File</h3><p>First, let&#x27;s save our tiny safe (the encrypted key) to a file.</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token operator">&lt;</span>CiphertextBlob<span class="token operator">&gt;</span> <span class="token operator">|</span> base64 -d <span class="token operator">&gt;</span> enc_data_key.bin
</span></code></pre></div><p>(Just copy the big string of gibberish from the <code>CiphertextBlob</code> field and paste it where <code>&lt;CiphertextBlob&gt;</code> is).</p><p>Now, we use the simple key (<code>Plaintext</code>) to encrypt our actual secret file using OpenSSL.</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">openssl enc -aes-256-cbc -pbkdf2 -in secret_file.txt -out encrypted_secret_file.txt -pass pass:<span class="token operator">&lt;</span>Plaintext<span class="token operator">&gt;</span>
</span></code></pre></div><p>(Again, just copy the <code>Plaintext</code> value. And yes, you might need to install OpenSSL if you&#x27;re on a Mac: <code>brew install openssl</code>).</p><p>At this point, you can safely delete the plaintext key from your memory. All you need to store is the <code>encrypted_secret_file.txt</code> and the <code>enc_data_key.bin</code> (our tiny safe).</p><h3 id="step-3-the-unlocking-process"><a href="#step-3-the-unlocking-process" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 3: The Unlocking Process</h3><p>To get our secret back, we just do everything in reverse.</p><p>First, we ask the master locksmith (KMS) to unlock our tiny safe.</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">aws kms decrypt --ciphertext-blob fileb://enc_data_key.bin
</span></code></pre></div><p>KMS will use the master key to open it and give us back the simple <code>Plaintext</code> key.</p><div class="relative"><pre><code class="code-highlight language-json"><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;KeyId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;Plaintext&quot;</span><span class="token operator">:</span> <span class="token string">&quot;4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;EncryptionAlgorithm&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SYMMETRIC_DEFAULT&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Finally, we use that decrypted <code>Plaintext</code> key to unlock our big file.</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">openssl enc -d -aes-256-cbc -pbkdf2 -in encrypted_secret_file.txt -out decrypted_secret_file.txt -pass pass:<span class="token operator">&lt;</span>Plaintext<span class="token operator">&gt;</span>
</span></code></pre></div><p>And just like that, <code>decrypted_secret_file.txt</code> appears, and our secret letter is readable again!</p><h2 id="the-aha-moment-this-is-everywhere"><a href="#the-aha-moment-this-is-everywhere" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The &quot;Aha!&quot; Moment: This Is Everywhere!</h2><p>Now, you might be thinking, &quot;Cool trick, Ted, but that&#x27;s a lot of command-line work.&quot; But here&#x27;s the kicker: you&#x27;ve been using this pattern all along without even knowing it!</p><p>Recently at work, I was digging into how Kubernetes handles its secrets. When you enable encryption for secrets at rest, guess what technology it uses under the hood? <strong>Envelope encryption!</strong> Kubernetes encrypts your secrets with a data key, and then it encrypts that data key with a master key from a provider like AWS KMS. The encrypted secrets and the encrypted data key are then stored safely in <code>etcd</code>.</p><p>It was a real &quot;aha!&quot; moment for me. As the old saying goes, <strong>功不唐捐 (gōng bù táng juān)</strong>—no effort is ever truly wasted. Learning these fundamental security concepts pays off in the most unexpected places.</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cloud">Cloud</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/aws">AWS</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cryptography">Cryptography</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/phxsql">A Look Back at WeChat&#x27;s PhxSQL and the &#x27;Fastest Majority&#x27;</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var h=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var r=t=\u003ei(t,\"__esModule\",{value:!0});var y=(t,a)=\u003e()=\u003e(a||t((a={exports:{}}).exports,a),a.exports),g=(t,a)=\u003e{r(t);for(var s in a)i(t,s,{get:a[s],enumerable:!0})},k=(t,a,s)=\u003e{if(a\u0026\u0026typeof a==\"object\"||typeof a==\"function\")for(let n of p(a))!u.call(t,n)\u0026\u0026n!==\"default\"\u0026\u0026i(t,n,{get:()=\u003ea[n],enumerable:!(s=d(a,n))||s.enumerable});return t},f=t=\u003ek(r(i(t!=null?h(m(t)):{},\"default\",t\u0026\u0026t.__esModule\u0026\u0026\"default\"in t?{get:()=\u003et.default,enumerable:!0}:{value:t,enumerable:!0})),t);var o=y((_,c)=\u003e{c.exports=_jsx_runtime});var v={};g(v,{default:()=\u003eN,frontmatter:()=\u003eb});var e=f(o()),b={title:\"Envelope Encryption: Boosting Cloud Security with KMS\",date:\"2023-07-02\",tags:[\"Cloud\",\"AWS\",\"Cryptography\"],draft:!1,summary:\"Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data.\",images:[]};function w(t={}){let{wrapper:a}=t.components||{};return a?(0,e.jsx)(a,Object.assign({},t,{children:(0,e.jsx)(s,{})})):s();function s(){let n=Object.assign({p:\"p\",strong:\"strong\",h2:\"h2\",a:\"a\",span:\"span\",ol:\"ol\",li:\"li\",h3:\"h3\",pre:\"pre\",code:\"code\",ul:\"ul\"},t.components),{Image:l}=n;return l||x(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"Way back in the dial-up era, long before the cloud was even a twinkle in a developer's eye, I was reading this legendary tome: 'Practical Unix \u0026 Internet Security'. It was dense, it was epic, and it taught me that cryptography was basically the secret magic that holds the entire internet together.\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/general/practical_unix_internet_sec.jpeg\"}),(0,e.jsxs)(n.p,{children:[\"Fast forward to today, and guess what? That ancient magic is more important than ever. In the cloud, we're constantly shuffling data around, and we need a rock-solid way to keep it safe. One of the most clever spells in the modern wizard's book is \",(0,e.jsx)(n.strong,{children:\"Envelope Encryption\"}),\".\"]}),(0,e.jsxs)(n.h2,{id:\"what-the-heck-is-envelope-encryption-a-silly-analogy\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#what-the-heck-is-envelope-encryption-a-silly-analogy\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What the Heck is Envelope Encryption? A Silly Analogy\"]}),(0,e.jsx)(n.p,{children:\"Okay, the name sounds fancy, but the concept is simple. Imagine this:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsxs)(n.li,{children:[\"You have a very long, secret letter you want to protect (this is \",(0,e.jsx)(n.strong,{children:\"your data\"}),\").\"]}),(0,e.jsxs)(n.li,{children:[\"You lock it in a sturdy metal box using a simple, everyday key. This key is fast and efficient for locking big boxes. (This is your \",(0,e.jsx)(n.strong,{children:\"Data Key\"}),\").\"]}),(0,e.jsx)(n.li,{children:\"Now you have a problem: what do you do with the key to the box? You can't just tape it to the lid!\"}),(0,e.jsxs)(n.li,{children:[\"So, you take that small, simple key and lock it inside a tiny, nearly-indestructible safe. This safe requires a huge, complex, one-of-a-kind key to open it. (This is your \",(0,e.jsx)(n.strong,{children:\"Master Key\"}),\" from KMS).\"]}),(0,e.jsx)(n.li,{children:'Finally, you take the tiny, locked safe (the encrypted data key) and glue it to the outside of the big metal box (your encrypted data). This tiny safe is the \"envelope.\"'})]}),(0,e.jsx)(n.p,{children:\"That's it! You get the best of both worlds: the speed of a simple key for your big data, and the super-high security of a master key for protecting that simple key. The master key itself never even touches your data.\"}),(0,e.jsxs)(n.h2,{id:\"lets-do-it-for-real-with-aws-kms\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#lets-do-it-for-real-with-aws-kms\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Let's Do It for Real with AWS KMS\"]}),(0,e.jsx)(n.p,{children:\"Let's put the analogy into practice. We'll use AWS KMS as our master locksmith and the command-line tool OpenSSL to handle the actual file locking.\"}),(0,e.jsxs)(n.h3,{id:\"step-1-generate-the-keys\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#step-1-generate-the-keys\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Step 1: Generate the Keys\"]}),(0,e.jsx)(n.p,{children:\"First, we ask our master locksmith (KMS) to create our key set. We need to give it the ID of our master key, which is the big, complex key that never leaves the KMS vault.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`aws kms generate-data-key --key-id 085865dc-8e72-42a9-94d6-f60cb43f637b --key-spec AES_256\n`})})}),(0,e.jsx)(n.p,{children:\"Make sure you've already created a master key in your KMS console to get an ID like this.\"}),(0,e.jsx)(l,{width:400,src:\"/static/images/general/general_kms_arn.png\"}),(0,e.jsx)(n.p,{children:\"KMS will hand you back two important things:\"}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"CiphertextBlob\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"AQIDAHgp3upyUvXfYTtaE+GSFfzK5pkL/Jc37eipuMi8fqwifwGrgrzt+nBcuzgUefb0Tr7gAAAAfjB8BgkqhkiG9w0BBwagbzBtAgEAMGgGCSqGSIb3DQEHATAeBglghkgBZQMEAS4wEQQMY626nlBe9k1ZWwoMAgEQgDuvQdZS/mBKVl0cF35ht7iq4WTz1ZlOW/kBARrndF7RHSxU3Kvc7+0PSpcJ28wcmeicvfxdzEs8R681kQ==\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Plaintext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"KeyId\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"Plaintext\"}),\": This is the simple, everyday key for our big metal box. We'll use this to encrypt our file.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"CiphertextBlob\"}),': This is the tiny, indestructible safe with our simple key locked inside. This is the \"envelope\" itself.']})]}),(0,e.jsxs)(n.h3,{id:\"step-2-lock-the-file\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#step-2-lock-the-file\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Step 2: Lock the File\"]}),(0,e.jsx)(n.p,{children:\"First, let's save our tiny safe (the encrypted key) to a file.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"CiphertextBlob\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" base64 -d \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` enc_data_key.bin\n`]})})}),(0,e.jsxs)(n.p,{children:[\"(Just copy the big string of gibberish from the \",(0,e.jsx)(n.code,{children:\"CiphertextBlob\"}),\" field and paste it where \",(0,e.jsx)(n.code,{children:\"\u003cCiphertextBlob\u003e\"}),\" is).\"]}),(0,e.jsxs)(n.p,{children:[\"Now, we use the simple key (\",(0,e.jsx)(n.code,{children:\"Plaintext\"}),\") to encrypt our actual secret file using OpenSSL.\"]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"openssl enc -aes-256-cbc -pbkdf2 -in secret_file.txt -out encrypted_secret_file.txt -pass pass:\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"Plaintext\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})})}),(0,e.jsxs)(n.p,{children:[\"(Again, just copy the \",(0,e.jsx)(n.code,{children:\"Plaintext\"}),\" value. And yes, you might need to install OpenSSL if you're on a Mac: \",(0,e.jsx)(n.code,{children:\"brew install openssl\"}),\").\"]}),(0,e.jsxs)(n.p,{children:[\"At this point, you can safely delete the plaintext key from your memory. All you need to store is the \",(0,e.jsx)(n.code,{children:\"encrypted_secret_file.txt\"}),\" and the \",(0,e.jsx)(n.code,{children:\"enc_data_key.bin\"}),\" (our tiny safe).\"]}),(0,e.jsxs)(n.h3,{id:\"step-3-the-unlocking-process\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#step-3-the-unlocking-process\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Step 3: The Unlocking Process\"]}),(0,e.jsx)(n.p,{children:\"To get our secret back, we just do everything in reverse.\"}),(0,e.jsx)(n.p,{children:\"First, we ask the master locksmith (KMS) to unlock our tiny safe.\"}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`aws kms decrypt --ciphertext-blob fileb://enc_data_key.bin\n`})})}),(0,e.jsxs)(n.p,{children:[\"KMS will use the master key to open it and give us back the simple \",(0,e.jsx)(n.code,{children:\"Plaintext\"}),\" key.\"]}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"KeyId\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"arn:aws:kms:us-west-2:392653644284:key/085865dc-8e72-42a9-94d6-f60cb43f637b\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"Plaintext\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"4iP4KiWfyMT43I6VnlmbTXB59ZaWp5U6ZOwCeOKFTOE=\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"EncryptionAlgorithm\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"SYMMETRIC_DEFAULT\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Finally, we use that decrypted \",(0,e.jsx)(n.code,{children:\"Plaintext\"}),\" key to unlock our big file.\"]}),(0,e.jsx)(n.pre,{className:\"language-shell\",children:(0,e.jsx)(n.code,{className:\"language-shell code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"openssl enc -d -aes-256-cbc -pbkdf2 -in encrypted_secret_file.txt -out decrypted_secret_file.txt -pass pass:\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"Plaintext\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})})}),(0,e.jsxs)(n.p,{children:[\"And just like that, \",(0,e.jsx)(n.code,{children:\"decrypted_secret_file.txt\"}),\" appears, and our secret letter is readable again!\"]}),(0,e.jsxs)(n.h2,{id:\"the-aha-moment-this-is-everywhere\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#the-aha-moment-this-is-everywhere\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),'The \"Aha!\" Moment: This Is Everywhere!']}),(0,e.jsx)(n.p,{children:`Now, you might be thinking, \"Cool trick, Ted, but that's a lot of command-line work.\" But here's the kicker: you've been using this pattern all along without even knowing it!`}),(0,e.jsxs)(n.p,{children:[\"Recently at work, I was digging into how Kubernetes handles its secrets. When you enable encryption for secrets at rest, guess what technology it uses under the hood? \",(0,e.jsx)(n.strong,{children:\"Envelope encryption!\"}),\" Kubernetes encrypts your secrets with a data key, and then it encrypts that data key with a master key from a provider like AWS KMS. The encrypted secrets and the encrypted data key are then stored safely in \",(0,e.jsx)(n.code,{children:\"etcd\"}),\".\"]}),(0,e.jsxs)(n.p,{children:['It was a real \"aha!\" moment for me. As the old saying goes, ',(0,e.jsx)(n.strong,{children:\"\\u529F\\u4E0D\\u5510\\u6350 (g\\u014Dng b\\xF9 t\\xE1ng ju\\u0101n)\"}),\"\\u2014no effort is ever truly wasted. Learning these fundamental security concepts pays off in the most unexpected places.\"]})]})}}var N=w;function x(t,a){throw new Error(\"Expected \"+(a?\"component\":\"object\")+\" `\"+t+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"What the Heck is Envelope Encryption? A Silly Analogy","url":"#what-the-heck-is-envelope-encryption-a-silly-analogy","depth":2},{"value":"Let's Do It for Real with AWS KMS","url":"#lets-do-it-for-real-with-aws-kms","depth":2},{"value":"Step 1: Generate the Keys","url":"#step-1-generate-the-keys","depth":3},{"value":"Step 2: Lock the File","url":"#step-2-lock-the-file","depth":3},{"value":"Step 3: The Unlocking Process","url":"#step-3-the-unlocking-process","depth":3},{"value":"The \"Aha!\" Moment: This Is Everywhere!","url":"#the-aha-moment-this-is-everywhere","depth":2}],"frontMatter":{"readingTime":{"text":"5 min read","minutes":4.43,"time":265800,"words":886},"slug":"general/envelope_encr.md","fileName":"general/envelope_encr.md.md","title":"Envelope Encryption: Boosting Cloud Security with KMS","date":"2023-07-02T00:00:00.000Z","tags":["Cloud","AWS","Cryptography"],"draft":false,"summary":"Explore envelope encryption and its importance for cloud security, using AWS Key Management Service (KMS) and OpenSSL to protect sensitive data.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"A Look Back at WeChat's PhxSQL and the 'Fastest Majority'","date":"2025-07-18T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This post explores how WeChat's PhxSQL uses the \"Fastest Majority\" principle to offer a timeless lesson in designing fast and resilient distributed database systems.","images":[],"slug":"general/phxsql"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["general","envelope_encr.md"]},"buildId":"0dwZe4eVU0jMD5Rxz286r","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>