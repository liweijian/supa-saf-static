<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>InfoSec Architect 102-Service Accounts in the Linux Universe</title><meta name="robots" content="follow, index"/><meta name="description" content="This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber."/><meta property="og:url" content="https://www.supasaf.com/blog/general/kerberos_ldap"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber."/><meta property="og:title" content="InfoSec Architect 102-Service Accounts in the Linux Universe"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="InfoSec Architect 102-Service Accounts in the Linux Universe"/><meta name="twitter:description" content="This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/general/kerberos_ldap"/><meta property="article:published_time" content="2025-10-08T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/general/kerberos_ldap"
  },
  "headline": "InfoSec Architect 102-Service Accounts in the Linux Universe",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2025-10-08T00:00:00.000Z",
  "dateModified": "2025-10-08T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/EMYzY6LkauV-oRT0pwBJn/_buildManifest.js" defer=""></script><script src="/_next/static/EMYzY6LkauV-oRT0pwBJn/_ssgManifest.js" defer=""></script><script src="/_next/static/EMYzY6LkauV-oRT0pwBJn/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-10-08T00:00:00.000Z">Wednesday, October 8, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">InfoSec Architect 102-Service Accounts in the Linux Universe</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>Hey everyone! Remember our <a target="_blank" rel="noopener noreferrer" href="https://www.supasaf.com/blog/service-account-1">last adventure</a> into the &quot;Stone Age&quot; of service accounts with Windows? We tamed Active Directory and made SQL Server bow down to the magic of Kerberos without a single password.</p><p>Well, I fell down the rabbit hole and stumbled upon an awesome blog post from Uber Engineering: <a target="_blank" rel="noopener noreferrer" href="https://www.uber.com/en-HK/blog/scaling-adoption-of-kerberos-at-uber/">Scaling Adoption of Kerberos at Uber</a>. They&#x27;re using this &quot;ancient&quot; protocol to secure a massive data platform with thousands of machines. If it&#x27;s good enough for Uber, it&#x27;s good enough for our lab!</p><p>Inspired, I decided to build a sequel. This time, we&#x27;re leaving the cozy world of Windows and diving into Linux. We&#x27;ll build a mini security kingdom from scratch on a single Ubuntu VM, using Kerberos and its trusty sidekick, LDAP.</p><p>Before we start, let&#x27;s get our analogies straight:</p><ul><li><p><strong>LDAP (Lightweight Directory Access Protocol)</strong>: Think of this as a super-organized &quot;<strong>company phonebook</strong>.&quot; It stores info about users, groups, and computers in a neat tree structure.</p></li><li><p><strong>Kerberos</strong>: This is your network&#x27;s very strict &quot;<strong>bouncer</strong>.&quot; It checks everyone&#x27;s ID at the door and gives them special tickets so they can access other services without flashing their password all over the place.</p></li></ul><p>Let&#x27;s get our hands dirty!</p><h2 id="part-1-installation-and-basic-setup"><a href="#part-1-installation-and-basic-setup" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Part 1: Installation and Basic Setup</h2><p>First, I SSH&#x27;d into my fresh Ubuntu server and installed all the goodies we&#x27;ll need.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># Update system packages</span>
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade -y
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Install LDAP core services and tools</span>
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y slapd ldap-utils
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Install Kerberos Key Distribution Center (KDC), admin server, and client tools</span>
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y krb5-kdc krb5-admin-server krb5-user
</span></code></pre></div><p>During the <code>krb5</code> installation, a friendly wizard pops up. This is our first meeting with the Kerberos bouncer.</p><ul><li><p>Default Kerberos version 5 realm: <code>SUPASAF.COM</code></p><ul><li>Nerd Note: A Realm is the kingdom Kerberos manages. It&#x27;s like a domain in Windows Active Directory. By convention, it&#x27;s just your domain name, but in all caps.</li></ul></li><li><p>Kerberos servers for your realm: <code>localhost</code></p></li><li><p>Administrative server for your Kerberos realm: <code>localhost</code></p><ul><li>Since we&#x27;re building our entire kingdom on one machine, all roads lead to <code>localhost</code>.</li></ul></li></ul><p>Next, we&#x27;ll configure the LDAP service using its own setup wizard.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> dpkg-reconfigure slapd
</span></code></pre></div><p>Of course! It&#x27;s great to see you&#x27;re continuing your hands-on exploration of Kerberos. Building on your last post is a fantastic idea.</p><p>Here is a draft for your follow-up blog post, written in simple, humorous English, keeping all your code and correcting minor technical points for clarity.</p><p>InfoSec Architect 101: Service Accounts in the Linux Universe Author: Ted Twitter: @supasaf</p><p>Hey everyone! Remember our last adventure into the &quot;Stone Age&quot; of service accounts with Windows? We tamed Active Directory and made SQL Server bow down to the magic of Kerberos without a single password.</p><p>Well, I fell down the rabbit hole and stumbled upon an awesome blog post from Uber Engineering: Scaling Adoption of Kerberos at Uber. They&#x27;re using this &quot;ancient&quot; protocol to secure a massive data platform with thousands of machines. If it&#x27;s good enough for Uber, it&#x27;s good enough for our lab!</p><p>Inspired, I decided to build a sequel. This time, we&#x27;re leaving the cozy world of Windows and diving into Linux. We&#x27;ll build a mini security kingdom from scratch on a single Ubuntu VM, using Kerberos and its trusty sidekick, LDAP.</p><p>Before we start, let&#x27;s get our analogies straight:</p><p>LDAP (Lightweight Directory Access Protocol): Think of this as a super-organized &quot;company phonebook.&quot; It stores info about users, groups, and computers in a neat tree structure.</p><p>Kerberos: This is your network&#x27;s very strict &quot;bouncer.&quot; It checks everyone&#x27;s ID at the door and gives them special tickets so they can access other services without flashing their password all over the place.</p><p>Let&#x27;s get our hands dirty!</p><p>Part 1: Installation and Basic Setup Getting the Tools First, I SSH&#x27;d into my fresh Ubuntu server and installed all the goodies we&#x27;ll need.</p><p>Bash</p><h1 id="ssh-into-my-server"><a href="#ssh-into-my-server" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>SSH into my server</h1><p>ssh ss@172.28.78.83</p><h1 id="update-system-packages"><a href="#update-system-packages" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Update system packages</h1><p>sudo apt update &amp;&amp; sudo apt upgrade -y</p><h1 id="install-ldap-core-services-and-tools"><a href="#install-ldap-core-services-and-tools" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Install LDAP core services and tools</h1><p>sudo apt install -y slapd ldap-utils</p><h1 id="install-kerberos-key-distribution-center-kdc-admin-server-and-client-tools"><a href="#install-kerberos-key-distribution-center-kdc-admin-server-and-client-tools" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Install Kerberos Key Distribution Center (KDC), admin server, and client tools</h1><p>sudo apt install -y krb5-kdc krb5-admin-server krb5-user During the krb5 installation, a friendly wizard pops up. This is our first meeting with the Kerberos bouncer.</p><p>Default Kerberos version 5 realm: SUPASAF.COM</p><p>Nerd Note: A Realm is the kingdom Kerberos manages. It&#x27;s like a domain in Windows Active Directory. By convention, it&#x27;s just your domain name, but in all caps.</p><p>Kerberos servers for your realm: localhost</p><p>Administrative server for your Kerberos realm: localhost</p><p>Since we&#x27;re building our entire kingdom on one machine, all roads lead to localhost.</p><p>Next, we&#x27;ll configure the LDAP service using its own setup wizard.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> dpkg-reconfigure slapd
</span></code></pre></div><p>Here are the choices I made:</p><ul><li><p><strong>Omit OpenLDAP server configuration?</strong> <code>No</code> (We definitely want to configure it!)</p></li><li><p><strong>DNS domain name</strong>: <code>supasaf.com</code></p><ul><li>This is important! It automatically creates the Base DN (Distinguished Name) for our directory, which will be <code>dc=supasaf,dc=com</code>. The DN is like the full file path to an entry in LDAP. <code>dc</code> stands for &quot;Domain Component.&quot;</li></ul></li><li><p><strong>Organization name</strong>: <code>Supasaf</code></p></li><li><p><strong>Administrator password</strong>: Pick a strong password (e.g., <code>admin&amp;*&amp;^@%28642</code>)</p></li><li><p><strong>Remove the database when slapd is purged</strong>? <code>No</code></p></li><li><p><strong>Move old database</strong>? <code>Yes</code></p></li></ul><p>Once that&#x27;s done, let&#x27;s peek inside our new, empty phonebook with <code>ldapsearch</code>.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~$ ldapsearch -x -LLL -b <span class="token string">&quot;dc=supasaf,dc=com&quot;</span>
</span><span class="code-line">dn: <span class="token assign-left variable">dc</span><span class="token operator">=</span>supasaf,dc<span class="token operator">=</span>com
</span><span class="code-line">objectClass: <span class="token function">top</span>
</span><span class="code-line">objectClass: dcObject
</span><span class="code-line">objectClass: organization
</span><span class="code-line">o: Supasaf
</span><span class="code-line">dc: supasaf
</span></code></pre></div><p>Looks good! The root of our directory exists.</p><p>Now, let&#x27;s create the database and the master key for our Kerberos realm.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> krb5_newrealm
</span><span class="code-line"><span class="token comment"># The system will ask you to enter and confirm the KDC master password, for example: master123</span>
</span></code></pre></div><p>This password is the key to the entire kingdom. Guard it well!</p><h2 id="creating-users-and-getting-tickets"><a href="#creating-users-and-getting-tickets" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Creating Users and Getting Tickets</h2><p>In Kerberos, every user, service, or machine is called a <strong>Principal</strong>. Let&#x27;s add a test user with the <code>kadmin.local</code> tool.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~$ <span class="token function">sudo</span> kadmin.local
</span><span class="code-line">Authenticating as principal root/admin@SUPASAF.COM with password.
</span><span class="code-line">kadmin.local:  addprinc testuser@SUPASAF.COM
</span><span class="code-line">No policy specified <span class="token keyword">for</span> testuser@SUPASAF.COM<span class="token punctuation">;</span> defaulting to no policy
</span><span class="code-line">Enter password <span class="token keyword">for</span> principal <span class="token string">&quot;testuser@SUPASAF.COM&quot;</span><span class="token class-name builtin">:</span> <span class="token comment"># Enter a password</span>
</span><span class="code-line">Re-enter password <span class="token keyword">for</span> principal <span class="token string">&quot;testuser@SUPASAF.COM&quot;</span><span class="token class-name builtin">:</span> <span class="token comment"># Confirm it</span>
</span><span class="code-line">Principal <span class="token string">&quot;testuser@SUPASAF.COM&quot;</span> created.
</span><span class="code-line">kadmin.local:  quit
</span></code></pre></div><h3 id="the-heart-of-kerberos-tickets"><a href="#the-heart-of-kerberos-tickets" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Heart of Kerberos: Tickets!</h3><p>This is where the magic happens. Instead of sending your password to every service, the flow works like this:</p><ol><li><p><strong>Authentication</strong> (<code>kinit</code>): You prove your identity to the KDC (the bouncer) using your password, just once.</p></li><li><p><strong>Get a TGT</strong>: The KDC gives you a <strong>TGT (Ticket-Granting Ticket)</strong>. Think of this as a temporary ID badge or a &quot;master ticket.&quot;</p></li><li><p><strong>Get a Service Ticket</strong>: When you want to access a service (like a database), you show your TGT to the KDC and ask for a specific ticket for that service.</p></li><li><p><strong>Access the Service</strong>: The KDC gives you a <strong>Service Ticket</strong>. You show this special ticket to the database, and it lets you in. No password ever crosses the network!</p></li></ol><p>Let&#x27;s try it:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># 1. Use kinit to ask the KDC for a TGT</span>
</span><span class="code-line">ss@ss:~$ kinit testuser@SUPASAF.COM
</span><span class="code-line">Password <span class="token keyword">for</span> testuser@SUPASAF.COM: <span class="token comment"># Enter the password</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 2. Use klist to see the ticket we received</span>
</span><span class="code-line">ss@ss:~$ klist
</span><span class="code-line">Ticket cache: FILE:/tmp/krb5cc_1000
</span><span class="code-line">Default principal: testuser@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line">Valid starting         Expires                Service principal
</span><span class="code-line"><span class="token number">10</span>/02/2025 <span class="token number">17</span>:29:27  <span class="token number">10</span>/03/2025 03:29:27  krbtgt/SUPASAF.COM@SUPASAF.COM
</span><span class="code-line">        renew <span class="token keyword">until</span> <span class="token number">10</span>/03/2025 <span class="token number">17</span>:29:23
</span></code></pre></div><p>Success! We got a ticket for <code>krbtgt/SUPASAF.COM@SUPASAF.COM</code>. That&#x27;s our TGT.</p><h3 id="organizing-our-ldap-phonebook"><a href="#organizing-our-ldap-phonebook" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Organizing our LDAP Phonebook</h3><p>A good phonebook has sections. Let&#x27;s create some &quot;folders&quot; (Organizational Units, or OUs) for our users, groups, and services using an <strong>LDIF (LDAP Data Interchange Format)</strong> file.</p><p>Create a file named <code>add-structure.ldif</code>:</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token comment"># Create the users Organizational Unit (OU)</span>
</span><span class="code-line"><span class="token atrule key">dn</span><span class="token punctuation">:</span> ou=users<span class="token punctuation">,</span>dc=supasaf<span class="token punctuation">,</span>dc=com
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> organizationalUnit
</span><span class="code-line"><span class="token atrule key">ou</span><span class="token punctuation">:</span> users
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create the groups OU</span>
</span><span class="code-line"><span class="token atrule key">dn</span><span class="token punctuation">:</span> ou=groups<span class="token punctuation">,</span>dc=supasaf<span class="token punctuation">,</span>dc=com
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> organizationalUnit
</span><span class="code-line"><span class="token atrule key">ou</span><span class="token punctuation">:</span> groups
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create the services OU</span>
</span><span class="code-line"><span class="token atrule key">dn</span><span class="token punctuation">:</span> ou=services<span class="token punctuation">,</span>dc=supasaf<span class="token punctuation">,</span>dc=com
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> organizationalUnit
</span><span class="code-line"><span class="token atrule key">ou</span><span class="token punctuation">:</span> services
</span></code></pre></div><p>Now, use <code>ldapadd</code> to load this structure into our directory.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~/ldap1002$ ldapadd -x -D <span class="token string">&quot;cn=admin,dc=supasaf,dc=com&quot;</span> -W -f add-structure.ldif
</span><span class="code-line">Enter LDAP Password: <span class="token comment"># Enter the admin password you set earlier</span>
</span><span class="code-line">adding new entry <span class="token string">&quot;ou=users,dc=supasaf,dc=com&quot;</span>
</span><span class="code-line">adding new entry <span class="token string">&quot;ou=groups,dc=supasaf,dc=com&quot;</span>
</span><span class="code-line">adding new entry <span class="token string">&quot;ou=services,dc=supasaf,dc=com&quot;</span>
</span></code></pre></div><h3 id="adding-users-to-the-phonebook"><a href="#adding-users-to-the-phonebook" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Adding Users to the Phonebook</h3><p>Let&#x27;s add two users, Alice and Bob, using another LDIF file.</p><p>Create <code>add-users.ldif</code>:</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">dn</span><span class="token punctuation">:</span> uid=alice<span class="token punctuation">,</span>ou=users<span class="token punctuation">,</span>dc=supasaf<span class="token punctuation">,</span>dc=com
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> inetOrgPerson
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> posixAccount
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> shadowAccount
</span><span class="code-line"><span class="token atrule key">uid</span><span class="token punctuation">:</span> alice
</span><span class="code-line"><span class="token atrule key">cn</span><span class="token punctuation">:</span> Alice Wang
</span><span class="code-line"><span class="token atrule key">sn</span><span class="token punctuation">:</span> Wang
</span><span class="code-line"><span class="token atrule key">loginShell</span><span class="token punctuation">:</span> /bin/bash
</span><span class="code-line"><span class="token atrule key">uidNumber</span><span class="token punctuation">:</span> <span class="token number">10001</span>
</span><span class="code-line"><span class="token atrule key">gidNumber</span><span class="token punctuation">:</span> <span class="token number">10001</span>
</span><span class="code-line"><span class="token atrule key">homeDirectory</span><span class="token punctuation">:</span> /home/alice
</span><span class="code-line"><span class="token atrule key">userPassword</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>SSHA<span class="token punctuation">}</span>IoOlXeNSaWG0jxUZcJQib6yAF/dzchFd <span class="token comment"># This needs to be generated</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token atrule key">dn</span><span class="token punctuation">:</span> uid=bob<span class="token punctuation">,</span>ou=users<span class="token punctuation">,</span>dc=supasaf<span class="token punctuation">,</span>dc=com
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> inetOrgPerson
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> posixAccount
</span><span class="code-line"><span class="token atrule key">objectClass</span><span class="token punctuation">:</span> shadowAccount
</span><span class="code-line"><span class="token atrule key">uid</span><span class="token punctuation">:</span> bob
</span><span class="code-line"><span class="token atrule key">cn</span><span class="token punctuation">:</span> Bob Li
</span><span class="code-line"><span class="token atrule key">sn</span><span class="token punctuation">:</span> Li
</span><span class="code-line"><span class="token atrule key">loginShell</span><span class="token punctuation">:</span> /bin/bash
</span><span class="code-line"><span class="token atrule key">uidNumber</span><span class="token punctuation">:</span> <span class="token number">10002</span>
</span><span class="code-line"><span class="token atrule key">gidNumber</span><span class="token punctuation">:</span> <span class="token number">10002</span>
</span><span class="code-line"><span class="token atrule key">homeDirectory</span><span class="token punctuation">:</span> /home/bob
</span><span class="code-line"><span class="token atrule key">userPassword</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>SSHA<span class="token punctuation">}</span>another_password_hash_here
</span></code></pre></div><p>We should never store plaintext passwords. Let&#x27;s generate a secure hash with <code>slappasswd</code>.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~/ldap1002$ slappasswd
</span><span class="code-line">New password: <span class="token comment"># Enter a password</span>
</span><span class="code-line">Re-enter new password: <span class="token comment"># Confirm it</span>
</span><span class="code-line"><span class="token punctuation">{</span>SSHA<span class="token punctuation">}</span>IoOlXeNSaWG0jxUZcJQib6yAF/dzchFd <span class="token comment"># Copy this hash</span>
</span></code></pre></div><p>Paste your generated hashes into the <code>add-users.ldif</code> file, then add them to LDAP.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~/ldap1002$ ldapadd -x -D <span class="token string">&quot;cn=admin,dc=supasaf,dc=com&quot;</span> -W -f add-users.ldif
</span><span class="code-line">Enter LDAP Password:
</span><span class="code-line">adding new entry <span class="token string">&quot;uid=alice,ou=users,dc=supasaf,dc=com&quot;</span>
</span><span class="code-line">adding new entry <span class="token string">&quot;uid=bob,ou=users,dc=supasaf,dc=com&quot;</span>
</span></code></pre></div><p>Great! Now we have users in both Kerberos and LDAP. But they don&#x27;t know about each other yet. Let&#x27;s connect them.</p><h2 id="integrating-ldap-with-kerberos"><a href="#integrating-ldap-with-kerberos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Integrating LDAP with Kerberos</h2><p>We want to make LDAP stop using its own simple passwords and start using our fancy Kerberos bouncer for authentication. The magical glue for this is <strong>SASL</strong>.</p><h3 id="what-the-heck-is-sasl"><a href="#what-the-heck-is-sasl" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What the Heck is SASL?</h3><ul><li><p><strong>What is SASL?</strong> SASL (Simple Authentication and Security Layer) is not an authentication method itself; it&#x27;s a framework. Think of it as a universal power adapter. Your application (LDAP) has one SASL socket, and you can plug in different authentication &quot;plugs&quot; like Kerberos (<code>GSSAPI</code>), <code>PLAIN</code>, etc.</p></li><li><p><strong>Is SASL Secure?</strong> That depends entirely on the &quot;plug&quot; (mechanism) you use. If you use <code>PLAIN</code>, your password travels in cleartext (very bad!). If you use <code>GSSAPI</code> (which uses Kerberos), it&#x27;s highly secure. So, SASL&#x27;s security is determined by the mechanism it uses.</p></li><li><p><strong>SASL and Kerberos?</strong> In our setup, Kerberos is the security &quot;engine,&quot; and SASL is the &quot;driveshaft&quot; that connects the engine to our LDAP application. LDAP uses the SASL framework to delegate the hard work of authentication to Kerberos.</p></li></ul><h3 id="configuring-ldap-to-use-kerberos"><a href="#configuring-ldap-to-use-kerberos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Configuring LDAP to Use Kerberos</h3><p>First, we need to install the SASL libraries that know how to talk to Kerberos.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y sasl2-bin libsasl2-modules-gssapi-mit
</span></code></pre></div><p>Just like a user, our LDAP service needs its own identity (Principal) to talk to the KDC. But since it&#x27;s a background service, it can&#x27;t type a password. So, we use a <strong>Keytab</strong> file.</p><p>A <strong>Keytab (Key Table)</strong> file is basically a password file for services. It holds the secret keys for one or more principals, allowing them to authenticate automatically without human help. This is the core problem Uber&#x27;s &quot;Keytab Distribution Pipeline&quot; solves: how to securely manage and distribute these secret files.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">sudo</span> kadmin.local
</span><span class="code-line">Authenticating as principal root/admin@SUPASAF.COM with password.
</span><span class="code-line"><span class="token comment"># -randkey generates a random key, which is much more secure than a password</span>
</span><span class="code-line">kadmin.local:  addprinc -randkey ldap/ss@SUPASAF.COM
</span><span class="code-line">Principal <span class="token string">&quot;ldap/ss@SUPASAF.COM&quot;</span> created.
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Export this principal&#x27;s key into a keytab file</span>
</span><span class="code-line">kadmin.local:  ktadd -k /etc/ldap/ldap.keytab ldap/ss@SUPASAF.COM
</span><span class="code-line">Entry <span class="token keyword">for</span> principal ldap/ss@SUPASAF.COM with kvno <span class="token number">2</span>, <span class="token punctuation">..</span>. added to keytab WRFILE:/etc/ldap/ldap.keytab.
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">kadmin.local:  quit
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># This keytab file is super sensitive. Lock it down!</span>
</span><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">sudo</span> <span class="token function">chown</span> openldap:openldap /etc/ldap/ldap.keytab
</span><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">400</span> /etc/ldap/ldap.keytab
</span></code></pre></div><p>Now, let&#x27;s tell the SASL daemon to use our Kerberos bouncer. Edit <code>/etc/default/saslauthd</code>.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># Edit the file</span>
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/default/saslauthd
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Change the content to this:</span>
</span><span class="code-line"><span class="token assign-left variable">START</span><span class="token operator">=</span>yes
</span><span class="code-line"><span class="token assign-left variable">MECHANISMS</span><span class="token operator">=</span><span class="token string">&quot;kerberos5&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Restart the services to apply our changes</span>
</span><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">sudo</span> systemctl restart saslauthd
</span><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">sudo</span> systemctl restart slapd
</span></code></pre></div><p>Boom! Our LDAP phonebook now uses our Kerberos bouncer for ID checks.</p><h2 id="simulating-the-uber-service-account-scene"><a href="#simulating-the-uber-service-account-scene" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Simulating the Uber Service Account Scene</h2><p>Uber&#x27;s blog talks about different account types (<code>User</code>, <code>Service</code>, <code>System</code>). The key takeaway is that their backend services (like HDFS, YARN) all use principals and keytabs to authenticate automatically. Let&#x27;s copy them.</p><h3 id="creating-service-principals-and-keytabs"><a href="#creating-service-principals-and-keytabs" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Creating Service Principals and Keytabs</h3><p>Let&#x27;s create principals for a few fake Hadoop services and a business service.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">sudo</span> kadmin.local
</span><span class="code-line">Authenticating as principal root/admin@SUPASAF.COM with password.
</span><span class="code-line"><span class="token comment"># Create principals for HDFS and YARN services</span>
</span><span class="code-line">kadmin.local:  addprinc -randkey hdfs/localhost@SUPASAF.COM
</span><span class="code-line">Principal <span class="token string">&quot;hdfs/localhost@SUPASAF.COM&quot;</span> created.
</span><span class="code-line">kadmin.local:  addprinc -randkey yarn/localhost@SUPASAF.COM
</span><span class="code-line">Principal <span class="token string">&quot;yarn/localhost@SUPASAF.COM&quot;</span> created.
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create a principal for a business service</span>
</span><span class="code-line">kadmin.local:  addprinc -randkey uber_eats@SUPASAF.COM
</span><span class="code-line">Principal <span class="token string">&quot;uber_eats@SUPASAF.COM&quot;</span> created.
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Generate keytabs for our hdfs and uber_eats services</span>
</span><span class="code-line">kadmin.local:  ktadd -k /tmp/hdfs.keytab hdfs/localhost@SUPASAF.COM
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">kadmin.local:  ktadd -k /tmp/uber_eats.keytab uber_eats@SUPASAF.COM
</span><span class="code-line"><span class="token punctuation">..</span>.
</span><span class="code-line">kadmin.local:  quit
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Make sure the service process could read it</span>
</span><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">644</span> /tmp/hdfs.keytab
</span></code></pre></div><h3 id="password-free-authentication-with-a-keytab"><a href="#password-free-authentication-with-a-keytab" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Password-Free Authentication with a Keytab</h3><p>This is the coolest part. Imagine you are the HDFS service starting up. You need to prove your identity to Kerberos, but you don&#x27;t have hands to type a password. You use the <code>-kt</code> flag with <code>kinit</code> to point to your secret keytab file.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># Authenticate using the hdfs.keytab file</span>
</span><span class="code-line">ss@ss:~/ldap1002$ kinit -kt /tmp/hdfs.keytab hdfs/localhost@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Immediately check our ticket cache</span>
</span><span class="code-line">ss@ss:~/ldap1002$ klist
</span><span class="code-line">Ticket cache: FILE:/tmp/krb5cc_1000
</span><span class="code-line">Default principal: hdfs/localhost@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line">Valid starting         Expires                Service principal
</span><span class="code-line"><span class="token number">10</span>/02/2025 <span class="token number">22</span>:07:38  <span class="token number">10</span>/03/2025 08:07:38  krbtgt/SUPASAF.COM@SUPASAF.COM
</span><span class="code-line">        renew <span class="token keyword">until</span> <span class="token number">10</span>/03/2025 <span class="token number">22</span>:07:38
</span></code></pre></div><p>It worked! We, as the <code>hdfs/localhost</code> service, got a TGT without typing any password. This is the foundation for all secure, automated backend services.</p><h2 id="passwordless-postgresql-access-with-kerberos"><a href="#passwordless-postgresql-access-with-kerberos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Passwordless PostgreSQL Access with Kerberos</h2><p>In any big company, applications need to talk to databases securely. Hardcoding passwords in config files is a recipe for disaster. This is why Uber built that keytab pipelineâ€”to let services (like a data analytics app) access other services (like a database) securely and automatically.</p><p>Our final mission: write a Python app that uses a keytab to connect to a PostgreSQL database, read and write data, all without a password in sight.</p><p>First, we need a database that speaks Kerberos. Luckily, the standard PostgreSQL on Ubuntu already does.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y postgresql postgresql-contrib libpq-dev
</span></code></pre></div><p>Let&#x27;s use <code>pg_config</code> to make sure it was built with GSSAPI support (the low-level library for Kerberos).</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~$ pg_config <span class="token operator">|</span> <span class="token function">grep</span> -i gssapi
</span><span class="code-line">CONFIGURE <span class="token operator">=</span>  <span class="token string">&#x27;--build=x86_64-linux-gnu&#x27;</span> <span class="token punctuation">..</span>. <span class="token string">&#x27;--with-gssapi&#x27;</span> <span class="token punctuation">..</span>.
</span><span class="code-line">LIBS <span class="token operator">=</span> <span class="token punctuation">..</span>. -lgssapi_krb5 <span class="token punctuation">..</span>.
</span></code></pre></div><p>The <code>--with-gssapi</code> flag confirms it&#x27;s ready for action!</p><h3 id="creating-principals-for-postgresql-and-our-app"><a href="#creating-principals-for-postgresql-and-our-app" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Creating Principals for PostgreSQL and our App</h3><p>Just like LDAP, our database service and our Python app need their own identities in Kerberos.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># Log in to the kadmin tool</span>
</span><span class="code-line"><span class="token function">sudo</span> kadmin.local
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create a principal for the PostgreSQL service.</span>
</span><span class="code-line"><span class="token comment"># The naming convention is usually: service_name/hostname@REALM</span>
</span><span class="code-line"><span class="token comment"># The hostname &#x27;ss&#x27; MUST match what the client uses to connect.</span>
</span><span class="code-line">kadmin.local<span class="token operator">&gt;</span> addprinc -randkey postgres/ss@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Export its key to a keytab file</span>
</span><span class="code-line">kadmin.local<span class="token operator">&gt;</span> ktadd -k /etc/postgresql/postgres.keytab postgres/ss@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line">kadmin.local<span class="token operator">&gt;</span> quit
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Set the correct permissions so only the postgres user can read this secret file</span>
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">chown</span> postgres:postgres /etc/postgresql/postgres.keytab
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">400</span> /etc/postgresql/postgres.keytab
</span></code></pre></div><p>Now, let&#x27;s create an identity for our Python app, which we&#x27;ll call <code>data_service</code>.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> kadmin.local
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create a principal for our application service</span>
</span><span class="code-line">kadmin.local<span class="token operator">&gt;</span> addprinc -randkey data_service@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Export its keytab, this time to our home directory</span>
</span><span class="code-line">kadmin.local<span class="token operator">&gt;</span> ktadd -k /home/ss/data_service.keytab data_service@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line">kadmin.local<span class="token operator">&gt;</span> quit
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Set permissions so the user running the app (ss) can read it</span>
</span><span class="code-line"><span class="token function">sudo</span> <span class="token function">chown</span> ss:ss /home/ss/data_service.keytab
</span><span class="code-line"><span class="token function">chmod</span> <span class="token number">400</span> /home/ss/data_service.keytab
</span></code></pre></div><h3 id="telling-postgresql-to-trust-kerberos"><a href="#telling-postgresql-to-trust-kerberos" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Telling PostgreSQL to Trust Kerberos</h3><p>We need to tell PostgreSQL about its new Kerberos identity.</p><p><strong>Step 1: Edit postgresql.conf</strong></p><p>This is the main config file. We need to tell it where its keytab is.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/postgresql/16/main/postgresql.conf
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Add or modify these lines at the end of the file</span>
</span><span class="code-line"><span class="token comment"># Kerberos configuration - point to the service&#x27;s own keytab file</span>
</span><span class="code-line">krb_server_keyfile <span class="token operator">=</span> <span class="token string">&#x27;/etc/postgresql/postgres.keytab&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Make sure the database is listening for network connections</span>
</span><span class="code-line">listen_addresses <span class="token operator">=</span> <span class="token string">&#x27;*&#x27;</span>
</span></code></pre></div><p>The <code>krb_server_keyfile</code> setting is the key. It tells PostgreSQL, &quot;When a client comes with a Kerberos ticket, use this file to verify it&#x27;s legit.&quot;</p><p><strong>Step 2: Edit pg_hba.conf</strong></p><p><code>hba</code> stands for &quot;Host-Based Authentication.&quot; This file is PostgreSQL&#x27;s firewall. It defines <strong>who</strong> can connect from where to <strong>which database</strong> using <strong>what method</strong>.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/postgresql/16/main/pg_hba.conf
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Add this rule at the very top of the file to give it priority</span>
</span><span class="code-line"><span class="token comment"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>
</span><span class="code-line"><span class="token function">host</span>    all             all             <span class="token number">127.0</span>.0.1/32            gss <span class="token assign-left variable">include_realm</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">krb_realm</span><span class="token operator">=</span>SUPASAF.COM
</span><span class="code-line"><span class="token function">host</span>    all             all             ::1/128                 gss <span class="token assign-left variable">include_realm</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">krb_realm</span><span class="token operator">=</span>SUPASAF.COM
</span></code></pre></div><p>Here&#x27;s what this rule means:</p><ul><li><p><code>host</code>: Allow TCP/IP connections.</p></li><li><p><code>all all</code>: For all databases and all users.</p></li><li><p><code>127.0.0.1/32</code>: Only from the local machine (for this lab).</p></li><li><p><code>gss</code>: <strong>This is the core!</strong> It means the authentication method must be <strong>GSSAPI</strong> (Kerberos).</p></li><li><p><code>include_realm=0</code>: A handy setting that tells PostgreSQL to strip the <code>@SUPASAF.COM</code> part from the principal name. This way, <code>data_service@SUPASAF.COM</code> is mapped to the database user <code>data_service</code>.</p></li><li><p><code>krb_realm</code>: Specifies which Kerberos realm we trust.</p></li></ul><p>Finally, restart PostgreSQL to make the new configuration active.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token function">sudo</span> systemctl restart postgresql
</span></code></pre></div><h3 id="mapping-identities-in-the-database"><a href="#mapping-identities-in-the-database" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Mapping Identities in the Database</h3><p>Kerberos handles <strong>Authentication</strong> (who you are), but PostgreSQL handles <strong>Authorization</strong> (what you&#x27;re allowed to do). We need to create a database user that matches our Kerberos principal.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># Switch to the postgres system user and open the psql command line</span>
</span><span class="code-line">ss@ss:~$ <span class="token function">sudo</span> -u postgres psql
</span><span class="code-line">psql <span class="token punctuation">(</span><span class="token number">16.10</span> <span class="token punctuation">(</span>Ubuntu <span class="token number">16.10</span>-0ubuntu0.24.04.1<span class="token punctuation">))</span>
</span><span class="code-line">Type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> help.
</span><span class="code-line">
</span><span class="code-line">-- Create a database user corresponding to the Kerberos principal <span class="token string">&#x27;data_service&#x27;</span>
</span><span class="code-line"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># CREATE USER data_service;</span>
</span><span class="code-line">CREATE ROLE
</span><span class="code-line">
</span><span class="code-line">-- Create a <span class="token class-name builtin">test</span> database and give all permissions to our new user
</span><span class="code-line"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># CREATE DATABASE testdb;</span>
</span><span class="code-line">CREATE DATABASE
</span><span class="code-line"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># GRANT ALL PRIVILEGES ON DATABASE testdb TO data_service;</span>
</span><span class="code-line">GRANT
</span><span class="code-line">
</span><span class="code-line">-- Connect to the new database
</span><span class="code-line"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># \c testdb</span>
</span><span class="code-line">You are now connected to database <span class="token string">&quot;testdb&quot;</span> as user <span class="token string">&quot;postgres&quot;</span><span class="token class-name builtin">.</span>
</span><span class="code-line">
</span><span class="code-line">-- Create a <span class="token class-name builtin">test</span> table and grant permissions
</span><span class="code-line"><span class="token assign-left variable">testdb</span><span class="token operator">=</span><span class="token comment"># CREATE TABLE kerberos_test (</span>
</span><span class="code-line">    <span class="token function">id</span> SERIAL PRIMARY KEY,
</span><span class="code-line">    message TEXT,
</span><span class="code-line">    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
</span><span class="code-line"><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">CREATE TABLE
</span><span class="code-line"><span class="token assign-left variable">testdb</span><span class="token operator">=</span><span class="token comment"># GRANT ALL PRIVILEGES ON TABLE kerberos_test TO data_service;</span>
</span><span class="code-line">GRANT
</span><span class="code-line"><span class="token assign-left variable">testdb</span><span class="token operator">=</span><span class="token comment"># GRANT USAGE, SELECT ON SEQUENCE kerberos_test_id_seq TO data_service;</span>
</span><span class="code-line">GRANT
</span><span class="code-line">
</span><span class="code-line">-- Exit psql
</span><span class="code-line"><span class="token assign-left variable">testdb</span><span class="token operator">=</span><span class="token comment"># \q</span>
</span></code></pre></div><p>Now, when <code>data_service@SUPASAF.COM</code> successfully authenticates, PostgreSQL will treat it as the <code>data_service</code> database user and apply these permissions.</p><h3 id="the-grand-finale-pythons-passwordless-db-access"><a href="#the-grand-finale-pythons-passwordless-db-access" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Grand Finale: Python&#x27;s Passwordless DB Access</h3><p>Let&#x27;s write a Python script to simulate our <code>data_service</code> application.</p><p>Install Dependencies:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y libkrb5-dev krb5-user
</span><span class="code-line">ss@ss:~$ pip3 <span class="token function">install</span> psycopg2-binary gssapi --break-system-packages
</span></code></pre></div><p>Create a file named <code>kerberos_db_access.py</code>:</p><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token keyword">import</span> os
</span><span class="code-line"><span class="token keyword">import</span> subprocess
</span><span class="code-line"><span class="token keyword">import</span> psycopg2
</span><span class="code-line"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">KerberosDBConnection</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token string triple-quoted-string">&quot;&quot;&quot;A database connection manager that uses Kerberos authentication.&quot;&quot;&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> keytab_path<span class="token punctuation">,</span> principal<span class="token punctuation">,</span> db_host<span class="token punctuation">,</span> db_name<span class="token punctuation">,</span> db_port<span class="token operator">=</span><span class="token number">5432</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">        Initializes the Kerberos database connection.
</span></span><span class="code-line"><span class="token string triple-quoted-string">
</span></span><span class="code-line"><span class="token string triple-quoted-string">        Args:
</span></span><span class="code-line"><span class="token string triple-quoted-string">            keytab_path: Full path to the keytab file.
</span></span><span class="code-line"><span class="token string triple-quoted-string">            principal: The Kerberos principal (e.g., data_service@SUPASAF.COM).
</span></span><span class="code-line"><span class="token string triple-quoted-string">            db_host: Database hostname.
</span></span><span class="code-line"><span class="token string triple-quoted-string">            db_name: Database name.
</span></span><span class="code-line"><span class="token string triple-quoted-string">            db_port: Database port.
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>keytab_path <span class="token operator">=</span> keytab_path
</span><span class="code-line">        self<span class="token punctuation">.</span>principal <span class="token operator">=</span> principal
</span><span class="code-line">        self<span class="token punctuation">.</span>db_host <span class="token operator">=</span> db_host
</span><span class="code-line">        self<span class="token punctuation">.</span>db_name <span class="token operator">=</span> db_name
</span><span class="code-line">        self<span class="token punctuation">.</span>db_port <span class="token operator">=</span> db_port
</span><span class="code-line">        self<span class="token punctuation">.</span>conn <span class="token operator">=</span> <span class="token boolean">None</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;Perform Kerberos authentication using the keytab.&quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment"># Destroy any existing tickets</span>
</span><span class="code-line">            subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;kdestroy&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>DEVNULL<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment"># Get a TGT using the keytab</span>
</span><span class="code-line">            cmd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#x27;kinit&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;-kt&#x27;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>keytab_path<span class="token punctuation">,</span> self<span class="token punctuation">.</span>principal<span class="token punctuation">]</span>
</span><span class="code-line">            result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">if</span> result<span class="token punctuation">.</span>returncode <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
</span><span class="code-line">                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Kerberos authentication failed: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">.</span>stderr<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;âœ“ Kerberos authentication successful for: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>principal<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment"># Show ticket info</span>
</span><span class="code-line">            klist_result <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;klist&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> capture_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\nCurrent Kerberos Tickets:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span>klist_result<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token boolean">True</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;âœ— Kerberos authentication failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token boolean">False</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;Establish the database connection (using GSSAPI).&quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment"># Extract username from the principal</span>
</span><span class="code-line">            db_user <span class="token operator">=</span> self<span class="token punctuation">.</span>principal<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#x27;@&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment"># Connection string (key part: use gssencmode=prefer)</span>
</span><span class="code-line">            connection_params <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token string">&#x27;host&#x27;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>db_host<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token string">&#x27;port&#x27;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>db_port<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token string">&#x27;dbname&#x27;</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>db_name<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token string">&#x27;user&#x27;</span><span class="token punctuation">:</span> db_user<span class="token punctuation">,</span>
</span><span class="code-line">                <span class="token string">&#x27;gssencmode&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;prefer&#x27;</span><span class="token punctuation">,</span>  <span class="token comment"># Use GSSAPI encryption</span>
</span><span class="code-line">                <span class="token string">&#x27;sslmode&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;prefer&#x27;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\nAttempting to connect to the database...&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Host: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>db_host<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>db_port<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Database: </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>db_name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  User: </span><span class="token interpolation"><span class="token punctuation">{</span>db_user<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Auth Method: Kerberos GSSAPI (Password-Free)&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            self<span class="token punctuation">.</span>conn <span class="token operator">=</span> psycopg2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token operator">**</span>connection_params<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;âœ“ Database connection successful!&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token boolean">True</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;âœ— Database connection failed: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">return</span> <span class="token boolean">False</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">execute_query</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> fetch<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;Execute a SQL query.&quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">&quot;Database is not connected&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">            cursor <span class="token operator">=</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>query<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token comment"># For SELECT or RETURNING clauses, fetch results</span>
</span><span class="code-line">            <span class="token keyword">if</span> fetch <span class="token keyword">or</span> query<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&#x27;SELECT&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">&#x27;RETURNING&#x27;</span> <span class="token keyword">in</span> query<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">                result <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">return</span> result
</span><span class="code-line">            <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">                self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">return</span> cursor<span class="token punctuation">.</span>rowcount
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">raise</span> e
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token string triple-quoted-string">&quot;&quot;&quot;Close the connection.&quot;&quot;&quot;</span>
</span><span class="code-line">        <span class="token keyword">if</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">:</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\nDatabase connection closed.&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token string triple-quoted-string">&quot;&quot;&quot;Main function to demonstrate passwordless Kerberos database access.&quot;&quot;&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Kerberos Passwordless Database Access Demo&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># Configuration (change according to your environment)</span>
</span><span class="code-line">    KEYTAB_PATH <span class="token operator">=</span> <span class="token string">&quot;/home/ss/data_service.keytab&quot;</span>
</span><span class="code-line">    PRINCIPAL <span class="token operator">=</span> <span class="token string">&quot;data_service@SUPASAF.COM&quot;</span>
</span><span class="code-line">    DB_HOST <span class="token operator">=</span> <span class="token string">&quot;ss&quot;</span>  <span class="token comment"># Or use FQDN</span>
</span><span class="code-line">    DB_NAME <span class="token operator">=</span> <span class="token string">&quot;testdb&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment"># Create the connection manager</span>
</span><span class="code-line">    db <span class="token operator">=</span> KerberosDBConnection<span class="token punctuation">(</span>
</span><span class="code-line">        keytab_path<span class="token operator">=</span>KEYTAB_PATH<span class="token punctuation">,</span>
</span><span class="code-line">        principal<span class="token operator">=</span>PRINCIPAL<span class="token punctuation">,</span>
</span><span class="code-line">        db_host<span class="token operator">=</span>DB_HOST<span class="token punctuation">,</span>
</span><span class="code-line">        db_name<span class="token operator">=</span>DB_NAME
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token comment"># Step 1: Kerberos Authentication</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">not</span> db<span class="token punctuation">.</span>authenticate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">return</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># Step 2: Connect to the Database</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token keyword">not</span> db<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token keyword">return</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># Step 3: Insert test data</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Inserting Test Data&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment"># Insert a test record with a timestamp</span>
</span><span class="code-line">        insert_query <span class="token operator">=</span> <span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">            INSERT INTO kerberos_test (message) 
</span></span><span class="code-line"><span class="token string triple-quoted-string">            VALUES (%s) 
</span></span><span class="code-line"><span class="token string triple-quoted-string">            RETURNING id, message, created_at
</span></span><span class="code-line"><span class="token string triple-quoted-string">        &quot;&quot;&quot;</span>
</span><span class="code-line">        test_message <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;Passwordless Kerberos auth test - </span><span class="token interpolation"><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\nInserting message: </span><span class="token interpolation"><span class="token punctuation">{</span>test_message<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        result <span class="token operator">=</span> db<span class="token punctuation">.</span>execute_query<span class="token punctuation">(</span>insert_query<span class="token punctuation">,</span> <span class="token punctuation">(</span>test_message<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> result<span class="token punctuation">:</span>
</span><span class="code-line">            record_id <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</span><span class="code-line">            record_msg <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</span><span class="code-line">            record_time <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\nâœ“ Data inserted successfully!&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Record ID: </span><span class="token interpolation"><span class="token punctuation">{</span>record_id<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Message: </span><span class="token interpolation"><span class="token punctuation">{</span>record_msg<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Timestamp: </span><span class="token interpolation"><span class="token punctuation">{</span>record_time<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Verification Steps&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\nYou can now verify the data was inserted with these commands:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1. Log into the database as the postgres user:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   sudo -u postgres psql -d testdb&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2. Run a query inside psql:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   SELECT * FROM kerberos_test ORDER BY id DESC LIMIT 5;&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3. Or run directly from the command line:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   sudo -u postgres psql -d testdb -c \&quot;SELECT * FROM kerberos_test WHERE id = </span><span class="token interpolation"><span class="token punctuation">{</span>record_id<span class="token punctuation">}</span></span><span class="token string">;\&quot;&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n4. Exit psql:&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;   \\q&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\nâœ“ All operations completed! No database password was used.&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\nâœ— An error occurred: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">import</span> traceback
</span><span class="code-line">        traceback<span class="token punctuation">.</span>print_exc<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">finally</span><span class="token punctuation">:</span>
</span><span class="code-line">        db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
</span><span class="code-line">    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div><p><strong>How It Works: The Ticket&#x27;s Journey</strong></p><ol><li><p><code>db.authenticate()</code>: The script runs <code>kinit -kt ....</code> The app shows its ID card (keytab) to the KDC (bouncer) and gets a <strong>TGT</strong> (the master ticket).</p></li><li><p><code>db.connect()</code>: When <code>psycopg2.connect()</code> is called with <code>gssencmode</code>, the underlying library (<code>libpq</code>) kicks off the GSSAPI process.</p></li><li><p><strong>Get Service Ticket</strong>: <code>libpq</code> sees the TGT in the cache, goes back to the KDC, and says &quot;Hey, I need a ticket to get into the PostgreSQL party (<code>postgres/ss@SUPASAF.COM</code>).&quot;</p></li><li><p><strong>Send Ticket</strong>: <code>libpq</code> gets the specific <strong>Service Ticket</strong> and sends it to the PostgreSQL server during the connection handshake.</p></li><li><p><strong>Server Verification</strong>: The PostgreSQL server receives the ticket and uses its own secret key from <code>postgres.keytab</code> to decrypt it. If it works, the server knows the client is legit.</p></li></ol><p>The whole process forms a secure chain of trust, and no passwords ever travel over the network.</p><p>Let&#x27;s run it!</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># Make sure the keytab file exists and has the right permissions</span>
</span><span class="code-line">ss@ss:~/ldap1002$ <span class="token function">ls</span> -l /home/ss/data_service.keytab
</span><span class="code-line">-r-------- <span class="token number">1</span> ss ss <span class="token number">150</span> Oct  <span class="token number">4</span> <span class="token number">10</span>:22 /home/ss/data_service.keytab
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Run our Python app</span>
</span><span class="code-line">ss@ss:~/ldap1002$ python3 kerberos_db_access.py
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">Kerberos Passwordless Database Access Demo
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">âœ“ Kerberos authentication successful for: data_service@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line">Current Kerberos Tickets:
</span><span class="code-line">Ticket cache: FILE:/tmp/krb5cc_1000
</span><span class="code-line">Default principal: data_service@SUPASAF.COM
</span><span class="code-line">
</span><span class="code-line">Valid starting         Expires                Service principal
</span><span class="code-line"><span class="token number">10</span>/04/2025 <span class="token number">10</span>:55:42  <span class="token number">10</span>/04/2025 <span class="token number">20</span>:55:42  krbtgt/SUPASAF.COM@SUPASAF.COM
</span><span class="code-line">        renew <span class="token keyword">until</span> <span class="token number">10</span>/05/2025 <span class="token number">10</span>:55:42
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">Attempting to connect to the database<span class="token punctuation">..</span>.
</span><span class="code-line">  Host: ss:5432
</span><span class="code-line">  Database: testdb
</span><span class="code-line">  User: data_service
</span><span class="code-line">  Auth Method: Kerberos GSSAPI <span class="token punctuation">(</span>Password-Free<span class="token punctuation">)</span>
</span><span class="code-line">âœ“ Database connection successful<span class="token operator">!</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">Inserting Test Data
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">
</span><span class="code-line">Inserting message: Passwordless Kerberos auth <span class="token class-name builtin">test</span> - <span class="token number">2025</span>-10-04 <span class="token number">10</span>:55:42
</span><span class="code-line">
</span><span class="code-line">âœ“ Data inserted successfully<span class="token operator">!</span>
</span><span class="code-line">  Record ID: <span class="token number">2</span>
</span><span class="code-line">  Message: Passwordless Kerberos auth <span class="token class-name builtin">test</span> - <span class="token number">2025</span>-10-04 <span class="token number">10</span>:55:42
</span><span class="code-line">  Timestamp: <span class="token number">2025</span>-10-04 <span class="token number">10</span>:55:42.331621
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">Verification Steps
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">
</span><span class="code-line">You can now verify the data was inserted with these commands:
</span><span class="code-line">
</span><span class="code-line"><span class="token number">1</span>. Log into the database as the postgres user:
</span><span class="code-line">   <span class="token function">sudo</span> -u postgres psql -d testdb
</span><span class="code-line">
</span><span class="code-line"><span class="token number">2</span>. Run a query inside psql:
</span><span class="code-line">   SELECT * FROM kerberos_test ORDER BY <span class="token function">id</span> DESC LIMIT <span class="token number">5</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token number">3</span>. Or run directly from the <span class="token class-name builtin">command</span> line:
</span><span class="code-line">   <span class="token function">sudo</span> -u postgres psql -d testdb -c <span class="token string">&quot;SELECT * FROM kerberos_test WHERE id = 2;&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token number">4</span>. Exit psql:
</span><span class="code-line">   <span class="token punctuation">\</span>q
</span><span class="code-line">
</span><span class="code-line">âœ“ All operations completed<span class="token operator">!</span> No database password was used.
</span><span class="code-line">
</span><span class="code-line">Database connection closed.
</span></code></pre></div><p>Let&#x27;s follow the instructions from the output and check the database ourselves.</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~$ <span class="token function">sudo</span> -u postgres psql -d testdb
</span><span class="code-line"><span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> ss:
</span><span class="code-line">psql <span class="token punctuation">(</span><span class="token number">16.10</span> <span class="token punctuation">(</span>Ubuntu <span class="token number">16.10</span>-0ubuntu0.24.04.1<span class="token punctuation">))</span>
</span><span class="code-line">Type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> help.
</span><span class="code-line">
</span><span class="code-line"><span class="token assign-left variable">testdb</span><span class="token operator">=</span><span class="token comment"># SELECT * FROM kerberos_test ORDER BY id DESC LIMIT 5;</span>
</span><span class="code-line"> <span class="token function">id</span> <span class="token operator">|</span>                   message                     <span class="token operator">|</span>          created_at
</span><span class="code-line">----+-----------------------------------------------+----------------------------
</span><span class="code-line">  <span class="token number">2</span> <span class="token operator">|</span> Passwordless Kerberos auth <span class="token class-name builtin">test</span> - <span class="token number">2025</span>-10-04 <span class="token number">10</span>:55:42 <span class="token operator">|</span> <span class="token number">2025</span>-10-04 <span class="token number">10</span>:55:42.331621
</span><span class="code-line">  <span class="token number">1</span> <span class="token operator">|</span> Passwordless Kerberos auth <span class="token class-name builtin">test</span> - <span class="token number">2025</span>-10-04 <span class="token number">10</span>:54:02 <span class="token operator">|</span> <span class="token number">2025</span>-10-04 <span class="token number">10</span>:54:02.399912
</span><span class="code-line"><span class="token punctuation">(</span><span class="token number">2</span> rows<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token assign-left variable">testdb</span><span class="token operator">=</span><span class="token comment"># \q</span>
</span></code></pre></div><p>It&#x27;s there! Our Python application, acting as a true service account, authenticated via Kerberos and wrote to the database without ever needing a password.</p><p>So there you have it. From Windows to Linux, Kerberos is still a powerful, relevant tool for building secure systems. It might seem complicated, but breaking it down with a hands-on lab makes all the difference.</p><p>Go build something!</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/architect">Architect</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/spiffe_go_k8s">From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">â† Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> â€¢ </div><div>Â© 2025</div><div> â€¢ </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),u=(a,s)=\u003e{i(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},k=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of p(s))!m.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=d(s,n))||c.enumerable});return a},g=a=\u003ek(i(l(a!=null?o(h(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((A,t)=\u003e{t.exports=_jsx_runtime});var w={};u(w,{default:()=\u003ey,frontmatter:()=\u003eb});var e=g(r()),b={title:\"InfoSec Architect 102-Service Accounts in the Linux Universe\",date:\"2025-10-08\",tags:[\"Architect\"],draft:!1,summary:\"This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber.\",images:[]};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",ul:\"ul\",li:\"li\",strong:\"strong\",h2:\"h2\",span:\"span\",pre:\"pre\",code:\"code\",h1:\"h1\",h3:\"h3\",ol:\"ol\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"Hey everyone! Remember our \",(0,e.jsx)(n.a,{href:\"https://www.supasaf.com/blog/service-account-1\",children:\"last adventure\"}),' into the \"Stone Age\" of service accounts with Windows? We tamed Active Directory and made SQL Server bow down to the magic of Kerberos without a single password.']}),(0,e.jsxs)(n.p,{children:[\"Well, I fell down the rabbit hole and stumbled upon an awesome blog post from Uber Engineering: \",(0,e.jsx)(n.a,{href:\"https://www.uber.com/en-HK/blog/scaling-adoption-of-kerberos-at-uber/\",children:\"Scaling Adoption of Kerberos at Uber\"}),`. They're using this \"ancient\" protocol to secure a massive data platform with thousands of machines. If it's good enough for Uber, it's good enough for our lab!`]}),(0,e.jsx)(n.p,{children:\"Inspired, I decided to build a sequel. This time, we're leaving the cozy world of Windows and diving into Linux. We'll build a mini security kingdom from scratch on a single Ubuntu VM, using Kerberos and its trusty sidekick, LDAP.\"}),(0,e.jsx)(n.p,{children:\"Before we start, let's get our analogies straight:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"LDAP (Lightweight Directory Access Protocol)\"}),': Think of this as a super-organized \"',(0,e.jsx)(n.strong,{children:\"company phonebook\"}),'.\" It stores info about users, groups, and computers in a neat tree structure.']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Kerberos\"}),`: This is your network's very strict \"`,(0,e.jsx)(n.strong,{children:\"bouncer\"}),`.\" It checks everyone's ID at the door and gives them special tickets so they can access other services without flashing their password all over the place.`]})})]}),(0,e.jsx)(n.p,{children:\"Let's get our hands dirty!\"}),(0,e.jsxs)(n.h2,{id:\"part-1-installation-and-basic-setup\",children:[(0,e.jsx)(n.a,{href:\"#part-1-installation-and-basic-setup\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Part 1: Installation and Basic Setup\"]}),(0,e.jsx)(n.p,{children:\"First, I SSH'd into my fresh Ubuntu server and installed all the goodies we'll need.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Update system packages\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" update \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),` upgrade -y\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Install LDAP core services and tools\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y slapd ldap-utils\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Install Kerberos Key Distribution Center (KDC), admin server, and client tools\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y krb5-kdc krb5-admin-server krb5-user\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"During the \",(0,e.jsx)(n.code,{children:\"krb5\"}),\" installation, a friendly wizard pops up. This is our first meeting with the Kerberos bouncer.\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[\"Default Kerberos version 5 realm: \",(0,e.jsx)(n.code,{children:\"SUPASAF.COM\"})]}),(0,e.jsx)(n.ul,{children:(0,e.jsx)(n.li,{children:\"Nerd Note: A Realm is the kingdom Kerberos manages. It's like a domain in Windows Active Directory. By convention, it's just your domain name, but in all caps.\"})})]}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"Kerberos servers for your realm: \",(0,e.jsx)(n.code,{children:\"localhost\"})]})}),(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[\"Administrative server for your Kerberos realm: \",(0,e.jsx)(n.code,{children:\"localhost\"})]}),(0,e.jsx)(n.ul,{children:(0,e.jsxs)(n.li,{children:[\"Since we're building our entire kingdom on one machine, all roads lead to \",(0,e.jsx)(n.code,{children:\"localhost\"}),\".\"]})})]})]}),(0,e.jsx)(n.p,{children:\"Next, we'll configure the LDAP service using its own setup wizard.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` dpkg-reconfigure slapd\n`]})})}),(0,e.jsx)(n.p,{children:\"Of course! It's great to see you're continuing your hands-on exploration of Kerberos. Building on your last post is a fantastic idea.\"}),(0,e.jsx)(n.p,{children:\"Here is a draft for your follow-up blog post, written in simple, humorous English, keeping all your code and correcting minor technical points for clarity.\"}),(0,e.jsx)(n.p,{children:\"InfoSec Architect 101: Service Accounts in the Linux Universe Author: Ted Twitter: @supasaf\"}),(0,e.jsx)(n.p,{children:'Hey everyone! Remember our last adventure into the \"Stone Age\" of service accounts with Windows? We tamed Active Directory and made SQL Server bow down to the magic of Kerberos without a single password.'}),(0,e.jsx)(n.p,{children:`Well, I fell down the rabbit hole and stumbled upon an awesome blog post from Uber Engineering: Scaling Adoption of Kerberos at Uber. They're using this \"ancient\" protocol to secure a massive data platform with thousands of machines. If it's good enough for Uber, it's good enough for our lab!`}),(0,e.jsx)(n.p,{children:\"Inspired, I decided to build a sequel. This time, we're leaving the cozy world of Windows and diving into Linux. We'll build a mini security kingdom from scratch on a single Ubuntu VM, using Kerberos and its trusty sidekick, LDAP.\"}),(0,e.jsx)(n.p,{children:\"Before we start, let's get our analogies straight:\"}),(0,e.jsx)(n.p,{children:'LDAP (Lightweight Directory Access Protocol): Think of this as a super-organized \"company phonebook.\" It stores info about users, groups, and computers in a neat tree structure.'}),(0,e.jsx)(n.p,{children:`Kerberos: This is your network's very strict \"bouncer.\" It checks everyone's ID at the door and gives them special tickets so they can access other services without flashing their password all over the place.`}),(0,e.jsx)(n.p,{children:\"Let's get our hands dirty!\"}),(0,e.jsx)(n.p,{children:\"Part 1: Installation and Basic Setup Getting the Tools First, I SSH'd into my fresh Ubuntu server and installed all the goodies we'll need.\"}),(0,e.jsx)(n.p,{children:\"Bash\"}),(0,e.jsxs)(n.h1,{id:\"ssh-into-my-server\",children:[(0,e.jsx)(n.a,{href:\"#ssh-into-my-server\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"SSH into my server\"]}),(0,e.jsx)(n.p,{children:\"ssh ss@172.28.78.83\"}),(0,e.jsxs)(n.h1,{id:\"update-system-packages\",children:[(0,e.jsx)(n.a,{href:\"#update-system-packages\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Update system packages\"]}),(0,e.jsx)(n.p,{children:\"sudo apt update \u0026\u0026 sudo apt upgrade -y\"}),(0,e.jsxs)(n.h1,{id:\"install-ldap-core-services-and-tools\",children:[(0,e.jsx)(n.a,{href:\"#install-ldap-core-services-and-tools\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Install LDAP core services and tools\"]}),(0,e.jsx)(n.p,{children:\"sudo apt install -y slapd ldap-utils\"}),(0,e.jsxs)(n.h1,{id:\"install-kerberos-key-distribution-center-kdc-admin-server-and-client-tools\",children:[(0,e.jsx)(n.a,{href:\"#install-kerberos-key-distribution-center-kdc-admin-server-and-client-tools\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Install Kerberos Key Distribution Center (KDC), admin server, and client tools\"]}),(0,e.jsx)(n.p,{children:\"sudo apt install -y krb5-kdc krb5-admin-server krb5-user During the krb5 installation, a friendly wizard pops up. This is our first meeting with the Kerberos bouncer.\"}),(0,e.jsx)(n.p,{children:\"Default Kerberos version 5 realm: SUPASAF.COM\"}),(0,e.jsx)(n.p,{children:\"Nerd Note: A Realm is the kingdom Kerberos manages. It's like a domain in Windows Active Directory. By convention, it's just your domain name, but in all caps.\"}),(0,e.jsx)(n.p,{children:\"Kerberos servers for your realm: localhost\"}),(0,e.jsx)(n.p,{children:\"Administrative server for your Kerberos realm: localhost\"}),(0,e.jsx)(n.p,{children:\"Since we're building our entire kingdom on one machine, all roads lead to localhost.\"}),(0,e.jsx)(n.p,{children:\"Next, we'll configure the LDAP service using its own setup wizard.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` dpkg-reconfigure slapd\n`]})})}),(0,e.jsx)(n.p,{children:\"Here are the choices I made:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Omit OpenLDAP server configuration?\"}),\" \",(0,e.jsx)(n.code,{children:\"No\"}),\" (We definitely want to configure it!)\"]})}),(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"DNS domain name\"}),\": \",(0,e.jsx)(n.code,{children:\"supasaf.com\"})]}),(0,e.jsx)(n.ul,{children:(0,e.jsxs)(n.li,{children:[\"This is important! It automatically creates the Base DN (Distinguished Name) for our directory, which will be \",(0,e.jsx)(n.code,{children:\"dc=supasaf,dc=com\"}),\". The DN is like the full file path to an entry in LDAP. \",(0,e.jsx)(n.code,{children:\"dc\"}),' stands for \"Domain Component.\"']})})]}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Organization name\"}),\": \",(0,e.jsx)(n.code,{children:\"Supasaf\"})]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Administrator password\"}),\": Pick a strong password (e.g., \",(0,e.jsx)(n.code,{children:\"admin\u0026*\u0026^@%28642\"}),\")\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Remove the database when slapd is purged\"}),\"? \",(0,e.jsx)(n.code,{children:\"No\"})]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Move old database\"}),\"? \",(0,e.jsx)(n.code,{children:\"Yes\"})]})})]}),(0,e.jsxs)(n.p,{children:[\"Once that's done, let's peek inside our new, empty phonebook with \",(0,e.jsx)(n.code,{children:\"ldapsearch\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ ldapsearch -x -LLL -b \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dn: \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"dc\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"supasaf,dc\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"objectClass: \",(0,e.jsx)(n.span,{className:\"token function\",children:\"top\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`objectClass: dcObject\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`objectClass: organization\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`o: Supasaf\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`dc: supasaf\n`})]})}),(0,e.jsx)(n.p,{children:\"Looks good! The root of our directory exists.\"}),(0,e.jsx)(n.p,{children:\"Now, let's create the database and the master key for our Kerberos realm.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` krb5_newrealm\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# The system will ask you to enter and confirm the KDC master password, for example: master123\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"This password is the key to the entire kingdom. Guard it well!\"}),(0,e.jsxs)(n.h2,{id:\"creating-users-and-getting-tickets\",children:[(0,e.jsx)(n.a,{href:\"#creating-users-and-getting-tickets\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating Users and Getting Tickets\"]}),(0,e.jsxs)(n.p,{children:[\"In Kerberos, every user, service, or machine is called a \",(0,e.jsx)(n.strong,{children:\"Principal\"}),\". Let's add a test user with the \",(0,e.jsx)(n.code,{children:\"kadmin.local\"}),\" tool.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Authenticating as principal root/admin@SUPASAF.COM with password.\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc testuser@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"No policy specified \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" testuser@SUPASAF.COM\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),` defaulting to no policy\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Enter password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testuser@SUPASAF.COM\"'}),(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter a password\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Re-enter password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testuser@SUPASAF.COM\"'}),(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Confirm it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testuser@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  quit\n`})]})}),(0,e.jsxs)(n.h3,{id:\"the-heart-of-kerberos-tickets\",children:[(0,e.jsx)(n.a,{href:\"#the-heart-of-kerberos-tickets\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Heart of Kerberos: Tickets!\"]}),(0,e.jsx)(n.p,{children:\"This is where the magic happens. Instead of sending your password to every service, the flow works like this:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Authentication\"}),\" (\",(0,e.jsx)(n.code,{children:\"kinit\"}),\"): You prove your identity to the KDC (the bouncer) using your password, just once.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Get a TGT\"}),\": The KDC gives you a \",(0,e.jsx)(n.strong,{children:\"TGT (Ticket-Granting Ticket)\"}),'. Think of this as a temporary ID badge or a \"master ticket.\"']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Get a Service Ticket\"}),\": When you want to access a service (like a database), you show your TGT to the KDC and ask for a specific ticket for that service.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Access the Service\"}),\": The KDC gives you a \",(0,e.jsx)(n.strong,{children:\"Service Ticket\"}),\". You show this special ticket to the database, and it lets you in. No password ever crosses the network!\"]})})]}),(0,e.jsx)(n.p,{children:\"Let's try it:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# 1. Use kinit to ask the KDC for a TGT\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~$ kinit testuser@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" testuser@SUPASAF.COM: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter the password\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# 2. Use klist to see the ticket we received\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~$ klist\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Ticket cache: FILE:/tmp/krb5cc_1000\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Default principal: testuser@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Valid starting         Expires                Service principal\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/02/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"17\"}),\":29:27  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`/03/2025 03:29:27  krbtgt/SUPASAF.COM@SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        renew \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"until\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/03/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"17\"}),`:29:23\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Success! We got a ticket for \",(0,e.jsx)(n.code,{children:\"krbtgt/SUPASAF.COM@SUPASAF.COM\"}),\". That's our TGT.\"]}),(0,e.jsxs)(n.h3,{id:\"organizing-our-ldap-phonebook\",children:[(0,e.jsx)(n.a,{href:\"#organizing-our-ldap-phonebook\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Organizing our LDAP Phonebook\"]}),(0,e.jsxs)(n.p,{children:[`A good phonebook has sections. Let's create some \"folders\" (Organizational Units, or OUs) for our users, groups, and services using an `,(0,e.jsx)(n.strong,{children:\"LDIF (LDAP Data Interchange Format)\"}),\" file.\"]}),(0,e.jsxs)(n.p,{children:[\"Create a file named \",(0,e.jsx)(n.code,{children:\"add-structure.ldif\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the users Organizational Unit (OU)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ou=users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` organizationalUnit\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ou\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` users\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the groups OU\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ou=groups\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` organizationalUnit\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ou\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` groups\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the services OU\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" ou=services\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` organizationalUnit\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ou\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` services\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, use \",(0,e.jsx)(n.code,{children:\"ldapadd\"}),\" to load this structure into our directory.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ ldapadd -x -D \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"cn=admin,dc=supasaf,dc=com\"'}),` -W -f add-structure.ldif\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Enter LDAP Password: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter the admin password you set earlier\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ou=users,dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ou=groups,dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ou=services,dc=supasaf,dc=com\"'}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"adding-users-to-the-phonebook\",children:[(0,e.jsx)(n.a,{href:\"#adding-users-to-the-phonebook\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Adding Users to the Phonebook\"]}),(0,e.jsx)(n.p,{children:\"Let's add two users, Alice and Bob, using another LDIF file.\"}),(0,e.jsxs)(n.p,{children:[\"Create \",(0,e.jsx)(n.code,{children:\"add-users.ldif\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" uid=alice\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ou=users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` inetOrgPerson\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` posixAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shadowAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` alice\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"cn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Alice Wang\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"sn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Wang\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"loginShell\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /bin/bash\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10001\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"gidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10001\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"homeDirectory\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /home/alice\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"userPassword\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"SSHA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"IoOlXeNSaWG0jxUZcJQib6yAF/dzchFd \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# This needs to be generated\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"dn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" uid=bob\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"ou=users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"dc=supasaf\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`dc=com\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` inetOrgPerson\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` posixAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"objectClass\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` shadowAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` bob\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"cn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Bob Li\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"sn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Li\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"loginShell\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /bin/bash\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"uidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10002\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"gidNumber\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10002\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"homeDirectory\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` /home/bob\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"userPassword\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"SSHA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`another_password_hash_here\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"We should never store plaintext passwords. Let's generate a secure hash with \",(0,e.jsx)(n.code,{children:\"slappasswd\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ slappasswd\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"New password: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enter a password\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Re-enter new password: \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Confirm it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"SSHA\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\"IoOlXeNSaWG0jxUZcJQib6yAF/dzchFd \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Copy this hash\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Paste your generated hashes into the \",(0,e.jsx)(n.code,{children:\"add-users.ldif\"}),\" file, then add them to LDAP.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ ldapadd -x -D \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"cn=admin,dc=supasaf,dc=com\"'}),` -W -f add-users.ldif\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Enter LDAP Password:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"uid=alice,ou=users,dc=supasaf,dc=com\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"adding new entry \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"uid=bob,ou=users,dc=supasaf,dc=com\"'}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Great! Now we have users in both Kerberos and LDAP. But they don't know about each other yet. Let's connect them.\"}),(0,e.jsxs)(n.h2,{id:\"integrating-ldap-with-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#integrating-ldap-with-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Integrating LDAP with Kerberos\"]}),(0,e.jsxs)(n.p,{children:[\"We want to make LDAP stop using its own simple passwords and start using our fancy Kerberos bouncer for authentication. The magical glue for this is \",(0,e.jsx)(n.strong,{children:\"SASL\"}),\".\"]}),(0,e.jsxs)(n.h3,{id:\"what-the-heck-is-sasl\",children:[(0,e.jsx)(n.a,{href:\"#what-the-heck-is-sasl\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What the Heck is SASL?\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"What is SASL?\"}),` SASL (Simple Authentication and Security Layer) is not an authentication method itself; it's a framework. Think of it as a universal power adapter. Your application (LDAP) has one SASL socket, and you can plug in different authentication \"plugs\" like Kerberos (`,(0,e.jsx)(n.code,{children:\"GSSAPI\"}),\"), \",(0,e.jsx)(n.code,{children:\"PLAIN\"}),\", etc.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Is SASL Secure?\"}),' That depends entirely on the \"plug\" (mechanism) you use. If you use ',(0,e.jsx)(n.code,{children:\"PLAIN\"}),\", your password travels in cleartext (very bad!). If you use \",(0,e.jsx)(n.code,{children:\"GSSAPI\"}),\" (which uses Kerberos), it's highly secure. So, SASL's security is determined by the mechanism it uses.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SASL and Kerberos?\"}),' In our setup, Kerberos is the security \"engine,\" and SASL is the \"driveshaft\" that connects the engine to our LDAP application. LDAP uses the SASL framework to delegate the hard work of authentication to Kerberos.']})})]}),(0,e.jsxs)(n.h3,{id:\"configuring-ldap-to-use-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#configuring-ldap-to-use-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Configuring LDAP to Use Kerberos\"]}),(0,e.jsx)(n.p,{children:\"First, we need to install the SASL libraries that know how to talk to Kerberos.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y sasl2-bin libsasl2-modules-gssapi-mit\n`]})})}),(0,e.jsxs)(n.p,{children:[\"Just like a user, our LDAP service needs its own identity (Principal) to talk to the KDC. But since it's a background service, it can't type a password. So, we use a \",(0,e.jsx)(n.strong,{children:\"Keytab\"}),\" file.\"]}),(0,e.jsxs)(n.p,{children:[\"A \",(0,e.jsx)(n.strong,{children:\"Keytab (Key Table)\"}),` file is basically a password file for services. It holds the secret keys for one or more principals, allowing them to authenticate automatically without human help. This is the core problem Uber's \"Keytab Distribution Pipeline\" solves: how to securely manage and distribute these secret files.`]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Authenticating as principal root/admin@SUPASAF.COM with password.\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# -randkey generates a random key, which is much more secure than a password\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey ldap/ss@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ldap/ss@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Export this principal's key into a keytab file\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  ktadd -k /etc/ldap/ldap.keytab ldap/ss@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" principal ldap/ss@SUPASAF.COM with kvno \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\", \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`. added to keytab WRFILE:/etc/ldap/ldap.keytab.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  quit\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# This keytab file is super sensitive. Lock it down!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chown\"}),` openldap:openldap /etc/ldap/ldap.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),` /etc/ldap/ldap.keytab\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, let's tell the SASL daemon to use our Kerberos bouncer. Edit \",(0,e.jsx)(n.code,{children:\"/etc/default/saslauthd\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Edit the file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"vim\"}),` /etc/default/saslauthd\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Change the content to this:\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"START\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`yes\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"MECHANISMS\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"kerberos5\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Restart the services to apply our changes\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart saslauthd\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart slapd\n`]})]})}),(0,e.jsx)(n.p,{children:\"Boom! Our LDAP phonebook now uses our Kerberos bouncer for ID checks.\"}),(0,e.jsxs)(n.h2,{id:\"simulating-the-uber-service-account-scene\",children:[(0,e.jsx)(n.a,{href:\"#simulating-the-uber-service-account-scene\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Simulating the Uber Service Account Scene\"]}),(0,e.jsxs)(n.p,{children:[\"Uber's blog talks about different account types (\",(0,e.jsx)(n.code,{children:\"User\"}),\", \",(0,e.jsx)(n.code,{children:\"Service\"}),\", \",(0,e.jsx)(n.code,{children:\"System\"}),\"). The key takeaway is that their backend services (like HDFS, YARN) all use principals and keytabs to authenticate automatically. Let's copy them.\"]}),(0,e.jsxs)(n.h3,{id:\"creating-service-principals-and-keytabs\",children:[(0,e.jsx)(n.a,{href:\"#creating-service-principals-and-keytabs\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating Service Principals and Keytabs\"]}),(0,e.jsx)(n.p,{children:\"Let's create principals for a few fake Hadoop services and a business service.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Authenticating as principal root/admin@SUPASAF.COM with password.\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create principals for HDFS and YARN services\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"hdfs/localhost@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey yarn/localhost@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"yarn/localhost@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a principal for a business service\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  addprinc -randkey uber_eats@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Principal \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"uber_eats@SUPASAF.COM\"'}),` created.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Generate keytabs for our hdfs and uber_eats services\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  ktadd -k /tmp/hdfs.keytab hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  ktadd -k /tmp/uber_eats.keytab uber_eats@SUPASAF.COM\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`kadmin.local:  quit\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Make sure the service process could read it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"644\"}),` /tmp/hdfs.keytab\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"password-free-authentication-with-a-keytab\",children:[(0,e.jsx)(n.a,{href:\"#password-free-authentication-with-a-keytab\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Password-Free Authentication with a Keytab\"]}),(0,e.jsxs)(n.p,{children:[\"This is the coolest part. Imagine you are the HDFS service starting up. You need to prove your identity to Kerberos, but you don't have hands to type a password. You use the \",(0,e.jsx)(n.code,{children:\"-kt\"}),\" flag with \",(0,e.jsx)(n.code,{children:\"kinit\"}),\" to point to your secret keytab file.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Authenticate using the hdfs.keytab file\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ kinit -kt /tmp/hdfs.keytab hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Immediately check our ticket cache\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ klist\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Ticket cache: FILE:/tmp/krb5cc_1000\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Default principal: hdfs/localhost@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Valid starting         Expires                Service principal\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/02/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"22\"}),\":07:38  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`/03/2025 08:07:38  krbtgt/SUPASAF.COM@SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        renew \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"until\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/03/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"22\"}),`:07:38\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"It worked! We, as the \",(0,e.jsx)(n.code,{children:\"hdfs/localhost\"}),\" service, got a TGT without typing any password. This is the foundation for all secure, automated backend services.\"]}),(0,e.jsxs)(n.h2,{id:\"passwordless-postgresql-access-with-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#passwordless-postgresql-access-with-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Passwordless PostgreSQL Access with Kerberos\"]}),(0,e.jsx)(n.p,{children:\"In any big company, applications need to talk to databases securely. Hardcoding passwords in config files is a recipe for disaster. This is why Uber built that keytab pipeline\\u2014to let services (like a data analytics app) access other services (like a database) securely and automatically.\"}),(0,e.jsx)(n.p,{children:\"Our final mission: write a Python app that uses a keytab to connect to a PostgreSQL database, read and write data, all without a password in sight.\"}),(0,e.jsx)(n.p,{children:\"First, we need a database that speaks Kerberos. Luckily, the standard PostgreSQL on Ubuntu already does.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y postgresql postgresql-contrib libpq-dev\n`]})})}),(0,e.jsxs)(n.p,{children:[\"Let's use \",(0,e.jsx)(n.code,{children:\"pg_config\"}),\" to make sure it was built with GSSAPI support (the low-level library for Kerberos).\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ pg_config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),` -i gssapi\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"CONFIGURE \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'--build=x86_64-linux-gnu'\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),\". \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'--with-gssapi'\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"LIBS \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),\". -lgssapi_krb5 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"--with-gssapi\"}),\" flag confirms it's ready for action!\"]}),(0,e.jsxs)(n.h3,{id:\"creating-principals-for-postgresql-and-our-app\",children:[(0,e.jsx)(n.a,{href:\"#creating-principals-for-postgresql-and-our-app\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Creating Principals for PostgreSQL and our App\"]}),(0,e.jsx)(n.p,{children:\"Just like LDAP, our database service and our Python app need their own identities in Kerberos.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Log in to the kadmin tool\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a principal for the PostgreSQL service.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# The naming convention is usually: service_name/hostname@REALM\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# The hostname 'ss' MUST match what the client uses to connect.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` addprinc -randkey postgres/ss@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Export its key to a keytab file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` ktadd -k /etc/postgresql/postgres.keytab postgres/ss@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` quit\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Set the correct permissions so only the postgres user can read this secret file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chown\"}),` postgres:postgres /etc/postgresql/postgres.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),` /etc/postgresql/postgres.keytab\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, let's create an identity for our Python app, which we'll call \",(0,e.jsx)(n.code,{children:\"data_service\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` kadmin.local\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a principal for our application service\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` addprinc -randkey data_service@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Export its keytab, this time to our home directory\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` ktadd -k /home/ss/data_service.keytab data_service@SUPASAF.COM\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"kadmin.local\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` quit\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Set permissions so the user running the app (ss) can read it\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"chown\"}),` ss:ss /home/ss/data_service.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"chmod\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),` /home/ss/data_service.keytab\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"telling-postgresql-to-trust-kerberos\",children:[(0,e.jsx)(n.a,{href:\"#telling-postgresql-to-trust-kerberos\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Telling PostgreSQL to Trust Kerberos\"]}),(0,e.jsx)(n.p,{children:\"We need to tell PostgreSQL about its new Kerberos identity.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Step 1: Edit postgresql.conf\"})}),(0,e.jsx)(n.p,{children:\"This is the main config file. We need to tell it where its keytab is.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"vim\"}),` /etc/postgresql/16/main/postgresql.conf\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Add or modify these lines at the end of the file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Kerberos configuration - point to the service's own keytab file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"krb_server_keyfile \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'/etc/postgresql/postgres.keytab'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Make sure the database is listening for network connections\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"listen_addresses \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'*'\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"krb_server_keyfile\"}),` setting is the key. It tells PostgreSQL, \"When a client comes with a Kerberos ticket, use this file to verify it's legit.\"`]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Step 2: Edit pg_hba.conf\"})}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"hba\"}),` stands for \"Host-Based Authentication.\" This file is PostgreSQL's firewall. It defines `,(0,e.jsx)(n.strong,{children:\"who\"}),\" can connect from where to \",(0,e.jsx)(n.strong,{children:\"which database\"}),\" using \",(0,e.jsx)(n.strong,{children:\"what method\"}),\".\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"vim\"}),` /etc/postgresql/16/main/pg_hba.conf\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Add this rule at the very top of the file to give it priority\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# TYPE  DATABASE        USER            ADDRESS                 METHOD\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"host\"}),\"    all             all             \",(0,e.jsx)(n.span,{className:\"token number\",children:\"127.0\"}),\".0.1/32            gss \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"include_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"krb_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"host\"}),\"    all             all             ::1/128                 gss \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"include_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"krb_realm\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`SUPASAF.COM\n`]})]})}),(0,e.jsx)(n.p,{children:\"Here's what this rule means:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"host\"}),\": Allow TCP/IP connections.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"all all\"}),\": For all databases and all users.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"127.0.0.1/32\"}),\": Only from the local machine (for this lab).\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"gss\"}),\": \",(0,e.jsx)(n.strong,{children:\"This is the core!\"}),\" It means the authentication method must be \",(0,e.jsx)(n.strong,{children:\"GSSAPI\"}),\" (Kerberos).\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"include_realm=0\"}),\": A handy setting that tells PostgreSQL to strip the \",(0,e.jsx)(n.code,{children:\"@SUPASAF.COM\"}),\" part from the principal name. This way, \",(0,e.jsx)(n.code,{children:\"data_service@SUPASAF.COM\"}),\" is mapped to the database user \",(0,e.jsx)(n.code,{children:\"data_service\"}),\".\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"krb_realm\"}),\": Specifies which Kerberos realm we trust.\"]})})]}),(0,e.jsx)(n.p,{children:\"Finally, restart PostgreSQL to make the new configuration active.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsx)(n.code,{className:\"language-bash code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` systemctl restart postgresql\n`]})})}),(0,e.jsxs)(n.h3,{id:\"mapping-identities-in-the-database\",children:[(0,e.jsx)(n.a,{href:\"#mapping-identities-in-the-database\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Mapping Identities in the Database\"]}),(0,e.jsxs)(n.p,{children:[\"Kerberos handles \",(0,e.jsx)(n.strong,{children:\"Authentication\"}),\" (who you are), but PostgreSQL handles \",(0,e.jsx)(n.strong,{children:\"Authorization\"}),\" (what you're allowed to do). We need to create a database user that matches our Kerberos principal.\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Switch to the postgres system user and open the psql command line\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` -u postgres psql\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"psql \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Ubuntu \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\"-0ubuntu0.24.04.1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"))\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Type \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"help\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` help.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-- Create a database user corresponding to the Kerberos principal \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'data_service'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# CREATE USER data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`CREATE ROLE\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-- Create a \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),` database and give all permissions to our new user\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# CREATE DATABASE testdb;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`CREATE DATABASE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# GRANT ALL PRIVILEGES ON DATABASE testdb TO data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`GRANT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-- Connect to the new database\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"postgres\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# \\\\c testdb\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"You are now connected to database \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testdb\"'}),\" as user \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"postgres\"'}),(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\".\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-- Create a \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),` table and grant permissions\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# CREATE TABLE kerberos_test (\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),` SERIAL PRIMARY KEY,\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    message TEXT,\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`CREATE TABLE\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# GRANT ALL PRIVILEGES ON TABLE kerberos_test TO data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`GRANT\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# GRANT USAGE, SELECT ON SEQUENCE kerberos_test_id_seq TO data_service;\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`GRANT\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`-- Exit psql\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# \\\\q\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Now, when \",(0,e.jsx)(n.code,{children:\"data_service@SUPASAF.COM\"}),\" successfully authenticates, PostgreSQL will treat it as the \",(0,e.jsx)(n.code,{children:\"data_service\"}),\" database user and apply these permissions.\"]}),(0,e.jsxs)(n.h3,{id:\"the-grand-finale-pythons-passwordless-db-access\",children:[(0,e.jsx)(n.a,{href:\"#the-grand-finale-pythons-passwordless-db-access\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Grand Finale: Python's Passwordless DB Access\"]}),(0,e.jsxs)(n.p,{children:[\"Let's write a Python script to simulate our \",(0,e.jsx)(n.code,{children:\"data_service\"}),\" application.\"]}),(0,e.jsx)(n.p,{children:\"Install Dependencies:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"apt\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` -y libkrb5-dev krb5-user\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ pip3 \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),` psycopg2-binary gssapi --break-system-packages\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Create a file named \",(0,e.jsx)(n.code,{children:\"kerberos_db_access.py\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` os\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` subprocess\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` psycopg2\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" datetime \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` datetime\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"KerberosDBConnection\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"A database connection manager that uses Kerberos authentication.\"\"\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"__init__\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" keytab_path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" db_host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" db_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" db_port\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5432\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`        Initializes the Kerberos database connection.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`        Args:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            keytab_path: Full path to the keytab file.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            principal: The Kerberos principal (e.g., data_service@SUPASAF.COM).\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            db_host: Database hostname.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            db_name: Database name.\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            db_port: Database port.\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'        \"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"keytab_path \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` keytab_path\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` principal\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_host \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` db_host\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` db_name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_port \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` db_port\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"authenticate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Perform Kerberos authentication using the keytab.\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Destroy any existing tickets\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"run\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'kdestroy'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" stderr\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"DEVNULL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Get a TGT using the keytab\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            cmd \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'kinit'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'-kt'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"keytab_path\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"run\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cmd\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" capture_output\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" text\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"returncode \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"raise\"}),\" Exception\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Kerberos authentication failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stderr\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\u2713 Kerberos authentication successful for: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Show ticket info\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            klist_result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" subprocess\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"run\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'klist'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" capture_output\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" text\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\nCurrent Kerberos Tickets:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"klist_result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"stdout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\u2717 Kerberos authentication failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"False\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"connect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Establish the database connection (using GSSAPI).\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Extract username from the principal\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            db_user \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"principal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"split\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Connection string (key part: use gssencmode=prefer)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            connection_params \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'host'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'port'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'dbname'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'user'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" db_user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'gssencmode'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'prefer'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Use GSSAPI encryption\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'sslmode'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'prefer'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\nAttempting to connect to the database...\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Host: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_host\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\":\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_port\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Database: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"db_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  User: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"db_user\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Auth Method: Kerberos GSSAPI (Password-Free)\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" psycopg2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"connect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"**\"}),\"connection_params\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2713 Database connection successful!\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\u2717 Database connection failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"False\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"execute_query\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" params\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"None\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" fetch\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token boolean\",children:\"True\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Execute a SQL query.\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"raise\"}),\" Exception\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Database is not connected\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            cursor \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"execute\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" params\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# For SELECT or RETURNING clauses, fetch results\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" fetch \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"upper\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"startswith\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'SELECT'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"or\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'RETURNING'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"upper\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"fetchall\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"commit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),` result\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"commit\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" cursor\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`rowcount\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"rollback\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"raise\"}),` e\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"close\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Close the connection.\"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            self\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"conn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\nDatabase connection closed.\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Main function to demonstrate passwordless Kerberos database access.\"\"\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Kerberos Passwordless Database Access Demo\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Configuration (change according to your environment)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    KEYTAB_PATH \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"/home/ss/data_service.keytab\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    PRINCIPAL \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"data_service@SUPASAF.COM\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    DB_HOST \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ss\"'}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Or use FQDN\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    DB_NAME \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"testdb\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the connection manager\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    db \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" KerberosDBConnection\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        keytab_path\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"KEYTAB_PATH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        principal\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"PRINCIPAL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        db_host\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"DB_HOST\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        db_name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`DB_NAME\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 1: Kerberos Authentication\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"authenticate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 2: Connect to the Database\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"connect\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 3: Insert test data\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Inserting Test Data\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Insert a test record with a timestamp\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        insert_query \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            INSERT INTO kerberos_test (message) \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            VALUES (%s) \n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`            RETURNING id, message, created_at\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'        \"\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        test_message \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Passwordless Kerberos auth test - '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"datetime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"now\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"strftime\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'%Y-%m-%d %H:%M:%S'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\nInserting message: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"test_message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"execute_query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"insert_query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"test_message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            record_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            record_msg \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            record_time \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n\\u2713 Data inserted successfully!\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Record ID: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Message: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_msg\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"  Timestamp: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Verification Steps\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=\"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\nYou can now verify the data was inserted with these commands:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n1. Log into the database as the postgres user:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"   sudo -u postgres psql -d testdb\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n2. Run a query inside psql:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"   SELECT * FROM kerberos_test ORDER BY id DESC LIMIT 5;\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n3. Or run directly from the command line:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"   sudo -u postgres psql -d testdb -c \\\\\"SELECT * FROM kerberos_test WHERE id = '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"record_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:';\\\\\"\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n4. Exit psql:\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"   \\\\\\\\q\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\\\n\\u2713 All operations completed! No database password was used.\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n\\u2717 An error occurred: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` traceback\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        traceback\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"print_exc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"finally\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        db\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"close\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"__main__\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    main\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"How It Works: The Ticket's Journey\"})}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"db.authenticate()\"}),\": The script runs \",(0,e.jsx)(n.code,{children:\"kinit -kt ....\"}),\" The app shows its ID card (keytab) to the KDC (bouncer) and gets a \",(0,e.jsx)(n.strong,{children:\"TGT\"}),\" (the master ticket).\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"db.connect()\"}),\": When \",(0,e.jsx)(n.code,{children:\"psycopg2.connect()\"}),\" is called with \",(0,e.jsx)(n.code,{children:\"gssencmode\"}),\", the underlying library (\",(0,e.jsx)(n.code,{children:\"libpq\"}),\") kicks off the GSSAPI process.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Get Service Ticket\"}),\": \",(0,e.jsx)(n.code,{children:\"libpq\"}),' sees the TGT in the cache, goes back to the KDC, and says \"Hey, I need a ticket to get into the PostgreSQL party (',(0,e.jsx)(n.code,{children:\"postgres/ss@SUPASAF.COM\"}),').\"']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Send Ticket\"}),\": \",(0,e.jsx)(n.code,{children:\"libpq\"}),\" gets the specific \",(0,e.jsx)(n.strong,{children:\"Service Ticket\"}),\" and sends it to the PostgreSQL server during the connection handshake.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Server Verification\"}),\": The PostgreSQL server receives the ticket and uses its own secret key from \",(0,e.jsx)(n.code,{children:\"postgres.keytab\"}),\" to decrypt it. If it works, the server knows the client is legit.\"]})})]}),(0,e.jsx)(n.p,{children:\"The whole process forms a secure chain of trust, and no passwords ever travel over the network.\"}),(0,e.jsx)(n.p,{children:\"Let's run it!\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Make sure the keytab file exists and has the right permissions\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/ldap1002$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"ls\"}),` -l /home/ss/data_service.keytab\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"-r-------- \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" ss ss \",(0,e.jsx)(n.span,{className:\"token number\",children:\"150\"}),\" Oct  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:22 /home/ss/data_service.keytab\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Run our Python app\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`ss@ss:~/ldap1002$ python3 kerberos_db_access.py\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Kerberos Passwordless Database Access Demo\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u2713 Kerberos authentication successful for: data_service@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Current Kerberos Tickets:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Ticket cache: FILE:/tmp/krb5cc_1000\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Default principal: data_service@SUPASAF.COM\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Valid starting         Expires                Service principal\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/04/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\":55:42  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/04/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"20\"}),`:55:42  krbtgt/SUPASAF.COM@SUPASAF.COM\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        renew \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"until\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"/05/2025 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Attempting to connect to the database\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  Host: ss:5432\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  Database: testdb\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  User: data_service\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Auth Method: Kerberos GSSAPI \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Password-Free\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2713 Database connection successful\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Inserting Test Data\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Inserting message: Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2713 Data inserted successfully\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Record ID: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Message: Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  Timestamp: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42.331621\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Verification Steps\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`You can now verify the data was inserted with these commands:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`. Log into the database as the postgres user:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` -u postgres psql -d testdb\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`. Run a query inside psql:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   SELECT * FROM kerberos_test ORDER BY \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),\" DESC LIMIT \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),\". Or run directly from the \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"command\"}),` line:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),\" -u postgres psql -d testdb -c \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"SELECT * FROM kerberos_test WHERE id = 2;\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),`. Exit psql:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`q\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2713 All operations completed\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),` No database password was used.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`Database connection closed.\n`})]})}),(0,e.jsx)(n.p,{children:\"Let's follow the instructions from the output and check the database ourselves.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~$ \",(0,e.jsx)(n.span,{className:\"token function\",children:\"sudo\"}),` -u postgres psql -d testdb\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"sudo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" password \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` ss:\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"psql \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"Ubuntu \",(0,e.jsx)(n.span,{className:\"token number\",children:\"16.10\"}),\"-0ubuntu0.24.04.1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"))\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Type \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"help\"'}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` help.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# SELECT * FROM kerberos_test ORDER BY id DESC LIMIT 5;\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"id\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\"                   message                     \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),`          created_at\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`----+-----------------------------------------------+----------------------------\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\":55:42 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:55:42.331621\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" Passwordless Kerberos auth \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"test\"}),\" - \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\":54:02 \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"-10-04 \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`:54:02.399912\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" rows\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token assign-left variable\",children:\"testdb\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token comment\",children:\"# \\\\q\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"It's there! Our Python application, acting as a true service account, authenticated via Kerberos and wrote to the database without ever needing a password.\"}),(0,e.jsx)(n.p,{children:\"So there you have it. From Windows to Linux, Kerberos is still a powerful, relevant tool for building secure systems. It might seem complicated, but breaking it down with a hands-on lab makes all the difference.\"}),(0,e.jsx)(n.p,{children:\"Go build something!\"})]})}}var y=f;return w;})();\n;return Component;","toc":[{"value":"Part 1: Installation and Basic Setup","url":"#part-1-installation-and-basic-setup","depth":2},{"value":"SSH into my server","url":"#ssh-into-my-server","depth":1},{"value":"Update system packages","url":"#update-system-packages","depth":1},{"value":"Install LDAP core services and tools","url":"#install-ldap-core-services-and-tools","depth":1},{"value":"Install Kerberos Key Distribution Center (KDC), admin server, and client tools","url":"#install-kerberos-key-distribution-center-kdc-admin-server-and-client-tools","depth":1},{"value":"Creating Users and Getting Tickets","url":"#creating-users-and-getting-tickets","depth":2},{"value":"The Heart of Kerberos: Tickets!","url":"#the-heart-of-kerberos-tickets","depth":3},{"value":"Organizing our LDAP Phonebook","url":"#organizing-our-ldap-phonebook","depth":3},{"value":"Adding Users to the Phonebook","url":"#adding-users-to-the-phonebook","depth":3},{"value":"Integrating LDAP with Kerberos","url":"#integrating-ldap-with-kerberos","depth":2},{"value":"What the Heck is SASL?","url":"#what-the-heck-is-sasl","depth":3},{"value":"Configuring LDAP to Use Kerberos","url":"#configuring-ldap-to-use-kerberos","depth":3},{"value":"Simulating the Uber Service Account Scene","url":"#simulating-the-uber-service-account-scene","depth":2},{"value":"Creating Service Principals and Keytabs","url":"#creating-service-principals-and-keytabs","depth":3},{"value":"Password-Free Authentication with a Keytab","url":"#password-free-authentication-with-a-keytab","depth":3},{"value":"Passwordless PostgreSQL Access with Kerberos","url":"#passwordless-postgresql-access-with-kerberos","depth":2},{"value":"Creating Principals for PostgreSQL and our App","url":"#creating-principals-for-postgresql-and-our-app","depth":3},{"value":"Telling PostgreSQL to Trust Kerberos","url":"#telling-postgresql-to-trust-kerberos","depth":3},{"value":"Mapping Identities in the Database","url":"#mapping-identities-in-the-database","depth":3},{"value":"The Grand Finale: Python's Passwordless DB Access","url":"#the-grand-finale-pythons-passwordless-db-access","depth":3}],"frontMatter":{"readingTime":{"text":"28 min read","minutes":27.4,"time":1644000,"words":5480},"slug":"general/kerberos_ldap","fileName":"general/kerberos_ldap.md","title":"InfoSec Architect 102-Service Accounts in the Linux Universe","date":"2025-10-08T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security â€“ Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)","date":"2025-10-06T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices.","images":[],"slug":"general/spiffe_go_k8s"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["general","kerberos_ldap"]},"buildId":"EMYzY6LkauV-oRT0pwBJn","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>