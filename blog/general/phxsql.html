<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>A Look Back at WeChat&#x27;s PhxSQL and the &#x27;Fastest Majority&#x27;</title><meta name="robots" content="follow, index"/><meta name="description" content="This post explores how WeChat&#x27;s PhxSQL uses the &quot;Fastest Majority&quot; principle to offer a timeless lesson in designing fast and resilient distributed database systems."/><meta property="og:url" content="https://www.supasaf.com/blog/general/phxsql"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="This post explores how WeChat&#x27;s PhxSQL uses the &quot;Fastest Majority&quot; principle to offer a timeless lesson in designing fast and resilient distributed database systems."/><meta property="og:title" content="A Look Back at WeChat&#x27;s PhxSQL and the &#x27;Fastest Majority&#x27;"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="A Look Back at WeChat&#x27;s PhxSQL and the &#x27;Fastest Majority&#x27;"/><meta name="twitter:description" content="This post explores how WeChat&#x27;s PhxSQL uses the &quot;Fastest Majority&quot; principle to offer a timeless lesson in designing fast and resilient distributed database systems."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/general/phxsql"/><meta property="article:published_time" content="2025-07-18T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/general/phxsql"
  },
  "headline": "A Look Back at WeChat's PhxSQL and the 'Fastest Majority'",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2025-07-18T00:00:00.000Z",
  "dateModified": "2025-07-18T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "This post explores how WeChat's PhxSQL uses the \"Fastest Majority\" principle to offer a timeless lesson in designing fast and resilient distributed database systems."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/oVQKg7I9e_0Oh0pHteJCk/_buildManifest.js" defer=""></script><script src="/_next/static/oVQKg7I9e_0Oh0pHteJCk/_ssgManifest.js" defer=""></script><script src="/_next/static/oVQKg7I9e_0Oh0pHteJCk/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-07-18T00:00:00.000Z">Friday, July 18, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">A Look Back at WeChat&#x27;s PhxSQL and the &#x27;Fastest Majority&#x27;</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>It&#x27;s 2016, and I&#x27;m working at WeChat (yes, that WeChat with over a billion users). Every day, servers are dying left and right – not because our hardware is garbage, but because when you have THAT many servers, even a 0.001% failure rate means something breaks every few minutes. It&#x27;s like having a million light bulbs in your house; statistically, one of them is going to burn out while you&#x27;re eating breakfast.</p><p>Fast forward to 2025, and I&#x27;m thinking about building a highly available secrets manager system. Suddenly, memories of PhxSQL come flooding back – that brilliant piece of engineering that WeChat open-sourced nine years ago, which somehow never got the attention it deserved. Maybe it&#x27;s because not many companies have WeChat&#x27;s &quot;billion users with payment systems&quot; problems. Most folks are still figuring out how to handle their first million users without their database catching fire.</p><p>Disclaimer: This article reflects my personal views and experiences. The content is not related to my previous or current employers.</p><h2 id="the-cross-region-latency-curse--every-dbas-nightmare"><a href="#the-cross-region-latency-curse--every-dbas-nightmare" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The &quot;Cross-Region Latency Curse&quot; – Every DBA&#x27;s Nightmare</h2><p>Let me paint you a picture of distributed database hell. You&#x27;ve got your fancy &quot;two regions, three centers&quot; setup – maybe 2 nodes in Guangzhou, 1 node in Shanghai. You feel smart, you feel prepared for disasters. Then reality hits.</p><p>All consensus algorithms (Paxos, Raft, your uncle&#x27;s homemade distributed protocol) work like a committee meeting where everyone needs to agree before anything gets done. In a cross-region setup, this means waiting for that one slow committee member in Shanghai to raise their hand and say &quot;I agree&quot; – over a network connection that takes 30+ milliseconds round trip.</p><p>It&#x27;s like trying to have a conversation where every sentence takes 30 seconds to travel. By the time Shanghai says &quot;yes,&quot; Guangzhou has already forgotten what they were talking about.</p><h2 id="phxsqls-brilliant-solution-the-fastest-majority-hack"><a href="#phxsqls-brilliant-solution-the-fastest-majority-hack" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>PhxSQL&#x27;s Brilliant Solution: The &quot;Fastest Majority&quot; Hack</h2><p>Here&#x27;s where PhxSQL gets clever. Instead of waiting for the slowest kid in class, it just waits for the fastest majority. Let me break down how this works in our &quot;Guangzhou 2 + Shanghai 1&quot; setup:</p><h3 id="the-magic-behind-the-scenes"><a href="#the-magic-behind-the-scenes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Magic Behind the Scenes</h3><p>When you have 3 nodes, you need 2 votes to make any decision (that&#x27;s your majority). Now, here&#x27;s the genius part:</p><ol><li><strong>The Leader is Usually Local</strong>: The master node will almost always be one of the Guangzhou nodes because they have better network connectivity to each other.</li><li><strong>The &quot;Committee Meeting&quot; Process</strong>: When Master Node A in Guangzhou wants to write something:</li></ol><ul><li>It sends the write request to both Guangzhou Node B and Shanghai Node C</li><li>Guangzhou Node B responds in ~2ms (same city, same coffee shop WiFi speed)</li><li>Shanghai Node C takes ~30ms to respond (cross-region, probably stuck in traffic)</li></ul><ol start="3"><li><strong>The &quot;Don&#x27;t Wait for the Slow Guy&quot; Philosophy</strong>: As soon as Master Node A gets confirmation from Guangzhou Node B, it has 2 votes (itself + Node B). That&#x27;s a majority! It can immediately:</li></ol><ul><li>Commit the transaction locally</li><li>Tell the client &quot;success!&quot;</li><li>Not care that Shanghai Node C is still processing the request</li></ul><p>It&#x27;s like starting the movie as soon as 2 out of 3 friends arrive, instead of waiting for the one who&#x27;s &quot;5 minutes away&quot; for the past hour.</p><h2 id="my-go--raft-implementation-phxsqls-soul-in-modern-clothes"><a href="#my-go--raft-implementation-phxsqls-soul-in-modern-clothes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>My Go + Raft Implementation: PhxSQL&#x27;s Soul in Modern Clothes</h2><p>While thinking about this secrets manager project, I decided to implement PhxSQL&#x27;s core philosophy using Go, Raft, and SQLite. Here&#x27;s the heart of the &quot;Fastest Majority&quot; implementation:</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>n <span class="token operator">*</span>RaftNode<span class="token punctuation">)</span> <span class="token function">replicateAndWaitForMajority</span><span class="token punctuation">(</span>entry LogEntry<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
</span><span class="code-line">    majorityNeeded <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>peers<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">var</span> successCount <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">        sync<span class="token punctuation">.</span>Mutex
</span><span class="code-line">        count <span class="token builtin">int</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    successCount<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// Count ourselves</span>
</span><span class="code-line">    
</span><span class="code-line">    doneChan <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">// Send to all peers concurrently</span>
</span><span class="code-line">    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> peer <span class="token operator">:=</span> <span class="token keyword">range</span> peers <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>peer <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token keyword">if</span> n<span class="token punctuation">.</span><span class="token function">sendAppendRequest</span><span class="token punctuation">(</span>peer<span class="token punctuation">,</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">                successCount<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                successCount<span class="token punctuation">.</span>count<span class="token operator">++</span>
</span><span class="code-line">                isMajority <span class="token operator">:=</span> successCount<span class="token punctuation">.</span>count <span class="token operator">&gt;</span> majorityNeeded
</span><span class="code-line">                successCount<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">                
</span><span class="code-line">                <span class="token keyword">if</span> isMajority <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token keyword">select</span> <span class="token punctuation">{</span>
</span><span class="code-line">                    <span class="token keyword">case</span> doneChan <span class="token operator">&lt;-</span> <span class="token boolean">true</span><span class="token punctuation">:</span> <span class="token comment">// We got majority!</span>
</span><span class="code-line">                    <span class="token keyword">default</span><span class="token punctuation">:</span>
</span><span class="code-line">                    <span class="token punctuation">}</span>
</span><span class="code-line">                <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">(</span>peer<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">// Wait for majority OR timeout</span>
</span><span class="code-line">    <span class="token keyword">select</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>doneChan<span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token boolean">true</span> <span class="token comment">// Success! We got our majority</span>
</span><span class="code-line">    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token comment">// Timeout, no majority</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>The beauty is in the <code>select</code> statement. We&#x27;re racing all the network requests, and as soon as we get enough votes for a majority, we declare victory and move on. No waiting for stragglers!</p><h2 id="testing-the-magic"><a href="#testing-the-magic" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Testing the Magic</h2><p>Let me show you this in action. I started 3 nodes and ran some tests:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token comment"># Create a table</span>
</span><span class="code-line"><span class="token function">curl</span> -X POST http://localhost:8001/sql -d <span class="token string">&#x27;{&quot;sql&quot;:&quot;CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT)&quot;}&#x27;</span>
</span><span class="code-line"><span class="token punctuation">{</span><span class="token string">&quot;success&quot;</span>:true,<span class="token string">&quot;result&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;rows&quot;</span>:null,<span class="token string">&quot;rows_affected&quot;</span>:0,<span class="token string">&quot;last_insert_id&quot;</span>:0<span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Insert some data</span>
</span><span class="code-line"><span class="token function">curl</span> -X POST http://localhost:8001/sql -d <span class="token string">&#x27;{&quot;sql&quot;:&quot;INSERT INTO users (name) VALUES (?)&quot;, &quot;args&quot;:[&quot;Alice&quot;]}&#x27;</span>
</span><span class="code-line"><span class="token punctuation">{</span><span class="token string">&quot;success&quot;</span>:true,<span class="token string">&quot;result&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;rows&quot;</span>:null,<span class="token string">&quot;rows_affected&quot;</span>:1,<span class="token string">&quot;last_insert_id&quot;</span>:1<span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">curl</span> -X POST http://localhost:8001/sql -d <span class="token string">&#x27;{&quot;sql&quot;:&quot;INSERT INTO users (name) VALUES (?)&quot;, &quot;args&quot;:[&quot;Bob&quot;]}&#x27;</span>
</span><span class="code-line"><span class="token punctuation">{</span><span class="token string">&quot;success&quot;</span>:true,<span class="token string">&quot;result&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;rows&quot;</span>:null,<span class="token string">&quot;rows_affected&quot;</span>:1,<span class="token string">&quot;last_insert_id&quot;</span>:2<span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Query from different nodes - data is replicated!</span>
</span><span class="code-line"><span class="token function">curl</span> -X POST http://localhost:8002/sql -d <span class="token string">&#x27;{&quot;sql&quot;:&quot;SELECT * FROM users&quot;}&#x27;</span>
</span><span class="code-line"><span class="token punctuation">{</span><span class="token string">&quot;success&quot;</span>:true,<span class="token string">&quot;result&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;rows&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:1,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:2,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>,<span class="token string">&quot;rows_affected&quot;</span>:0,<span class="token string">&quot;last_insert_id&quot;</span>:0<span class="token punctuation">}</span><span class="token punctuation">}</span>
</span></code></pre></div><p>Node 1 logs show the election process:</p><img width="600" src="/static/images/general/raftdb1.png"/><h2 id="the-trade-off-speed-vs-absolute-durability"><a href="#the-trade-off-speed-vs-absolute-durability" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Trade-off: Speed vs. Absolute Durability</h2><p>Now, let&#x27;s address the elephant in the room. What if Guangzhou gets hit by a meteor right after the client receives &quot;success&quot; but before Shanghai gets the data? Well, that data is gone forever.</p><p>This isn&#x27;t a bug – it&#x27;s a feature! PhxSQL makes a deliberate choice: <strong>optimize for the 99.999% case where regions don&#x27;t get destroyed, rather than the 0.001% disaster scenario.</strong></p><p>For most applications, losing a few writes during a complete regional disaster is acceptable. The alternative – making every write operation 30ms slower to guard against meteor strikes – would make your users suffer every single day for a scenario that hopefully never happens.</p><h2 id="why-phxsql-never-became-the-next-big-thing"><a href="#why-phxsql-never-became-the-next-big-thing" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Why PhxSQL Never Became the Next Big Thing</h2><p>Nine years have passed since WeChat open-sourced PhxSQL, and it never really took off. Here&#x27;s my theory:</p><ul><li><strong>The &quot;WeChat Problem&quot; is Rare</strong>: Not many companies have billion-user social networks with payment systems. Most companies are still figuring out how to handle their first million users.</li><li><strong>Cloud-Native Happened</strong>: In 2025, most companies just use managed database services with built-in HA. Why build your own distributed database when AWS RDS or Google Cloud SQL does it for you?</li><li><strong>Ecosystem Matters</strong>: PhxSQL never built the ecosystem. No fancy dashboard, no Docker images, no Kubernetes operators. If you can&#x27;t deploy it with one YAML file, modern DevOps teams won&#x27;t touch it.</li><li><strong>On-Premise is Dead</strong>: Most companies moved to the cloud. Those who didn&#x27;t probably went with TiDB or other modern distributed databases.</li></ul><h2 id="the-lasting-legacy-the-philosophy-still-matters"><a href="#the-lasting-legacy-the-philosophy-still-matters" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Lasting Legacy: The Philosophy Still Matters</h2><p>Even though PhxSQL itself might be a museum piece, its &quot;Fastest Majority&quot; philosophy is still relevant in 2025. Whether you&#x27;re building microservices, distributed caches, or that secrets manager I mentioned, remember:</p><ul><li><strong>Optimize for the common case, not the disaster scenario</strong></li><li><strong>Don&#x27;t let the slowest node dictate your performance</strong></li><li><strong>Sometimes &quot;fast enough&quot; is better than &quot;perfectly consistent&quot;</strong></li></ul><h2 id="my-wechat-days-learning-from-giants"><a href="#my-wechat-days-learning-from-giants" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>My WeChat Days: Learning from Giants</h2><p>Back when I was part of the WeChat team, dealing with scale was a daily reality. When you have over a billion daily active users across social messaging, payments, and mini-programs, hardware failures aren&#x27;t &quot;if&quot; – they&#x27;re &quot;when&quot; and &quot;how many today?&quot; WeChat&#x27;s approach to PhxSQL made perfect sense in that context. The team had:</p><ul><li>Deep MySQL expertise (it&#x27;s the most widely used database in China)</li><li>Extensive Paxos algorithm experience (they also open-sourced Paxos-based NoSQL and message queue systems)</li><li>A real need for automated failure handling and node replacement</li></ul><p>Building a Paxos layer on top of MySQL wasn&#x27;t just clever – it was necessary survival at that scale.</p><h2 id="sometimes-the-old-ways-are-still-good-ways"><a href="#sometimes-the-old-ways-are-still-good-ways" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Sometimes the Old Ways Are Still Good Ways</h2><p>Would I recommend PhxSQL for a new project in 2025? Probably not. Would I recommend understanding its philosophy? Absolutely.</p><p>In our rush toward cloud-native, serverless, and AI-everything, we sometimes forget that some of the best engineering solutions come from understanding fundamental trade-offs. PhxSQL&#x27;s &quot;Fastest Majority&quot; approach is a masterclass in making the right compromises.</p><p>So the next time you&#x27;re designing a distributed system, remember: you don&#x27;t always need to wait for the slowest member of the committee. Sometimes, the fastest majority is all you need.</p><p>P.S. - The full Go implementation is <a target="_blank" rel="noopener noreferrer" href="https://github.com/liweijian/RaxSQL">available</a> if you want to play with it. It&#x27;s about 900 lines of code that capture the essence of a system that handled billions of users. Not bad for a weekend project!</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/architect">Architect</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/temporal">An InfoSec Architect&#x27;s First Taste of Temporal</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/hacker_physicist">Hacker and Physicist - A Tale of &quot;Common Sense&quot;</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var h=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var c=a=\u003ei(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{c(a);for(var t in s)i(a,t,{get:s[t],enumerable:!0})},g=(a,s,t)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of m(s))!u.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026i(a,n,{get:()=\u003es[n],enumerable:!(t=d(s,n))||t.enumerable});return a},y=a=\u003eg(c(i(a!=null?h(p(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((T,l)=\u003e{l.exports=_jsx_runtime});var x={};k(x,{default:()=\u003ew,frontmatter:()=\u003ef});var e=y(r()),f={title:\"A Look Back at WeChat's PhxSQL and the 'Fastest Majority'\",date:\"2025-07-18\",tags:[\"Architect\"],draft:!1,summary:`This post explores how WeChat's PhxSQL uses the \"Fastest Majority\" principle to offer a timeless lesson in designing fast and resilient distributed database systems.`,images:[]};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({p:\"p\",h2:\"h2\",a:\"a\",span:\"span\",h3:\"h3\",ol:\"ol\",li:\"li\",strong:\"strong\",ul:\"ul\",pre:\"pre\",code:\"code\"},a.components),{Image:o}=n;return o||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"It's 2016, and I'm working at WeChat (yes, that WeChat with over a billion users). Every day, servers are dying left and right \\u2013 not because our hardware is garbage, but because when you have THAT many servers, even a 0.001% failure rate means something breaks every few minutes. It's like having a million light bulbs in your house; statistically, one of them is going to burn out while you're eating breakfast.\"}),(0,e.jsx)(n.p,{children:`Fast forward to 2025, and I'm thinking about building a highly available secrets manager system. Suddenly, memories of PhxSQL come flooding back \\u2013 that brilliant piece of engineering that WeChat open-sourced nine years ago, which somehow never got the attention it deserved. Maybe it's because not many companies have WeChat's \"billion users with payment systems\" problems. Most folks are still figuring out how to handle their first million users without their database catching fire.`}),(0,e.jsx)(n.p,{children:\"Disclaimer: This article reflects my personal views and experiences. The content is not related to my previous or current employers.\"}),(0,e.jsxs)(n.h2,{id:\"the-cross-region-latency-curse--every-dbas-nightmare\",children:[(0,e.jsx)(n.a,{href:\"#the-cross-region-latency-curse--every-dbas-nightmare\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),`The \"Cross-Region Latency Curse\" \\u2013 Every DBA's Nightmare`]}),(0,e.jsx)(n.p,{children:`Let me paint you a picture of distributed database hell. You've got your fancy \"two regions, three centers\" setup \\u2013 maybe 2 nodes in Guangzhou, 1 node in Shanghai. You feel smart, you feel prepared for disasters. Then reality hits.`}),(0,e.jsx)(n.p,{children:`All consensus algorithms (Paxos, Raft, your uncle's homemade distributed protocol) work like a committee meeting where everyone needs to agree before anything gets done. In a cross-region setup, this means waiting for that one slow committee member in Shanghai to raise their hand and say \"I agree\" \\u2013 over a network connection that takes 30+ milliseconds round trip.`}),(0,e.jsx)(n.p,{children:`It's like trying to have a conversation where every sentence takes 30 seconds to travel. By the time Shanghai says \"yes,\" Guangzhou has already forgotten what they were talking about.`}),(0,e.jsxs)(n.h2,{id:\"phxsqls-brilliant-solution-the-fastest-majority-hack\",children:[(0,e.jsx)(n.a,{href:\"#phxsqls-brilliant-solution-the-fastest-majority-hack\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),`PhxSQL's Brilliant Solution: The \"Fastest Majority\" Hack`]}),(0,e.jsx)(n.p,{children:`Here's where PhxSQL gets clever. Instead of waiting for the slowest kid in class, it just waits for the fastest majority. Let me break down how this works in our \"Guangzhou 2 + Shanghai 1\" setup:`}),(0,e.jsxs)(n.h3,{id:\"the-magic-behind-the-scenes\",children:[(0,e.jsx)(n.a,{href:\"#the-magic-behind-the-scenes\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Magic Behind the Scenes\"]}),(0,e.jsx)(n.p,{children:\"When you have 3 nodes, you need 2 votes to make any decision (that's your majority). Now, here's the genius part:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"The Leader is Usually Local\"}),\": The master node will almost always be one of the Guangzhou nodes because they have better network connectivity to each other.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:'The \"Committee Meeting\" Process'}),\": When Master Node A in Guangzhou wants to write something:\"]})]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"It sends the write request to both Guangzhou Node B and Shanghai Node C\"}),(0,e.jsx)(n.li,{children:\"Guangzhou Node B responds in ~2ms (same city, same coffee shop WiFi speed)\"}),(0,e.jsx)(n.li,{children:\"Shanghai Node C takes ~30ms to respond (cross-region, probably stuck in traffic)\"})]}),(0,e.jsx)(n.ol,{start:\"3\",children:(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:`The \"Don't Wait for the Slow Guy\" Philosophy`}),\": As soon as Master Node A gets confirmation from Guangzhou Node B, it has 2 votes (itself + Node B). That's a majority! It can immediately:\"]})}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Commit the transaction locally\"}),(0,e.jsx)(n.li,{children:'Tell the client \"success!\"'}),(0,e.jsx)(n.li,{children:\"Not care that Shanghai Node C is still processing the request\"})]}),(0,e.jsx)(n.p,{children:`It's like starting the movie as soon as 2 out of 3 friends arrive, instead of waiting for the one who's \"5 minutes away\" for the past hour.`}),(0,e.jsxs)(n.h2,{id:\"my-go--raft-implementation-phxsqls-soul-in-modern-clothes\",children:[(0,e.jsx)(n.a,{href:\"#my-go--raft-implementation-phxsqls-soul-in-modern-clothes\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"My Go + Raft Implementation: PhxSQL's Soul in Modern Clothes\"]}),(0,e.jsx)(n.p,{children:`While thinking about this secrets manager project, I decided to implement PhxSQL's core philosophy using Go, Raft, and SQLite. Here's the heart of the \"Fastest Majority\" implementation:`}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-go\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"n \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"RaftNode\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"replicateAndWaitForMajority\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"entry LogEntry\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"bool\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    majorityNeeded \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"peers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),\" successCount \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        sync\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`Mutex\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        count \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"int\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    successCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"count \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Count ourselves\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    doneChan \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"make\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"chan\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"bool\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Send to all peers concurrently\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"_\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" peer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"range\"}),\" peers \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"go\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"peer \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" n\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"sendAppendRequest\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"peer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" req\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                successCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Lock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                successCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"count\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"++\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                isMajority \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" successCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"count \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),` majorityNeeded\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                successCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Unlock\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`                \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" isMajority \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" doneChan \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c-\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// We got majority!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"default\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"peer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Wait for majority OR timeout\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"select\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c-\"}),\"doneChan\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Success! We got our majority\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"case\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c-\"}),\"time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"After\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Second\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Timeout, no majority\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"The beauty is in the \",(0,e.jsx)(n.code,{children:\"select\"}),\" statement. We're racing all the network requests, and as soon as we get enough votes for a majority, we declare victory and move on. No waiting for stragglers!\"]}),(0,e.jsxs)(n.h2,{id:\"testing-the-magic\",children:[(0,e.jsx)(n.a,{href:\"#testing-the-magic\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Testing the Magic\"]}),(0,e.jsx)(n.p,{children:\"Let me show you this in action. I started 3 nodes and ran some tests:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a table\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -X POST http://localhost:8001/sql -d \",(0,e.jsx)(n.span,{className:\"token string\",children:`'{\"sql\":\"CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT)\"}'`}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"success\"'}),\":true,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"result\"'}),\":\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows\"'}),\":null,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows_affected\"'}),\":0,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"last_insert_id\"'}),\":0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Insert some data\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -X POST http://localhost:8001/sql -d \",(0,e.jsx)(n.span,{className:\"token string\",children:`'{\"sql\":\"INSERT INTO users (name) VALUES (?)\", \"args\":[\"Alice\"]}'`}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"success\"'}),\":true,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"result\"'}),\":\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows\"'}),\":null,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows_affected\"'}),\":1,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"last_insert_id\"'}),\":1\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -X POST http://localhost:8001/sql -d \",(0,e.jsx)(n.span,{className:\"token string\",children:`'{\"sql\":\"INSERT INTO users (name) VALUES (?)\", \"args\":[\"Bob\"]}'`}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"success\"'}),\":true,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"result\"'}),\":\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows\"'}),\":null,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows_affected\"'}),\":1,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"last_insert_id\"'}),\":2\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Query from different nodes - data is replicated!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"curl\"}),\" -X POST http://localhost:8002/sql -d \",(0,e.jsx)(n.span,{className:\"token string\",children:`'{\"sql\":\"SELECT * FROM users\"}'`}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"success\"'}),\":true,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"result\"'}),\":\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows\"'}),\":\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"id\"'}),\":1,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"name\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Alice\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\",\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"id\"'}),\":2,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"name\"'}),(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Bob\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\",\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"rows_affected\"'}),\":0,\",(0,e.jsx)(n.span,{className:\"token string\",children:'\"last_insert_id\"'}),\":0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Node 1 logs show the election process:\"}),(0,e.jsx)(o,{width:600,src:\"/static/images/general/raftdb1.png\"}),(0,e.jsxs)(n.h2,{id:\"the-trade-off-speed-vs-absolute-durability\",children:[(0,e.jsx)(n.a,{href:\"#the-trade-off-speed-vs-absolute-durability\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Trade-off: Speed vs. Absolute Durability\"]}),(0,e.jsx)(n.p,{children:`Now, let's address the elephant in the room. What if Guangzhou gets hit by a meteor right after the client receives \"success\" but before Shanghai gets the data? Well, that data is gone forever.`}),(0,e.jsxs)(n.p,{children:[\"This isn't a bug \\u2013 it's a feature! PhxSQL makes a deliberate choice: \",(0,e.jsx)(n.strong,{children:\"optimize for the 99.999% case where regions don't get destroyed, rather than the 0.001% disaster scenario.\"})]}),(0,e.jsx)(n.p,{children:\"For most applications, losing a few writes during a complete regional disaster is acceptable. The alternative \\u2013 making every write operation 30ms slower to guard against meteor strikes \\u2013 would make your users suffer every single day for a scenario that hopefully never happens.\"}),(0,e.jsxs)(n.h2,{id:\"why-phxsql-never-became-the-next-big-thing\",children:[(0,e.jsx)(n.a,{href:\"#why-phxsql-never-became-the-next-big-thing\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Why PhxSQL Never Became the Next Big Thing\"]}),(0,e.jsx)(n.p,{children:\"Nine years have passed since WeChat open-sourced PhxSQL, and it never really took off. Here's my theory:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:'The \"WeChat Problem\" is Rare'}),\": Not many companies have billion-user social networks with payment systems. Most companies are still figuring out how to handle their first million users.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Cloud-Native Happened\"}),\": In 2025, most companies just use managed database services with built-in HA. Why build your own distributed database when AWS RDS or Google Cloud SQL does it for you?\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Ecosystem Matters\"}),\": PhxSQL never built the ecosystem. No fancy dashboard, no Docker images, no Kubernetes operators. If you can't deploy it with one YAML file, modern DevOps teams won't touch it.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"On-Premise is Dead\"}),\": Most companies moved to the cloud. Those who didn't probably went with TiDB or other modern distributed databases.\"]})]}),(0,e.jsxs)(n.h2,{id:\"the-lasting-legacy-the-philosophy-still-matters\",children:[(0,e.jsx)(n.a,{href:\"#the-lasting-legacy-the-philosophy-still-matters\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Lasting Legacy: The Philosophy Still Matters\"]}),(0,e.jsx)(n.p,{children:`Even though PhxSQL itself might be a museum piece, its \"Fastest Majority\" philosophy is still relevant in 2025. Whether you're building microservices, distributed caches, or that secrets manager I mentioned, remember:`}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.strong,{children:\"Optimize for the common case, not the disaster scenario\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.strong,{children:\"Don't let the slowest node dictate your performance\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.strong,{children:'Sometimes \"fast enough\" is better than \"perfectly consistent\"'})})]}),(0,e.jsxs)(n.h2,{id:\"my-wechat-days-learning-from-giants\",children:[(0,e.jsx)(n.a,{href:\"#my-wechat-days-learning-from-giants\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"My WeChat Days: Learning from Giants\"]}),(0,e.jsx)(n.p,{children:`Back when I was part of the WeChat team, dealing with scale was a daily reality. When you have over a billion daily active users across social messaging, payments, and mini-programs, hardware failures aren't \"if\" \\u2013 they're \"when\" and \"how many today?\" WeChat's approach to PhxSQL made perfect sense in that context. The team had:`}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Deep MySQL expertise (it's the most widely used database in China)\"}),(0,e.jsx)(n.li,{children:\"Extensive Paxos algorithm experience (they also open-sourced Paxos-based NoSQL and message queue systems)\"}),(0,e.jsx)(n.li,{children:\"A real need for automated failure handling and node replacement\"})]}),(0,e.jsx)(n.p,{children:\"Building a Paxos layer on top of MySQL wasn't just clever \\u2013 it was necessary survival at that scale.\"}),(0,e.jsxs)(n.h2,{id:\"sometimes-the-old-ways-are-still-good-ways\",children:[(0,e.jsx)(n.a,{href:\"#sometimes-the-old-ways-are-still-good-ways\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Sometimes the Old Ways Are Still Good Ways\"]}),(0,e.jsx)(n.p,{children:\"Would I recommend PhxSQL for a new project in 2025? Probably not. Would I recommend understanding its philosophy? Absolutely.\"}),(0,e.jsx)(n.p,{children:`In our rush toward cloud-native, serverless, and AI-everything, we sometimes forget that some of the best engineering solutions come from understanding fundamental trade-offs. PhxSQL's \"Fastest Majority\" approach is a masterclass in making the right compromises.`}),(0,e.jsx)(n.p,{children:\"So the next time you're designing a distributed system, remember: you don't always need to wait for the slowest member of the committee. Sometimes, the fastest majority is all you need.\"}),(0,e.jsxs)(n.p,{children:[\"P.S. - The full Go implementation is \",(0,e.jsx)(n.a,{href:\"https://github.com/liweijian/RaxSQL\",children:\"available\"}),\" if you want to play with it. It's about 900 lines of code that capture the essence of a system that handled billions of users. Not bad for a weekend project!\"]})]})}}var w=b;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return x;})();\n;return Component;","toc":[{"value":"The \"Cross-Region Latency Curse\" – Every DBA's Nightmare","url":"#the-cross-region-latency-curse--every-dbas-nightmare","depth":2},{"value":"PhxSQL's Brilliant Solution: The \"Fastest Majority\" Hack","url":"#phxsqls-brilliant-solution-the-fastest-majority-hack","depth":2},{"value":"The Magic Behind the Scenes","url":"#the-magic-behind-the-scenes","depth":3},{"value":"My Go + Raft Implementation: PhxSQL's Soul in Modern Clothes","url":"#my-go--raft-implementation-phxsqls-soul-in-modern-clothes","depth":2},{"value":"Testing the Magic","url":"#testing-the-magic","depth":2},{"value":"The Trade-off: Speed vs. Absolute Durability","url":"#the-trade-off-speed-vs-absolute-durability","depth":2},{"value":"Why PhxSQL Never Became the Next Big Thing","url":"#why-phxsql-never-became-the-next-big-thing","depth":2},{"value":"The Lasting Legacy: The Philosophy Still Matters","url":"#the-lasting-legacy-the-philosophy-still-matters","depth":2},{"value":"My WeChat Days: Learning from Giants","url":"#my-wechat-days-learning-from-giants","depth":2},{"value":"Sometimes the Old Ways Are Still Good Ways","url":"#sometimes-the-old-ways-are-still-good-ways","depth":2}],"frontMatter":{"readingTime":{"text":"9 min read","minutes":8.085,"time":485100,"words":1617},"slug":"general/phxsql","fileName":"general/phxsql.md","title":"A Look Back at WeChat's PhxSQL and the 'Fastest Majority'","date":"2025-07-18T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This post explores how WeChat's PhxSQL uses the \"Fastest Majority\" principle to offer a timeless lesson in designing fast and resilient distributed database systems.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"An InfoSec Architect's First Taste of Temporal","date":"2025-07-08T00:00:00.000Z","tags":["Secrets Management"],"draft":false,"summary":"This is a therapy session for anyone traumatized by fragile scripts. I traded my `cron/try/catch` nightmares for a robot project manager named Temporal.","images":[],"slug":"general/temporal"},"next":{"title":"Hacker and Physicist - A Tale of \"Common Sense\"","date":"2025-08-22T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Why fundamental digital principles are as invisible (and essential) as the laws of physics.","images":[],"slug":"general/hacker_physicist"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["general","phxsql"]},"buildId":"oVQKg7I9e_0Oh0pHteJCk","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>