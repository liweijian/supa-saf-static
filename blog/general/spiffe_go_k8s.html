<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)</title><meta name="robots" content="follow, index"/><meta name="description" content="This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices."/><meta property="og:url" content="https://www.supasaf.com/blog/general/spiffe_go_k8s"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices."/><meta property="og:title" content="From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)"/><meta name="twitter:description" content="This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/general/spiffe_go_k8s"/><meta property="article:published_time" content="2025-10-06T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/general/spiffe_go_k8s"
  },
  "headline": "From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2025-10-06T00:00:00.000Z",
  "dateModified": "2025-10-06T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/oVQKg7I9e_0Oh0pHteJCk/_buildManifest.js" defer=""></script><script src="/_next/static/oVQKg7I9e_0Oh0pHteJCk/_ssgManifest.js" defer=""></script><script src="/_next/static/oVQKg7I9e_0Oh0pHteJCk/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-10-06T00:00:00.000Z">Monday, October 6, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>A few years ago, when someone needed to get two microservices to talk to each other securely, they would probably generate a long-lived API key, paste it into a config file, and commit it ‚Äî maybe even to a public repo (oops). Then they‚Äôd cross their fingers and hope nobody found it.</p><p>It feels a bit like leaving your house key under the doormat. It‚Äôs simple, sure, but is it secure? Not really.</p><p>Welcome to the wonderful, chaotic world of microservice security. In my market, getting developers to encrypt internal traffic is a weekly adventure. We have teams building awesome things with Java Spring Boot and using Nacos for service discovery, but the communication between them is often plain, unencrypted HTTP.</p><p>After watching a fantastic gRPC Conf talk, <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=qFSHoxs8i2Q">Fortifying gRPC Microservices</a>, I was inspired. The speaker explained these complex topics in such a clear, story-like way. I thought, &quot;I have to try this myself!&quot; So, I fired up my laptop, spun up Minikube, and built a working Go demo. The process was incredibly enlightening, and I want to share that journey with you.</p><p>So grab a coffee, and let&#x27;s go from zero to Zero Trust. All the code is available on my GitHub: <a target="_blank" rel="noopener noreferrer" href="https://github.com/liweijian/spire-demo">https://github.com/liweijian/spire-demo</a></p><h2 id="its-behind-a-firewall"><a href="#its-behind-a-firewall" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>&quot;It&#x27;s Behind a Firewall&quot;</h2><p>First question: why do we even need to secure communication inside our own network? Isn&#x27;t that what the firewall is for?</p><p>Relying solely on a firewall is like having a world-class bouncer at the front door of a nightclub, but once you&#x27;re inside, it&#x27;s a total free-for-all. No one checks your ID again, so anyone could potentially impersonate a staff member and walk into the cash room.</p><p>In the digital world, if an attacker gets past your firewall (your &quot;bouncer&quot;), they can listen to all your internal plaintext traffic. As the Snowden leaks famously revealed with a slide saying &quot;<strong>SSL added and removed here</strong>&quot;, even giants like Google had their internal traffic tapped.</p><img width="800" src="/static/images/general/snowden.jpg"/><p>In today&#x27;s world of dynamic, cloud-native environments, services are ephemeral. Their IP addresses change constantly. Using network location as a security measure is like trying to identify a friend based on the parking spot they&#x27;re in. Tomorrow, someone else will be in that spot.</p><p>This is the core idea of <strong>Zero Trust: Never trust, always verify</strong>.</p><h2 id="the-painful-journey-api-keys-and-the-mtls-headache"><a href="#the-painful-journey-api-keys-and-the-mtls-headache" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Painful Journey: API Keys and the mTLS Headache</h2><p>Okay, so we need to secure our internal traffic. What are our options?</p><ol><li><p><strong>API Keys &amp; Access Tokens</strong>: This is often the first step. We issue a secret key or a short-lived JWT token to a client. The client flashes this token, and the server says, &quot;Okay, you&#x27;re in.&quot; This is better than nothing, but if the communication channel isn&#x27;t encrypted, an attacker can just snatch the token off the wire and use it. We&#x27;ve solved one problem but ignored the bigger one: encryption.</p></li><li><p><strong>Traditional mTLS</strong>: The next logical step is mutual TLS. It‚Äôs like a secret handshake where both the client and server show their IDs (certificates) to prove who they are before they start talking. This is great! But doing it manually in a microservices world is a nightmare.</p><ul><li><p><strong>Certificate Management is a Pain</strong>: Who creates the certificates? Who signs them? How do you get them onto every single pod? How do you rotate them before they expire? It quickly becomes a full-time job.</p></li><li><p><strong>Identity is Flimsy</strong>: What do you put in the certificate as the &quot;name&quot;? An IP address? A DNS name? As we discussed, these things are meaningless for ephemeral workloads. We once had to disable the default gRPC name validation and write our own custom, brittle code to check the identity. It worked, but it felt like holding things together with duct tape.</p></li></ul></li></ol><p>There had to be a better way. And there is.</p><h2 id="the-hero-arrives-spiffe-and-spire"><a href="#the-hero-arrives-spiffe-and-spire" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Hero Arrives: SPIFFE and SPIRE</h2><p>This is where our story gets its heroes.</p><p><strong>SPIFFE (Secure Production Identity Framework For Everyone)</strong> is not a tool, but a <strong>standard</strong>. It‚Äôs a set of rules for how to give a software service a strong, verifiable identity, no matter where it&#x27;s running.</p><p>The core concept is the <strong>SPIFFE ID</strong>, a unique name for your service that looks like this: <code>spiffe://your-company.com/your-service</code>.</p><ul><li><p>The <code>your-company.com</code> part is the &quot;trust domain.&quot; Think of it as the country that issues the passport.</p></li><li><p>The <code>/your-service</code> part is the unique identity within that country.</p></li></ul><p>This ID is then embedded into a short-lived cryptographic document called an <strong>SVID (Spiffe Verifiable Identity Document)</strong>, which is usually just a standard X.509 certificate or JWT.</p><p><strong>SPIRE (SPIFFE Runtime Environment)</strong> is the <strong>implementation</strong> of the SPIFFE standard. It‚Äôs the machinery that actually does the work. Think of SPIRE as the passport office for your services. It consists of two main parts:</p><ul><li><p><strong>SPIRE Server</strong>: The central authority. It manages which service gets which SPIFFE ID and signs the certificates.</p></li><li><p><strong>SPIRE Agent</strong>: A little helper that runs on every node (or machine/pod). Its job is to figure out which services are running on its node and securely deliver the correct &quot;passport&quot; (SVID) to them.</p></li></ul><p>The magic is in how the Agent verifies a workload&#x27;s identity, a process called <strong>Workload Attestation</strong>. In Kubernetes, the Agent can ask the kubelet, &quot;Hey, tell me about the process that&#x27;s calling me. What&#x27;s its service account? What&#x27;s its namespace?&quot; Based on these trusted proofs, the Agent gets the correct SVID from the SPIRE Server.</p><p>The result? Every service gets a strong, short-lived, automatically rotated identity without you having to lift a finger.</p><h2 id="lets-get-our-hands-dirty-a-live-demo-in-minikube"><a href="#lets-get-our-hands-dirty-a-live-demo-in-minikube" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Let&#x27;s Get Our Hands Dirty: A Live Demo in Minikube!</h2><p>Talk is cheap. Let me show you how this actually works. I&#x27;ve put together a simple Go-based gRPC client/server demo that runs on Minikube.</p><img width="800" src="/static/images/general/spiffe_grpc.png"/><p><strong>Credit goes to <a target="_blank" rel="noopener noreferrer" href="https://youtu.be/qFSHoxs8i2Q?t=1115">Mehrdad Afshari</a></strong></p><h3 id="setup-spiresh-the-magic-wand"><a href="#setup-spiresh-the-magic-wand" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>setup-spire.sh</code> (The Magic Wand)</h3><p>This script installs SPIRE using Helm and registers the identities for our client and server. We are telling SPIRE: &quot;Any pod running with the Kubernetes service account <code>my-server-sa</code> should be given the identity <code>spiffe://supasaf.com/server</code>.&quot;</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line"><span class="token important shebang">#!/bin/bash</span>
</span><span class="code-line"><span class="token builtin class-name">set</span> -e
</span><span class="code-line">
</span><span class="code-line"><span class="token variable assign-left">KUBECTL</span><span class="token operator">=</span><span class="token string">&quot;minikube kubectl --&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üöÄ Setting up SPIRE demo environment...&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üë§ Creating Service Accounts...&quot;</span>
</span><span class="code-line"><span class="token variable">$KUBECTL</span> apply -f - <span class="token operator">&lt;&lt;</span> <span class="token string">ENDSA
</span></span><span class="code-line"><span class="token string">apiVersion: v1
</span></span><span class="code-line"><span class="token string">kind: ServiceAccount
</span></span><span class="code-line"><span class="token string">metadata:
</span></span><span class="code-line"><span class="token string">  name: my-server-sa
</span></span><span class="code-line"><span class="token string">  namespace: default
</span></span><span class="code-line"><span class="token string">---
</span></span><span class="code-line"><span class="token string">apiVersion: v1
</span></span><span class="code-line"><span class="token string">kind: ServiceAccount
</span></span><span class="code-line"><span class="token string">metadata:
</span></span><span class="code-line"><span class="token string">  name: my-client-sa
</span></span><span class="code-line"><span class="token string">  namespace: default
</span></span><span class="code-line"><span class="token string">ENDSA</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üì¶ Installing SPIRE with Helm...&quot;</span>
</span><span class="code-line">helm repo <span class="token function">add</span> spiffe https://spiffe.github.io/helm-charts/ <span class="token operator"><span class="token important file-descriptor">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token boolean">true</span>
</span><span class="code-line">helm repo update
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üì¶ Installing SPIRE with custom values...&quot;</span>
</span><span class="code-line"><span class="token keyword">if</span> helm list -n spire-system <span class="token operator">|</span> <span class="token function">grep</span> -q spire<span class="token punctuation">;</span> <span class="token keyword">then</span>
</span><span class="code-line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;‚ö†Ô∏è  SPIRE already installed, upgrading with custom values...&quot;</span>
</span><span class="code-line">    helm upgrade spire spiffe/spire <span class="token punctuation">\</span>
</span><span class="code-line">        --namespace spire-system <span class="token punctuation">\</span>
</span><span class="code-line">        -f spire-values.yaml <span class="token punctuation">\</span>
</span><span class="code-line">        --wait <span class="token punctuation">\</span>
</span><span class="code-line">        --timeout 5m
</span><span class="code-line"><span class="token keyword">else</span>
</span><span class="code-line">    helm <span class="token function">install</span> spire spiffe/spire <span class="token punctuation">\</span>
</span><span class="code-line">        --namespace spire-system <span class="token punctuation">\</span>
</span><span class="code-line">        --create-namespace <span class="token punctuation">\</span>
</span><span class="code-line">        -f spire-values.yaml <span class="token punctuation">\</span>
</span><span class="code-line">        --wait <span class="token punctuation">\</span>
</span><span class="code-line">        --timeout 5m
</span><span class="code-line"><span class="token keyword">fi</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;‚è≥ Waiting for SPIRE components to be ready...&quot;</span>
</span><span class="code-line"><span class="token variable">$KUBECTL</span> <span class="token function">wait</span> --for<span class="token operator">=</span>condition<span class="token operator">=</span>ready pod -l app.kubernetes.io/name<span class="token operator">=</span>server -n spire-system --timeout<span class="token operator">=</span>300s
</span><span class="code-line"><span class="token variable">$KUBECTL</span> <span class="token function">wait</span> --for<span class="token operator">=</span>condition<span class="token operator">=</span>ready pod -l app.kubernetes.io/name<span class="token operator">=</span>agent -n spire-system --timeout<span class="token operator">=</span>300s
</span><span class="code-line">
</span><span class="code-line"><span class="token variable assign-left">SERVER_POD</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$KUBECTL get pod -n spire-system -l app.kubernetes.io/name<span class="token operator">=</span>server -o <span class="token variable assign-left">jsonpath</span><span class="token operator">=</span><span class="token string">&#x27;{.items[0].metadata.name}&#x27;</span><span class="token variable">)</span></span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;‚úÖ SPIRE Server pod: <span class="token variable">$SERVER_POD</span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üîê Registering node identity...&quot;</span>
</span><span class="code-line"><span class="token variable">$KUBECTL</span> <span class="token builtin class-name">exec</span> -n spire-system <span class="token variable">$SERVER_POD</span> -c spire-server -- <span class="token punctuation">\</span>
</span><span class="code-line">    /opt/spire/bin/spire-server entry create <span class="token punctuation">\</span>
</span><span class="code-line">    -node <span class="token punctuation">\</span>
</span><span class="code-line">    -spiffeID spiffe://supasaf.com/minikube-node <span class="token punctuation">\</span>
</span><span class="code-line">    -selector k8s_psat:cluster:minikube <span class="token punctuation">\</span>
</span><span class="code-line">    -selector k8s_psat:agent_ns:spire-system <span class="token punctuation">\</span>
</span><span class="code-line">    -selector k8s_psat:agent_sa:spire-agent <span class="token operator"><span class="token important file-descriptor">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;‚ö†Ô∏è  Node entry already exists&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üîê Registering server workload identity...&quot;</span>
</span><span class="code-line"><span class="token variable">$KUBECTL</span> <span class="token builtin class-name">exec</span> -n spire-system <span class="token variable">$SERVER_POD</span> -c spire-server -- <span class="token punctuation">\</span>
</span><span class="code-line">    /opt/spire/bin/spire-server entry create <span class="token punctuation">\</span>
</span><span class="code-line">    -parentID spiffe://supasaf.com/minikube-node <span class="token punctuation">\</span>
</span><span class="code-line">    -spiffeID spiffe://supasaf.com/server <span class="token punctuation">\</span>
</span><span class="code-line">    -selector k8s:ns:default <span class="token punctuation">\</span>
</span><span class="code-line">    -selector k8s:sa:my-server-sa <span class="token operator"><span class="token important file-descriptor">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;‚ö†Ô∏è  Server entry already exists&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üîê Registering client workload identity...&quot;</span>
</span><span class="code-line"><span class="token variable">$KUBECTL</span> <span class="token builtin class-name">exec</span> -n spire-system <span class="token variable">$SERVER_POD</span> -c spire-server -- <span class="token punctuation">\</span>
</span><span class="code-line">    /opt/spire/bin/spire-server entry create <span class="token punctuation">\</span>
</span><span class="code-line">    -parentID spiffe://supasaf.com/minikube-node <span class="token punctuation">\</span>
</span><span class="code-line">    -spiffeID spiffe://supasaf.com/client <span class="token punctuation">\</span>
</span><span class="code-line">    -selector k8s:ns:default <span class="token punctuation">\</span>
</span><span class="code-line">    -selector k8s:sa:my-client-sa <span class="token operator"><span class="token important file-descriptor">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;‚ö†Ô∏è  Client entry already exists&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üìã Registered entries:&quot;</span>
</span><span class="code-line"><span class="token variable">$KUBECTL</span> <span class="token builtin class-name">exec</span> -n spire-system <span class="token variable">$SERVER_POD</span> -c spire-server -- <span class="token punctuation">\</span>
</span><span class="code-line">    /opt/spire/bin/spire-server entry show
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;‚úÖ SPIRE setup complete!&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;üìù Registered SPIFFE IDs:&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;   Node:   spiffe://supasaf.com/minikube-node&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;   Server: spiffe://supasaf.com/server (SA: my-server-sa)&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;   Client: spiffe://supasaf.com/client (SA: my-client-sa)&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Next steps:&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;1. Build: ./build.sh&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;2. Deploy: kubectl apply -f deployment.yaml&quot;</span>
</span><span class="code-line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;3. Check logs: kubectl logs -l app=my-server -f&quot;</span>
</span></code></pre></div><p>We will get the following outputs</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">‚úÖ SPIRE Server pod: spire-server-0
</span><span class="code-line">üîê Registering node identity<span class="token punctuation">..</span>.
</span><span class="code-line">Entry ID         <span class="token builtin class-name">:</span> 11223f64-8be3-4d84-9d7e-1827b599c5ae
</span><span class="code-line">SPIFFE ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/minikube-node
</span><span class="code-line">Parent ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/spire/server
</span><span class="code-line">Revision         <span class="token builtin class-name">:</span> <span class="token number">0</span>
</span><span class="code-line">X509-SVID TTL    <span class="token builtin class-name">:</span> default
</span><span class="code-line">JWT-SVID TTL     <span class="token builtin class-name">:</span> default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s_psat:agent_ns:spire-system
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s_psat:agent_sa:spire-agent
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s_psat:cluster:minikube
</span><span class="code-line">
</span><span class="code-line">üîê Registering server workload identity<span class="token punctuation">..</span>.
</span><span class="code-line">Entry ID         <span class="token builtin class-name">:</span> 977ab667-1001-476f-bb4d-838bb4fc556b
</span><span class="code-line">SPIFFE ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/server
</span><span class="code-line">Parent ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/minikube-node
</span><span class="code-line">Revision         <span class="token builtin class-name">:</span> <span class="token number">0</span>
</span><span class="code-line">X509-SVID TTL    <span class="token builtin class-name">:</span> default
</span><span class="code-line">JWT-SVID TTL     <span class="token builtin class-name">:</span> default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:ns:default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:sa:my-server-sa
</span><span class="code-line">
</span><span class="code-line">üîê Registering client workload identity<span class="token punctuation">..</span>.
</span><span class="code-line">Entry ID         <span class="token builtin class-name">:</span> 06a80986-983e-401e-9545-e71dfc2aecde
</span><span class="code-line">SPIFFE ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/client
</span><span class="code-line">Parent ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/minikube-node
</span><span class="code-line">Revision         <span class="token builtin class-name">:</span> <span class="token number">0</span>
</span><span class="code-line">X509-SVID TTL    <span class="token builtin class-name">:</span> default
</span><span class="code-line">JWT-SVID TTL     <span class="token builtin class-name">:</span> default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:ns:default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:sa:my-client-sa
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">üìã Registered entries:
</span><span class="code-line">Found <span class="token number">3</span> entries
</span><span class="code-line">Entry ID         <span class="token builtin class-name">:</span> 06a80986-983e-401e-9545-e71dfc2aecde
</span><span class="code-line">SPIFFE ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/client
</span><span class="code-line">Parent ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/minikube-node
</span><span class="code-line">Revision         <span class="token builtin class-name">:</span> <span class="token number">0</span>
</span><span class="code-line">X509-SVID TTL    <span class="token builtin class-name">:</span> default
</span><span class="code-line">JWT-SVID TTL     <span class="token builtin class-name">:</span> default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:ns:default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:sa:my-client-sa
</span><span class="code-line">
</span><span class="code-line">Entry ID         <span class="token builtin class-name">:</span> 11223f64-8be3-4d84-9d7e-1827b599c5ae
</span><span class="code-line">SPIFFE ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/minikube-node
</span><span class="code-line">Parent ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/spire/server
</span><span class="code-line">Revision         <span class="token builtin class-name">:</span> <span class="token number">0</span>
</span><span class="code-line">X509-SVID TTL    <span class="token builtin class-name">:</span> default
</span><span class="code-line">JWT-SVID TTL     <span class="token builtin class-name">:</span> default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s_psat:agent_ns:spire-system
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s_psat:agent_sa:spire-agent
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s_psat:cluster:minikube
</span><span class="code-line">
</span><span class="code-line">Entry ID         <span class="token builtin class-name">:</span> 977ab667-1001-476f-bb4d-838bb4fc556b
</span><span class="code-line">SPIFFE ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/server
</span><span class="code-line">Parent ID        <span class="token builtin class-name">:</span> spiffe://supasaf.com/minikube-node
</span><span class="code-line">Revision         <span class="token builtin class-name">:</span> <span class="token number">0</span>
</span><span class="code-line">X509-SVID TTL    <span class="token builtin class-name">:</span> default
</span><span class="code-line">JWT-SVID TTL     <span class="token builtin class-name">:</span> default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:ns:default
</span><span class="code-line">Selector         <span class="token builtin class-name">:</span> k8s:sa:my-server-sa
</span><span class="code-line">
</span><span class="code-line">
</span><span class="code-line">‚úÖ SPIRE setup complete<span class="token operator">!</span>
</span><span class="code-line">
</span><span class="code-line">üìù Registered SPIFFE IDs:
</span><span class="code-line">   Node:   spiffe://supasaf.com/minikube-node
</span><span class="code-line">   Server: spiffe://supasaf.com/server <span class="token punctuation">(</span>SA: my-server-sa<span class="token punctuation">)</span>
</span><span class="code-line">   Client: spiffe://supasaf.com/client <span class="token punctuation">(</span>SA: my-client-sa<span class="token punctuation">)</span>
</span></code></pre></div><h3 id="deploymentyaml-the-blueprint"><a href="#deploymentyaml-the-blueprint" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>deployment.yaml</code> (The Blueprint)</h3><p>This file tells Kubernetes how to run our apps. The most important part is the <code>volumes</code> section. We use the <code>csi.spiffe.io</code> driver to mount the SPIRE Agent&#x27;s socket directly into our pod. This is how our app talks to the agent.</p><div class="relative"><pre><code class="code-highlight language-yaml"><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> ServiceAccount
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server<span class="token punctuation">-</span>sa
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span><span class="code-line"><span class="token punctuation">---</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> ServiceAccount
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>client<span class="token punctuation">-</span>sa
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span><span class="code-line"><span class="token punctuation">---</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Service
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server<span class="token punctuation">-</span>svc
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server
</span><span class="code-line">  <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token punctuation">-</span> <span class="token atrule key">protocol</span><span class="token punctuation">:</span> TCP
</span><span class="code-line">      <span class="token atrule key">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span><span class="code-line">      <span class="token atrule key">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span><span class="code-line">  <span class="token atrule key">type</span><span class="token punctuation">:</span> ClusterIP
</span><span class="code-line"><span class="token punctuation">---</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server<span class="token punctuation">-</span>deployment
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">serviceAccountName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server<span class="token punctuation">-</span>sa
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server
</span><span class="code-line">        <span class="token atrule key">image</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>server<span class="token punctuation">:</span>latest
</span><span class="code-line">        <span class="token atrule key">imagePullPolicy</span><span class="token punctuation">:</span> Never
</span><span class="code-line">        <span class="token atrule key">ports</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</span><span class="code-line">        <span class="token atrule key">env</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> SPIFFE_ENDPOINT_SOCKET
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> unix<span class="token punctuation">:</span>///spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api/spire<span class="token punctuation">-</span>agent.sock
</span><span class="code-line">        <span class="token atrule key">volumeMounts</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api
</span><span class="code-line">          <span class="token atrule key">mountPath</span><span class="token punctuation">:</span> /spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api
</span><span class="code-line">          <span class="token atrule key">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token atrule key">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api
</span><span class="code-line">        <span class="token atrule key">csi</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;csi.spiffe.io&quot;</span>
</span><span class="code-line">          <span class="token atrule key">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line"><span class="token punctuation">---</span>
</span><span class="code-line"><span class="token atrule key">apiVersion</span><span class="token punctuation">:</span> apps/v1
</span><span class="code-line"><span class="token atrule key">kind</span><span class="token punctuation">:</span> Deployment
</span><span class="code-line"><span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>client<span class="token punctuation">-</span>deployment
</span><span class="code-line">  <span class="token atrule key">namespace</span><span class="token punctuation">:</span> default
</span><span class="code-line"><span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token atrule key">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
</span><span class="code-line">  <span class="token atrule key">selector</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">matchLabels</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>client
</span><span class="code-line">  <span class="token atrule key">template</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token atrule key">metadata</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">labels</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token atrule key">app</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>client
</span><span class="code-line">    <span class="token atrule key">spec</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token atrule key">serviceAccountName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>client<span class="token punctuation">-</span>sa
</span><span class="code-line">      <span class="token atrule key">restartPolicy</span><span class="token punctuation">:</span> Always
</span><span class="code-line">      <span class="token atrule key">containers</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>client
</span><span class="code-line">        <span class="token atrule key">image</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>client<span class="token punctuation">:</span>latest
</span><span class="code-line">        <span class="token atrule key">imagePullPolicy</span><span class="token punctuation">:</span> Never
</span><span class="code-line">        <span class="token atrule key">env</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> SPIFFE_ENDPOINT_SOCKET
</span><span class="code-line">          <span class="token atrule key">value</span><span class="token punctuation">:</span> unix<span class="token punctuation">:</span>///spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api/spire<span class="token punctuation">-</span>agent.sock
</span><span class="code-line">        <span class="token atrule key">volumeMounts</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api
</span><span class="code-line">          <span class="token atrule key">mountPath</span><span class="token punctuation">:</span> /spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api
</span><span class="code-line">          <span class="token atrule key">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span><span class="code-line">      <span class="token atrule key">volumes</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> spiffe<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>api
</span><span class="code-line">        <span class="token atrule key">csi</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token atrule key">driver</span><span class="token punctuation">:</span> <span class="token string">&quot;csi.spiffe.io&quot;</span>
</span><span class="code-line">          <span class="token atrule key">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</span></code></pre></div><h3 id="servermaingo-the-wise-guardian"><a href="#servermaingo-the-wise-guardian" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>server/main.go (The Wise Guardian)</h3><p>Look how simple the Go code is! We don&#x27;t handle any private keys or certificate files. We just ask the <code>workloadapi</code> for a <code>Source</code>, and it handles all the magic of talking to the SPIRE Agent behind the scenes. When a request comes in, we can inspect the peer&#x27;s certificate and pull out its verified SPIFFE ID.</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token keyword">package</span> main
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token string">&quot;context&quot;</span>
</span><span class="code-line">        <span class="token string">&quot;log&quot;</span>
</span><span class="code-line">        <span class="token string">&quot;net&quot;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token string">&quot;github.com/spiffe/go-spiffe/v2/spiffetls/tlsconfig&quot;</span>
</span><span class="code-line">        <span class="token string">&quot;github.com/spiffe/go-spiffe/v2/workloadapi&quot;</span>
</span><span class="code-line">        <span class="token string">&quot;google.golang.org/grpc&quot;</span>
</span><span class="code-line">        <span class="token string">&quot;google.golang.org/grpc/credentials&quot;</span>
</span><span class="code-line">        <span class="token string">&quot;google.golang.org/grpc/peer&quot;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token string">&quot;spire-demo/proto&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> Server <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">        proto<span class="token punctuation">.</span>UnimplementedEchoServer
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>Server<span class="token punctuation">)</span> <span class="token function">SayHello</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> in <span class="token operator">*</span>proto<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>proto<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        p<span class="token punctuation">,</span> ok <span class="token operator">:=</span> peer<span class="token punctuation">.</span><span class="token function">FromContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: could not get peer from context&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">return</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Message<span class="token punctuation">:</span> <span class="token string">&quot;ERROR: no peer info&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        tlsInfo<span class="token punctuation">,</span> ok <span class="token operator">:=</span> p<span class="token punctuation">.</span>AuthInfo<span class="token punctuation">.</span><span class="token punctuation">(</span>credentials<span class="token punctuation">.</span>TLSInfo<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: peer auth info is not TLS&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">return</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Message<span class="token punctuation">:</span> <span class="token string">&quot;ERROR: no TLS info&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>tlsInfo<span class="token punctuation">.</span>State<span class="token punctuation">.</span>PeerCertificates<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: no peer certificates&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">return</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Message<span class="token punctuation">:</span> <span class="token string">&quot;ERROR: no certificates&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        cert <span class="token operator">:=</span> tlsInfo<span class="token punctuation">.</span>State<span class="token punctuation">.</span>PeerCertificates<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>cert<span class="token punctuation">.</span>URIs<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: no URIs in certificate&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">                <span class="token keyword">return</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Message<span class="token punctuation">:</span> <span class="token string">&quot;ERROR: no SPIFFE ID&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        spiffeID <span class="token operator">:=</span> cert<span class="token punctuation">.</span>URIs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;‚úÖ Received a request from client with SPIFFE ID: %s&quot;</span><span class="token punctuation">,</span> spiffeID<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">.</span>Response<span class="token punctuation">{</span>Message<span class="token punctuation">:</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">+</span> in<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">&quot; from &quot;</span> <span class="token operator">+</span> spiffeID<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">        ctx <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;üöÄ Starting server, waiting for SPIRE agent...&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        source<span class="token punctuation">,</span> err <span class="token operator">:=</span> workloadapi<span class="token punctuation">.</span><span class="token function">NewX509Source</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;‚ùå Unable to create X509Source: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token keyword">defer</span> source<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;‚úÖ Successfully connected to SPIRE agent&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        tlsConfig <span class="token operator">:=</span> tlsconfig<span class="token punctuation">.</span><span class="token function">MTLSServerConfig</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> source<span class="token punctuation">,</span> tlsconfig<span class="token punctuation">.</span><span class="token function">AuthorizeAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        creds <span class="token operator">:=</span> credentials<span class="token punctuation">.</span><span class="token function">NewTLS</span><span class="token punctuation">(</span>tlsConfig<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        server <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">NewServer</span><span class="token punctuation">(</span>grpc<span class="token punctuation">.</span><span class="token function">Creds</span><span class="token punctuation">(</span>creds<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        proto<span class="token punctuation">.</span><span class="token function">RegisterEchoServer</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Server<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        lis<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;‚ùå Failed to listen: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;üéß Server listening on :8080 with mTLS enabled&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">if</span> err <span class="token operator">:=</span> server<span class="token punctuation">.</span><span class="token function">Serve</span><span class="token punctuation">(</span>lis<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">                log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;‚ùå Failed to serve: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="the-aha-moment-checking-the-logs"><a href="#the-aha-moment-checking-the-logs" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The &quot;Aha!&quot; Moment: Checking the Logs</h3><p>After running <code>./setup-spire.sh</code>, <code>./build.sh</code>, and <code>kubectl apply -f deployment.yaml</code>, let&#x27;s look at the logs.</p><p>Server Logs:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~/spire-demo$ kubectl logs -l <span class="token variable assign-left">app</span><span class="token operator">=</span>my-server -f
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:24 üöÄ Starting server, waiting <span class="token keyword">for</span> SPIRE agent<span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:25 ‚úÖ Successfully connected to SPIRE agent
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:25 üéß Server listening on :8080 with mTLS enabled
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:25 ‚úÖ Received a request from client with SPIFFE ID: spiffe://supasaf.com/client
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:31 ‚úÖ Received a request from client with SPIFFE ID: spiffe://supasaf.com/client
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:50 ‚úÖ Received a request from client with SPIFFE ID: spiffe://supasaf.com/client
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:52:22 ‚úÖ Received a request from client with SPIFFE ID: spiffe://supasaf.com/client
</span></code></pre></div><p>Client Logs:</p><div class="relative"><pre><code class="language-bash code-highlight"><span class="code-line">ss@ss:~/spire-demo$ kubectl logs -l <span class="token variable assign-left">app</span><span class="token operator">=</span>my-client -f
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:30 üöÄ Starting client, waiting <span class="token keyword">for</span> SPIRE agent<span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:31 ‚úÖ Successfully connected to SPIRE agent
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:31 üîÑ Attempting to connect to server <span class="token punctuation">(</span>attempt <span class="token number">1</span>/10<span class="token punctuation">)</span><span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:31 ‚úÖ Connected to server
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:31 üì§ Sending request to server<span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:31 ‚úÖ Response from server: Hello SPIFFE from spiffe://supasaf.com/client
</span><span class="code-line"><span class="token number">2025</span>/10/06 08:51:31 üéâ Zero Trust communication successful<span class="token operator">!</span>
</span></code></pre></div><p>Look at that beautiful server log! <code>Received a request from client with SPIFFE ID: spiffe://supasaf.com/client</code>.</p><p>The server doesn&#x27;t know the client&#x27;s IP address, nor does it care. It knows its <strong>true</strong>, cryptographically verified identity. This is the foundation of Zero Trust security. We&#x27;ve successfully established a secure, authenticated, and encrypted channel between two microservices, and it was almost entirely automatic.</p><h2 id="wrapping-up"><a href="#wrapping-up" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Wrapping Up</h2><p>Building this demo was a real eye-opener. The concepts from the gRPC Conf talk came to life when I could actually see the SPIFFE IDs in my logs, watch certificates rotate automatically, and know that every connection was authenticated and encrypted.</p><p>In my market, where English documentation can be a barrier and plaintext HTTP is still common, I hope this practical example helps show that zero trust isn&#x27;t as scary as it sounds. SPIRE handles the complexity - certificate management, rotation, attestation - so we can focus on building secure applications.</p><p>Now if you&#x27;ll excuse me, I have another meeting about microservice security next week. But this time, I&#x27;m bringing a working demo. üöÄ</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/architect">Architect</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/hacker_physicist">Hacker and Physicist - A Tale of &quot;Common Sense&quot;</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/kerberos_ldap">InfoSec Architect 102-Service Accounts in the Linux Universe</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">‚Üê Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> ‚Ä¢ </div><div>¬© 2025</div><div> ‚Ä¢ </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=a=\u003el(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{t(a);for(var c in s)l(a,c,{get:s[c],enumerable:!0})},f=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026l(a,n,{get:()=\u003es[n],enumerable:!(c=p(s,n))||c.enumerable});return a},g=a=\u003ef(t(l(a!=null?d(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((P,o)=\u003e{o.exports=_jsx_runtime});var I={};k(I,{default:()=\u003ev,frontmatter:()=\u003ey});var e=g(r()),y={title:\"From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)\",date:\"2025-10-06\",tags:[\"Architect\"],draft:!1,summary:\"This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices.\",images:[]};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",strong:\"strong\",ol:\"ol\",li:\"li\",ul:\"ul\",code:\"code\",h3:\"h3\",pre:\"pre\"},a.components),{Image:i}=n;return i||w(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"A few years ago, when someone needed to get two microservices to talk to each other securely, they would probably generate a long-lived API key, paste it into a config file, and commit it \\u2014 maybe even to a public repo (oops). Then they\\u2019d cross their fingers and hope nobody found it.\"}),(0,e.jsx)(n.p,{children:\"It feels a bit like leaving your house key under the doormat. It\\u2019s simple, sure, but is it secure? Not really.\"}),(0,e.jsx)(n.p,{children:\"Welcome to the wonderful, chaotic world of microservice security. In my market, getting developers to encrypt internal traffic is a weekly adventure. We have teams building awesome things with Java Spring Boot and using Nacos for service discovery, but the communication between them is often plain, unencrypted HTTP.\"}),(0,e.jsxs)(n.p,{children:[\"After watching a fantastic gRPC Conf talk, \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/watch?v=qFSHoxs8i2Q\",children:\"Fortifying gRPC Microservices\"}),', I was inspired. The speaker explained these complex topics in such a clear, story-like way. I thought, \"I have to try this myself!\" So, I fired up my laptop, spun up Minikube, and built a working Go demo. The process was incredibly enlightening, and I want to share that journey with you.']}),(0,e.jsxs)(n.p,{children:[\"So grab a coffee, and let's go from zero to Zero Trust. All the code is available on my GitHub: \",(0,e.jsx)(n.a,{href:\"https://github.com/liweijian/spire-demo\",children:\"https://github.com/liweijian/spire-demo\"})]}),(0,e.jsxs)(n.h2,{id:\"its-behind-a-firewall\",children:[(0,e.jsx)(n.a,{href:\"#its-behind-a-firewall\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),`\"It's Behind a Firewall\"`]}),(0,e.jsx)(n.p,{children:\"First question: why do we even need to secure communication inside our own network? Isn't that what the firewall is for?\"}),(0,e.jsx)(n.p,{children:\"Relying solely on a firewall is like having a world-class bouncer at the front door of a nightclub, but once you're inside, it's a total free-for-all. No one checks your ID again, so anyone could potentially impersonate a staff member and walk into the cash room.\"}),(0,e.jsxs)(n.p,{children:['In the digital world, if an attacker gets past your firewall (your \"bouncer\"), they can listen to all your internal plaintext traffic. As the Snowden leaks famously revealed with a slide saying \"',(0,e.jsx)(n.strong,{children:\"SSL added and removed here\"}),'\", even giants like Google had their internal traffic tapped.']}),(0,e.jsx)(i,{width:800,src:\"/static/images/general/snowden.jpg\"}),(0,e.jsx)(n.p,{children:\"In today's world of dynamic, cloud-native environments, services are ephemeral. Their IP addresses change constantly. Using network location as a security measure is like trying to identify a friend based on the parking spot they're in. Tomorrow, someone else will be in that spot.\"}),(0,e.jsxs)(n.p,{children:[\"This is the core idea of \",(0,e.jsx)(n.strong,{children:\"Zero Trust: Never trust, always verify\"}),\".\"]}),(0,e.jsxs)(n.h2,{id:\"the-painful-journey-api-keys-and-the-mtls-headache\",children:[(0,e.jsx)(n.a,{href:\"#the-painful-journey-api-keys-and-the-mtls-headache\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Painful Journey: API Keys and the mTLS Headache\"]}),(0,e.jsx)(n.p,{children:\"Okay, so we need to secure our internal traffic. What are our options?\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"API Keys \u0026 Access Tokens\"}),`: This is often the first step. We issue a secret key or a short-lived JWT token to a client. The client flashes this token, and the server says, \"Okay, you're in.\" This is better than nothing, but if the communication channel isn't encrypted, an attacker can just snatch the token off the wire and use it. We've solved one problem but ignored the bigger one: encryption.`]})}),(0,e.jsxs)(n.li,{children:[(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Traditional mTLS\"}),\": The next logical step is mutual TLS. It\\u2019s like a secret handshake where both the client and server show their IDs (certificates) to prove who they are before they start talking. This is great! But doing it manually in a microservices world is a nightmare.\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Certificate Management is a Pain\"}),\": Who creates the certificates? Who signs them? How do you get them onto every single pod? How do you rotate them before they expire? It quickly becomes a full-time job.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Identity is Flimsy\"}),': What do you put in the certificate as the \"name\"? An IP address? A DNS name? As we discussed, these things are meaningless for ephemeral workloads. We once had to disable the default gRPC name validation and write our own custom, brittle code to check the identity. It worked, but it felt like holding things together with duct tape.']})})]})]})]}),(0,e.jsx)(n.p,{children:\"There had to be a better way. And there is.\"}),(0,e.jsxs)(n.h2,{id:\"the-hero-arrives-spiffe-and-spire\",children:[(0,e.jsx)(n.a,{href:\"#the-hero-arrives-spiffe-and-spire\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Hero Arrives: SPIFFE and SPIRE\"]}),(0,e.jsx)(n.p,{children:\"This is where our story gets its heroes.\"}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIFFE (Secure Production Identity Framework For Everyone)\"}),\" is not a tool, but a \",(0,e.jsx)(n.strong,{children:\"standard\"}),\". It\\u2019s a set of rules for how to give a software service a strong, verifiable identity, no matter where it's running.\"]}),(0,e.jsxs)(n.p,{children:[\"The core concept is the \",(0,e.jsx)(n.strong,{children:\"SPIFFE ID\"}),\", a unique name for your service that looks like this: \",(0,e.jsx)(n.code,{children:\"spiffe://your-company.com/your-service\"}),\".\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"your-company.com\"}),' part is the \"trust domain.\" Think of it as the country that issues the passport.']})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.code,{children:\"/your-service\"}),\" part is the unique identity within that country.\"]})})]}),(0,e.jsxs)(n.p,{children:[\"This ID is then embedded into a short-lived cryptographic document called an \",(0,e.jsx)(n.strong,{children:\"SVID (Spiffe Verifiable Identity Document)\"}),\", which is usually just a standard X.509 certificate or JWT.\"]}),(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIRE (SPIFFE Runtime Environment)\"}),\" is the \",(0,e.jsx)(n.strong,{children:\"implementation\"}),\" of the SPIFFE standard. It\\u2019s the machinery that actually does the work. Think of SPIRE as the passport office for your services. It consists of two main parts:\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIRE Server\"}),\": The central authority. It manages which service gets which SPIFFE ID and signs the certificates.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"SPIRE Agent\"}),': A little helper that runs on every node (or machine/pod). Its job is to figure out which services are running on its node and securely deliver the correct \"passport\" (SVID) to them.']})})]}),(0,e.jsxs)(n.p,{children:[\"The magic is in how the Agent verifies a workload's identity, a process called \",(0,e.jsx)(n.strong,{children:\"Workload Attestation\"}),`. In Kubernetes, the Agent can ask the kubelet, \"Hey, tell me about the process that's calling me. What's its service account? What's its namespace?\" Based on these trusted proofs, the Agent gets the correct SVID from the SPIRE Server.`]}),(0,e.jsx)(n.p,{children:\"The result? Every service gets a strong, short-lived, automatically rotated identity without you having to lift a finger.\"}),(0,e.jsxs)(n.h2,{id:\"lets-get-our-hands-dirty-a-live-demo-in-minikube\",children:[(0,e.jsx)(n.a,{href:\"#lets-get-our-hands-dirty-a-live-demo-in-minikube\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Let's Get Our Hands Dirty: A Live Demo in Minikube!\"]}),(0,e.jsx)(n.p,{children:\"Talk is cheap. Let me show you how this actually works. I've put together a simple Go-based gRPC client/server demo that runs on Minikube.\"}),(0,e.jsx)(i,{width:800,src:\"/static/images/general/spiffe_grpc.png\"}),(0,e.jsx)(n.p,{children:(0,e.jsxs)(n.strong,{children:[\"Credit goes to \",(0,e.jsx)(n.a,{href:\"https://youtu.be/qFSHoxs8i2Q?t=1115\",children:\"Mehrdad Afshari\"})]})}),(0,e.jsxs)(n.h3,{id:\"setup-spiresh-the-magic-wand\",children:[(0,e.jsx)(n.a,{href:\"#setup-spiresh-the-magic-wand\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),(0,e.jsx)(n.code,{children:\"setup-spire.sh\"}),\" (The Magic Wand)\"]}),(0,e.jsxs)(n.p,{children:['This script installs SPIRE using Helm and registers the identities for our client and server. We are telling SPIRE: \"Any pod running with the Kubernetes service account ',(0,e.jsx)(n.code,{children:\"my-server-sa\"}),\" should be given the identity \",(0,e.jsx)(n.code,{children:\"spiffe://supasaf.com/server\"}),'.\"']}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token important shebang\",children:\"#!/bin/bash\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"set\"}),` -e\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"KUBECTL\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"minikube kubectl --\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F680} Setting up SPIRE demo environment...\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F464} Creating Service Accounts...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" apply -f - \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\u003c\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`ENDSA\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`apiVersion: v1\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`kind: ServiceAccount\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`metadata:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  name: my-server-sa\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  namespace: default\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`---\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`apiVersion: v1\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`kind: ServiceAccount\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`metadata:\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  name: my-client-sa\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string\",children:`  namespace: default\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:\"ENDSA\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4E6} Installing SPIRE with Helm...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"helm repo \",(0,e.jsx)(n.span,{className:\"token function\",children:\"add\"}),\" spiffe https://spiffe.github.io/helm-charts/ \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\"\u003e\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`helm repo update\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4E6} Installing SPIRE with custom values...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" helm list -n spire-system \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"grep\"}),\" -q spire\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"then\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  SPIRE already installed, upgrading with custom values...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    helm upgrade spire spiffe/spire \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --namespace spire-system \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -f spire-values.yaml \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --wait \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        --timeout 5m\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    helm \",(0,e.jsx)(n.span,{className:\"token function\",children:\"install\"}),\" spire spiffe/spire \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --namespace spire-system \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --create-namespace \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        -f spire-values.yaml \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        --wait \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`        --timeout 5m\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fi\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u23F3 Waiting for SPIRE components to be ready...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"wait\"}),\" --for\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"condition\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"ready pod -l app.kubernetes.io/name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"server -n spire-system --timeout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`300s\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"wait\"}),\" --for\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"condition\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"ready pod -l app.kubernetes.io/name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"agent -n spire-system --timeout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`300s\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"SERVER_POD\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token variable\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$(\"}),\"$KUBECTL get pod -n spire-system -l app.kubernetes.io/name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"server -o \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"jsonpath\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'{.items[0].metadata.name}'\"}),(0,e.jsx)(n.span,{className:\"token variable\",children:\")\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"\\u2705 SPIRE Server pod: ',(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F510} Registering node identity...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    /opt/spire/bin/spire-server entry create \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -spiffeID spiffe://supasaf.com/minikube-node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s_psat:cluster:minikube \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s_psat:agent_ns:spire-system \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s_psat:agent_sa:spire-agent \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\"\u003e\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  Node entry already exists\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F510} Registering server workload identity...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    /opt/spire/bin/spire-server entry create \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -parentID spiffe://supasaf.com/minikube-node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -spiffeID spiffe://supasaf.com/server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:ns:default \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:sa:my-server-sa \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\"\u003e\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  Server entry already exists\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F510} Registering client workload identity...\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    /opt/spire/bin/spire-server entry create \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -parentID spiffe://supasaf.com/minikube-node \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -spiffeID spiffe://supasaf.com/client \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:ns:default \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    -selector k8s:sa:my-client-sa \",(0,e.jsxs)(n.span,{className:\"token operator\",children:[(0,e.jsx)(n.span,{className:\"token important file-descriptor\",children:\"2\"}),\"\u003e\"]}),\"/dev/null \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"||\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u26A0\\uFE0F  Client entry already exists\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4CB} Registered entries:\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token variable\",children:\"$KUBECTL\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"exec\"}),\" -n spire-system \",(0,e.jsx)(n.span,{className:\"token variable\",children:\"$SERVER_POD\"}),\" -c spire-server -- \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\\\\\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    /opt/spire/bin/spire-server entry show\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2705 SPIRE setup complete!\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F4DD} Registered SPIFFE IDs:\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"   Node:   spiffe://supasaf.com/minikube-node\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"   Server: spiffe://supasaf.com/server (SA: my-server-sa)\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"   Client: spiffe://supasaf.com/client (SA: my-client-sa)\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Next steps:\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"1. Build: ./build.sh\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2. Deploy: kubectl apply -f deployment.yaml\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\"echo\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"3. Check logs: kubectl logs -l app=my-server -f\"'}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"We will get the following outputs\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u2705 SPIRE Server pod: spire-server-0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u{1F510} Registering node identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 11223f64-8be3-4d84-9d7e-1827b599c5ae\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/spire/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_ns:spire-system\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_sa:spire-agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:cluster:minikube\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u{1F510} Registering server workload identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 977ab667-1001-476f-bb4d-838bb4fc556b\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-server-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u{1F510} Registering client workload identity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 06a80986-983e-401e-9545-e71dfc2aecde\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-client-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u{1F4CB} Registered entries:\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Found \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),` entries\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 06a80986-983e-401e-9545-e71dfc2aecde\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-client-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 11223f64-8be3-4d84-9d7e-1827b599c5ae\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/spire/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_ns:spire-system\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:agent_sa:spire-agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s_psat:cluster:minikube\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Entry ID         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` 977ab667-1001-476f-bb4d-838bb4fc556b\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"SPIFFE ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Parent ID        \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` spiffe://supasaf.com/minikube-node\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Revision         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"X509-SVID TTL    \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"JWT-SVID TTL     \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:ns:default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Selector         \",(0,e.jsx)(n.span,{className:\"token builtin class-name\",children:\":\"}),` k8s:sa:my-server-sa\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\u2705 SPIRE setup complete\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\u{1F4DD} Registered SPIFFE IDs:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`   Node:   spiffe://supasaf.com/minikube-node\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   Server: spiffe://supasaf.com/server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"SA: my-server-sa\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   Client: spiffe://supasaf.com/client \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"SA: my-client-sa\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"deploymentyaml-the-blueprint\",children:[(0,e.jsx)(n.a,{href:\"#deploymentyaml-the-blueprint\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),(0,e.jsx)(n.code,{children:\"deployment.yaml\"}),\" (The Blueprint)\"]}),(0,e.jsxs)(n.p,{children:[\"This file tells Kubernetes how to run our apps. The most important part is the \",(0,e.jsx)(n.code,{children:\"volumes\"}),\" section. We use the \",(0,e.jsx)(n.code,{children:\"csi.spiffe.io\"}),\" driver to mount the SPIRE Agent's socket directly into our pod. This is how our app talks to the agent.\"]}),(0,e.jsx)(n.pre,{className:\"language-yaml\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-yaml\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ServiceAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ServiceAccount\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Service\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`svc\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"protocol\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` TCP\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"port\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"targetPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"type\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ClusterIP\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"serviceAccountName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Never\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"ports\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containerPort\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8080\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` SPIFFE_ENDPOINT_SOCKET\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" unix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"///spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"api/spire\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`agent.sock\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" /spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"csi\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"driver\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"csi.spiffe.io\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"apiVersion\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` apps/v1\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"kind\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`deployment\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"namespace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` default\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"replicas\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"selector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"matchLabels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"template\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"metadata\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"labels\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"spec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"serviceAccountName\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`sa\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"restartPolicy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Always\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"containers\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"image\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" my\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`latest\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"imagePullPolicy\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` Never\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` SPIFFE_ENDPOINT_SOCKET\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"value\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" unix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\"///spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"api/spire\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`agent.sock\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumeMounts\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"mountPath\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" /spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"volumes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" spiffe\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),\"workload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\"}),`api\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"csi\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"driver\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"csi.spiffe.io\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token atrule key\",children:\"readOnly\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean important\",children:\"true\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"servermaingo-the-wise-guardian\",children:[(0,e.jsx)(n.a,{href:\"#servermaingo-the-wise-guardian\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"server/main.go (The Wise Guardian)\"]}),(0,e.jsxs)(n.p,{children:[\"Look how simple the Go code is! We don't handle any private keys or certificate files. We just ask the \",(0,e.jsx)(n.code,{children:\"workloadapi\"}),\" for a \",(0,e.jsx)(n.code,{children:\"Source\"}),\", and it handles all the magic of talking to the SPIRE Agent behind the scenes. When a request comes in, we can inspect the peer's certificate and pull out its verified SPIFFE ID.\"]}),(0,e.jsx)(n.pre,{className:\"language-go\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-go\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"package\"}),` main\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"log\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"net\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"github.com/spiffe/go-spiffe/v2/spiffetls/tlsconfig\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"github.com/spiffe/go-spiffe/v2/workloadapi\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.golang.org/grpc\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.golang.org/grpc/credentials\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"google.golang.org/grpc/peer\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"spire-demo/proto\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" Server \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`UnimplementedEchoServer\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"s \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"Server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"SayHello\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" in \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"error\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ok \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" peer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"FromContext\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"ok \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: could not get peer from context\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no peer info\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        tlsInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" ok \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" p\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"AuthInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"credentials\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"TLSInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),\"ok \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: peer auth info is not TLS\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no TLS info\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"tlsInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"State\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PeerCertificates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: no peer certificates\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no certificates\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        cert \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" tlsInfo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"State\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"PeerCertificates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cert\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"URIs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"Error: no URIs in certificate\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ERROR: no SPIFFE ID\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        spiffeID \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" cert\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"URIs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"String\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Printf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2705 Received a request from client with SPIFFE ID: %s\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" spiffeID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"Message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Hello \"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" in\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\" from \"'}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" spiffeID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        ctx \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" context\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Background\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F680} Starting server, waiting for SPIRE agent...\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" workloadapi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"NewX509Source\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Fatalf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u274C Unable to create X509Source: %v\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"defer\"}),\" source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Close\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u2705 Successfully connected to SPIRE agent\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        tlsConfig \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" tlsconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"MTLSServerConfig\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" source\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" tlsconfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"AuthorizeAny\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        creds \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" credentials\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"NewTLS\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"tlsConfig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        server \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" grpc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"NewServer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"grpc\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Creds\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"creds\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        proto\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"RegisterEchoServer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"Server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        lis\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" net\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Listen\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"tcp\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\":8080\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Fatalf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u274C Failed to listen: %v\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Println\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u{1F3A7} Server listening on :8080 with mTLS enabled\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":=\"}),\" server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Serve\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"lis\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" err \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                log\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"Fatalf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"\\u274C Failed to serve: %v\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"the-aha-moment-checking-the-logs\",children:[(0,e.jsx)(n.a,{href:\"#the-aha-moment-checking-the-logs\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),'The \"Aha!\" Moment: Checking the Logs']}),(0,e.jsxs)(n.p,{children:[\"After running \",(0,e.jsx)(n.code,{children:\"./setup-spire.sh\"}),\", \",(0,e.jsx)(n.code,{children:\"./build.sh\"}),\", and \",(0,e.jsx)(n.code,{children:\"kubectl apply -f deployment.yaml\"}),\", let's look at the logs.\"]}),(0,e.jsx)(n.p,{children:\"Server Logs:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/spire-demo$ kubectl logs -l \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`my-server -f\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:24 \\u{1F680} Starting server, waiting \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" SPIRE agent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:25 \\u2705 Successfully connected to SPIRE agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:25 \\u{1F3A7} Server listening on :8080 with mTLS enabled\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:25 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:50 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:52:22 \\u2705 Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\n`]})]})}),(0,e.jsx)(n.p,{children:\"Client Logs:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"ss@ss:~/spire-demo$ kubectl logs -l \",(0,e.jsx)(n.span,{className:\"token variable assign-left\",children:\"app\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`my-client -f\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:30 \\u{1F680} Starting client, waiting \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" SPIRE agent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Successfully connected to SPIRE agent\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:31 \\u{1F504} Attempting to connect to server \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"attempt \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"/10\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Connected to server\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:31 \\u{1F4E4} Sending request to server\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),`/10/06 08:51:31 \\u2705 Response from server: Hello SPIFFE from spiffe://supasaf.com/client\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2025\"}),\"/10/06 08:51:31 \\u{1F389} Zero Trust communication successful\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Look at that beautiful server log! \",(0,e.jsx)(n.code,{children:\"Received a request from client with SPIFFE ID: spiffe://supasaf.com/client\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"The server doesn't know the client's IP address, nor does it care. It knows its \",(0,e.jsx)(n.strong,{children:\"true\"}),\", cryptographically verified identity. This is the foundation of Zero Trust security. We've successfully established a secure, authenticated, and encrypted channel between two microservices, and it was almost entirely automatic.\"]}),(0,e.jsxs)(n.h2,{id:\"wrapping-up\",children:[(0,e.jsx)(n.a,{href:\"#wrapping-up\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Wrapping Up\"]}),(0,e.jsx)(n.p,{children:\"Building this demo was a real eye-opener. The concepts from the gRPC Conf talk came to life when I could actually see the SPIFFE IDs in my logs, watch certificates rotate automatically, and know that every connection was authenticated and encrypted.\"}),(0,e.jsx)(n.p,{children:\"In my market, where English documentation can be a barrier and plaintext HTTP is still common, I hope this practical example helps show that zero trust isn't as scary as it sounds. SPIRE handles the complexity - certificate management, rotation, attestation - so we can focus on building secure applications.\"}),(0,e.jsx)(n.p,{children:\"Now if you'll excuse me, I have another meeting about microservice security next week. But this time, I'm bringing a working demo. \\u{1F680}\"})]})}}var v=b;function w(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return I;})();\n;return Component;","toc":[{"value":"\"It's Behind a Firewall\"","url":"#its-behind-a-firewall","depth":2},{"value":"The Painful Journey: API Keys and the mTLS Headache","url":"#the-painful-journey-api-keys-and-the-mtls-headache","depth":2},{"value":"The Hero Arrives: SPIFFE and SPIRE","url":"#the-hero-arrives-spiffe-and-spire","depth":2},{"value":"Let's Get Our Hands Dirty: A Live Demo in Minikube!","url":"#lets-get-our-hands-dirty-a-live-demo-in-minikube","depth":2},{"value":"setup-spire.sh (The Magic Wand)","url":"#setup-spiresh-the-magic-wand","depth":3},{"value":"deployment.yaml (The Blueprint)","url":"#deploymentyaml-the-blueprint","depth":3},{"value":"server/main.go (The Wise Guardian)","url":"#servermaingo-the-wise-guardian","depth":3},{"value":"The \"Aha!\" Moment: Checking the Logs","url":"#the-aha-moment-checking-the-logs","depth":3},{"value":"Wrapping Up","url":"#wrapping-up","depth":2}],"frontMatter":{"readingTime":{"text":"19 min read","minutes":18.065,"time":1083900,"words":3613},"slug":"general/spiffe_go_k8s","fileName":"general/spiffe_go_k8s.md","title":"From Zero to Zero Trust: Securing Microservices with SPIFFE (The Fun Way!)","date":"2025-10-06T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This post uses a hands-on Go demo to show how SPIFFE/SPIRE automates Zero Trust security for gRPC microservices.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security ‚Äì Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"Hacker and Physicist - A Tale of \"Common Sense\"","date":"2025-08-22T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Why fundamental digital principles are as invisible (and essential) as the laws of physics.","images":[],"slug":"general/hacker_physicist"},"next":{"title":"InfoSec Architect 102-Service Accounts in the Linux Universe","date":"2025-10-08T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber.","images":[],"slug":"general/kerberos_ldap"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["general","spiffe_go_k8s"]},"buildId":"oVQKg7I9e_0Oh0pHteJCk","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>