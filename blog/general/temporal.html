<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>An InfoSec Architect&#x27;s First Taste of Temporal</title><meta name="robots" content="follow, index"/><meta name="description" content="This is a therapy session for anyone traumatized by fragile scripts. I traded my `cron/try/catch` nightmares for a robot project manager named Temporal."/><meta property="og:url" content="https://www.supasaf.com/blog/general/temporal"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="This is a therapy session for anyone traumatized by fragile scripts. I traded my `cron/try/catch` nightmares for a robot project manager named Temporal."/><meta property="og:title" content="An InfoSec Architect&#x27;s First Taste of Temporal"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="An InfoSec Architect&#x27;s First Taste of Temporal"/><meta name="twitter:description" content="This is a therapy session for anyone traumatized by fragile scripts. I traded my `cron/try/catch` nightmares for a robot project manager named Temporal."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/general/temporal"/><meta property="article:published_time" content="2025-07-08T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/general/temporal"
  },
  "headline": "An InfoSec Architect's First Taste of Temporal",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2025-07-08T00:00:00.000Z",
  "dateModified": "2025-07-08T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "This is a therapy session for anyone traumatized by fragile scripts. I traded my `cron/try/catch` nightmares for a robot project manager named Temporal."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/57OeLVf1Nd2Rw95vy3ba7/_buildManifest.js" defer=""></script><script src="/_next/static/57OeLVf1Nd2Rw95vy3ba7/_ssgManifest.js" defer=""></script><script src="/_next/static/57OeLVf1Nd2Rw95vy3ba7/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-07-08T00:00:00.000Z">Tuesday, July 8, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">An InfoSec Architect&#x27;s First Taste of Temporal</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>It&#x27;s the spring of 2005. I&#x27;m staring at a computer monitor the size of a small refrigerator, the kind that makes a thunk sound when you turn it on. My mission? Installing Red Hat 9(Not RHEL!) and learning this magical command called <code>cron</code>. It felt like peak technology—telling the computer to do something later, automatically!</p><p>Fast forward a decade or two, and I&#x27;m a professional developer. <code>cron</code> is still around, but now I&#x27;m also writing code to handle the chaos between microservices. This is where I met my white whale, one of the most terrifying bugs of my career. I was working on a backend service for an app with over a billion daily active users (no pressure, right?). In a moment of what I thought was pure genius, I added some retry logic inside a <code>try...catch</code> block. The problem? Another bug in my retry code caused it to... throw another <code>exception</code>.</p><p>The result was an infinite loop of failures, like trying to put out a fire with a gasoline-filled water gun. It was a horrifying lesson: <strong>manually writing robust retry and recovery logic is a dangerous, soul-crushing business</strong>.</p><p>Recently, I was brainstorming how to build a <a target="_blank" rel="noopener noreferrer" href="https://www.supasaf.com/blog/raft-algo">cost-effective secrets management system</a>. I stumbled upon <a target="_blank" rel="noopener noreferrer" href="https://www.uber.com/en-HK/blog/building-ubers-multi-cloud-secrets-management-platform/">a blog post from Uber</a> about their system, and a tool called Cadence was the star of the show. This led me to its successor, Temporal, and I decided to build a small demo to see if it could finally save me from my retry-logic nightmares.</p><p>And oh boy, it can.</p><h2 id="so-what-is-temporal"><a href="#so-what-is-temporal" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>So, What is Temporal?</h2><p>Imagine Temporal is a super-smart, patient, and forget-proof project manager. This manager doesn&#x27;t do the actual work (your code does that), but it orchestrates, supervises, and remembers every single detail of a complex project, ensuring it gets done perfectly, no matter what disasters happen along the way.</p><p>For our scenario, the &quot;complex project&quot; is this: <strong>Safely rotate a database password for a critical service deployed across multiple regions</strong>.</p><p>Let&#x27;s see how our new project manager, Temporal, handles this job.</p><h2 id="example--the-cross-region-key-rotation-workflow"><a href="#example--the-cross-region-key-rotation-workflow" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Example : The &quot;Cross-Region Key Rotation&quot; Workflow</h2><p>Our goal: Rotate the database password for &quot;Payment Service A,&quot; which runs in both Azure East US and Azure West US. The whole process might take 10 minutes, and failure is not an option.</p><h3 id="step-1-kicking-off-the-project-scheduling"><a href="#step-1-kicking-off-the-project-scheduling" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 1: Kicking Off the Project (Scheduling)</h3><p><strong>The Old Way</strong>: You’d set up an external cron job to trigger a script every 90 days. Hope the server running cron doesn&#x27;t go down!</p><p><strong>The Temporal Way</strong>: You define a Workflow and simply tell it, &quot;Run yourself every 90 days.&quot; Temporal has powerful, built-in scheduling. It will reliably kick off the project right on time.</p><h3 id="step-2-generating-the-new-password-executing-a-task"><a href="#step-2-generating-the-new-password-executing-a-task" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 2: Generating the New Password (Executing a Task)</h3><p>The project manager (Temporal) gives the first command: &quot;Go generate a new password.&quot; (This calls a <code>Secret Provider API</code>).</p><p>This task might fail because the network decided to take a coffee break.</p><p>Temporal&#x27;s Superpower (Automatic Retries): You can configure the task and tell Temporal: &quot;If this fails, wait 5 seconds and try again. Do this up to 3 times.&quot; Temporal will diligently follow your orders. You don&#x27;t have to write a single try-catch-retry loop.</p><h3 id="step-3-distributing-the-new-password-state-persistence"><a href="#step-3-distributing-the-new-password-state-persistence" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 3: Distributing the New Password (State Persistence)</h3><p>This is the critical part. Our manager now has the new password and needs to give it to two different teams:</p><ul><li>Write the new password to the East US Key Vault.</li><li>Write the same new password to the West US Key Vault.</li></ul><p>Disaster Strikes! Imagine the server running your code crashes right after it successfully writes to the East US vault!</p><p><strong>The Old Way</strong>: When your program restarts, it has amnesia. It has no idea what it was doing. It might generate a new password (yikes!) or just sit there, confused, leaving your systems in an inconsistent state. You’d need to build a complex state-tracking table in a database just to remember &quot;Step 3a is done, but 3b is not.&quot;</p><p><strong>Temporal&#x27;s Superpower (State Persistence / Flawless Memory)</strong>: After every successful step, Temporal automatically saves a snapshot of the workflow&#x27;s progress. When the server comes back online, a new worker picks up the job and Temporal says, &quot;Ah, I remember! The new password was generated and already sent to East US. My next task is to send it to West US.&quot; This guarantees the workflow runs exactly once without missing a beat or redoing work.</p><h3 id="step-4-waiting-for-confirmation-long-running--timeouts"><a href="#step-4-waiting-for-confirmation-long-running--timeouts" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 4: Waiting for Confirmation (Long-Running &amp; Timeouts)</h3><p>After distributing the password, the project manager needs to tell the deployment platform to restart the apps and then wait for them to report &quot;new password test successful.&quot;</p><p>This waiting period could be 5-10 minutes.</p><p><strong>The Old Way</strong>: A typical web service or script would time out or die trying to &quot;pause&quot; for that long waiting for a callback.</p><p><strong>Temporal&#x27;s Superpower (Long-Running Workflows)</strong>: Temporal workflows are designed to run for a long time. A workflow can happily pause for minutes, hours, or even days waiting for an external signal, all without consuming any compute resources.</p><p><strong>Temporal&#x27;s Superpower (Timeouts)</strong>: You can also tell Temporal, &quot;If you don&#x27;t hear back in 15 minutes, consider the mission a failure.&quot; This prevents the process from getting stuck forever.</p><h3 id="step-5-handling-failure-recovery--compensation"><a href="#step-5-handling-failure-recovery--compensation" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step 5: Handling Failure (Recovery &amp; Compensation)</h3><p>Disaster Strikes Again! The app reports back: &quot;New password test FAILED!&quot;</p><p><strong>The Old Way</strong>: You&#x27;d need to write a tangled mess of if-else and catch blocks to manually roll back the changes. This &quot;compensation&quot; logic (like calling an API to delete the new password version from the Key Vaults) is incredibly error-prone.</p><p><strong>Temporal&#x27;s Superpower (Failure Recovery)</strong>: You can define a &quot;cleanup plan&quot; or a Saga pattern right in your workflow. When Temporal receives the failure signal, it automatically executes your pre-defined rollback steps, like deleting the new secrets from both Key Vaults, restoring everything to its initial state, and sending an alert to the on-call engineer.</p><h2 id="lets-build-it-a-hands-on-temporal-project"><a href="#lets-build-it-a-hands-on-temporal-project" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Let&#x27;s Build It! A Hands-On Temporal Project</h2><h3 id="step-zero-prep-your-dev-environment"><a href="#step-zero-prep-your-dev-environment" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step Zero: Prep Your Dev Environment</h3><p>Please follow the official docs for Temporal and Vault to get them set up. I&#x27;m running my local environment in WSL on Windows.(Ask AI for the setup steps, please:p)</p><p>Once ready, start the Temporal and Vault services.</p><h3 id="step-one-create-the-go-project-and-install-dependencies"><a href="#step-one-create-the-go-project-and-install-dependencies" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step One: Create the Go Project and Install Dependencies</h3><p>Now, let&#x27;s set up our project structure:</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">ss@ss:~$ tree temporal-vault-demo/
</span><span class="code-line">temporal-vault-demo/
</span><span class="code-line">├── go.mod
</span><span class="code-line">├── go.sum
</span><span class="code-line">├── starter
</span><span class="code-line">│   └── main.go
</span><span class="code-line">├── worker
</span><span class="code-line">│   └── main.go
</span><span class="code-line">└── workflow.go
</span></code></pre></div><h2 id="step-two-write-the-workflow-and-activities-the-core-logic"><a href="#step-two-write-the-workflow-and-activities-the-core-logic" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step Two: Write the Workflow and Activities (The Core Logic)</h2><p>In your temporal-vault-demo directory, create a new file named <code>workflow.go</code>. This is where we&#x27;ll define the master plan for our project manager.</p><p>In Temporal, any action that has a side effect (like an API call, database write, or reading from a file) should be in an <strong>Activity</strong>. The <strong>Workflow</strong> is the orchestrator that calls these Activities in the correct order.</p><p><code>workflow.go</code> Code:</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token keyword">package</span> temporal_vault_demo
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">(</span>
</span><span class="code-line">	<span class="token string">&quot;context&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;crypto/rand&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;fmt&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;math/big&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;time&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token string">&quot;github.com/hashicorp/vault/api&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;go.temporal.io/sdk/activity&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;go.temporal.io/sdk/workflow&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// ========================================================================</span>
</span><span class="code-line"><span class="token comment">// 1. Activities - The actual &quot;doers&quot; of work</span>
</span><span class="code-line"><span class="token comment">// ========================================================================</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> Activities <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line">	VaultClient <span class="token operator">*</span>api<span class="token punctuation">.</span>Client
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// GeneratePassword is an activity that creates a random password.</span>
</span><span class="code-line"><span class="token comment">// We should use KMS service in real world</span>
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>Activities<span class="token punctuation">)</span> <span class="token function">GeneratePassword</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	activity<span class="token punctuation">.</span><span class="token function">GetLogger</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Generating a new password...&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	chars <span class="token operator">:=</span> <span class="token string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&amp;*&quot;</span>
</span><span class="code-line">	length <span class="token operator">:=</span> <span class="token number">16</span>
</span><span class="code-line">	password <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span>
</span><span class="code-line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
</span><span class="code-line">		n<span class="token punctuation">,</span> err <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span>Reader<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>chars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">		password <span class="token operator">+=</span> <span class="token function">string</span><span class="token punctuation">(</span>chars<span class="token punctuation">[</span>n<span class="token punctuation">.</span><span class="token function">Int64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">return</span> password<span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// WriteSecretToVault is an activity that writes a secret to a given path in Vault.</span>
</span><span class="code-line"><span class="token comment">// We should use the APIs from Cloud Service Provider to write it to, like Azure Key Vault</span>
</span><span class="code-line"><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>Activities<span class="token punctuation">)</span> <span class="token function">WriteSecretToVault</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> path <span class="token builtin">string</span><span class="token punctuation">,</span> secretValue <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">	logger <span class="token operator">:=</span> activity<span class="token punctuation">.</span><span class="token function">GetLogger</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Writing secret to Vault path.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	secretData <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span> secretValue<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> a<span class="token punctuation">.</span>VaultClient<span class="token punctuation">.</span><span class="token function">KVv2</span><span class="token punctuation">(</span><span class="token string">&quot;secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> path<span class="token punctuation">,</span> secretData<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to write secret to Vault.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">return</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Successfully wrote secret to Vault.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Path&quot;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// ========================================================================</span>
</span><span class="code-line"><span class="token comment">// 2. Workflow - The orchestrator, the project manager</span>
</span><span class="code-line"><span class="token comment">// ========================================================================</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token function">SecretDistributionWorkflow</span><span class="token punctuation">(</span>ctx workflow<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token comment">// Set timeout options for our activities.</span>
</span><span class="code-line">	ao <span class="token operator">:=</span> workflow<span class="token punctuation">.</span>ActivityOptions<span class="token punctuation">{</span>
</span><span class="code-line">		StartToCloseTimeout<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	ctx <span class="token operator">=</span> workflow<span class="token punctuation">.</span><span class="token function">WithActivityOptions</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> ao<span class="token punctuation">)</span>
</span><span class="code-line">	logger <span class="token operator">:=</span> workflow<span class="token punctuation">.</span><span class="token function">GetLogger</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Secret Distribution Workflow started.&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Step 1: Call the activity to generate a new password.</span>
</span><span class="code-line">	<span class="token keyword">var</span> newPassword <span class="token builtin">string</span>
</span><span class="code-line">	err <span class="token operator">:=</span> workflow<span class="token punctuation">.</span><span class="token function">ExecuteActivity</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;GeneratePassword&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>newPassword<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to generate password.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">return</span> err
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Successfully generated a new password.&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Step 2: Distribute the password to both &quot;regions&quot; concurrently.</span>
</span><span class="code-line">	<span class="token comment">// We use an error channel to collect results from our concurrent tasks.</span>
</span><span class="code-line">	errorChan <span class="token operator">:=</span> workflow<span class="token punctuation">.</span><span class="token function">NewChannel</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// A note on concurrency: We must use workflow.Go, not a standard Go routine.</span>
</span><span class="code-line">	<span class="token comment">// This allows Temporal to manage the concurrency in a deterministic way</span>
</span><span class="code-line">	<span class="token comment">// that can be safely replayed if the worker crashes.</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Concurrent Task A: Write to East US</span>
</span><span class="code-line">	workflow<span class="token punctuation">.</span><span class="token function">Go</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx workflow<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		err <span class="token operator">:=</span> workflow<span class="token punctuation">.</span><span class="token function">ExecuteActivity</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;WriteSecretToVault&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;db/east-us&quot;</span><span class="token punctuation">,</span> newPassword<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			errorChan<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to write to east-us: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">			errorChan<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// Send nil for success</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Concurrent Task B: Write to West US</span>
</span><span class="code-line">	workflow<span class="token punctuation">.</span><span class="token function">Go</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx workflow<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">		err <span class="token operator">:=</span> workflow<span class="token punctuation">.</span><span class="token function">ExecuteActivity</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;WriteSecretToVault&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;db/west-us&quot;</span><span class="token punctuation">,</span> newPassword<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			errorChan<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;failed to write to west-us: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">			errorChan<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// Send nil for success</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Wait for both concurrent tasks to finish.</span>
</span><span class="code-line">	<span class="token keyword">var</span> errs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">error</span>
</span><span class="code-line">	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
</span><span class="code-line">		<span class="token keyword">var</span> errResult <span class="token builtin">error</span>
</span><span class="code-line">		errorChan<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>errResult<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> errResult <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">			errs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>errs<span class="token punctuation">,</span> errResult<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>errs<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
</span><span class="code-line">		logger<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;One or more distribution tasks failed.&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Errors&quot;</span><span class="token punctuation">,</span> errs<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token comment">// This is where you would add compensation logic,</span>
</span><span class="code-line">		<span class="token comment">// like an activity to delete the secrets that were already written.</span>
</span><span class="code-line">		<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;workflow failed with errors: %v&quot;</span><span class="token punctuation">,</span> errs<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	logger<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;Workflow completed successfully! Secret distributed to all regions.&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="step-three-create-and-run-the-worker"><a href="#step-three-create-and-run-the-worker" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step Three: Create and Run the Worker</h3><p>The Worker is a background process that connects to the Temporal server. It listens for tasks and executes the workflow and activity code we just wrote.</p><p>Create a new folder <code>worker</code> and place a <code>main.go</code> file inside it.</p><p><code>worker/main.go</code> Code:</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token keyword">package</span> main
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">(</span>
</span><span class="code-line">	<span class="token string">&quot;log&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token string">&quot;github.com/hashicorp/vault/api&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;go.temporal.io/sdk/client&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;go.temporal.io/sdk/worker&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Import the workflow and activities from our root package</span>
</span><span class="code-line">	temporalvault <span class="token string">&quot;temporal-vault-demo&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	<span class="token comment">// 1. Create the Temporal client.</span>
</span><span class="code-line">	c<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>Options<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to create Temporal client&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// 2. Create the Vault client.</span>
</span><span class="code-line">	<span class="token comment">// It&#x27;s configured to automatically pick up the VAULT_ADDR and VAULT_TOKEN</span>
</span><span class="code-line">	<span class="token comment">// environment variables, which is super handy for local dev.</span>
</span><span class="code-line">	vaultClient<span class="token punctuation">,</span> err <span class="token operator">:=</span> api<span class="token punctuation">.</span><span class="token function">NewClient</span><span class="token punctuation">(</span>api<span class="token punctuation">.</span><span class="token function">DefaultConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to create Vault client&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// 3. Create a new Worker.</span>
</span><span class="code-line">	<span class="token comment">// &quot;secret-distribution-task-queue&quot; is the name of the list our Starter</span>
</span><span class="code-line">	<span class="token comment">// will place jobs on.</span>
</span><span class="code-line">	w <span class="token operator">:=</span> worker<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">&quot;secret-distribution-task-queue&quot;</span><span class="token punctuation">,</span> worker<span class="token punctuation">.</span>Options<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// 4. Register our Workflow and Activities with the Worker.</span>
</span><span class="code-line">	activities <span class="token operator">:=</span> <span class="token operator">&amp;</span>temporalvault<span class="token punctuation">.</span>Activities<span class="token punctuation">{</span>VaultClient<span class="token punctuation">:</span> vaultClient<span class="token punctuation">}</span>
</span><span class="code-line">	w<span class="token punctuation">.</span><span class="token function">RegisterWorkflow</span><span class="token punctuation">(</span>temporalvault<span class="token punctuation">.</span>SecretDistributionWorkflow<span class="token punctuation">)</span>
</span><span class="code-line">	w<span class="token punctuation">.</span><span class="token function">RegisterActivity</span><span class="token punctuation">(</span>activities<span class="token punctuation">.</span>GeneratePassword<span class="token punctuation">)</span>
</span><span class="code-line">	w<span class="token punctuation">.</span><span class="token function">RegisterActivity</span><span class="token punctuation">(</span>activities<span class="token punctuation">.</span>WriteSecretToVault<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// 5. Start the Worker! It will now poll for tasks.</span>
</span><span class="code-line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Starting Worker...&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	err <span class="token operator">=</span> w<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>worker<span class="token punctuation">.</span><span class="token function">InterruptCh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to start Worker&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>A friendly reminder: the <code>import &quot;temporal-vault-demo&quot;</code> line should match the module name from your <code>go mod init</code> command.</p><h3 id="step-four-create-and-run-the-starter"><a href="#step-four-create-and-run-the-starter" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step Four: Create and Run the Starter</h3><p>The Starter is a simple, one-off program whose only job is to tell Temporal, &quot;Hey, please kick off a new <code>SecretDistributionWorkflow</code> for me.&quot;</p><p>Create another new folder <code>starter</code>, and add a <code>main.go</code> file to it.</p><p><code>starter/main.go</code> Code:</p><div class="relative"><pre><code class="code-highlight language-go"><span class="code-line"><span class="token keyword">package</span> main
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">(</span>
</span><span class="code-line">	<span class="token string">&quot;context&quot;</span>
</span><span class="code-line">	<span class="token string">&quot;log&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token string">&quot;go.temporal.io/sdk/client&quot;</span>
</span><span class="code-line">
</span><span class="code-line">	temporalvault <span class="token string">&quot;temporal-vault-demo&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">	c<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>Options<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to create Temporal client&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">	<span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Define the options for our workflow.</span>
</span><span class="code-line">	<span class="token comment">// WorkflowID is a unique business-level ID for this specific run.</span>
</span><span class="code-line">	<span class="token comment">// TaskQueue must match the name the Worker is listening on.</span>
</span><span class="code-line">	workflowOptions <span class="token operator">:=</span> client<span class="token punctuation">.</span>StartWorkflowOptions<span class="token punctuation">{</span>
</span><span class="code-line">		ID<span class="token punctuation">:</span>        <span class="token string">&quot;secret-distribution-workflow-1&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">		TaskQueue<span class="token punctuation">:</span> <span class="token string">&quot;secret-distribution-task-queue&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Start the workflow! This is an asynchronous operation.</span>
</span><span class="code-line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Starting Secret Distribution Workflow...&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	we<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ExecuteWorkflow</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> workflowOptions<span class="token punctuation">,</span> temporalvault<span class="token punctuation">.</span>SecretDistributionWorkflow<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to execute workflow&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Started workflow - WorkflowID: %s, RunID: %s&quot;</span><span class="token punctuation">,</span> we<span class="token punctuation">.</span><span class="token function">GetID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> we<span class="token punctuation">.</span><span class="token function">GetRunID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	<span class="token comment">// Now, we&#x27;ll wait for the workflow to complete.</span>
</span><span class="code-line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Waiting for workflow to complete...&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">	err <span class="token operator">=</span> we<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line">		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;Workflow failed&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Workflow completed successfully!&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><h3 id="step-five-run-and-verify"><a href="#step-five-run-and-verify" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Step Five: Run and Verify!</h3><p>You&#x27;ll need two separate terminal windows (in addition to the ones running Temporal and Vault).</p><p><strong>Terminal 1 - Run the Worker</strong>:</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">ss@ss:~/temporal-vault-demo$ go run worker/main.go
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:33 INFO  No logger configured <span class="token keyword">for</span> temporal client. Created default one.
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:33 Starting Worker<span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:33 INFO  Started Worker Namespace default TaskQueue secret-distribution-task-queue WorkerID <span class="token number">160626</span>@ss@
</span><span class="code-line"><span class="token punctuation">..</span>.
</span></code></pre></div><p><strong>Terminal 2 - Run the Starter (after the Worker is running)</strong>:</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">ss@ss:~/temporal-vault-demo$ go run starter/main.go
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:56 INFO  No logger configured <span class="token keyword">for</span> temporal client. Created default one.
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:56 Starting Secret Distribution Workflow<span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:56 Started workflow - WorkflowID: secret-distribution-workflow-1, RunID: 0197ea2b-0293-719a-9e21-c937d191147b
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:56 Waiting <span class="token keyword">for</span> workflow to complete<span class="token punctuation">..</span>.
</span><span class="code-line"><span class="token number">2025</span>/07/08 <span class="token number">21</span>:12:56 Workflow completed successfully<span class="token operator">!</span>
</span></code></pre></div><p><strong>Observation and Verification</strong>:</p><p>Now for the moment of truth. You can use the vault CLI in your terminal to see if the secrets were actually written.</p><div class="relative"><pre><code class="language-shell code-highlight"><span class="code-line">ss@ss:~/temporal-vault-demo$ vault kv get secret/db/east-us
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Secret Path <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">secret/data/db/east-us
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Metadata <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">Key                Value
</span><span class="code-line">---                -----
</span><span class="code-line">created_time       <span class="token number">2025</span>-07-08T13:12:56.746048772Z
</span><span class="code-line">custom_metadata    <span class="token operator">&lt;</span>nil<span class="token operator">&gt;</span>
</span><span class="code-line">deletion_time      n/a
</span><span class="code-line">destroyed          <span class="token boolean">false</span>
</span><span class="code-line">version            <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> Data <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">Key         Value
</span><span class="code-line">---         -----
</span><span class="code-line">password    GiAd@lEQ0lSaxdSP
</span><span class="code-line">
</span><span class="code-line">ss@ss:~/temporal-vault-demo$ vault kv get secret/db/west-us
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Secret Path <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">secret/data/db/west-us
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Metadata <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">Key                Value
</span><span class="code-line">---                -----
</span><span class="code-line">created_time       <span class="token number">2025</span>-07-08T13:12:56.746342827Z
</span><span class="code-line">custom_metadata    <span class="token operator">&lt;</span>nil<span class="token operator">&gt;</span>
</span><span class="code-line">deletion_time      n/a
</span><span class="code-line">destroyed          <span class="token boolean">false</span>
</span><span class="code-line">version            <span class="token number">1</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> Data <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</span><span class="code-line">Key         Value
</span><span class="code-line">---         -----
</span><span class="code-line">password    GiAd@lEQ0lSaxdSP
</span></code></pre></div><p>Success! The same password in both locations. And if you check out the Temporal Web UI at <a target="_blank" rel="noopener noreferrer" href="http://localhost:8233">http://localhost:8233</a>, you&#x27;ll see a beautiful record of our completed workflow.</p><img width="600" src="/static/images/general/temporal.png "/><p>It lets you focus on your business logic, while the robot project manager handles the messy reality of distributed systems. And trust me, after my <code>try...catch...fail</code> incident, that&#x27;s a promotion we could all use.</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/secrets-management">Secrets-Management</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/raft-algo">Consensus Algorithms Through the Eyes of an Infosec Architect</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/phxsql">A Look Back at WeChat&#x27;s PhxSQL and the &#x27;Fastest Majority&#x27;</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var t=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var o=a=\u003et(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{o(a);for(var c in s)t(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let e of h(s))!u.call(a,e)\u0026\u0026e!==\"default\"\u0026\u0026t(a,e,{get:()=\u003es[e],enumerable:!(c=p(s,e))||c.enumerable});return a},f=a=\u003eg(o(t(a!=null?d(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((x,i)=\u003e{i.exports=_jsx_runtime});var T={};k(T,{default:()=\u003eb,frontmatter:()=\u003ew});var n=f(r()),w={title:\"An InfoSec Architect's First Taste of Temporal\",date:\"2025-07-08\",tags:[\"Secrets Management\"],draft:!1,summary:\"This is a therapy session for anyone traumatized by fragile scripts. I traded my `cron/try/catch` nightmares for a robot project manager named Temporal.\",images:[]};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({p:\"p\",code:\"code\",strong:\"strong\",a:\"a\",h2:\"h2\",span:\"span\",h3:\"h3\",ul:\"ul\",li:\"li\",pre:\"pre\"},a.components),{Image:l}=e;return l||v(\"Image\",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"It's the spring of 2005. I'm staring at a computer monitor the size of a small refrigerator, the kind that makes a thunk sound when you turn it on. My mission? Installing Red Hat 9(Not RHEL!) and learning this magical command called \",(0,n.jsx)(e.code,{children:\"cron\"}),\". It felt like peak technology\\u2014telling the computer to do something later, automatically!\"]}),(0,n.jsxs)(e.p,{children:[\"Fast forward a decade or two, and I'm a professional developer. \",(0,n.jsx)(e.code,{children:\"cron\"}),\" is still around, but now I'm also writing code to handle the chaos between microservices. This is where I met my white whale, one of the most terrifying bugs of my career. I was working on a backend service for an app with over a billion daily active users (no pressure, right?). In a moment of what I thought was pure genius, I added some retry logic inside a \",(0,n.jsx)(e.code,{children:\"try...catch\"}),\" block. The problem? Another bug in my retry code caused it to... throw another \",(0,n.jsx)(e.code,{children:\"exception\"}),\".\"]}),(0,n.jsxs)(e.p,{children:[\"The result was an infinite loop of failures, like trying to put out a fire with a gasoline-filled water gun. It was a horrifying lesson: \",(0,n.jsx)(e.strong,{children:\"manually writing robust retry and recovery logic is a dangerous, soul-crushing business\"}),\".\"]}),(0,n.jsxs)(e.p,{children:[\"Recently, I was brainstorming how to build a \",(0,n.jsx)(e.a,{href:\"https://www.supasaf.com/blog/raft-algo\",children:\"cost-effective secrets management system\"}),\". I stumbled upon \",(0,n.jsx)(e.a,{href:\"https://www.uber.com/en-HK/blog/building-ubers-multi-cloud-secrets-management-platform/\",children:\"a blog post from Uber\"}),\" about their system, and a tool called Cadence was the star of the show. This led me to its successor, Temporal, and I decided to build a small demo to see if it could finally save me from my retry-logic nightmares.\"]}),(0,n.jsx)(e.p,{children:\"And oh boy, it can.\"}),(0,n.jsxs)(e.h2,{id:\"so-what-is-temporal\",children:[(0,n.jsx)(e.a,{href:\"#so-what-is-temporal\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"So, What is Temporal?\"]}),(0,n.jsx)(e.p,{children:\"Imagine Temporal is a super-smart, patient, and forget-proof project manager. This manager doesn't do the actual work (your code does that), but it orchestrates, supervises, and remembers every single detail of a complex project, ensuring it gets done perfectly, no matter what disasters happen along the way.\"}),(0,n.jsxs)(e.p,{children:['For our scenario, the \"complex project\" is this: ',(0,n.jsx)(e.strong,{children:\"Safely rotate a database password for a critical service deployed across multiple regions\"}),\".\"]}),(0,n.jsx)(e.p,{children:\"Let's see how our new project manager, Temporal, handles this job.\"}),(0,n.jsxs)(e.h2,{id:\"example--the-cross-region-key-rotation-workflow\",children:[(0,n.jsx)(e.a,{href:\"#example--the-cross-region-key-rotation-workflow\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),'Example : The \"Cross-Region Key Rotation\" Workflow']}),(0,n.jsx)(e.p,{children:'Our goal: Rotate the database password for \"Payment Service A,\" which runs in both Azure East US and Azure West US. The whole process might take 10 minutes, and failure is not an option.'}),(0,n.jsxs)(e.h3,{id:\"step-1-kicking-off-the-project-scheduling\",children:[(0,n.jsx)(e.a,{href:\"#step-1-kicking-off-the-project-scheduling\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 1: Kicking Off the Project (Scheduling)\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"The Old Way\"}),\": You\\u2019d set up an external cron job to trigger a script every 90 days. Hope the server running cron doesn't go down!\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"The Temporal Way\"}),': You define a Workflow and simply tell it, \"Run yourself every 90 days.\" Temporal has powerful, built-in scheduling. It will reliably kick off the project right on time.']}),(0,n.jsxs)(e.h3,{id:\"step-2-generating-the-new-password-executing-a-task\",children:[(0,n.jsx)(e.a,{href:\"#step-2-generating-the-new-password-executing-a-task\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 2: Generating the New Password (Executing a Task)\"]}),(0,n.jsxs)(e.p,{children:['The project manager (Temporal) gives the first command: \"Go generate a new password.\" (This calls a ',(0,n.jsx)(e.code,{children:\"Secret Provider API\"}),\").\"]}),(0,n.jsx)(e.p,{children:\"This task might fail because the network decided to take a coffee break.\"}),(0,n.jsx)(e.p,{children:`Temporal's Superpower (Automatic Retries): You can configure the task and tell Temporal: \"If this fails, wait 5 seconds and try again. Do this up to 3 times.\" Temporal will diligently follow your orders. You don't have to write a single try-catch-retry loop.`}),(0,n.jsxs)(e.h3,{id:\"step-3-distributing-the-new-password-state-persistence\",children:[(0,n.jsx)(e.a,{href:\"#step-3-distributing-the-new-password-state-persistence\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 3: Distributing the New Password (State Persistence)\"]}),(0,n.jsx)(e.p,{children:\"This is the critical part. Our manager now has the new password and needs to give it to two different teams:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Write the new password to the East US Key Vault.\"}),(0,n.jsx)(e.li,{children:\"Write the same new password to the West US Key Vault.\"})]}),(0,n.jsx)(e.p,{children:\"Disaster Strikes! Imagine the server running your code crashes right after it successfully writes to the East US vault!\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"The Old Way\"}),': When your program restarts, it has amnesia. It has no idea what it was doing. It might generate a new password (yikes!) or just sit there, confused, leaving your systems in an inconsistent state. You\\u2019d need to build a complex state-tracking table in a database just to remember \"Step 3a is done, but 3b is not.\"']}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Temporal's Superpower (State Persistence / Flawless Memory)\"}),`: After every successful step, Temporal automatically saves a snapshot of the workflow's progress. When the server comes back online, a new worker picks up the job and Temporal says, \"Ah, I remember! The new password was generated and already sent to East US. My next task is to send it to West US.\" This guarantees the workflow runs exactly once without missing a beat or redoing work.`]}),(0,n.jsxs)(e.h3,{id:\"step-4-waiting-for-confirmation-long-running--timeouts\",children:[(0,n.jsx)(e.a,{href:\"#step-4-waiting-for-confirmation-long-running--timeouts\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 4: Waiting for Confirmation (Long-Running \u0026 Timeouts)\"]}),(0,n.jsx)(e.p,{children:'After distributing the password, the project manager needs to tell the deployment platform to restart the apps and then wait for them to report \"new password test successful.\"'}),(0,n.jsx)(e.p,{children:\"This waiting period could be 5-10 minutes.\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"The Old Way\"}),': A typical web service or script would time out or die trying to \"pause\" for that long waiting for a callback.']}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Temporal's Superpower (Long-Running Workflows)\"}),\": Temporal workflows are designed to run for a long time. A workflow can happily pause for minutes, hours, or even days waiting for an external signal, all without consuming any compute resources.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Temporal's Superpower (Timeouts)\"}),`: You can also tell Temporal, \"If you don't hear back in 15 minutes, consider the mission a failure.\" This prevents the process from getting stuck forever.`]}),(0,n.jsxs)(e.h3,{id:\"step-5-handling-failure-recovery--compensation\",children:[(0,n.jsx)(e.a,{href:\"#step-5-handling-failure-recovery--compensation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step 5: Handling Failure (Recovery \u0026 Compensation)\"]}),(0,n.jsx)(e.p,{children:'Disaster Strikes Again! The app reports back: \"New password test FAILED!\"'}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"The Old Way\"}),`: You'd need to write a tangled mess of if-else and catch blocks to manually roll back the changes. This \"compensation\" logic (like calling an API to delete the new password version from the Key Vaults) is incredibly error-prone.`]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Temporal's Superpower (Failure Recovery)\"}),': You can define a \"cleanup plan\" or a Saga pattern right in your workflow. When Temporal receives the failure signal, it automatically executes your pre-defined rollback steps, like deleting the new secrets from both Key Vaults, restoring everything to its initial state, and sending an alert to the on-call engineer.']}),(0,n.jsxs)(e.h2,{id:\"lets-build-it-a-hands-on-temporal-project\",children:[(0,n.jsx)(e.a,{href:\"#lets-build-it-a-hands-on-temporal-project\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Let's Build It! A Hands-On Temporal Project\"]}),(0,n.jsxs)(e.h3,{id:\"step-zero-prep-your-dev-environment\",children:[(0,n.jsx)(e.a,{href:\"#step-zero-prep-your-dev-environment\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step Zero: Prep Your Dev Environment\"]}),(0,n.jsx)(e.p,{children:\"Please follow the official docs for Temporal and Vault to get them set up. I'm running my local environment in WSL on Windows.(Ask AI for the setup steps, please:p)\"}),(0,n.jsx)(e.p,{children:\"Once ready, start the Temporal and Vault services.\"}),(0,n.jsxs)(e.h3,{id:\"step-one-create-the-go-project-and-install-dependencies\",children:[(0,n.jsx)(e.a,{href:\"#step-one-create-the-go-project-and-install-dependencies\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step One: Create the Go Project and Install Dependencies\"]}),(0,n.jsx)(e.p,{children:\"Now, let's set up our project structure:\"}),(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`ss@ss:~$ tree temporal-vault-demo/\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`temporal-vault-demo/\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 go.mod\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 go.sum\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 starter\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502\\xA0 \\xA0\\u2514\\u2500\\u2500 main.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 worker\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502\\xA0 \\xA0\\u2514\\u2500\\u2500 main.go\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2514\\u2500\\u2500 workflow.go\n`})]})}),(0,n.jsxs)(e.h2,{id:\"step-two-write-the-workflow-and-activities-the-core-logic\",children:[(0,n.jsx)(e.a,{href:\"#step-two-write-the-workflow-and-activities-the-core-logic\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step Two: Write the Workflow and Activities (The Core Logic)\"]}),(0,n.jsxs)(e.p,{children:[\"In your temporal-vault-demo directory, create a new file named \",(0,n.jsx)(e.code,{children:\"workflow.go\"}),\". This is where we'll define the master plan for our project manager.\"]}),(0,n.jsxs)(e.p,{children:[\"In Temporal, any action that has a side effect (like an API call, database write, or reading from a file) should be in an \",(0,n.jsx)(e.strong,{children:\"Activity\"}),\". The \",(0,n.jsx)(e.strong,{children:\"Workflow\"}),\" is the orchestrator that calls these Activities in the correct order.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"workflow.go\"}),\" Code:\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),` temporal_vault_demo\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"crypto/rand\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"fmt\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"math/big\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"time\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github.com/hashicorp/vault/api\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"go.temporal.io/sdk/activity\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"go.temporal.io/sdk/workflow\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ========================================================================\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'// 1. Activities - The actual \"doers\" of work'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ========================================================================\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" Activities \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"struct\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tVaultClient \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`Client\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// GeneratePassword is an activity that creates a random password.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// We should use KMS service in real world\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"a \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"Activities\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"GeneratePassword\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tactivity\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetLogger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Generating a new password...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tchars \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^\u0026*\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlength \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tpassword \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" length\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"++\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tn\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" rand\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"rand\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Reader\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" big\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewInt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"int64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"chars\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tpassword \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"chars\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"n\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Int64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" password\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// WriteSecretToVault is an activity that writes a secret to a given path in Vault.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// We should use the APIs from Cloud Service Provider to write it to, like Azure Key Vault\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"a \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\"Activities\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"WriteSecretToVault\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" path \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" secretValue \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogger \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" activity\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetLogger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Writing secret to Vault path.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tsecretData \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"interface\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"password\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" secretValue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"_\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" a\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"VaultClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"KVv2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"secret\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Put\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" secretData\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Failed to write secret to Vault.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Error\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Successfully wrote secret to Vault.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Path\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" path\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ========================================================================\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 2. Workflow - The orchestrator, the project manager\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ========================================================================\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"SecretDistributionWorkflow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Set timeout options for our activities.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tao \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"ActivityOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tStartToCloseTimeout\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"*\"}),\" time\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Second\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tctx \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"WithActivityOptions\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ao\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogger \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetLogger\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Secret Distribution Workflow started.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Step 1: Call the activity to generate a new password.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" newPassword \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ExecuteActivity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"GeneratePassword\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"newPassword\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Failed to generate password.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Error\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),` err\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Successfully generated a new password.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:'// Step 2: Distribute the password to both \"regions\" concurrently.'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// We use an error channel to collect results from our concurrent tasks.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\terrorChan \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewChannel\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// A note on concurrency: We must use workflow.Go, not a standard Go routine.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// This allows Temporal to manage the concurrency in a deterministic way\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// that can be safely replayed if the worker crashes.\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Concurrent Task A: Write to East US\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tworkflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Go\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ExecuteActivity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"WriteSecretToVault\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"db/east-us\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" newPassword\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\terrorChan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Send\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"failed to write to east-us: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\terrorChan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Send\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Send nil for success\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Concurrent Task B: Write to West US\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tworkflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Go\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ExecuteActivity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"WriteSecretToVault\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"db/west-us\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" newPassword\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\terrorChan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Send\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"failed to write to west-us: %w\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\terrorChan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Send\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Send nil for success\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Wait for both concurrent tasks to finish.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" errs \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"2\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),\" i\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"++\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"var\"}),\" errResult \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"error\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\terrorChan\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Receive\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"ctx\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"errResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" errResult \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\terrs \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"append\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"errs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" errResult\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"len\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"errs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Error\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"One or more distribution tasks failed.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Errors\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" errs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// This is where you would add compensation logic,\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// like an activity to delete the secrets that were already written.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" fmt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Errorf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"workflow failed with errors: %v\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" errs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlogger\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Info\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Workflow completed successfully! Secret distributed to all regions.\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"step-three-create-and-run-the-worker\",children:[(0,n.jsx)(e.a,{href:\"#step-three-create-and-run-the-worker\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step Three: Create and Run the Worker\"]}),(0,n.jsx)(e.p,{children:\"The Worker is a background process that connects to the Temporal server. It listens for tasks and executes the workflow and activity code we just wrote.\"}),(0,n.jsxs)(e.p,{children:[\"Create a new folder \",(0,n.jsx)(e.code,{children:\"worker\"}),\" and place a \",(0,n.jsx)(e.code,{children:\"main.go\"}),\" file inside it.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"worker/main.go\"}),\" Code:\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),` main\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"log\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"github.com/hashicorp/vault/api\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"go.temporal.io/sdk/client\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"go.temporal.io/sdk/worker\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Import the workflow and activities from our root package\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\ttemporalvault \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"temporal-vault-demo\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 1. Create the Temporal client.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Dial\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Fatalln\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Unable to create Temporal client\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"defer\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Close\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 2. Create the Vault client.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// It's configured to automatically pick up the VAULT_ADDR and VAULT_TOKEN\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// environment variables, which is super handy for local dev.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tvaultClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"NewClient\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"api\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"DefaultConfig\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Fatalln\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Unable to create Vault client\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 3. Create a new Worker.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:'// \"secret-distribution-task-queue\" is the name of the list our Starter'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// will place jobs on.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tw \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" worker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"New\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"secret-distribution-task-queue\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" worker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 4. Register our Workflow and Activities with the Worker.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tactivities \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"temporalvault\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Activities\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"VaultClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" vaultClient\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tw\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"RegisterWorkflow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"temporalvault\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SecretDistributionWorkflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tw\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"RegisterActivity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"activities\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"GeneratePassword\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tw\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"RegisterActivity\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"activities\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"WriteSecretToVault\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// 5. Start the Worker! It will now poll for tasks.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Starting Worker...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" w\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"worker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"InterruptCh\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Fatalln\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Unable to start Worker\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[\"A friendly reminder: the \",(0,n.jsx)(e.code,{children:'import \"temporal-vault-demo\"'}),\" line should match the module name from your \",(0,n.jsx)(e.code,{children:\"go mod init\"}),\" command.\"]}),(0,n.jsxs)(e.h3,{id:\"step-four-create-and-run-the-starter\",children:[(0,n.jsx)(e.a,{href:\"#step-four-create-and-run-the-starter\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step Four: Create and Run the Starter\"]}),(0,n.jsxs)(e.p,{children:['The Starter is a simple, one-off program whose only job is to tell Temporal, \"Hey, please kick off a new ',(0,n.jsx)(e.code,{children:\"SecretDistributionWorkflow\"}),' for me.\"']}),(0,n.jsxs)(e.p,{children:[\"Create another new folder \",(0,n.jsx)(e.code,{children:\"starter\"}),\", and add a \",(0,n.jsx)(e.code,{children:\"main.go\"}),\" file to it.\"]}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"starter/main.go\"}),\" Code:\"]}),(0,n.jsx)(e.pre,{className:\"language-go\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-go\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"package\"}),` main\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"context\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"log\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"go.temporal.io/sdk/client\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\ttemporalvault \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"temporal-vault-demo\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"func\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"main\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tc\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Dial\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"Options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Fatalln\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Unable to create Temporal client\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"defer\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Close\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Define the options for our workflow.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// WorkflowID is a unique business-level ID for this specific run.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// TaskQueue must match the name the Worker is listening on.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tworkflowOptions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" client\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"StartWorkflowOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tID\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"secret-distribution-workflow-1\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tTaskQueue\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"secret-distribution-task-queue\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Start the workflow! This is an asynchronous operation.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Starting Secret Distribution Workflow...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\twe\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\":=\"}),\" c\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"ExecuteWorkflow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Background\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" workflowOptions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" temporalvault\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"SecretDistributionWorkflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Fatalln\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Unable to execute workflow\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Printf\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Started workflow - WorkflowID: %s, RunID: %s\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" we\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" we\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"GetRunID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Now, we'll wait for the workflow to complete.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Waiting for workflow to complete...\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\terr \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" we\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Get\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"context\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Background\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" err \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!=\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"nil\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Fatalln\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Workflow failed\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" err\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\t\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"\tlog\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"Println\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"Workflow completed successfully!\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,n.jsxs)(e.h3,{id:\"step-five-run-and-verify\",children:[(0,n.jsx)(e.a,{href:\"#step-five-run-and-verify\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Step Five: Run and Verify!\"]}),(0,n.jsx)(e.p,{children:\"You'll need two separate terminal windows (in addition to the ones running Temporal and Vault).\"}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Terminal 1 - Run the Worker\"}),\":\"]}),(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`ss@ss:~/temporal-vault-demo$ go run worker/main.go\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),\":12:33 INFO\\xA0 No logger configured \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),` temporal client. Created default one.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),\":12:33 Starting Worker\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),\":12:33 INFO\\xA0 Started Worker Namespace default TaskQueue secret-distribution-task-queue WorkerID \",(0,n.jsx)(e.span,{className:\"token number\",children:\"160626\"}),`@ss@\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Terminal 2 - Run the Starter (after the Worker is running)\"}),\":\"]}),(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`ss@ss:~/temporal-vault-demo$ go run starter/main.go\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),\":12:56 INFO\\xA0 No logger configured \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),` temporal client. Created default one.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),\":12:56 Starting Secret Distribution Workflow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),`:12:56 Started workflow - WorkflowID: secret-distribution-workflow-1, RunID: 0197ea2b-0293-719a-9e21-c937d191147b\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),\":12:56 Waiting \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" workflow to complete\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),\"/07/08 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"21\"}),\":12:56 Workflow completed successfully\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"!\"}),`\n`]})]})}),(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"Observation and Verification\"}),\":\"]}),(0,n.jsx)(e.p,{children:\"Now for the moment of truth. You can use the vault CLI in your terminal to see if the secrets were actually written.\"}),(0,n.jsx)(e.pre,{className:\"language-shell\",children:(0,n.jsxs)(e.code,{className:\"language-shell code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`ss@ss:~/temporal-vault-demo$ vault kv get secret/db/east-us\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Secret Path \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`secret/data/db/east-us\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Metadata \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Key\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 Value\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`---\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 -----\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"created_time\\xA0 \\xA0 \\xA0 \\xA0\",(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),`-07-08T13:12:56.746048772Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"custom_metadata\\xA0 \\xA0 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"nil\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`deletion_time\\xA0 \\xA0 \\xA0 n/a\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"destroyed\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"version\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" Data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Key\\xA0 \\xA0 \\xA0 \\xA0 \\xA0Value\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`---\\xA0 \\xA0 \\xA0 \\xA0 \\xA0-----\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`password\\xA0 \\xA0 GiAd@lEQ0lSaxdSP\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`ss@ss:~/temporal-vault-demo$ vault kv get secret/db/west-us\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Secret Path \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`secret/data/db/west-us\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Metadata \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Key\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 Value\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`---\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 -----\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"created_time\\xA0 \\xA0 \\xA0 \\xA0\",(0,n.jsx)(e.span,{className:\"token number\",children:\"2025\"}),`-07-08T13:12:56.746342827Z\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"custom_metadata\\xA0 \\xA0 \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"nil\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`deletion_time\\xA0 \\xA0 \\xA0 n/a\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"destroyed\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"false\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"version\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),\" Data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"==\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`Key\\xA0 \\xA0 \\xA0 \\xA0 \\xA0Value\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`---\\xA0 \\xA0 \\xA0 \\xA0 \\xA0-----\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`password\\xA0 \\xA0 GiAd@lEQ0lSaxdSP\n`})]})}),(0,n.jsxs)(e.p,{children:[\"Success! The same password in both locations. And if you check out the Temporal Web UI at \",(0,n.jsx)(e.a,{href:\"http://localhost:8233\",children:\"http://localhost:8233\"}),\", you'll see a beautiful record of our completed workflow.\"]}),(0,n.jsx)(l,{width:600,src:\"/static/images/general/temporal.png \"}),(0,n.jsxs)(e.p,{children:[\"It lets you focus on your business logic, while the robot project manager handles the messy reality of distributed systems. And trust me, after my \",(0,n.jsx)(e.code,{children:\"try...catch...fail\"}),\" incident, that's a promotion we could all use.\"]})]})}}var b=y;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return T;})();\n;return Component;","toc":[{"value":"So, What is Temporal?","url":"#so-what-is-temporal","depth":2},{"value":"Example : The \"Cross-Region Key Rotation\" Workflow","url":"#example--the-cross-region-key-rotation-workflow","depth":2},{"value":"Step 1: Kicking Off the Project (Scheduling)","url":"#step-1-kicking-off-the-project-scheduling","depth":3},{"value":"Step 2: Generating the New Password (Executing a Task)","url":"#step-2-generating-the-new-password-executing-a-task","depth":3},{"value":"Step 3: Distributing the New Password (State Persistence)","url":"#step-3-distributing-the-new-password-state-persistence","depth":3},{"value":"Step 4: Waiting for Confirmation (Long-Running \u0026 Timeouts)","url":"#step-4-waiting-for-confirmation-long-running--timeouts","depth":3},{"value":"Step 5: Handling Failure (Recovery \u0026 Compensation)","url":"#step-5-handling-failure-recovery--compensation","depth":3},{"value":"Let's Build It! A Hands-On Temporal Project","url":"#lets-build-it-a-hands-on-temporal-project","depth":2},{"value":"Step Zero: Prep Your Dev Environment","url":"#step-zero-prep-your-dev-environment","depth":3},{"value":"Step One: Create the Go Project and Install Dependencies","url":"#step-one-create-the-go-project-and-install-dependencies","depth":3},{"value":"Step Two: Write the Workflow and Activities (The Core Logic)","url":"#step-two-write-the-workflow-and-activities-the-core-logic","depth":2},{"value":"Step Three: Create and Run the Worker","url":"#step-three-create-and-run-the-worker","depth":3},{"value":"Step Four: Create and Run the Starter","url":"#step-four-create-and-run-the-starter","depth":3},{"value":"Step Five: Run and Verify!","url":"#step-five-run-and-verify","depth":3}],"frontMatter":{"readingTime":{"text":"18 min read","minutes":17.015,"time":1020900,"words":3403},"slug":"general/temporal","fileName":"general/temporal.md","title":"An InfoSec Architect's First Taste of Temporal","date":"2025-07-08T00:00:00.000Z","tags":["Secrets Management"],"draft":false,"summary":"This is a therapy session for anyone traumatized by fragile scripts. I traded my `cron/try/catch` nightmares for a robot project manager named Temporal.","images":[]}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"Consensus Algorithms Through the Eyes of an Infosec Architect","date":"2025-07-04T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"a.k.a. I wrote a Raft cluster in Go and accidentally learned a lot","images":[],"slug":"raft-algo"},"next":{"title":"A Look Back at WeChat's PhxSQL and the 'Fastest Majority'","date":"2025-07-18T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This post explores how WeChat's PhxSQL uses the \"Fastest Majority\" principle to offer a timeless lesson in designing fast and resilient distributed database systems.","images":[],"slug":"general/phxsql"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["general","temporal"]},"buildId":"57OeLVf1Nd2Rw95vy3ba7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>