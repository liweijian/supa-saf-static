<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>An IAM Split-Privilege Model with Terraform for Robust Cybersecurity</title><meta name="robots" content="follow, index"/><meta name="description" content="A practical (and funny) guide to implementing a split-privilege model in AWS. We&#x27;ll separate the power to create permissions from the power to assign them, making your cloud a whole lot safer."/><meta property="og:url" content="https://www.supasaf.com/blog/terraform/terraform_sec_2_iam1"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="A practical (and funny) guide to implementing a split-privilege model in AWS. We&#x27;ll separate the power to create permissions from the power to assign them, making your cloud a whole lot safer."/><meta property="og:title" content="An IAM Split-Privilege Model with Terraform for Robust Cybersecurity"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="An IAM Split-Privilege Model with Terraform for Robust Cybersecurity"/><meta name="twitter:description" content="A practical (and funny) guide to implementing a split-privilege model in AWS. We&#x27;ll separate the power to create permissions from the power to assign them, making your cloud a whole lot safer."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/terraform/terraform_sec_2_iam1"/><meta property="article:published_time" content="2023-05-14T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/terraform/terraform_sec_2_iam1"
  },
  "headline": "An IAM Split-Privilege Model with Terraform for Robust Cybersecurity",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-05-14T00:00:00.000Z",
  "dateModified": "2023-05-14T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "A practical (and funny) guide to implementing a split-privilege model in AWS. We'll separate the power to create permissions from the power to assign them, making your cloud a whole lot safer."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/FHK-ySMycB0TLv9rRH6je/_buildManifest.js" defer=""></script><script src="/_next/static/FHK-ySMycB0TLv9rRH6je/_ssgManifest.js" defer=""></script><script src="/_next/static/FHK-ySMycB0TLv9rRH6je/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-05-14T00:00:00.000Z">Sunday, May 14, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">An IAM Split-Privilege Model with Terraform for Robust Cybersecurity</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>In our <a target="_blank" rel="noopener noreferrer" href="https://www.supasaf.com/blog/terraform/terraform_sec_1_iam0">last chat</a>, we talked about managing the keys to your cloud castle. But what about the person who makes the keys? In a typical setup, it&#x27;s easy to accidentally create a user with &quot;God Mode&quot; privileges—someone who can not only open any door but can also forge new keys for themselves to open doors that don&#x27;t even exist yet. This is an attacker&#x27;s dream and a security admin&#x27;s nightmare.</p><p>If a single person can create a new, all-powerful permission policy and then attach that policy to their own account, it&#x27;s game over. They can go from a lowly castle guard to the king of the world in about five minutes. This is a massive security vulnerability just waiting to happen.</p><p>Thankfully, some very clever people have thought about this problem. In his excellent book, &quot;AWS Security,&quot; Dylan Shields lays out a brilliant solution: The Split-Privilege Model. The idea is simple but powerful, like the rule for launching a nuclear missile: it should take two people with two different keys.</p><h2 id="the-two-key-solution-the-master-and-the-manager"><a href="#the-two-key-solution-the-master-and-the-manager" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Two-Key Solution: The Master and The Manager</h2><p>The model splits the &quot;God Mode&quot; power into two separate roles. Neither role on its own is all-powerful.</p><ol><li><p><strong>The Master (The Key Maker)</strong>: This role is like your master blacksmith. They can forge new keys (create IAM policies), build new keychains (create roles), and issue new ID cards (create users). But here&#x27;s the catch: they can&#x27;t give the keys to anyone. They just make them and put them on the wall.</p></li><li><p><strong>The Manager (The Key Giver)</strong>: This role is the castle chamberlain. They can&#x27;t make new keys. But they can take the keys the Master has already made and assign them to the right people (attach policies to users and roles, add users to groups).</p></li></ol><p>See the genius here? To take over the castle, an attacker would need to steal the keys from both the blacksmith and the chamberlain. You&#x27;ve just doubled the difficulty of a privilege escalation attack.</p><h2 id="lets-build-it-with-terraform"><a href="#lets-build-it-with-terraform" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Let&#x27;s Build It with Terraform</h2><p>Talk is cheap, so let&#x27;s get to the code. Using Terraform, we can build these two separate, limited roles. This is the blueprint for our &quot;two-key&quot; system. Notice the <code>Allow</code> and <code>Deny</code> statements—they are explicitly designed to stop one role from doing the other&#x27;s job.</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_user&quot;</span></span> <span class="token string">&quot;supasaf_master&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;supasaf_master&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_role&quot;</span></span> <span class="token string">&quot;master_role&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;master_role&quot;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">assume_role_policy</span> <span class="token punctuation">=</span> jsonencode(<span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Version</span> <span class="token punctuation">=</span> <span class="token string">&quot;2012-10-17&quot;</span>,
</span><span class="code-line">    <span class="token property">Statement</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token string">&quot;sts:AssumeRole&quot;</span>,
</span><span class="code-line">        <span class="token property">Principal</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token property">AWS</span> <span class="token punctuation">=</span> aws_iam_user.supasaf_master.arn
</span><span class="code-line">        <span class="token punctuation">}</span>,
</span><span class="code-line">        <span class="token property">Effect</span> <span class="token punctuation">=</span> <span class="token string">&quot;Allow&quot;</span>,
</span><span class="code-line">      <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line">  <span class="token punctuation">}</span>)
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_role_policy&quot;</span></span> <span class="token string">&quot;master_policy&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;master_policy&quot;</span>
</span><span class="code-line">  <span class="token property">role</span> <span class="token punctuation">=</span> aws_iam_role.master_role.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">policy</span> <span class="token punctuation">=</span> jsonencode(<span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Version</span> <span class="token punctuation">=</span> <span class="token string">&quot;2012-10-17&quot;</span>,
</span><span class="code-line">    <span class="token property">Statement</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token string">&quot;iam:AttachRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreatePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreatePolicyVersion&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateRole&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateUser&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeletePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeletePolicyVersion&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteRole&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteUser&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:PutRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:GetPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListPolicies&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:GetPolicyVersion&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListPoliciesGrantingServiceAccess&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:GetRole&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListPolicyVersions&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:GetRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListRolePolicies&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:GetUser&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListAttachedGroupPolicies&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:GetUserPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListAttachedRolePolicies&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListEntitiesForPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListAttachedUserPolicies&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListGroupPolicies&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListRoles&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListGroups&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListUsers&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:ListGroupsForUser&quot;</span>
</span><span class="code-line">        <span class="token punctuation">]</span>,
</span><span class="code-line">        <span class="token property">Effect</span>   <span class="token punctuation">=</span> <span class="token string">&quot;Allow&quot;</span>,
</span><span class="code-line">        <span class="token property">Resource</span> <span class="token punctuation">=</span> <span class="token string">&quot;*&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>,
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token string">&quot;iam:AttachRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreatePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreatePolicyVersion&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateRole&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateUser&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeletePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeletePolicyVersion&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteRole&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteUser&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:PutRolePolicy&quot;</span>
</span><span class="code-line">        <span class="token punctuation">]</span>,
</span><span class="code-line">        <span class="token property">Effect</span>   <span class="token punctuation">=</span> <span class="token string">&quot;Deny&quot;</span>,
</span><span class="code-line">        <span class="token property">Resource</span> <span class="token punctuation">=</span> <span class="token string">&quot;*&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line">  <span class="token punctuation">}</span>)
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Manager Role</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_user&quot;</span></span> <span class="token string">&quot;supasaf_manager&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;supasaf_manager&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_role&quot;</span></span> <span class="token string">&quot;manager_role&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;manager_role&quot;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">assume_role_policy</span> <span class="token punctuation">=</span> jsonencode(<span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Version</span> <span class="token punctuation">=</span> <span class="token string">&quot;2012-10-17&quot;</span>,
</span><span class="code-line">    <span class="token property">Statement</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token string">&quot;sts:AssumeRole&quot;</span>,
</span><span class="code-line">        <span class="token property">Principal</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">          <span class="token property">AWS</span> <span class="token punctuation">=</span> aws_iam_user.supasaf_manager.arn
</span><span class="code-line">        <span class="token punctuation">}</span>,
</span><span class="code-line">        <span class="token property">Effect</span> <span class="token punctuation">=</span> <span class="token string">&quot;Allow&quot;</span>,
</span><span class="code-line">      <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line">  <span class="token punctuation">}</span>)
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_role_policy&quot;</span></span> <span class="token string">&quot;manager_policy&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;manager_policy&quot;</span>
</span><span class="code-line">  <span class="token property">role</span> <span class="token punctuation">=</span> aws_iam_role.manager_role.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">policy</span> <span class="token punctuation">=</span> jsonencode(<span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Version</span> <span class="token punctuation">=</span> <span class="token string">&quot;2012-10-17&quot;</span>,
</span><span class="code-line">    <span class="token property">Statement</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token string">&quot;iam:AddUserToGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:AttachGroupPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteGroupPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteUserPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DetachGroupPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DetachRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DetachUserPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:PutGroupPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:PutUserPolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:RemoveUserFromGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:UpdateGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:UpdateAssumeRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:UpdateUser&quot;</span>
</span><span class="code-line">        <span class="token punctuation">]</span>,
</span><span class="code-line">        <span class="token property">Effect</span>   <span class="token punctuation">=</span> <span class="token string">&quot;Allow&quot;</span>,
</span><span class="code-line">        <span class="token property">Resource</span> <span class="token punctuation">=</span> <span class="token string">&quot;*&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>,
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token string">&quot;iam:AttachRolePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreatePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreatePolicyVersion&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateRole&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:CreateUser&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteGroup&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeletePolicy&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeletePolicyVersion&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteRole&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:DeleteUser&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;iam:PutRolePolicy&quot;</span>
</span><span class="code-line">        <span class="token punctuation">]</span>,
</span><span class="code-line">        <span class="token property">Effect</span>   <span class="token punctuation">=</span> <span class="token string">&quot;Deny&quot;</span>,
</span><span class="code-line">        <span class="token property">Resource</span> <span class="token punctuation">=</span> <span class="token string">&quot;*&quot;</span>
</span><span class="code-line">      <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token punctuation">]</span>,
</span><span class="code-line">  <span class="token punctuation">}</span>)
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Once you apply this, you can check out your new roles in the AWS console, feeling much safer.</p><img width="600" src="/static/images/terraform/iam_manager_role.png"/><h2 id="where-do-we-go-from-here-leveling-up-your-iam-security"><a href="#where-do-we-go-from-here-leveling-up-your-iam-security" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Where Do We Go From Here? Leveling Up Your IAM Security</h2><p>Okay, so you’ve implemented the two-key rule. Awesome! That already puts you way ahead of the game. But what&#x27;s next on the path to becoming an IAM security guru?</p><ol><li><p><strong>Permissions Boundaries</strong>: This is the ultimate safety net. A permissions boundary is a policy you attach to a user or role that sets the maximum permissions they can ever have. Even if the Manager role tries to attach a God Mode policy to a user, the permissions boundary can stop it, saying, &quot;Nope, you can&#x27;t grant powers that you don&#x27;t have yourself.&quot; It&#x27;s like putting a ceiling on what&#x27;s possible, preventing even the most creative privilege escalation.</p></li><li><p><strong>Automated Code Scanning</strong>: Before you even <code>terraform apply</code>, you can have tools automatically check your code for security mistakes. Tools like Open Policy Agent (OPA) act like a building inspector for your code. They&#x27;ll scan your Terraform files and scream at you if you accidentally write a policy that&#x27;s too permissive, like <code>Action: &quot;*&quot;, Resource: &quot;*&quot;</code>. This is a lifesaver for catching mistakes early.</p></li><li><p><strong>Active Monitoring and Auditing</strong>: Having great locks on your doors is fantastic, but you still need security cameras. Make sure you have AWS CloudTrail enabled to log every single IAM action. Who assumed the Master role? When? What policies did they create? You should also use Amazon GuardDuty, which uses machine learning to detect suspicious IAM activity, like a role being used from a strange location.</p></li></ol><h2 id="the-takeaway-be-the-smart-warden-not-the-panicked-guard"><a href="#the-takeaway-be-the-smart-warden-not-the-panicked-guard" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Takeaway: Be the Smart Warden, Not the Panicked Guard</h2><p>In the world of cloud security, thinking like an attacker is half the battle. They will always look for the single point of failure—the one user, the one key that can unlock everything. The split-privilege model is a simple, powerful way to eliminate that single point of failure.</p><p>By combining this model with other IAM best practices and the power of Terraform, you move from being the panicked guard with a messy key ring to the wise, calm castle warden who has a clear, enforceable plan. You&#x27;ll sleep better at night, I promise.</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/terraform">Terraform</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cloud">Cloud</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/aws">AWS</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/terraform/terraform_sec_1_iam0">Harnessing AWS IAM and Terraform for Enhanced Cybersecurity</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/service-account-1">InfoSec architect 101-Service account from prehistory</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var t=a=\u003ec(a,\"__esModule\",{value:!0});var u=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{t(a);for(var l in s)c(a,l,{get:s[l],enumerable:!0})},y=(a,s,l)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!N.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026c(a,n,{get:()=\u003es[n],enumerable:!(l=p(s,n))||l.enumerable});return a},g=a=\u003ey(t(c(a!=null?d(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=u((A,r)=\u003e{r.exports=_jsx_runtime});var _={};k(_,{default:()=\u003eP,frontmatter:()=\u003ef});var e=g(o()),f={title:\"An IAM Split-Privilege Model with Terraform for Robust Cybersecurity\",date:\"2023-05-14\",tags:[\"Terraform\",\"Cloud\",\"AWS\"],draft:!1,summary:\"A practical (and funny) guide to implementing a split-privilege model in AWS. We'll separate the power to create permissions from the power to assign them, making your cloud a whole lot safer.\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(l,{})})):l();function l(){let n=Object.assign({p:\"p\",a:\"a\",h2:\"h2\",span:\"span\",ol:\"ol\",li:\"li\",strong:\"strong\",code:\"code\",pre:\"pre\"},a.components),{Image:i}=n;return i||b(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"In our \",(0,e.jsx)(n.a,{href:\"https://www.supasaf.com/blog/terraform/terraform_sec_1_iam0\",children:\"last chat\"}),`, we talked about managing the keys to your cloud castle. But what about the person who makes the keys? In a typical setup, it's easy to accidentally create a user with \"God Mode\" privileges\\u2014someone who can not only open any door but can also forge new keys for themselves to open doors that don't even exist yet. This is an attacker's dream and a security admin's nightmare.`]}),(0,e.jsx)(n.p,{children:\"If a single person can create a new, all-powerful permission policy and then attach that policy to their own account, it's game over. They can go from a lowly castle guard to the king of the world in about five minutes. This is a massive security vulnerability just waiting to happen.\"}),(0,e.jsx)(n.p,{children:'Thankfully, some very clever people have thought about this problem. In his excellent book, \"AWS Security,\" Dylan Shields lays out a brilliant solution: The Split-Privilege Model. The idea is simple but powerful, like the rule for launching a nuclear missile: it should take two people with two different keys.'}),(0,e.jsxs)(n.h2,{id:\"the-two-key-solution-the-master-and-the-manager\",children:[(0,e.jsx)(n.a,{href:\"#the-two-key-solution-the-master-and-the-manager\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Two-Key Solution: The Master and The Manager\"]}),(0,e.jsx)(n.p,{children:'The model splits the \"God Mode\" power into two separate roles. Neither role on its own is all-powerful.'}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"The Master (The Key Maker)\"}),\": This role is like your master blacksmith. They can forge new keys (create IAM policies), build new keychains (create roles), and issue new ID cards (create users). But here's the catch: they can't give the keys to anyone. They just make them and put them on the wall.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"The Manager (The Key Giver)\"}),\": This role is the castle chamberlain. They can't make new keys. But they can take the keys the Master has already made and assign them to the right people (attach policies to users and roles, add users to groups).\"]})})]}),(0,e.jsx)(n.p,{children:\"See the genius here? To take over the castle, an attacker would need to steal the keys from both the blacksmith and the chamberlain. You've just doubled the difficulty of a privilege escalation attack.\"}),(0,e.jsxs)(n.h2,{id:\"lets-build-it-with-terraform\",children:[(0,e.jsx)(n.a,{href:\"#lets-build-it-with-terraform\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Let's Build It with Terraform\"]}),(0,e.jsxs)(n.p,{children:[`Talk is cheap, so let's get to the code. Using Terraform, we can build these two separate, limited roles. This is the blueprint for our \"two-key\" system. Notice the `,(0,e.jsx)(n.code,{children:\"Allow\"}),\" and \",(0,e.jsx)(n.code,{children:\"Deny\"}),\" statements\\u2014they are explicitly designed to stop one role from doing the other's job.\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_user\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"supasaf_master\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"supasaf_master\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_role\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"master_role\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"master_role\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"assume_role_policy\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" jsonencode(\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2012-10-17\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sts:AssumeRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Principal\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:\"AWS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_user.supasaf_master.arn\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_role_policy\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"master_policy\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"master_policy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"role\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_role.master_role.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"policy\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" jsonencode(\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2012-10-17\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:AttachRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreatePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreatePolicyVersion\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateUser\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeletePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeletePolicyVersion\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteUser\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:PutRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:GetPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListPolicies\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:GetPolicyVersion\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListPoliciesGrantingServiceAccess\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:GetRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListPolicyVersions\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:GetRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListRolePolicies\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:GetUser\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListAttachedGroupPolicies\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:GetUserPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListAttachedRolePolicies\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListEntitiesForPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListAttachedUserPolicies\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListGroupPolicies\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListRoles\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListGroups\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListUsers\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:ListGroupsForUser\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:AttachRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreatePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreatePolicyVersion\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateUser\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeletePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeletePolicyVersion\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteUser\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:PutRolePolicy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Deny\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Manager Role\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_user\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"supasaf_manager\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"supasaf_manager\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_role\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"manager_role\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"manager_role\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"assume_role_policy\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" jsonencode(\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2012-10-17\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"sts:AssumeRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Principal\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:\"AWS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_user.supasaf_manager.arn\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_role_policy\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"manager_policy\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"manager_policy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"role\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_role.manager_role.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"policy\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" jsonencode(\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2012-10-17\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:AddUserToGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:AttachGroupPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteGroupPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteUserPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DetachGroupPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DetachRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DetachUserPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:PutGroupPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:PutUserPolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:RemoveUserFromGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:UpdateGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:UpdateAssumeRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:UpdateUser\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:AttachRolePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreatePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreatePolicyVersion\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:CreateUser\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteGroup\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeletePolicy\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeletePolicyVersion\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteRole\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:DeleteUser\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"iam:PutRolePolicy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Deny\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"*\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Once you apply this, you can check out your new roles in the AWS console, feeling much safer.\"}),(0,e.jsx)(i,{width:600,src:\"/static/images/terraform/iam_manager_role.png\"}),(0,e.jsxs)(n.h2,{id:\"where-do-we-go-from-here-leveling-up-your-iam-security\",children:[(0,e.jsx)(n.a,{href:\"#where-do-we-go-from-here-leveling-up-your-iam-security\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Where Do We Go From Here? Leveling Up Your IAM Security\"]}),(0,e.jsx)(n.p,{children:\"Okay, so you\\u2019ve implemented the two-key rule. Awesome! That already puts you way ahead of the game. But what's next on the path to becoming an IAM security guru?\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Permissions Boundaries\"}),`: This is the ultimate safety net. A permissions boundary is a policy you attach to a user or role that sets the maximum permissions they can ever have. Even if the Manager role tries to attach a God Mode policy to a user, the permissions boundary can stop it, saying, \"Nope, you can't grant powers that you don't have yourself.\" It's like putting a ceiling on what's possible, preventing even the most creative privilege escalation.`]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Automated Code Scanning\"}),\": Before you even \",(0,e.jsx)(n.code,{children:\"terraform apply\"}),\", you can have tools automatically check your code for security mistakes. Tools like Open Policy Agent (OPA) act like a building inspector for your code. They'll scan your Terraform files and scream at you if you accidentally write a policy that's too permissive, like \",(0,e.jsx)(n.code,{children:'Action: \"*\", Resource: \"*\"'}),\". This is a lifesaver for catching mistakes early.\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Active Monitoring and Auditing\"}),\": Having great locks on your doors is fantastic, but you still need security cameras. Make sure you have AWS CloudTrail enabled to log every single IAM action. Who assumed the Master role? When? What policies did they create? You should also use Amazon GuardDuty, which uses machine learning to detect suspicious IAM activity, like a role being used from a strange location.\"]})})]}),(0,e.jsxs)(n.h2,{id:\"the-takeaway-be-the-smart-warden-not-the-panicked-guard\",children:[(0,e.jsx)(n.a,{href:\"#the-takeaway-be-the-smart-warden-not-the-panicked-guard\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Takeaway: Be the Smart Warden, Not the Panicked Guard\"]}),(0,e.jsx)(n.p,{children:\"In the world of cloud security, thinking like an attacker is half the battle. They will always look for the single point of failure\\u2014the one user, the one key that can unlock everything. The split-privilege model is a simple, powerful way to eliminate that single point of failure.\"}),(0,e.jsx)(n.p,{children:\"By combining this model with other IAM best practices and the power of Terraform, you move from being the panicked guard with a messy key ring to the wise, calm castle warden who has a clear, enforceable plan. You'll sleep better at night, I promise.\"})]})}}var P=w;function b(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return _;})();\n;return Component;","toc":[{"value":"The Two-Key Solution: The Master and The Manager","url":"#the-two-key-solution-the-master-and-the-manager","depth":2},{"value":"Let's Build It with Terraform","url":"#lets-build-it-with-terraform","depth":2},{"value":"Where Do We Go From Here? Leveling Up Your IAM Security","url":"#where-do-we-go-from-here-leveling-up-your-iam-security","depth":2},{"value":"The Takeaway: Be the Smart Warden, Not the Panicked Guard","url":"#the-takeaway-be-the-smart-warden-not-the-panicked-guard","depth":2}],"frontMatter":{"readingTime":{"text":"8 min read","minutes":7.325,"time":439500,"words":1465},"slug":"terraform/terraform_sec_2_iam1","fileName":"terraform/terraform_sec_2_iam1.md","title":"An IAM Split-Privilege Model with Terraform for Robust Cybersecurity","date":"2023-05-14T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"A practical (and funny) guide to implementing a split-privilege model in AWS. We'll separate the power to create permissions from the power to assign them, making your cloud a whole lot safer."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"Harnessing AWS IAM and Terraform for Enhanced Cybersecurity","date":"2023-05-13T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"An old-timer's guide to using Terraform to manage who gets to touch what in your AWS account. Learn about IAM users, policies, groups, and roles without falling asleep.","slug":"terraform/terraform_sec_1_iam0"},"next":{"title":"InfoSec architect 101-Service account from prehistory","date":"2025-07-01T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Service accounts may sound boring, but they’re the unsung heroes of secure automation. In this post, we time-travel back to the prehistoric age of Windows domains to see how service accounts and Kerberos work together to avoid hardcoded passwords and security nightmares.","images":[],"slug":"service-account-1"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["terraform","terraform_sec_2_iam1"]},"buildId":"FHK-ySMycB0TLv9rRH6je","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>