<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Bastion Hosts: Safeguarding Your Cloud Resources</title><meta name="robots" content="follow, index"/><meta name="description" content="Discover the significance of bastion hosts in cloud security and learn how to set up a secure gateway using Terraform in AWS, ensuring protection for private resources while reducing the attack surface area."/><meta property="og:url" content="https://www.supasaf.com/blog/terraform/terraform_sec_4_bastion"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="Discover the significance of bastion hosts in cloud security and learn how to set up a secure gateway using Terraform in AWS, ensuring protection for private resources while reducing the attack surface area."/><meta property="og:title" content="Bastion Hosts: Safeguarding Your Cloud Resources"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Bastion Hosts: Safeguarding Your Cloud Resources"/><meta name="twitter:description" content="Discover the significance of bastion hosts in cloud security and learn how to set up a secure gateway using Terraform in AWS, ensuring protection for private resources while reducing the attack surface area."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/terraform/terraform_sec_4_bastion"/><meta property="article:published_time" content="2023-06-26T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/terraform/terraform_sec_4_bastion"
  },
  "headline": "Bastion Hosts: Safeguarding Your Cloud Resources",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2023-06-26T00:00:00.000Z",
  "dateModified": "2023-06-26T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "Discover the significance of bastion hosts in cloud security and learn how to set up a secure gateway using Terraform in AWS, ensuring protection for private resources while reducing the attack surface area."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/Y0yMeFuQcZiOOzLcfYDBY/_buildManifest.js" defer=""></script><script src="/_next/static/Y0yMeFuQcZiOOzLcfYDBY/_ssgManifest.js" defer=""></script><script src="/_next/static/Y0yMeFuQcZiOOzLcfYDBY/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2023-06-26T00:00:00.000Z">Monday, June 26, 2023</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Bastion Hosts: Safeguarding Your Cloud Resources</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><h2 id="a-note-from-the-future-reviewed-in-2025"><a href="#a-note-from-the-future-reviewed-in-2025" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A Note from the Future (Reviewed in 2025)</h2><p>Hey there! This article was originally written in 2023 and is a fantastic step-by-step guide to understanding the concept of a bastion host and building the required network infrastructure (VPCs, subnets, security groups) with Terraform. The principles here are solid.</p><p>However, as cloud security evolves, so do our best practices. For a real-world production environment in 2025, I strongly recommend not leaving an SSH port open 24/7, even on a bastion host.</p><p>The modern, more secure approach is to use Just-in-Time (JIT) VM access. Services like AWS Systems Manager Session Manager allow you to get temporary, on-demand, and fully audited command-line access to your private instances without ever exposing the SSH port. The guiding principle is that production servers shouldn&#x27;t need to run the sshd service at all.</p><p>So, please enjoy this article as a great hands-on lab for learning about cloud networking. Just remember to reach for JIT access when you&#x27;re building for production!</p><hr/><h1 id="editors-note-the-original-2023-article-begins-below"><a href="#editors-note-the-original-2023-article-begins-below" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Editor&#x27;s Note: The original 2023 article begins below.</h1><p>In the world of cloud computing, security is paramount. As organizations embrace the cloud, it becomes crucial to implement robust strategies to protect valuable resources from unauthorized access. One essential aspect of cloud security is the bastion host – a dedicated server that acts as a secure gateway, ensuring the protection of private resources within your network. In this blog post, we&#x27;ll explore the concept of bastion hosts, understand their significance in cloud security, and demonstrate how to set up a bastion host using Terraform in AWS. We&#x27;ll also create a private RDS instance to serve as the target server, enhancing your security measures.</p><h2 id="so-what-exactly-is-a-bastion-host"><a href="#so-what-exactly-is-a-bastion-host" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>So, what Exactly is a Bastion Host?</h2><p>A bastion host, also known as a jump server or a bastion server, is a specialized server that acts as a secure entry point into a private network. Its primary role is to serve as a single access point, granting authorized users secure access to other resources within the network, such as databases or private instances. By implementing a bastion host, organizations can establish strict access controls, closely monitor and log access attempts, and significantly reduce the attack surface area.</p><h2 id="the-crucial-role-of-bastion-hosts-in-cloud-security"><a href="#the-crucial-role-of-bastion-hosts-in-cloud-security" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The Crucial Role of Bastion Hosts in Cloud Security</h2><p>Integrating bastion hosts into your cloud security strategy offers several key benefits:</p><h3 id="secure-remote-access"><a href="#secure-remote-access" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Secure Remote Access:</h3><p>Bastion hosts enable secure remote access to private resources. Instead of exposing sensitive resources directly to the internet, users must first connect to the bastion host, which acts as a secure gateway. This additional layer of protection significantly reduces the risk of unauthorized access.</p><h3 id="access-control"><a href="#access-control" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Access Control:</h3><p>With bastion hosts, organizations can enforce stringent access control policies. Only authorized users with the appropriate credentials and permissions can access the bastion host. From there, they can authenticate and access other resources within the private network. This helps prevent unauthorized users from directly accessing sensitive resources.</p><h3 id="monitoring-and-logging"><a href="#monitoring-and-logging" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Monitoring and Logging:</h3><p>By channeling all access attempts through the bastion host, organizations gain effective monitoring and logging capabilities. Valuable audit trails are generated, allowing organizations to track who accessed which resources and when. These logs are invaluable for forensic analysis and investigations during security incidents.</p><h3 id="reduced-attack-surface"><a href="#reduced-attack-surface" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Reduced Attack Surface:</h3><p>Bastion hosts act as a single point of entry into the private network, effectively reducing the overall attack surface area. By limiting external access solely to the bastion host, organizations gain better control and security for their resources. This isolation mitigates the risk of direct attacks on private instances or databases.</p><h2 id="setting-up-a-bastion-host-in-aws-using-terraform"><a href="#setting-up-a-bastion-host-in-aws-using-terraform" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Setting up a Bastion Host in AWS Using Terraform</h2><p>Now, let&#x27;s delve into setting up a bastion host in AWS using Terraform. We&#x27;ll create an EC2 instance to serve as the bastion host, which will be located in a public subnet. Additionally, we&#x27;ll create a private RDS instance to act as the target server, residing in a private subnet.</p><h3 id="vpc"><a href="#vpc" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>VPC</h3><p>To begin, we need create the AWS VPC, we&#x27;ll define the necessary resources in our Terraform configuration file, typically named <code>variables.tf</code>:</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;aws_region&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">&quot;us-west-2&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// This variable is to set the</span>
</span><span class="code-line"><span class="token comment">// CIDR block for the VPC</span>
</span><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;vpc_cidr_block&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;CIDR block for VPC&quot;</span>
</span><span class="code-line">  <span class="token property">type</span>        <span class="token punctuation">=</span> string
</span><span class="code-line">  <span class="token property">default</span>     <span class="token punctuation">=</span> <span class="token string">&quot;10.0.0.0/16&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>And the <code>main.tf</code>:</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">aws</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">&quot;hashicorp/aws&quot;</span>
</span><span class="code-line">      <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;~&gt; 4.16&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">required_version</span> <span class="token punctuation">=</span> <span class="token string">&quot;&gt;= 1.2.0&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">provider<span class="token type variable"> &quot;aws&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">region</span> <span class="token punctuation">=</span> var.aws_region
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">data <span class="token type variable">&quot;aws_availability_zones&quot;</span></span> <span class="token string">&quot;available&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">state</span> <span class="token punctuation">=</span> <span class="token string">&quot;available&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_vpc&quot;</span></span> <span class="token string">&quot;ec2_rds_vpc&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">cidr_block</span>           <span class="token punctuation">=</span> var.vpc_cidr_block
</span><span class="code-line">  <span class="token property">enable_dns_hostnames</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2_rds_vpc&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Once you have the configuration file set up, run the following commands to initialize Terraform and apply the configuration:</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line">terraform init
</span><span class="code-line">terraform apply
</span></code></pre></div><p>We may double check from the AWS console as:</p><img width="600" src="/static/images/terraform/t4_vpc_console.png"/><p>Create AWS gateway(<code>main.tf</code>):</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_internet_gateway&quot;</span></span> <span class="token string">&quot;ec2_rds_gw&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">vpc_id</span> <span class="token punctuation">=</span> aws_vpc.ec2_rds_vpc.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2_rds_gw&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>We can see the Network connections became <strong>1</strong>!</p><img width="600" src="/static/images/terraform/t4_vpc_connections.png"/><p>RDS needs both public and private subnets(<code>variables.tf</code>),</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;subnet_count&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Number of subnets&quot;</span>
</span><span class="code-line">  <span class="token property">type</span>        <span class="token punctuation">=</span> map(number)
</span><span class="code-line">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">public</span>  <span class="token punctuation">=</span> <span class="token number">1</span>,
</span><span class="code-line">    <span class="token property">private</span> <span class="token punctuation">=</span> <span class="token number">2</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;public_subnet_cidr_blocks&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Available CIDR blocks for public subnets&quot;</span>
</span><span class="code-line">  <span class="token property">type</span>        <span class="token punctuation">=</span> list(string)
</span><span class="code-line">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token string">&quot;10.0.1.0/24&quot;</span>,
</span><span class="code-line">    <span class="token string">&quot;10.0.2.0/24&quot;</span>,
</span><span class="code-line">    <span class="token string">&quot;10.0.3.0/24&quot;</span>,
</span><span class="code-line">    <span class="token string">&quot;10.0.4.0/24&quot;</span>
</span><span class="code-line">  <span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;private_subnet_cidr_blocks&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Available CIDR blocks for private subnets&quot;</span>
</span><span class="code-line">  <span class="token property">type</span>        <span class="token punctuation">=</span> list(string)
</span><span class="code-line">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token string">&quot;10.0.101.0/24&quot;</span>,
</span><span class="code-line">    <span class="token string">&quot;10.0.102.0/24&quot;</span>,
</span><span class="code-line">    <span class="token string">&quot;10.0.103.0/24&quot;</span>,
</span><span class="code-line">    <span class="token string">&quot;10.0.104.0/24&quot;</span>,
</span><span class="code-line">  <span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Along with <code>main.tf</code>:</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_subnet&quot;</span></span> <span class="token string">&quot;ec2rds_public_subnet&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">count</span> <span class="token punctuation">=</span> var.subnet_count.public
</span><span class="code-line">  <span class="token property">vpc_id</span> <span class="token punctuation">=</span> aws_vpc.ec2_rds_vpc.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// &quot;10.0.1.0/24&quot;</span>
</span><span class="code-line">  <span class="token property">cidr_block</span> <span class="token punctuation">=</span> var.public_subnet_cidr_blocks<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// our region is us-west-2, this should grab us-west-2a</span>
</span><span class="code-line">  <span class="token property">availability_zone</span> <span class="token punctuation">=</span> data.aws_availability_zones.available.names<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_public_subnet_<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">count</span><span class="token punctuation">.</span><span class="token type variable">index</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_subnet&quot;</span></span> <span class="token string">&quot;ec2rds_private_subnet&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">count</span> <span class="token punctuation">=</span> var.subnet_count.private
</span><span class="code-line">  <span class="token property">vpc_id</span> <span class="token punctuation">=</span> aws_vpc.ec2_rds_vpc.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// &quot;10.0.102.0/24&quot;</span>
</span><span class="code-line">  <span class="token property">cidr_block</span> <span class="token punctuation">=</span> var.private_subnet_cidr_blocks<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// our region is us-west-2, this should grab us-west-2b</span>
</span><span class="code-line">  <span class="token property">availability_zone</span> <span class="token punctuation">=</span> data.aws_availability_zones.available.names<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_private_subnet_<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">count</span><span class="token punctuation">.</span><span class="token type variable">index</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>OK, the number of Subnets became <strong>3</strong>:</p><img width="600" src="/static/images/terraform/t4_subnets_number.png"/><p>The next step is to create Route Tables(<code>main.tf</code>):</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_route_table&quot;</span></span> <span class="token string">&quot;ec2rds_public_rt&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">vpc_id</span> <span class="token punctuation">=</span> aws_vpc.ec2_rds_vpc.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">route</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// &quot;0.0.0.0/0&quot; means anywhere on the internet can access</span>
</span><span class="code-line">    <span class="token property">cidr_block</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.0.0.0/0&quot;</span>
</span><span class="code-line">    <span class="token property">gateway_id</span> <span class="token punctuation">=</span> aws_internet_gateway.ec2_rds_gw.id
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_route_table_association&quot;</span></span> <span class="token string">&quot;public&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">count</span>          <span class="token punctuation">=</span> var.subnet_count.public
</span><span class="code-line">  <span class="token property">route_table_id</span> <span class="token punctuation">=</span> aws_route_table.ec2rds_public_rt.id
</span><span class="code-line">  <span class="token property">subnet_id</span>      <span class="token punctuation">=</span> aws_subnet.ec2rds_public_subnet<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>.id
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_route_table&quot;</span></span> <span class="token string">&quot;ec2rds_private_rt&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">vpc_id</span> <span class="token punctuation">=</span> aws_vpc.ec2_rds_vpc.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// We don&#x27;t need to setup `route` for private route table</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_route_table_association&quot;</span></span> <span class="token string">&quot;private&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">count</span>          <span class="token punctuation">=</span> var.subnet_count.private
</span><span class="code-line">  <span class="token property">route_table_id</span> <span class="token punctuation">=</span> aws_route_table.ec2rds_private_rt.id
</span><span class="code-line">  <span class="token property">subnet_id</span>      <span class="token punctuation">=</span> aws_subnet.ec2rds_private_subnet<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>.id
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Route tables will connect the gateway if all goes well:</p><img width="600" src="/static/images/terraform/t4_routetables_connecting.png"/><p>Take a breath, we are going the setup the Security Groups now(<code>variables.tf</code>):</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;my_ip&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">&quot;CHANGE_IT_TO_YOUR_IP&quot;</span> <span class="token comment">// change it to your IP!</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>And <code>main.tf</code>:</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_security_group&quot;</span></span> <span class="token string">&quot;ec2rds_web_sg&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>        <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_web_sg&quot;</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Security group for tutorial web servers&quot;</span>
</span><span class="code-line">  <span class="token property">vpc_id</span>      <span class="token punctuation">=</span> aws_vpc.ec2_rds_vpc.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// Only my IP can access port 22(SSH)</span>
</span><span class="code-line">  <span class="token keyword">ingress</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Allow SSH from my computer&quot;</span>
</span><span class="code-line">    <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token string">&quot;22&quot;</span>
</span><span class="code-line">    <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token string">&quot;22&quot;</span>
</span><span class="code-line">    <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">&quot;tcp&quot;</span>
</span><span class="code-line">    <span class="token comment">// This is using the variable &quot;my_ip&quot;</span>
</span><span class="code-line">    <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">my_ip</span><span class="token punctuation">}</span></span>/32&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">egress</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Allow all outbound traffic&quot;</span>
</span><span class="code-line">    <span class="token property">from_port</span>   <span class="token punctuation">=</span> <span class="token number">0</span>
</span><span class="code-line">    <span class="token property">to_port</span>     <span class="token punctuation">=</span> <span class="token number">0</span>
</span><span class="code-line">    <span class="token property">protocol</span>    <span class="token punctuation">=</span> <span class="token string">&quot;-1&quot;</span>
</span><span class="code-line">    <span class="token property">cidr_blocks</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;0.0.0.0/0&quot;</span><span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_web_sg&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_security_group&quot;</span></span> <span class="token string">&quot;ec2rds_db_sg&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>        <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_db_sg&quot;</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Security group for tutorial databases&quot;</span>
</span><span class="code-line">  <span class="token property">vpc_id</span>      <span class="token punctuation">=</span> aws_vpc.ec2_rds_vpc.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// Only allow access from bastion server</span>
</span><span class="code-line">  <span class="token keyword">ingress</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">description</span>     <span class="token punctuation">=</span> <span class="token string">&quot;Allow MySQL traffic from only the web sg&quot;</span>
</span><span class="code-line">    <span class="token property">from_port</span>       <span class="token punctuation">=</span> <span class="token string">&quot;3306&quot;</span>
</span><span class="code-line">    <span class="token property">to_port</span>         <span class="token punctuation">=</span> <span class="token string">&quot;3306&quot;</span>
</span><span class="code-line">    <span class="token property">protocol</span>        <span class="token punctuation">=</span> <span class="token string">&quot;tcp&quot;</span>
</span><span class="code-line">    <span class="token property">security_groups</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>aws_security_group.ec2rds_web_sg.id<span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_db_sg&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Well, that the security groups should look like from AWS console:</p><img width="600" src="/static/images/terraform/t4_security_groups.png"/><h3 id="rds"><a href="#rds" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>RDS</h3><p>RDS is simple, we need to setup DB Subnet Group(<code>main.tf</code>):</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_db_subnet_group&quot;</span></span> <span class="token string">&quot;ec2rds_db_subnet_group&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>        <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_db_subnet_group&quot;</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;DB subnet group for tutorial&quot;</span>
</span><span class="code-line">  <span class="token property">subnet_ids</span>  <span class="token punctuation">=</span> <span class="token punctuation">[</span>for subnet in aws_subnet.ec2rds_private_subnet : subnet.id<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>The RDS&#x27; subnet group is connecting to VPC private subnets now:</p><img width="600" src="/static/images/terraform/t4_rds_subnet_group.png"/><p>Create DB(<code>variables.tf</code>):</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;db_username&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Database master user&quot;</span>
</span><span class="code-line">  <span class="token property">type</span>        <span class="token punctuation">=</span> string
</span><span class="code-line">  <span class="token property">default</span>     <span class="token punctuation">=</span> <span class="token string">&quot;mmuser&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;db_password&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Database master user password&quot;</span>
</span><span class="code-line">  <span class="token property">type</span>        <span class="token punctuation">=</span> string
</span><span class="code-line">  <span class="token property">sensitive</span>   <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;settings&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Configuration settings&quot;</span>
</span><span class="code-line">  <span class="token property">type</span>        <span class="token punctuation">=</span> map(any)
</span><span class="code-line">  <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">&quot;database&quot;</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">allocated_storage</span>   <span class="token punctuation">=</span> <span class="token number">10</span>            <span class="token comment">// storage in gigabytes</span>
</span><span class="code-line">      <span class="token property">engine</span>              <span class="token punctuation">=</span> <span class="token string">&quot;mysql&quot;</span>       <span class="token comment">// engine type</span>
</span><span class="code-line">      <span class="token property">engine_version</span>      <span class="token punctuation">=</span> <span class="token string">&quot;8.0.27&quot;</span>      <span class="token comment">// engine version</span>
</span><span class="code-line">      <span class="token property">instance_class</span>      <span class="token punctuation">=</span> <span class="token string">&quot;db.t2.micro&quot;</span> <span class="token comment">// rds instance type</span>
</span><span class="code-line">      <span class="token property">db_name</span>             <span class="token punctuation">=</span> <span class="token string">&quot;mmdb&quot;</span>        <span class="token comment">// database name</span>
</span><span class="code-line">      <span class="token property">skip_final_snapshot</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line">    <span class="token punctuation">}</span>,
</span><span class="code-line">    <span class="token property">&quot;web_app&quot;</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">count</span>         <span class="token punctuation">=</span> <span class="token number">1</span>          <span class="token comment">// the number of EC2 instances</span>
</span><span class="code-line">      <span class="token property">instance_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;t2.micro&quot;</span> <span class="token comment">// the EC2 instance</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Together with <code>main.tf</code>:</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_db_instance&quot;</span></span> <span class="token string">&quot;ec2rds_db&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">allocated_storage</span> <span class="token punctuation">=</span> var.settings.database.allocated_storage
</span><span class="code-line">  <span class="token property">engine</span> <span class="token punctuation">=</span> var.settings.database.engine
</span><span class="code-line">  <span class="token property">engine_version</span> <span class="token punctuation">=</span> var.settings.database.engine_version
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// &quot;db.t2.micro&quot;</span>
</span><span class="code-line">  <span class="token property">instance_class</span> <span class="token punctuation">=</span> var.settings.database.instance_class
</span><span class="code-line">  <span class="token property">db_name</span> <span class="token punctuation">=</span> var.settings.database.db_name
</span><span class="code-line">  <span class="token property">username</span> <span class="token punctuation">=</span> var.db_username
</span><span class="code-line">  <span class="token property">password</span> <span class="token punctuation">=</span> var.db_password
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// &quot;ec2rds_db_subnet_group&quot;</span>
</span><span class="code-line">  <span class="token property">db_subnet_group_name</span> <span class="token punctuation">=</span> aws_db_subnet_group.ec2rds_db_subnet_group.name
</span><span class="code-line">  <span class="token property">vpc_security_group_ids</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>aws_security_group.ec2rds_db_sg.id<span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token property">skip_final_snapshot</span> <span class="token punctuation">=</span> var.settings.database.skip_final_snapshot
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>And here&#x27;s the DB:</p><img width="600" src="/static/images/terraform/t4_rds_success.png"/><h3 id="ec2"><a href="#ec2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>EC2</h3><p>Just to demo, we use terraform to generate key pair:</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">variable<span class="token type variable"> &quot;key_name&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">default</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_key&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;tls_private_key&quot;</span></span> <span class="token string">&quot;example&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">algorithm</span> <span class="token punctuation">=</span> <span class="token string">&quot;RSA&quot;</span>
</span><span class="code-line">  <span class="token property">rsa_bits</span>  <span class="token punctuation">=</span> <span class="token number">4096</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_key_pair&quot;</span></span> <span class="token string">&quot;generated_key&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">key_name</span>   <span class="token punctuation">=</span> var.key_name
</span><span class="code-line">  <span class="token property">public_key</span> <span class="token punctuation">=</span> tls_private_key.example.public_key_openssh
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>And trigger it:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">terraform output -raw private_key &gt; key.pem
</span><span class="code-line">chmod 400 key.pem
</span></code></pre></div><p>Then we will create EC2 instance and Elastic IP:</p><div class="relative"><pre><code class="language-hcl code-highlight"><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_instance&quot;</span></span> <span class="token string">&quot;ec2rds_web&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">count</span>                  <span class="token punctuation">=</span> var.settings.web_app.count
</span><span class="code-line">  <span class="token property">ami</span>                    <span class="token punctuation">=</span> <span class="token string">&quot;ami-0735c191cf914754d&quot;</span>
</span><span class="code-line">  <span class="token property">instance_type</span>          <span class="token punctuation">=</span> var.settings.web_app.instance_type
</span><span class="code-line">  <span class="token property">subnet_id</span>              <span class="token punctuation">=</span> aws_subnet.ec2rds_public_subnet<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>.id
</span><span class="code-line">  <span class="token property">key_name</span>               <span class="token punctuation">=</span> aws_key_pair.generated_key.key_name
</span><span class="code-line">  <span class="token property">vpc_security_group_ids</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>aws_security_group.ec2rds_web_sg.id<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_web_<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">count</span><span class="token punctuation">.</span><span class="token type variable">index</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_eip&quot;</span></span> <span class="token string">&quot;ec2rds_web_eip&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">count</span> <span class="token punctuation">=</span> var.settings.web_app.count
</span><span class="code-line">  <span class="token property">instance</span> <span class="token punctuation">=</span> aws_instance.ec2rds_web<span class="token punctuation">[</span>count.index<span class="token punctuation">]</span>.id
</span><span class="code-line">  <span class="token property">vpc</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;ec2rds_web_eip_<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">count</span><span class="token punctuation">.</span><span class="token type variable">index</span><span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;web_public_ip&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;The public IP address of the web server&quot;</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_eip.ec2rds_web_eip<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.public_ip
</span><span class="code-line">  <span class="token property">depends_on</span>  <span class="token punctuation">=</span> <span class="token punctuation">[</span>aws_eip.ec2rds_web_eip<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;web_public_dns&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;The public DNS address of the web server&quot;</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_eip.ec2rds_web_eip<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.public_dns
</span><span class="code-line">  <span class="token property">depends_on</span>  <span class="token punctuation">=</span> <span class="token punctuation">[</span>aws_eip.ec2rds_web_eip<span class="token punctuation">]</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;database_endpoint&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;The endpoint of the database&quot;</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_db_instance.ec2rds_db.address
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;database_port&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;The port of the database&quot;</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_db_instance.ec2rds_db.port
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>We will get the information by the output:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">Outputs:
</span><span class="code-line">
</span><span class="code-line">database_endpoint = &quot;terraform-20230415125733155100000002.cji0cptoqdd8.us-west-2.rds.amazonaws.com&quot;
</span><span class="code-line">database_port = 3306
</span><span class="code-line">private_key = &lt;sensitive&gt;
</span><span class="code-line">web_public_dns = &quot;ec2-44-228-83-13.us-west-2.compute.amazonaws.com&quot;
</span><span class="code-line">web_public_ip = &quot;44.228.83.13&quot;
</span></code></pre></div><p>Login the bastion server by:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">ssh -i &quot;key.pem&quot; ubuntu@44.228.83.13
</span></code></pre></div><p>Access RDS from bastion server:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">sudo apt-get update -y &amp;&amp; sudo apt install mysql-client -y
</span><span class="code-line">
</span><span class="code-line">mysql -h terraform-20230415125733155100000002.cji0cptoqdd8.us-west-2.rds.amazonaws.com -P 3306 -u mmuser -p
</span></code></pre></div><p>OK, now we will show the DB:</p><div class="relative"><pre><code class="code-highlight"><span class="code-line">mysql&gt; show DATABASES;
</span><span class="code-line">+--------------------+
</span><span class="code-line">| Database           |
</span><span class="code-line">+--------------------+
</span><span class="code-line">| information_schema |
</span><span class="code-line">| mmdb               |
</span><span class="code-line">| mysql              |
</span><span class="code-line">| performance_schema |
</span><span class="code-line">| sys                |
</span><span class="code-line">+--------------------+
</span><span class="code-line">5 rows in set (0.00 sec)
</span></code></pre></div><p>WOW~ <code>mmdb</code> in it!</p><p>By incorporating bastion hosts into your cloud infrastructure and leveraging the power of Terraform for automation, you can establish a secure and controlled access mechanism to safeguard your sensitive resources in the cloud. With the increasing adoption of cloud computing and the rising importance of security, bastion hosts are an essential component of any robust cloud security strategy. So, embrace the power of bastion hosts and fortify your cloud environment today.</p></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/terraform">Terraform</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cloud">Cloud</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/aws">AWS</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/terraform/terraform_sec_3_abac">ABAC and RBAC: A Journey with Terraform and AWS Tagged Resources</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/service-account-1">InfoSec architect 101-Service account from prehistory</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var p=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=a=\u003ei(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{t(a);for(var c in s)i(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026i(a,n,{get:()=\u003es[n],enumerable:!(c=d(s,n))||c.enumerable});return a},y=a=\u003eg(t(i(a!=null?p(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var o=N((S,r)=\u003e{r.exports=_jsx_runtime});var f={};k(f,{default:()=\u003ew,frontmatter:()=\u003eb});var e=y(o()),b={title:\"Bastion Hosts: Safeguarding Your Cloud Resources\",date:\"2023-06-26\",tags:[\"Terraform\",\"Cloud\",\"AWS\"],draft:!1,summary:\"Discover the significance of bastion hosts in cloud security and learn how to set up a secure gateway using Terraform in AWS, ensuring protection for private resources while reducing the attack surface area.\"};function _(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",hr:\"hr\",h1:\"h1\",h3:\"h3\",code:\"code\",pre:\"pre\",strong:\"strong\"},a.components),{Image:l}=n;return l||v(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"a-note-from-the-future-reviewed-in-2025\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#a-note-from-the-future-reviewed-in-2025\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"A Note from the Future (Reviewed in 2025)\"]}),(0,e.jsx)(n.p,{children:\"Hey there! This article was originally written in 2023 and is a fantastic step-by-step guide to understanding the concept of a bastion host and building the required network infrastructure (VPCs, subnets, security groups) with Terraform. The principles here are solid.\"}),(0,e.jsx)(n.p,{children:\"However, as cloud security evolves, so do our best practices. For a real-world production environment in 2025, I strongly recommend not leaving an SSH port open 24/7, even on a bastion host.\"}),(0,e.jsx)(n.p,{children:\"The modern, more secure approach is to use Just-in-Time (JIT) VM access. Services like AWS Systems Manager Session Manager allow you to get temporary, on-demand, and fully audited command-line access to your private instances without ever exposing the SSH port. The guiding principle is that production servers shouldn't need to run the sshd service at all.\"}),(0,e.jsx)(n.p,{children:\"So, please enjoy this article as a great hands-on lab for learning about cloud networking. Just remember to reach for JIT access when you're building for production!\"}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h1,{id:\"editors-note-the-original-2023-article-begins-below\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#editors-note-the-original-2023-article-begins-below\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Editor's Note: The original 2023 article begins below.\"]}),(0,e.jsx)(n.p,{children:\"In the world of cloud computing, security is paramount. As organizations embrace the cloud, it becomes crucial to implement robust strategies to protect valuable resources from unauthorized access. One essential aspect of cloud security is the bastion host \\u2013 a dedicated server that acts as a secure gateway, ensuring the protection of private resources within your network. In this blog post, we'll explore the concept of bastion hosts, understand their significance in cloud security, and demonstrate how to set up a bastion host using Terraform in AWS. We'll also create a private RDS instance to serve as the target server, enhancing your security measures.\"}),(0,e.jsxs)(n.h2,{id:\"so-what-exactly-is-a-bastion-host\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#so-what-exactly-is-a-bastion-host\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"So, what Exactly is a Bastion Host?\"]}),(0,e.jsx)(n.p,{children:\"A bastion host, also known as a jump server or a bastion server, is a specialized server that acts as a secure entry point into a private network. Its primary role is to serve as a single access point, granting authorized users secure access to other resources within the network, such as databases or private instances. By implementing a bastion host, organizations can establish strict access controls, closely monitor and log access attempts, and significantly reduce the attack surface area.\"}),(0,e.jsxs)(n.h2,{id:\"the-crucial-role-of-bastion-hosts-in-cloud-security\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#the-crucial-role-of-bastion-hosts-in-cloud-security\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Crucial Role of Bastion Hosts in Cloud Security\"]}),(0,e.jsx)(n.p,{children:\"Integrating bastion hosts into your cloud security strategy offers several key benefits:\"}),(0,e.jsxs)(n.h3,{id:\"secure-remote-access\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#secure-remote-access\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Secure Remote Access:\"]}),(0,e.jsx)(n.p,{children:\"Bastion hosts enable secure remote access to private resources. Instead of exposing sensitive resources directly to the internet, users must first connect to the bastion host, which acts as a secure gateway. This additional layer of protection significantly reduces the risk of unauthorized access.\"}),(0,e.jsxs)(n.h3,{id:\"access-control\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#access-control\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Access Control:\"]}),(0,e.jsx)(n.p,{children:\"With bastion hosts, organizations can enforce stringent access control policies. Only authorized users with the appropriate credentials and permissions can access the bastion host. From there, they can authenticate and access other resources within the private network. This helps prevent unauthorized users from directly accessing sensitive resources.\"}),(0,e.jsxs)(n.h3,{id:\"monitoring-and-logging\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#monitoring-and-logging\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Monitoring and Logging:\"]}),(0,e.jsx)(n.p,{children:\"By channeling all access attempts through the bastion host, organizations gain effective monitoring and logging capabilities. Valuable audit trails are generated, allowing organizations to track who accessed which resources and when. These logs are invaluable for forensic analysis and investigations during security incidents.\"}),(0,e.jsxs)(n.h3,{id:\"reduced-attack-surface\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#reduced-attack-surface\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Reduced Attack Surface:\"]}),(0,e.jsx)(n.p,{children:\"Bastion hosts act as a single point of entry into the private network, effectively reducing the overall attack surface area. By limiting external access solely to the bastion host, organizations gain better control and security for their resources. This isolation mitigates the risk of direct attacks on private instances or databases.\"}),(0,e.jsxs)(n.h2,{id:\"setting-up-a-bastion-host-in-aws-using-terraform\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#setting-up-a-bastion-host-in-aws-using-terraform\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Setting up a Bastion Host in AWS Using Terraform\"]}),(0,e.jsx)(n.p,{children:\"Now, let's delve into setting up a bastion host in AWS using Terraform. We'll create an EC2 instance to serve as the bastion host, which will be located in a public subnet. Additionally, we'll create a private RDS instance to act as the target server, residing in a private subnet.\"}),(0,e.jsxs)(n.h3,{id:\"vpc\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#vpc\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"VPC\"]}),(0,e.jsxs)(n.p,{children:[\"To begin, we need create the AWS VPC, we'll define the necessary resources in our Terraform configuration file, typically named \",(0,e.jsx)(n.code,{children:\"variables.tf\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"aws_region\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"us-west-2\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// This variable is to set the\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// CIDR block for the VPC\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"vpc_cidr_block\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"CIDR block for VPC\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\"     \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.0.0/16\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"And the \",(0,e.jsx)(n.code,{children:\"main.tf\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"terraform\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"required_providers\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"aws\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"source\"}),\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"hashicorp/aws\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"~\u003e 4.16\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"required_version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\u003e= 1.2.0\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"provider\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"aws\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"region\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.aws_region\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"data \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_availability_zones\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"available\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"state\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"available\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_vpc\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2_rds_vpc\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"cidr_block\"}),\"           \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.vpc_cidr_block\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"enable_dns_hostnames\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2_rds_vpc\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Once you have the configuration file set up, run the following commands to initialize Terraform and apply the configuration:\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`terraform init\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`terraform apply\n`})]})}),(0,e.jsx)(n.p,{children:\"We may double check from the AWS console as:\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/t4_vpc_console.png\"}),(0,e.jsxs)(n.p,{children:[\"Create AWS gateway(\",(0,e.jsx)(n.code,{children:\"main.tf\"}),\"):\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_internet_gateway\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2_rds_gw\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_vpc.ec2_rds_vpc.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2_rds_gw\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"We can see the Network connections became \",(0,e.jsx)(n.strong,{children:\"1\"}),\"!\"]}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/t4_vpc_connections.png\"}),(0,e.jsxs)(n.p,{children:[\"RDS needs both public and private subnets(\",(0,e.jsx)(n.code,{children:\"variables.tf\"}),\"),\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"subnet_count\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Number of subnets\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` map(number)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"public\"}),\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"private\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"public_subnet_cidr_blocks\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Available CIDR blocks for public subnets\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` list(string)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.1.0/24\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.2.0/24\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.3.0/24\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.4.0/24\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"private_subnet_cidr_blocks\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Available CIDR blocks for private subnets\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` list(string)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.101.0/24\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.102.0/24\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.103.0/24\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"10.0.104.0/24\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Along with \",(0,e.jsx)(n.code,{children:\"main.tf\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_subnet\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_public_subnet\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"count\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.subnet_count.public\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_vpc.ec2_rds_vpc.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:'// \"10.0.1.0/24\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"cidr_block\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" var.public_subnet_cidr_blocks\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// our region is us-west-2, this should grab us-west-2a\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"availability_zone\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" data.aws_availability_zones.available.names\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"ec2rds_public_subnet_',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"count\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token type variable\",children:\"index\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_subnet\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_private_subnet\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"count\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.subnet_count.private\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_vpc.ec2_rds_vpc.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:'// \"10.0.102.0/24\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"cidr_block\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" var.private_subnet_cidr_blocks\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// our region is us-west-2, this should grab us-west-2b\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"availability_zone\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" data.aws_availability_zones.available.names\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"ec2rds_private_subnet_',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"count\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token type variable\",children:\"index\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"OK, the number of Subnets became \",(0,e.jsx)(n.strong,{children:\"3\"}),\":\"]}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/t4_subnets_number.png\"}),(0,e.jsxs)(n.p,{children:[\"The next step is to create Route Tables(\",(0,e.jsx)(n.code,{children:\"main.tf\"}),\"):\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_route_table\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_public_rt\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_vpc.ec2_rds_vpc.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"route\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:'// \"0.0.0.0/0\" means anywhere on the internet can access'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"cidr_block\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"0.0.0.0/0\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"gateway_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_internet_gateway.ec2_rds_gw.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_route_table_association\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"public\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"count\"}),\"          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.subnet_count.public\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"route_table_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_route_table.ec2rds_public_rt.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"subnet_id\"}),\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" aws_subnet.ec2rds_public_subnet\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_route_table\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_private_rt\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_vpc.ec2_rds_vpc.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// We don't need to setup `route` for private route table\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_route_table_association\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"private\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"count\"}),\"          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.subnet_count.private\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"route_table_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_route_table.ec2rds_private_rt.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"subnet_id\"}),\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" aws_subnet.ec2rds_private_subnet\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Route tables will connect the gateway if all goes well:\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/t4_routetables_connecting.png\"}),(0,e.jsxs)(n.p,{children:[\"Take a breath, we are going the setup the Security Groups now(\",(0,e.jsx)(n.code,{children:\"variables.tf\"}),\"):\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"my_ip\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"CHANGE_IT_TO_YOUR_IP\"'}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// change it to your IP!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"And \",(0,e.jsx)(n.code,{children:\"main.tf\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_security_group\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_web_sg\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_web_sg\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Security group for tutorial web servers\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_id\"}),\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_vpc.ec2_rds_vpc.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Only my IP can access port 22(SSH)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ingress\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow SSH from my computer\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"from_port\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"22\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"to_port\"}),\"     \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"22\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"protocol\"}),\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"tcp\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:'// This is using the variable \"my_ip\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"cidr_blocks\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"var\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token type variable\",children:\"my_ip\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'/32\"']}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"egress\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow all outbound traffic\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"from_port\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"to_port\"}),\"     \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"protocol\"}),\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"-1\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"cidr_blocks\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"0.0.0.0/0\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_web_sg\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_security_group\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_db_sg\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_db_sg\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Security group for tutorial databases\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_id\"}),\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_vpc.ec2_rds_vpc.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Only allow access from bastion server\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ingress\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\"     \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow MySQL traffic from only the web sg\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"from_port\"}),\"       \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"3306\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"to_port\"}),\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"3306\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"protocol\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"tcp\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"security_groups\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"aws_security_group.ec2rds_web_sg.id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_db_sg\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Well, that the security groups should look like from AWS console:\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/t4_security_groups.png\"}),(0,e.jsxs)(n.h3,{id:\"rds\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#rds\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"RDS\"]}),(0,e.jsxs)(n.p,{children:[\"RDS is simple, we need to setup DB Subnet Group(\",(0,e.jsx)(n.code,{children:\"main.tf\"}),\"):\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_db_subnet_group\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_db_subnet_group\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_db_subnet_group\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"DB subnet group for tutorial\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"subnet_ids\"}),\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"for subnet in aws_subnet.ec2rds_private_subnet : subnet.id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"The RDS' subnet group is connecting to VPC private subnets now:\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/t4_rds_subnet_group.png\"}),(0,e.jsxs)(n.p,{children:[\"Create DB(\",(0,e.jsx)(n.code,{children:\"variables.tf\"}),\"):\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"db_username\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Database master user\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\"     \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"mmuser\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"db_password\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Database master user password\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` string\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"sensitive\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"settings\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Configuration settings\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"type\"}),\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` map(any)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"database\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"allocated_storage\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// storage in gigabytes\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"engine\"}),\"              \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"mysql\"'}),\"       \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// engine type\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"engine_version\"}),\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"8.0.27\"'}),\"      \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// engine version\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"instance_class\"}),\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"db.t2.micro\"'}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// rds instance type\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"db_name\"}),\"             \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"mmdb\"'}),\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// database name\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"skip_final_snapshot\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"web_app\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"count\"}),\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\"          \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// the number of EC2 instances\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:\"instance_type\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"t2.micro\"'}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// the EC2 instance\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Together with \",(0,e.jsx)(n.code,{children:\"main.tf\"}),\":\"]}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_db_instance\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_db\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"allocated_storage\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.database.allocated_storage\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"engine\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.database.engine\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"engine_version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.database.engine_version\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:'// \"db.t2.micro\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"instance_class\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.database.instance_class\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"db_name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.database.db_name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"username\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.db_username\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"password\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.db_password\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:'// \"ec2rds_db_subnet_group\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"db_subnet_group_name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_db_subnet_group.ec2rds_db_subnet_group.name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_security_group_ids\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"aws_security_group.ec2rds_db_sg.id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"skip_final_snapshot\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.database.skip_final_snapshot\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"And here's the DB:\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/t4_rds_success.png\"}),(0,e.jsxs)(n.h3,{id:\"ec2\",children:[(0,e.jsx)(n.a,{\"aria-hidden\":\"true\",href:\"#ec2\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"EC2\"]}),(0,e.jsx)(n.p,{children:\"Just to demo, we use terraform to generate key pair:\"}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"variable\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"key_name\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_key\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"tls_private_key\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"example\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"algorithm\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"RSA\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"rsa_bits\"}),\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4096\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_key_pair\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"generated_key\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"key_name\"}),\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.key_name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"public_key\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` tls_private_key.example.public_key_openssh\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"And trigger it:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`terraform output -raw private_key \u003e key.pem\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`chmod 400 key.pem\n`})]})}),(0,e.jsx)(n.p,{children:\"Then we will create EC2 instance and Elastic IP:\"}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"language-hcl code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_instance\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_web\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"count\"}),\"                  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.web_app.count\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"ami\"}),\"                    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ami-0735c191cf914754d\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"instance_type\"}),\"          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.web_app.instance_type\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"subnet_id\"}),\"              \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" aws_subnet.ec2rds_public_subnet\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"key_name\"}),\"               \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_key_pair.generated_key.key_name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc_security_group_ids\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"aws_security_group.ec2rds_web_sg.id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"ec2rds_web_',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"count\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token type variable\",children:\"index\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_eip\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ec2rds_web_eip\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"count\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` var.settings.web_app.count\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"instance\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" aws_instance.ec2rds_web\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"count.index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"vpc\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"ec2rds_web_eip_',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"count\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token type variable\",children:\"index\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"web_public_ip\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"The public IP address of the web server\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"       \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" aws_eip.ec2rds_web_eip\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`.public_ip\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"depends_on\"}),\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"aws_eip.ec2rds_web_eip\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"web_public_dns\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"The public DNS address of the web server\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"       \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" aws_eip.ec2rds_web_eip\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`.public_dns\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"depends_on\"}),\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"aws_eip.ec2rds_web_eip\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"database_endpoint\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"The endpoint of the database\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"       \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_db_instance.ec2rds_db.address\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"database_port\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"The port of the database\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"       \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_db_instance.ec2rds_db.port\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"We will get the information by the output:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`Outputs:\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`database_endpoint = \"terraform-20230415125733155100000002.cji0cptoqdd8.us-west-2.rds.amazonaws.com\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`database_port = 3306\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`private_key = \u003csensitive\u003e\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`web_public_dns = \"ec2-44-228-83-13.us-west-2.compute.amazonaws.com\"\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`web_public_ip = \"44.228.83.13\"\n`})]})}),(0,e.jsx)(n.p,{children:\"Login the bastion server by:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`ssh -i \"key.pem\" ubuntu@44.228.83.13\n`})})}),(0,e.jsx)(n.p,{children:\"Access RDS from bastion server:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`sudo apt-get update -y \u0026\u0026 sudo apt install mysql-client -y\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`mysql -h terraform-20230415125733155100000002.cji0cptoqdd8.us-west-2.rds.amazonaws.com -P 3306 -u mmuser -p\n`})]})}),(0,e.jsx)(n.p,{children:\"OK, now we will show the DB:\"}),(0,e.jsx)(n.pre,{children:(0,e.jsxs)(n.code,{className:\"code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`mysql\u003e show DATABASES;\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+--------------------+\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`| Database           |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+--------------------+\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`| information_schema |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`| mmdb               |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`| mysql              |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`| performance_schema |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`| sys                |\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`+--------------------+\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`5 rows in set (0.00 sec)\n`})]})}),(0,e.jsxs)(n.p,{children:[\"WOW~ \",(0,e.jsx)(n.code,{children:\"mmdb\"}),\" in it!\"]}),(0,e.jsx)(n.p,{children:\"By incorporating bastion hosts into your cloud infrastructure and leveraging the power of Terraform for automation, you can establish a secure and controlled access mechanism to safeguard your sensitive resources in the cloud. With the increasing adoption of cloud computing and the rising importance of security, bastion hosts are an essential component of any robust cloud security strategy. So, embrace the power of bastion hosts and fortify your cloud environment today.\"})]})}}var w=_;function v(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return f;})();\n;return Component;","toc":[{"value":"A Note from the Future (Reviewed in 2025)","url":"#a-note-from-the-future-reviewed-in-2025","depth":2},{"value":"Editor's Note: The original 2023 article begins below.","url":"#editors-note-the-original-2023-article-begins-below","depth":1},{"value":"So, what Exactly is a Bastion Host?","url":"#so-what-exactly-is-a-bastion-host","depth":2},{"value":"The Crucial Role of Bastion Hosts in Cloud Security","url":"#the-crucial-role-of-bastion-hosts-in-cloud-security","depth":2},{"value":"Secure Remote Access:","url":"#secure-remote-access","depth":3},{"value":"Access Control:","url":"#access-control","depth":3},{"value":"Monitoring and Logging:","url":"#monitoring-and-logging","depth":3},{"value":"Reduced Attack Surface:","url":"#reduced-attack-surface","depth":3},{"value":"Setting up a Bastion Host in AWS Using Terraform","url":"#setting-up-a-bastion-host-in-aws-using-terraform","depth":2},{"value":"VPC","url":"#vpc","depth":3},{"value":"RDS","url":"#rds","depth":3},{"value":"EC2","url":"#ec2","depth":3}],"frontMatter":{"readingTime":{"text":"14 min read","minutes":13.66,"time":819600,"words":2732},"slug":"terraform/terraform_sec_4_bastion","fileName":"terraform/terraform_sec_4_bastion.md","title":"Bastion Hosts: Safeguarding Your Cloud Resources","date":"2023-06-26T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"Discover the significance of bastion hosts in cloud security and learn how to set up a secure gateway using Terraform in AWS, ensuring protection for private resources while reducing the attack surface area."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"ABAC and RBAC: A Journey with Terraform and AWS Tagged Resources","date":"2023-05-16T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"Exploring the nuances of Attribute-based Access Control (ABAC) and Role-based Access Control (RBAC) in cloud security using Terraform, and understanding their strategic implementation in managing AWS tagged resources.","slug":"terraform/terraform_sec_3_abac"},"next":{"title":"InfoSec architect 101-Service account from prehistory","date":"2025-07-01T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"Service accounts may sound boring, but they’re the unsung heroes of secure automation. In this post, we time-travel back to the prehistoric age of Windows domains to see how service accounts and Kerberos work together to avoid hardcoded passwords and security nightmares.","images":[],"slug":"service-account-1"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["terraform","terraform_sec_4_bastion"]},"buildId":"Y0yMeFuQcZiOOzLcfYDBY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>