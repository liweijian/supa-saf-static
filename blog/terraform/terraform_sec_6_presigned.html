<!DOCTYPE html><html lang="en" class="scroll-smooth"><head><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><meta content="width=device-width, initial-scale=1" name="viewport"/><title>Stop Making Your S3 Buckets Public! A Guide to Presigned URLs</title><meta name="robots" content="follow, index"/><meta name="description" content="Learn how to use S3 Presigned URLs to securely share private files without ever making your bucket public."/><meta property="og:url" content="https://www.supasaf.com/blog/terraform/terraform_sec_6_presigned"/><meta property="og:type" content="article"/><meta property="og:site_name" content="Cybersecurity, Cloud and Compiler"/><meta property="og:description" content="Learn how to use S3 Presigned URLs to securely share private files without ever making your bucket public."/><meta property="og:title" content="Stop Making Your S3 Buckets Public! A Guide to Presigned URLs"/><meta property="og:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site"/><meta name="twitter:title" content="Stop Making Your S3 Buckets Public! A Guide to Presigned URLs"/><meta name="twitter:description" content="Learn how to use S3 Presigned URLs to securely share private files without ever making your bucket public."/><meta name="twitter:image" content="https://www.supasaf.com/static/images/twitter-card.png"/><link rel="canonical" href="https://www.supasaf.com/blog/terraform/terraform_sec_6_presigned"/><meta property="article:published_time" content="2025-11-15T00:00:00.000Z"/><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.supasaf.com/blog/terraform/terraform_sec_6_presigned"
  },
  "headline": "Stop Making Your S3 Buckets Public! A Guide to Presigned URLs",
  "image": [
    {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/twitter-card.png"
    }
  ],
  "datePublished": "2025-11-15T00:00:00.000Z",
  "dateModified": "2025-11-15T00:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Ted"
    }
  ],
  "publisher": {
    "@type": "Organization",
    "name": "Supa Safe",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.supasaf.com/static/images/logo2.png"
    }
  },
  "description": "Learn how to use S3 Presigned URLs to securely share private files without ever making your bucket public."
}</script><meta name="next-head-count" content="20"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><link rel="preload" href="/_next/static/css/52032488e305abd8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/52032488e305abd8.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-7bf052786ac70438.js" defer=""></script><script src="/_next/static/chunks/main-80446c6fe86f961e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c8c0eb7eb758c19d.js" defer=""></script><script src="/_next/static/chunks/410-35c4fb535edd9439.js" defer=""></script><script src="/_next/static/chunks/1-53b2bdc23927c90b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-0728882d0f489132.js" defer=""></script><script src="/_next/static/PHX-ldckUn2p0ORkOJq2c/_buildManifest.js" defer=""></script><script src="/_next/static/PHX-ldckUn2p0ORkOJq2c/_ssgManifest.js" defer=""></script><script src="/_next/static/PHX-ldckUn2p0ORkOJq2c/_middlewareManifest.js" defer=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-900 dark:text-white"><div id="__next" data-reactroot=""><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between"><header class="flex items-center justify-between py-10"><div><a aria-label="Supa Safe" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><g stroke-width="1.5" fill="none"><path stroke="#93a3a9" vector-effect="non-scaling-stroke" d="M255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95"></path><path stroke="#3b777e" vector-effect="non-scaling-stroke" d="M255.83 59.14q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41"></path><path stroke="#a7d3d4" vector-effect="non-scaling-stroke" d="M202.69 315.81q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="M195.06 187.52q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16"></path><path stroke="#93a3aa" vector-effect="non-scaling-stroke" d="m250.65 258.4-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0"></path></g><path fill="#fffefe" d="M0 0h512v512H0V0Zm255.59 32.64q-1.42-.7-3.54-1.73a1.5 1.49-45.2 0 0-1.32.01q-50.57 24.94-105.46 35.16Q99.16 74.67 52.7 75a.96.95-89.7 0 0-.95.95q-.16 35.05.24 69.05.56 47.23 9.78 93.54 22.44 112.62 103.44 192.11 7.03 6.89 14.68 13.57 32.68 28.51 70.66 50.1a1.23 1.23-45.1 0 0 1.24 0q40.62-23.16 75.25-54.53Q412.88 362.01 438 248.5q10.21-46.13 12.25-95.75.57-13.88.19-77.19a.51.5-89.4 0 0-.49-.51q-52.56-.84-96.7-10.05-28.79-6.01-56.65-15.41-21.08-7.11-41.01-16.95Z"></path><path fill="#274754" d="M255.59 32.64q19.93 9.84 41.01 16.95 27.86 9.4 56.65 15.41 44.14 9.21 96.7 10.05a.51.5-89.4 0 1 .49.51q.38 63.31-.19 77.19-2.04 49.62-12.25 95.75-25.12 113.51-110.96 191.29-34.63 31.37-75.25 54.53a1.23 1.23-44.4 0 1-1.24 0q-37.98-21.59-70.66-50.1-7.65-6.68-14.68-13.57-81-79.49-103.44-192.11-9.22-46.31-9.78-93.54-.4-34-.24-69.05a.96.95-89.7 0 1 .95-.95q46.46-.33 92.57-8.92 54.89-10.22 105.46-35.16a1.5 1.49-45.2 0 1 1.32-.01q2.12 1.03 3.54 1.73Zm.24 26.5q-2.08-.89-3.82-1.68a2.11 2.1 45.2 0 0-1.72-.01q-39.78 17.64-81.04 27.05Q122.6 95.15 74.8 97.54a.53.51 88.9 0 0-.49.53q-.09 23.34-.07 46.68.01 11.6.53 19.99 2.46 39.82 11.48 80.26 11.03 49.46 34.97 92.77 21.15 38.27 51.8 69.46 34.34 34.95 77.32 60.62a1.3 1.3 90 0 0 1.32 0q43.02-25.62 77.21-60.73 64.32-66.08 85.64-156.07 9.17-38.71 12.3-78.32.7-8.83 1-19.97.75-26.89.43-54.51a.73.72-89.2 0 0-.69-.72q-55.89-2.9-109.45-16.98-31.93-8.4-62.27-21.41Z"></path><path fill="#4ea7a8" d="M255.83 59.14q30.34 13.01 62.27 21.41 53.56 14.08 109.45 16.98a.73.72-89.2 0 1 .69.72q.32 27.62-.43 54.51-.3 11.14-1 19.97-3.13 39.61-12.3 78.32-21.32 89.99-85.64 156.07-34.19 35.11-77.21 60.73a1.3 1.3-90 0 1-1.32 0q-42.98-25.67-77.32-60.62-30.65-31.19-51.8-69.46Q97.28 294.46 86.25 245q-9.02-40.44-11.48-80.26-.52-8.39-.53-19.99-.02-23.34.07-46.68a.53.51 88.9 0 1 .49-.53q47.8-2.39 94.45-13.04 41.26-9.41 81.04-27.05a2.11 2.1 45.2 0 1 1.72.01q1.74.79 3.82 1.68Zm-53.14 256.67q19.99 18.66 48.13 35.43a.83.83 90 0 0 .86 0q21.29-12.65 40.29-28.42 9.61-7.98 14.13-14.06 11.65-15.69 11.65-35.76v-90.98a.52.52 90 0 0-.52-.52l-132.42.06a.5.49 0 0 0-.5.49q.32 45.48.38 90.95.03 26.05 18 42.81Z"></path><path fill="#fff" d="M202.69 315.81q-17.97-16.76-18-42.81-.06-45.47-.38-90.95a.5.49 0 0 1 .5-.49l132.42-.06a.52.52-90 0 1 .52.52V273q0 20.07-11.65 35.76-4.52 6.08-14.13 14.06-19 15.77-40.29 28.42a.83.83-90 0 1-.86 0q-28.14-16.77-48.13-35.43Zm-7.63-128.29q-1.81-.09-4.01.03a.59.58 88.5 0 0-.55.59v71.12q0 16.12.49 19.97 2.71 21.36 19.85 35.93 18.84 16.01 39.98 28.83a.83.83 90 0 0 .86 0q19.76-11.9 38.88-27.93 20.76-17.39 20.83-44.56.11-41.38.11-83.55a.45.45 45 0 0-.45-.45q-55.89-.11-111.98.18-.5 0-4.01-.16Z"></path><path fill="#274654" d="M199.07 187.68q56.09-.29 111.98-.18a.45.45 45 0 1 .45.45q0 42.17-.11 83.55-.07 27.17-20.83 44.56-19.12 16.03-38.88 27.93a.83.83-90 0 1-.86 0q-21.14-12.82-39.98-28.83-17.14-14.57-19.85-35.93-.49-3.85-.49-19.97v-71.12a.59.58 88.5 0 1 .55-.59q2.2-.12 4.01-.03 3.51.16 4.01.16Zm51.58 70.72-41.2-40.58q-.68-.67-.69.29l-.26 27.64a1.18 1.16-67.2 0 0 .34.85l41.72 41.83a.63.62-44.7 0 0 .89 0l41.45-41.58a1.28 1.17 69.8 0 0 .35-.85l.19-27.82q.01-1.24-.87-.38l-41.21 40.6a.51.5-44.6 0 1-.71 0Z"></path><path fill="#fff" d="m251.36 258.4 41.21-40.6q.88-.86.87.38l-.19 27.82a1.28 1.17 69.8 0 1-.35.85l-41.45 41.58a.63.62-44.7 0 1-.89 0l-41.72-41.83a1.18 1.16-67.2 0 1-.34-.85l.26-27.64q.01-.96.69-.29l41.2 40.58a.51.5-44.6 0 0 .71 0Z"></path></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Supa Safe</div></div></a></div><div class="flex items-center text-base leading-5"><div class="hidden sm:block"><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/blog">Blog</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/tags">Tags</a><a class="p-1 font-medium text-gray-900 dark:text-gray-100 sm:p-4" href="/about">About</a></div><button aria-label="Toggle Dark Mode" type="button" class="ml-1 mr-1 h-8 w-8 rounded p-1 sm:ml-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><div class="sm:hidden"><button type="button" class="ml-1 mr-1 h-8 w-8 rounded py-1" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><div class="fixed top-0 left-0 z-10 h-full w-full transform bg-gray-200 opacity-95 duration-300 ease-in-out dark:bg-gray-800 translate-x-full"><div class="flex justify-end"><button type="button" class="mr-5 mt-11 h-8 w-8 rounded" aria-label="Toggle Menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="text-gray-900 dark:text-gray-100"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><nav class="fixed mt-8 h-full"><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/blog">Blog</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/tags">Tags</a></div><div class="px-12 py-4"><a class="text-2xl font-bold tracking-widest text-gray-900 dark:text-gray-100" href="/about">About</a></div></nav></div></div></div></header><main class="mb-auto"><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" type="button" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-6 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2025-11-15T00:00:00.000Z">Saturday, November 15, 2025</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Stop Making Your S3 Buckets Public! A Guide to Presigned URLs</h1></div></div></header><div class="divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0" style="grid-template-rows:auto 1fr"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center space-x-8 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/avatar.jpg" width="38px" height="38px" alt="avatar" class="h-10 w-10 rounded-full"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Ted</dd><dt class="sr-only">Twitter</dt><dd><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/supasaf" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">@supasaf</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pt-10 pb-8 dark:prose-dark"><p>A developer needs to share a file from cloud storage. What do they do? They go to the S3 console, click &quot;Properties,&quot; &quot;Permissions,&quot; and set the bucket to... &quot;<strong>Public</strong>&quot;.</p><p>As a security guy, this is the moment my eye starts to twitch uncontrollably.</p><p>Making a bucket &quot;public&quot; is the cloud equivalent of leaving your house keys taped to the front door with a giant &quot;COME ON IN!&quot; sign. It&#x27;s a &quot;Resume-Generating Event,&quot; as in, you&#x27;ll need to update your resume after you get fired.</p><p>The other day at work, I ran into a classic version of this problem. Algorithm team has a new service (on Tencent Cloud, actually) that generates an image. This image needs to be seen by our end user, maybe internal staff or maybe even an external partner.</p><p>So, how do you let someone access one file in a private bucket, just one time, without giving them the keys to the entire kingdom?</p><p>The answer is simple and beautiful: <a target="_blank" rel="noopener noreferrer" href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/ShareObjectPreSignedURL.html">Presigned URLs</a>.</p><p>To prove how cool this is, I decided to build a minimal demo from scratch using my AWS Free Tier. (Hey, you gotta keep your hands dirty, right?)</p><h2 id="what-the-heck-is-an-s3-presigned-url"><a href="#what-the-heck-is-an-s3-presigned-url" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What the Heck is an S3 Presigned URL?</h2><p>Think of it like a magical, single-use, self-destructing ticket to a VIP club.</p><ul><li><strong>The Club (Your S3 Bucket)</strong>: Is 100% private. The bouncer (AWS) checks everyone at the door.</li><li><strong>The Ticket (The Presigned URL)</strong>: You (a trusted IAM identity) generate this special ticket. It has a cryptographic signature baked right into the URL query string.</li><li><strong>The Rules</strong>: The signature basically tells the bouncer: &quot;This person is with me. Let them <strong>GET</strong> the file <code>order-123.jpg</code>... but <strong>only for the next 5 minutes</strong>.&quot;</li></ul><p>After 5 minutes, that URL is just a useless string of text (it gives a 403 Access Denied error).</p><p>In another words, your S3 bucket stays 100% private. (No, really. Don&#x27;t you dare touch that public access block.)</p><p>You never share your permanent Access Keys. The signature in the URL is temporary.</p><p>Access is temporary. You set the expiration. 60 seconds? 10 minutes? You&#x27;re the boss.</p><p>Access is specific. This URL might only work for a GET (download) or a PUT (upload), and only for one specific file.</p><h2 id="building-the-fortress-with-terraform"><a href="#building-the-fortress-with-terraform" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Building the Fortress (with Terraform)</h2><p>In the modern cloud world, we don&#x27;t &quot;click around in the console.&quot; That&#x27;s called &quot;ClickOps,&quot; and it&#x27;s how mistakes happen. We use Infrastructure as Code (IaC) to build our environment so it&#x27;s repeatable and secure.</p><p>Here’s my main.tf script to build a fortress-like S3 setup.</p><div class="relative"><pre><code class="code-highlight language-hcl"><span class="code-line"><span class="token keyword">terraform</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">required_providers</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">aws</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">source</span>  <span class="token punctuation">=</span> <span class="token string">&quot;hashicorp/aws&quot;</span>
</span><span class="code-line">      <span class="token property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;~&gt; 5.0&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">provider<span class="token type variable"> &quot;aws&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">region</span> <span class="token punctuation">=</span> <span class="token string">&quot;us-east-1&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Generate a random suffix to keep the bucket name unique</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;random_id&quot;</span></span> <span class="token string">&quot;suffix&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">byte_length</span> <span class="token punctuation">=</span> <span class="token number">4</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create the S3 bucket</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_s3_bucket&quot;</span></span> <span class="token string">&quot;demo_bucket&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">bucket</span>        <span class="token punctuation">=</span> <span class="token string">&quot;presigned-demo-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>random_id<span class="token punctuation">.</span>suffix<span class="token punctuation">.</span>hex<span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">force_destroy</span> <span class="token punctuation">=</span> <span class="token boolean">true</span> <span class="token comment"># Good for demos, NOT for prod!</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Purpose</span> <span class="token punctuation">=</span> <span class="token string">&quot;PresignedURLDemo&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># BLOCK ALL PUBLIC ACCESS. This is the most important part.</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_s3_bucket_public_access_block&quot;</span></span> <span class="token string">&quot;demo_block&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">bucket</span> <span class="token punctuation">=</span> aws_s3_bucket.demo_bucket.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">block_public_acls</span>       <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line">  <span class="token property">block_public_policy</span>     <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line">  <span class="token property">ignore_public_acls</span>      <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line">  <span class="token property">restrict_public_buckets</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Enable server-side encryption by default</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_s3_bucket_server_side_encryption_configuration&quot;</span></span> <span class="token string">&quot;demo_encryption&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">bucket</span> <span class="token punctuation">=</span> aws_s3_bucket.demo_bucket.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">rule</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">apply_server_side_encryption_by_default</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">sse_algorithm</span> <span class="token punctuation">=</span> <span class="token string">&quot;AES256&quot;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Enable versioning (good practice)</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_s3_bucket_versioning&quot;</span></span> <span class="token string">&quot;demo_versioning&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">bucket</span> <span class="token punctuation">=</span> aws_s3_bucket.demo_bucket.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">versioning_configuration</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">status</span> <span class="token punctuation">=</span> <span class="token string">&quot;Enabled&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Add a lifecycle rule to delete demo files after 7 days</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_s3_bucket_lifecycle_configuration&quot;</span></span> <span class="token string">&quot;demo_lifecycle&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">bucket</span> <span class="token punctuation">=</span> aws_s3_bucket.demo_bucket.id
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">rule</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">id</span>     <span class="token punctuation">=</span> <span class="token string">&quot;delete-after-7-days&quot;</span>
</span><span class="code-line">    <span class="token property">status</span> <span class="token punctuation">=</span> <span class="token string">&quot;Enabled&quot;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">filter</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">prefix</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>  <span class="token comment"># Apply to all objects</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">expiration</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token property">days</span> <span class="token punctuation">=</span> <span class="token number">7</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create an IAM user (for demo purposes)</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_user&quot;</span></span> <span class="token string">&quot;presigned_user&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;presigned-demo-user-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>random_id<span class="token punctuation">.</span>suffix<span class="token punctuation">.</span>hex<span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Purpose</span> <span class="token punctuation">=</span> <span class="token string">&quot;PresignedURLDemo&quot;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create a minimal IAM policy</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_policy&quot;</span></span> <span class="token string">&quot;presigned_policy&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">name</span>        <span class="token punctuation">=</span> <span class="token string">&quot;presigned-demo-policy-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>random_id<span class="token punctuation">.</span>suffix<span class="token punctuation">.</span>hex<span class="token punctuation">}</span></span>&quot;</span>
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Allow minimal S3 access for presigned URL demo&quot;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token property">policy</span> <span class="token punctuation">=</span> jsonencode(<span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token property">Version</span> <span class="token punctuation">=</span> <span class="token string">&quot;2012-10-17&quot;</span>
</span><span class="code-line">    <span class="token property">Statement</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Effect</span> <span class="token punctuation">=</span> <span class="token string">&quot;Allow&quot;</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token string">&quot;s3:GetObject&quot;</span>,
</span><span class="code-line">          <span class="token string">&quot;s3:PutObject&quot;</span>
</span><span class="code-line">        <span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token property">Resource</span> <span class="token punctuation">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>aws_s3_bucket<span class="token punctuation">.</span>demo_bucket<span class="token punctuation">.</span>arn<span class="token punctuation">}</span></span>/*&quot;</span> <span class="token comment"># Only on objects</span>
</span><span class="code-line">      <span class="token punctuation">}</span>,
</span><span class="code-line">      <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token property">Effect</span> <span class="token punctuation">=</span> <span class="token string">&quot;Allow&quot;</span>
</span><span class="code-line">        <span class="token property">Action</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">          <span class="token string">&quot;s3:ListBucket&quot;</span>
</span><span class="code-line">        <span class="token punctuation">]</span>
</span><span class="code-line">        <span class="token property">Resource</span> <span class="token punctuation">=</span> aws_s3_bucket.demo_bucket.arn <span class="token comment"># Only on the bucket itself</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">}</span>)
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Attach the policy to the user</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_user_policy_attachment&quot;</span></span> <span class="token string">&quot;attach_policy&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">user</span>       <span class="token punctuation">=</span> aws_iam_user.presigned_user.name
</span><span class="code-line">  <span class="token property">policy_arn</span> <span class="token punctuation">=</span> aws_iam_policy.presigned_policy.arn
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Create access keys for the demo user</span>
</span><span class="code-line"><span class="token keyword">resource <span class="token type variable">&quot;aws_iam_access_key&quot;</span></span> <span class="token string">&quot;demo_key&quot;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">user</span> <span class="token punctuation">=</span> aws_iam_user.presigned_user.name
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># --- Outputs ---</span>
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;bucket_name&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_s3_bucket.demo_bucket.bucket
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;S3 bucket name&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;bucket_region&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_s3_bucket.demo_bucket.region
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;S3 bucket region&quot;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;access_key_id&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_iam_access_key.demo_key.id
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;AWS Access Key ID&quot;</span>
</span><span class="code-line">  <span class="token property">sensitive</span>   <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">output<span class="token type variable"> &quot;secret_access_key&quot; </span></span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">value</span>       <span class="token punctuation">=</span> aws_iam_access_key.demo_key.secret
</span><span class="code-line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;AWS Secret Access Key&quot;</span>
</span><span class="code-line">  <span class="token property">sensitive</span>   <span class="token punctuation">=</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>I run terraform apply, and poof! My environment is ready. Look at that beautiful, private, encrypted, and locked-down setup.</p><img width="600" src="/static/images/terraform/s3_t_1.png"/><img width="600" src="/static/images/terraform/s3_t_2.png"/><img width="600" src="/static/images/terraform/s3_t_3.png"/><img width="600" src="/static/images/terraform/s3_t_4.png"/><img width="600" src="/static/images/terraform/s3_t_5.png"/><h2 id="the-secret-handshake-with-python"><a href="#the-secret-handshake-with-python" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>The &quot;Secret Handshake&quot; (with Python)</h2><p>Okay, the fortress is built. Now I need to simulate the real business logic. I&#x27;ll use Python and the boto3 library.</p><p>The script will do two things:</p><ol><li><p>Act 1 (Simulate the &quot;<strong>Algorithm Team</strong>&quot;): Generate a presigned URL to <strong>UPLOAD</strong> a file (PUT).</p></li><li><p>Act 2 (Simulate the &quot;<strong>End User</strong>&quot;): Generate a presigned URL to <strong>DOWNLOAD</strong> that file (GET).</p></li></ol><div class="relative"><pre><code class="code-highlight language-python"><span class="code-line"><span class="token comment">#!/usr/bin/env python3</span>
</span><span class="code-line"><span class="token string triple-quoted-string">&quot;&quot;&quot;
</span></span><span class="code-line"><span class="token string triple-quoted-string">Simple S3 Presigned URL Demo
</span></span><span class="code-line"><span class="token string triple-quoted-string">Upload and download files using presigned URLs
</span></span><span class="code-line"><span class="token string triple-quoted-string">&quot;&quot;&quot;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> boto3
</span><span class="code-line"><span class="token keyword">import</span> requests
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># ========================================</span>
</span><span class="code-line"><span class="token comment"># Configuration - Replace with your values</span>
</span><span class="code-line"><span class="token comment"># ========================================</span>
</span><span class="code-line">BUCKET_NAME <span class="token operator">=</span> <span class="token string">&quot;presigned-demo-dd12e798&quot;</span> <span class="token comment"># I got this from my terraform output</span>
</span><span class="code-line">REGION <span class="token operator">=</span> <span class="token string">&quot;us-east-1&quot;</span>
</span><span class="code-line">LOCAL_FILE <span class="token operator">=</span> <span class="token string">&quot;ud.jpg&quot;</span> <span class="token comment"># A test image I have</span>
</span><span class="code-line">OBJECT_KEY <span class="token operator">=</span> <span class="token string">&quot;ud.jpg&quot;</span> <span class="token comment"># The name it will have in S3</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># ========================================</span>
</span><span class="code-line"><span class="token comment"># Main Demo</span>
</span><span class="code-line"><span class="token comment"># ========================================</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;=== S3 Presigned URL Demo ===\n&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># Create S3 client</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Creating S3 client for region: </span><span class="token interpolation"><span class="token punctuation">{</span>REGION<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token comment"># Boto3 will find the keys from my ~/.aws/credentials file</span>
</span><span class="code-line">    s3_client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">&#x27;s3&#x27;</span><span class="token punctuation">,</span> region_name<span class="token operator">=</span>REGION<span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># Step 1: Generate presigned URL for upload (PUT)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n1. Generating presigned URL for upload (expires in 600 seconds)...&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    upload_url <span class="token operator">=</span> s3_client<span class="token punctuation">.</span>generate_presigned_url<span class="token punctuation">(</span>
</span><span class="code-line">        ClientMethod<span class="token operator">=</span><span class="token string">&#x27;put_object&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        Params<span class="token operator">=</span><span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token string">&#x27;Bucket&#x27;</span><span class="token punctuation">:</span> BUCKET_NAME<span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&#x27;Key&#x27;</span><span class="token punctuation">:</span> OBJECT_KEY<span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&#x27;ContentType&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;image/jpeg&#x27;</span> <span class="token comment"># Important for uploads!</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">        ExpiresIn<span class="token operator">=</span><span class="token number">600</span> <span class="token comment"># 10 minutes</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   Upload URL: </span><span class="token interpolation"><span class="token punctuation">{</span>upload_url<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">80]</span><span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># Step 2: Upload file using presigned URL</span>
</span><span class="code-line">    <span class="token comment"># We use &#x27;requests&#x27; here to act like a client that does NOT have AWS keys</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n2. Uploading </span><span class="token interpolation"><span class="token punctuation">{</span>LOCAL_FILE<span class="token punctuation">}</span></span><span class="token string"> using presigned URL...&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>LOCAL_FILE<span class="token punctuation">,</span> <span class="token string">&#x27;rb&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
</span><span class="code-line">        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>put<span class="token punctuation">(</span>
</span><span class="code-line">            upload_url<span class="token punctuation">,</span>
</span><span class="code-line">            data<span class="token operator">=</span>f<span class="token punctuation">,</span>
</span><span class="code-line">            headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#x27;Content-Type&#x27;</span><span class="token punctuation">:</span> <span class="token string">&#x27;image/jpeg&#x27;</span><span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ Upload successful!&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ Upload failed: </span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   Error: </span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># Step 3: Generate presigned URL for download (GET)</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n3. Generating presigned URL for download (expires in 300 seconds)...&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    download_url <span class="token operator">=</span> s3_client<span class="token punctuation">.</span>generate_presigned_url<span class="token punctuation">(</span>
</span><span class="code-line">        ClientMethod<span class="token operator">=</span><span class="token string">&#x27;get_object&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">        Params<span class="token operator">=</span><span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token string">&#x27;Bucket&#x27;</span><span class="token punctuation">:</span> BUCKET_NAME<span class="token punctuation">,</span>
</span><span class="code-line">            <span class="token string">&#x27;Key&#x27;</span><span class="token punctuation">:</span> OBJECT_KEY
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">        ExpiresIn<span class="token operator">=</span><span class="token number">300</span> <span class="token comment"># 5 minutes</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">  _   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   Download URL: </span><span class="token interpolation"><span class="token punctuation">{</span>download_url<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">80]</span><span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># Step 4: Download file using presigned URL</span>
</span><span class="code-line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\n4. Downloading file using presigned URL...&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>download_url<span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
</span><span class="code-line">        output_file <span class="token operator">=</span> <span class="token string">&quot;downloaded_ud.jpg&quot;</span>
</span><span class="code-line">        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>output_file<span class="token punctuation">,</span> <span class="token string">&#x27;wb&#x27;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
</span><span class="code-line">            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✓ Download successful!&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   File saved as: </span><span class="token interpolation"><span class="token punctuation">{</span>output_file<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   File size: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> bytes&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;   ✗ Download failed: </span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
</span><span class="code-line">    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre></div><p>And look at the result! It just works.</p><div class="relative"><pre><code class="code-highlight language-bash"><span class="code-line"><span class="token punctuation">(</span>base<span class="token punctuation">)</span> ss@ss:~/s3_1113$ python3 demo.py
</span><span class="code-line"><span class="token operator">==</span><span class="token operator">=</span> S3 Presigned URL Demo <span class="token operator">==</span><span class="token operator">=</span>
</span><span class="code-line">
</span><span class="code-line">Creating S3 client <span class="token keyword">for</span> region: us-east-1
</span><span class="code-line">
</span><span class="code-line"><span class="token number">1</span>. Generating presigned URL <span class="token keyword">for</span> upload <span class="token punctuation">(</span>expires <span class="token keyword">in</span> <span class="token number">600</span> seconds<span class="token punctuation">)</span><span class="token punctuation">..</span>.
</span><span class="code-line">   Upload URL: https://presigned-demo-dd12e798.s3.amazonaws.com/ud.jpg?AWSAccessKeyId<span class="token operator">=</span>AKIAXDJLS<span class="token punctuation">..</span>.
</span><span class="code-line">
</span><span class="code-line"><span class="token number">2</span>. Uploading ud.jpg using presigned URL<span class="token punctuation">..</span>.
</span><span class="code-line">   ✓ Upload successful<span class="token operator">!</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token number">3</span>. Generating presigned URL <span class="token keyword">for</span> download <span class="token punctuation">(</span>expires <span class="token keyword">in</span> <span class="token number">300</span> seconds<span class="token punctuation">)</span><span class="token punctuation">..</span>.
</span><span class="code-line">   Download URL: https://presigned-demo-dd12e798.s3.amazonaws.com/ud.jpg?AWSAccessKeyId<span class="token operator">=</span>AKIAXDJLS<span class="token punctuation">..</span>.
</span><span class="code-line">
</span><span class="code-line"><span class="token number">4</span>. Downloading <span class="token function">file</span> using presigned URL<span class="token punctuation">..</span>.
</span><span class="code-line">   ✓ Download successful<span class="token operator">!</span>
</span><span class="code-line">   File saved as: downloaded_ud.jpg
</span><span class="code-line">   File size: <span class="token number">65049</span> bytes
</span></code></pre></div><p>The requests library, which has zero idea about my AWS keys, was able to both upload and download a file to my 100% private S3 bucket. That&#x27;s the magic.</p><h2 id="ok-but-how-do-you-do-this-in-production"><a href="#ok-but-how-do-you-do-this-in-production" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>OK, But How Do You Do This in Production?</h2><p>My demo was great, but I used a long-term <strong>IAM User</strong> key (aws_iam_access_key) stored on my laptop.</p><p>In a real production environment... <strong>NEVER DO THIS</strong>.</p><p>Storing static, long-lived access keys in your application code is a massive security risk. If those keys ever leak, a hacker has a permanent key to your S3 bucket.</p><p>In a real, &quot;grown-up&quot; architecture, you use a &quot;<strong>Signing Service</strong>&quot; pattern.</p><ol><li><strong>Create a dedicated AWS Lambda function</strong>. Its only job is to generate these presigned URLs. Let&#x27;s call it the &quot;URL-Signing-Guy.&quot;</li><li><strong>Give the Lambda an IAM Role (not a User!)</strong>. This role is a temporary identity that the Lambda &quot;wears&quot; when it runs. This role has a very strict policy: <code>s3:GetObject</code> and <code>s3:PutObject</code> only for your specific bucket.</li><li><strong>Put an API Gateway in front of the Lambda</strong>. Your main application (the algorithm service) doesn&#x27;t call S3 directly. It calls your own secure API endpoint (e.g., POST <code>/api/v1/get-upload-url</code>).</li><li><strong>Strengthen the S3 Bucket Policy</strong>. This is the expert-level move. You add a Bucket Policy to S3 that says: &quot;I will only accept GetObject or PutObject requests IF they come from the &#x27;URL-Signing-Guy&#x27; Lambda&#x27;s IAM Role.&quot;</li></ol></div><div id="comment"></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/terraform">Terraform</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/cloud">Cloud</a><a class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/tags/aws">AWS</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/general/kerberos_ldap">InfoSec Architect 102-Service Accounts in the Linux Universe</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400" href="/blog">← Back to the blog</a></div></footer></div></div></article></div></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Supa Safe</div><div> • </div><div>© 2025</div><div> • </div><a href="/">Cybersecurity, Cloud and Compiler</a></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"mdxSource":"var Component=(()=\u003e{var d=Object.create;var i=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var t=a=\u003ei(a,\"__esModule\",{value:!0});var N=(a,s)=\u003e()=\u003e(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=\u003e{t(a);for(var c in s)i(a,c,{get:s[c],enumerable:!0})},g=(a,s,c)=\u003e{if(s\u0026\u0026typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)\u0026\u0026n!==\"default\"\u0026\u0026i(a,n,{get:()=\u003es[n],enumerable:!(c=p(s,n))||c.enumerable});return a},y=a=\u003eg(t(i(a!=null?d(m(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=N((S,o)=\u003e{o.exports=_jsx_runtime});var v={};k(v,{default:()=\u003ew,frontmatter:()=\u003e_});var e=y(r()),_={title:\"Stop Making Your S3 Buckets Public! A Guide to Presigned URLs\",date:\"2025-11-15\",tags:[\"Terraform\",\"Cloud\",\"AWS\"],draft:!1,summary:\"Learn how to use S3 Presigned URLs to securely share private files without ever making your bucket public.\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({p:\"p\",strong:\"strong\",a:\"a\",h2:\"h2\",span:\"span\",ul:\"ul\",li:\"li\",code:\"code\",pre:\"pre\",ol:\"ol\"},a.components),{Image:l}=n;return l||f(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:['A developer needs to share a file from cloud storage. What do they do? They go to the S3 console, click \"Properties,\" \"Permissions,\" and set the bucket to... \"',(0,e.jsx)(n.strong,{children:\"Public\"}),'\".']}),(0,e.jsx)(n.p,{children:\"As a security guy, this is the moment my eye starts to twitch uncontrollably.\"}),(0,e.jsx)(n.p,{children:`Making a bucket \"public\" is the cloud equivalent of leaving your house keys taped to the front door with a giant \"COME ON IN!\" sign. It's a \"Resume-Generating Event,\" as in, you'll need to update your resume after you get fired.`}),(0,e.jsx)(n.p,{children:\"The other day at work, I ran into a classic version of this problem. Algorithm team has a new service (on Tencent Cloud, actually) that generates an image. This image needs to be seen by our end user, maybe internal staff or maybe even an external partner.\"}),(0,e.jsx)(n.p,{children:\"So, how do you let someone access one file in a private bucket, just one time, without giving them the keys to the entire kingdom?\"}),(0,e.jsxs)(n.p,{children:[\"The answer is simple and beautiful: \",(0,e.jsx)(n.a,{href:\"https://docs.aws.amazon.com/AmazonS3/latest/userguide/ShareObjectPreSignedURL.html\",children:\"Presigned URLs\"}),\".\"]}),(0,e.jsx)(n.p,{children:\"To prove how cool this is, I decided to build a minimal demo from scratch using my AWS Free Tier. (Hey, you gotta keep your hands dirty, right?)\"}),(0,e.jsxs)(n.h2,{id:\"what-the-heck-is-an-s3-presigned-url\",children:[(0,e.jsx)(n.a,{href:\"#what-the-heck-is-an-s3-presigned-url\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What the Heck is an S3 Presigned URL?\"]}),(0,e.jsx)(n.p,{children:\"Think of it like a magical, single-use, self-destructing ticket to a VIP club.\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"The Club (Your S3 Bucket)\"}),\": Is 100% private. The bouncer (AWS) checks everyone at the door.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"The Ticket (The Presigned URL)\"}),\": You (a trusted IAM identity) generate this special ticket. It has a cryptographic signature baked right into the URL query string.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"The Rules\"}),': The signature basically tells the bouncer: \"This person is with me. Let them ',(0,e.jsx)(n.strong,{children:\"GET\"}),\" the file \",(0,e.jsx)(n.code,{children:\"order-123.jpg\"}),\"... but \",(0,e.jsx)(n.strong,{children:\"only for the next 5 minutes\"}),'.\"']})]}),(0,e.jsx)(n.p,{children:\"After 5 minutes, that URL is just a useless string of text (it gives a 403 Access Denied error).\"}),(0,e.jsx)(n.p,{children:\"In another words, your S3 bucket stays 100% private. (No, really. Don't you dare touch that public access block.)\"}),(0,e.jsx)(n.p,{children:\"You never share your permanent Access Keys. The signature in the URL is temporary.\"}),(0,e.jsx)(n.p,{children:\"Access is temporary. You set the expiration. 60 seconds? 10 minutes? You're the boss.\"}),(0,e.jsx)(n.p,{children:\"Access is specific. This URL might only work for a GET (download) or a PUT (upload), and only for one specific file.\"}),(0,e.jsxs)(n.h2,{id:\"building-the-fortress-with-terraform\",children:[(0,e.jsx)(n.a,{href:\"#building-the-fortress-with-terraform\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Building the Fortress (with Terraform)\"]}),(0,e.jsx)(n.p,{children:`In the modern cloud world, we don't \"click around in the console.\" That's called \"ClickOps,\" and it's how mistakes happen. We use Infrastructure as Code (IaC) to build our environment so it's repeatable and secure.`}),(0,e.jsx)(n.p,{children:\"Here\\u2019s my main.tf script to build a fortress-like S3 setup.\"}),(0,e.jsx)(n.pre,{className:\"language-hcl\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-hcl\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"terraform\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"required_providers\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"aws\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"source\"}),\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"hashicorp/aws\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"~\u003e 5.0\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"provider\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"aws\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"region\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"us-east-1\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Generate a random suffix to keep the bucket name unique\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"random_id\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"suffix\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"byte_length\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create the S3 bucket\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_s3_bucket\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"demo_bucket\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"bucket\"}),\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"presigned-demo-',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"random_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"suffix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"hex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"force_destroy\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Good for demos, NOT for prod!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Purpose\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"PresignedURLDemo\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# BLOCK ALL PUBLIC ACCESS. This is the most important part.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_s3_bucket_public_access_block\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"demo_block\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"bucket\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_s3_bucket.demo_bucket.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"block_public_acls\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"block_public_policy\"}),\"\\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"ignore_public_acls\"}),\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"restrict_public_buckets\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enable server-side encryption by default\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_s3_bucket_server_side_encryption_configuration\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"demo_encryption\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"bucket\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_s3_bucket.demo_bucket.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"rule\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"apply_server_side_encryption_by_default\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"sse_algorithm\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"AES256\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Enable versioning (good practice)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_s3_bucket_versioning\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"demo_versioning\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"bucket\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_s3_bucket.demo_bucket.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"versioning_configuration\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"status\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Enabled\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Add a lifecycle rule to delete demo files after 7 days\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_s3_bucket_lifecycle_configuration\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"demo_lifecycle\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"bucket\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_s3_bucket.demo_bucket.id\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"rule\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"id\"}),\"\\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"delete-after-7-days\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"status\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Enabled\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"filter\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"prefix\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Apply to all objects\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"expiration\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"days\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"7\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create an IAM user (for demo purposes)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_user\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"presigned_user\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"presigned-demo-user-',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"random_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"suffix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"hex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"tags\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Purpose\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"PresignedURLDemo\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create a minimal IAM policy\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_policy\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"presigned_policy\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"name\"}),\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"presigned-demo-policy-',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"random_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"suffix\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"hex\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'\"']}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow minimal S3 access for presigned URL demo\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"policy\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" jsonencode(\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Version\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2012-10-17\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Statement\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:GetObject\"'}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:PutObject\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string\",children:['\"',(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"$\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"aws_s3_bucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"demo_bucket\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"arn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),'/*\"']}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Only on objects\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`,\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Effect\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Allow\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Action\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"s3:ListBucket\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" aws_s3_bucket.demo_bucket.arn \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Only on the bucket itself\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`)\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Attach the policy to the user\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_user_policy_attachment\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"attach_policy\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"user\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_user.presigned_user.name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"policy_arn\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_policy.presigned_policy.arn\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create access keys for the demo user\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"resource \",(0,e.jsx)(n.span,{className:\"token type variable\",children:'\"aws_iam_access_key\"'})]}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"demo_key\"'}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"user\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_user.presigned_user.name\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# --- Outputs ---\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"bucket_name\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_s3_bucket.demo_bucket.bucket\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"S3 bucket name\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"bucket_region\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_s3_bucket.demo_bucket.region\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"S3 bucket region\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"access_key_id\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_access_key.demo_key.id\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"AWS Access Key ID\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"sensitive\"}),\"\\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token keyword\",children:[\"output\",(0,e.jsx)(n.span,{className:\"token type variable\",children:' \"secret_access_key\" '})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"value\"}),\"\\xA0 \\xA0 \\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),` aws_iam_access_key.demo_key.secret\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"description\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"AWS Secret Access Key\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \",(0,e.jsx)(n.span,{className:\"token property\",children:\"sensitive\"}),\"\\xA0 \\xA0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"I run terraform apply, and poof! My environment is ready. Look at that beautiful, private, encrypted, and locked-down setup.\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/s3_t_1.png\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/s3_t_2.png\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/s3_t_3.png\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/s3_t_4.png\"}),(0,e.jsx)(l,{width:600,src:\"/static/images/terraform/s3_t_5.png\"}),(0,e.jsxs)(n.h2,{id:\"the-secret-handshake-with-python\",children:[(0,e.jsx)(n.a,{href:\"#the-secret-handshake-with-python\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),'The \"Secret Handshake\" (with Python)']}),(0,e.jsx)(n.p,{children:\"Okay, the fortress is built. Now I need to simulate the real business logic. I'll use Python and the boto3 library.\"}),(0,e.jsx)(n.p,{children:\"The script will do two things:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:['Act 1 (Simulate the \"',(0,e.jsx)(n.strong,{children:\"Algorithm Team\"}),'\"): Generate a presigned URL to ',(0,e.jsx)(n.strong,{children:\"UPLOAD\"}),\" a file (PUT).\"]})}),(0,e.jsx)(n.li,{children:(0,e.jsxs)(n.p,{children:['Act 2 (Simulate the \"',(0,e.jsx)(n.strong,{children:\"End User\"}),'\"): Generate a presigned URL to ',(0,e.jsx)(n.strong,{children:\"DOWNLOAD\"}),\" that file (GET).\"]})})]}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#!/usr/bin/env python3\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`Simple S3 Presigned URL Demo\n`})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:`Upload and download files using presigned URLs\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token string triple-quoted-string\",children:'\"\"\"'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` boto3\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),` requests\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# ========================================\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Configuration - Replace with your values\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# ========================================\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"BUCKET_NAME \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"presigned-demo-dd12e798\"'}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# I got this from my terraform output\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"REGION \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"us-east-1\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"LOCAL_FILE \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ud.jpg\"'}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# A test image I have\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"OBJECT_KEY \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ud.jpg\"'}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# The name it will have in S3\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# ========================================\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Main Demo\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# ========================================\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"main\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"=== S3 Presigned URL Demo ===\\\\n\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0\\xA0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Create S3 client\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Creating S3 client for region: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"REGION\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Boto3 will find the keys from my ~/.aws/credentials file\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 s3_client \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" boto3\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'s3'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" region_name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"REGION\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0\\xA0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 1: Generate presigned URL for upload (PUT)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n1. Generating presigned URL for upload (expires in 600 seconds)...\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 upload_url \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" s3_client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"generate_presigned_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 ClientMethod\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'put_object'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 Params\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Bucket'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" BUCKET_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Key'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" OBJECT_KEY\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'ContentType'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'image/jpeg'\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Important for uploads!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 ExpiresIn\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"600\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# 10 minutes\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0Upload URL: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"upload_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token format-spec\",children:\"80]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'...\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0\\xA0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 2: Upload file using presigned URL\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# We use 'requests' here to act like a client that does NOT have AWS keys\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n2. Uploading '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"LOCAL_FILE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:' using presigned URL...\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"LOCAL_FILE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'rb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 response \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"put\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 upload_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 data\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Content-Type'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'image/jpeg'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0\\xA0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"status_code \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0\\u2713 Upload successful!\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0\\u2717 Upload failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"status_code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0Error: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0\\xA0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 3: Generate presigned URL for download (GET)\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n3. Generating presigned URL for download (expires in 300 seconds)...\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 download_url \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" s3_client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"generate_presigned_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 ClientMethod\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'get_object'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 Params\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Bucket'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" BUCKET_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Key'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` OBJECT_KEY\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 ExpiresIn\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"300\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# 5 minutes\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 _ \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0Download URL: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"download_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),(0,e.jsx)(n.span,{className:\"token format-spec\",children:\"80]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'...\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0\\xA0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# Step 4: Download file using presigned URL\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\\\n4. Downloading file using presigned URL...\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 response \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"download_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0\\xA0\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"status_code \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 output_file \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"downloaded_ud.jpg\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"with\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"open\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"output_file\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'wb'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \\xA0 \\xA0 f\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"write\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"content\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string-interpolation\",children:(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0\\u2713 Download successful!\"'})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0File saved as: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"output_file\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0File size: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"content\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:' bytes\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"else\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 \\xA0 \\xA0 \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"\\xA0 \\xA0\\u2717 Download failed: '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"status_code\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" __name__ \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"__main__\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0 main\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"And look at the result! It just works.\"}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"base\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),` ss@ss:~/s3_1113$ python3 demo.py\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" S3 Presigned URL Demo \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"Creating S3 client \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),` region: us-east-1\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\". Generating presigned URL \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" upload \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"expires \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"600\"}),\" seconds\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0Upload URL: https://presigned-demo-dd12e798.s3.amazonaws.com/ud.jpg?AWSAccessKeyId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"AKIAXDJLS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),\". Uploading ud.jpg using presigned URL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0\\u2713 Upload successful\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),\". Generating presigned URL \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" download \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"expires \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"300\"}),\" seconds\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0Download URL: https://presigned-demo-dd12e798.s3.amazonaws.com/ud.jpg?AWSAccessKeyId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"AKIAXDJLS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),\". Downloading \",(0,e.jsx)(n.span,{className:\"token function\",children:\"file\"}),\" using presigned URL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0\\u2713 Download successful\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\\xA0 \\xA0File saved as: downloaded_ud.jpg\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"\\xA0 \\xA0File size: \",(0,e.jsx)(n.span,{className:\"token number\",children:\"65049\"}),` bytes\n`]})]})}),(0,e.jsx)(n.p,{children:\"The requests library, which has zero idea about my AWS keys, was able to both upload and download a file to my 100% private S3 bucket. That's the magic.\"}),(0,e.jsxs)(n.h2,{id:\"ok-but-how-do-you-do-this-in-production\",children:[(0,e.jsx)(n.a,{href:\"#ok-but-how-do-you-do-this-in-production\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"OK, But How Do You Do This in Production?\"]}),(0,e.jsxs)(n.p,{children:[\"My demo was great, but I used a long-term \",(0,e.jsx)(n.strong,{children:\"IAM User\"}),\" key (aws_iam_access_key) stored on my laptop.\"]}),(0,e.jsxs)(n.p,{children:[\"In a real production environment... \",(0,e.jsx)(n.strong,{children:\"NEVER DO THIS\"}),\".\"]}),(0,e.jsx)(n.p,{children:\"Storing static, long-lived access keys in your application code is a massive security risk. If those keys ever leak, a hacker has a permanent key to your S3 bucket.\"}),(0,e.jsxs)(n.p,{children:['In a real, \"grown-up\" architecture, you use a \"',(0,e.jsx)(n.strong,{children:\"Signing Service\"}),'\" pattern.']}),(0,e.jsxs)(n.ol,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Create a dedicated AWS Lambda function\"}),`. Its only job is to generate these presigned URLs. Let's call it the \"URL-Signing-Guy.\"`]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Give the Lambda an IAM Role (not a User!)\"}),'. This role is a temporary identity that the Lambda \"wears\" when it runs. This role has a very strict policy: ',(0,e.jsx)(n.code,{children:\"s3:GetObject\"}),\" and \",(0,e.jsx)(n.code,{children:\"s3:PutObject\"}),\" only for your specific bucket.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Put an API Gateway in front of the Lambda\"}),\". Your main application (the algorithm service) doesn't call S3 directly. It calls your own secure API endpoint (e.g., POST \",(0,e.jsx)(n.code,{children:\"/api/v1/get-upload-url\"}),\").\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Strengthen the S3 Bucket Policy\"}),`. This is the expert-level move. You add a Bucket Policy to S3 that says: \"I will only accept GetObject or PutObject requests IF they come from the 'URL-Signing-Guy' Lambda's IAM Role.\"`]})]})]})}}var w=b;function f(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return v;})();\n;return Component;","toc":[{"value":"What the Heck is an S3 Presigned URL?","url":"#what-the-heck-is-an-s3-presigned-url","depth":2},{"value":"Building the Fortress (with Terraform)","url":"#building-the-fortress-with-terraform","depth":2},{"value":"The \"Secret Handshake\" (with Python)","url":"#the-secret-handshake-with-python","depth":2},{"value":"OK, But How Do You Do This in Production?","url":"#ok-but-how-do-you-do-this-in-production","depth":2}],"frontMatter":{"readingTime":{"text":"13 min read","minutes":12.74,"time":764400,"words":2548},"slug":"terraform/terraform_sec_6_presigned","fileName":"terraform/terraform_sec_6_presigned.md","title":"Stop Making Your S3 Buckets Public! A Guide to Presigned URLs","date":"2025-11-15T00:00:00.000Z","tags":["Terraform","Cloud","AWS"],"draft":false,"summary":"Learn how to use S3 Presigned URLs to securely share private files without ever making your bucket public."}},"authorDetails":[{"readingTime":{"text":"1 min read","minutes":0.72,"time":43200,"words":144},"slug":["default"],"fileName":"default.md","name":"Ted","avatar":"/static/images/avatar.jpg","occupation":"CISSP, CKS, AWS Certified Security – Specialty, Microsoft Cybersecurity Architect Expert","email":"nerd@supasaf.com","twitter":"https://twitter.com/supasaf","date":null}],"prev":{"title":"InfoSec Architect 102-Service Accounts in the Linux Universe","date":"2025-10-08T00:00:00.000Z","tags":["Architect"],"draft":false,"summary":"This hands-on guide walks you through setting up Kerberos and LDAP on Ubuntu to achieve secure, password-free database access for service accounts, inspired by real-world practices at Uber.","images":[],"slug":"general/kerberos_ldap"},"next":null},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["terraform","terraform_sec_6_presigned"]},"buildId":"PHX-ldckUn2p0ORkOJq2c","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>